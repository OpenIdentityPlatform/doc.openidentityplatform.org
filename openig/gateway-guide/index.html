<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <style type="text/css">
   /*
* The contents of this file are subject to the terms of the Common Development and
* Distribution License (the License). You may not use this file except in compliance with the
* License.
*
* You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the
* specific language governing permission and limitations under the License.
*
* When distributing Covered Software, include this CDDL Header Notice in each file and include
* the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL
* Header, with the fields enclosed by brackets [] replaced by your own identifying
* information: "Portions copyright [year] [name of copyright owner]".
*
* Copyright 2015 ForgeRock AS.
* Portions copyright 2024 3A Systems LLC.
*/

/***********************************/
/* Imported Styles
/***********************************/

@import url(https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,300,400,700);
@import url(https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css);
@import url(https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css);
/* @import url(https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css); */
@import url(https://cdnjs.cloudflare.com/ajax/libs/jquery.colorbox/1.4.33/example1/colorbox.css);

/***********************************/
/* General Styles
/***********************************/

html {
    height: 100%;
}

body {
    /* Dark Grey */

    color: #2a2f32;
    font-family: 'Open Sans', "proxima-nova", sans-serif;
}

a {
    /* Sea Green */
    color: #519387;
}

a.link[href^="http"] {
    background-image: url("includes/logos/Icon_External_Link.png");
    background-position: top right;
    background-repeat: no-repeat;
    padding-right: 15px;
    margin-right: 2px;
}

a.self-link, a.self-link:hover, a.self-link:active {
    color: inherit;
    text-decoration: none;
}

a[href].self-link:hover::after
{
    -moz-osx-font-smoothing: grayscale;
    content: "\e144";
    color: #519387;
    display: inline-block;
    font-family: "Glyphicons Halflings";
    font-size: 75%;
    font-style: normal;
    line-height: 1;
    padding-left: 5px;
    position: relative;
    top: 1px;
}


li.L0,
li.L1,
li.L2,
li.L3,
li.L5,
li.L6,
li.L7,
li.L8 {
    list-style-type: decimal !important
}

.section,
.chapter,
.preface,
.glossary,
.refentry,
.reference,
.appendix,
.index,
.titlepage h2,
.titlepage h3,
.titlepage h4,
.titlepage h5 {
    padding-top: 60px;
    margin-top: -50px;
}

.left-shape-content {
    background: url("includes/logos/left-shape-4.png") no-repeat scroll 0 0 rgba(0, 0, 0, 0);
    float: left;
    height: 566px;
    position: fixed;
    width: 57px;
    top: 60%;
    z-index: -1;
}

/***********************************/
/* Bootstrap Override Styles
/***********************************/

/* Button Styles */

.btn-primary {
    /* Sea Green */
    background-color: #519387;

    /* Dark Sea Green */
    border-color: #488378;
    color: #fff;
}

.btn-default {
    background-color: #A1A8AD;
    border-color: #8a9298;
    color: #ffffff;
}

.btn-default:hover,
.btn-default:focus,
.btn-default.focus,
.btn-default:active,
.btn-default.active,
.open > .dropdown-toggle.btn-default {
    background-color: #3f4b54;
    border-color: #1B2025;
    color: #ffffff;
}

/* Tooltip Styles */

.tooltip.in {
    opacity: 0.95;
}

.tooltip.bottom .tooltip-arrow {
    border-bottom-color: #519387;
}

.tooltip-inner {
    background-color: #519387;
}

/* List Styles */

.dl-horizontal dt {
    white-space: normal;
    padding: 0 3px 0 0;
    width: 200px;
}

.dl-horizontal dd {
    border-bottom: 1px dotted rgb(125, 179, 168);
    border-bottom: 1px dotted rgba(125, 179, 168, 0.8);
    margin-bottom: 18px;
    margin-left: 210px;
}

.dl-horizontal {
    border-top: 1px dotted rgb(125, 179, 168);
    border-top: 1px dotted rgba(125, 179, 168, 0.9);
    padding-top: 10px;
}

.variablelist dt {
    margin: 18px 0 5px 15px;
}

.variablelist dd {
    border-bottom: 1px dotted rgba(125, 179, 168, 0.8);
    margin: 5px 0 5px 30px;
}

.variablelist > dl {
    border-top: 1px dotted rgba(125, 179, 168, 0.8);
}


/***********************************/
/* Redirect Page Styles
/***********************************/

.index-redirect,
.index-redirect body {
    height: 100%;
    background-color: #333;
    font-family: 'Open Sans', "proxima-nova", sans-serif;
}
.index-redirect body {
    color: #fff;
    text-align: center;
}
.index-redirect .container {
    display: table;
    vertical-align: middle;
    height: 100%;
}
.index-redirect .btn-primary {
    /* Sea Green */
    background-color: #519387;

    /* Dark Sea Green */
    border-color: #488378;
    color: #fff;
}
.index-redirect .cover-heading {
    font-weight: 400 !important;
}
.index-redirect .vertical-center-row {
    display: table-cell;
    vertical-align: middle;
}

/***********************************/
/* Header Styles
/***********************************/

.navbar-brand {
    padding: 7px 15px;
    display: flex;
    align-items: center;
}
.navbar-brand > img {
    height: 100%;
}

.navbar.navbar-inverse.navbar-fixed-top {
    box-shadow: 0 0 10px 2px #111;
}
.nav > li > a {
    font-weight: 200;
}

/***********************************/
/* Banner Styles
/***********************************/

.jumbotron {
    /* Sea Green */
    background: url("includes/logos/hero-bg-01.png") no-repeat scroll left top #519387;
    color: white;
    box-shadow: 0 0 10px 2px grey;
    margin-top: 50px;
    padding: 0 0 10px;
}
.jumbotron small {
    color: white;
}
.jumbotron p {
    font-size: 12px;
    font-weight: 400;
    margin-bottom: 5px;
}
.jumbotron h1 {
    font-size: 23px !important;
    font-weight: 300 !important;
}

/***********************************/
/* Table of Contents Styles
/***********************************/

#sidebar .nav>li>a {
    /* Light Grey */

    color: #777;
    border-left: 4px solid transparent;
    padding: 4px 10px;
    font-size: 13px;
    font-weight: 400;
}
/* nested links */

#sidebar .nav .nav>li>a {
    padding-top: 2px;
    padding-bottom: 2px;
    padding-left: 30px;
    font-size: 12px;
}
/* nested nested links */

#sidebar .nav .nav .nav>li>a {
    font-size: 11px;
    padding-bottom: 2px;
    padding-left: 50px;
    padding-top: 4px;
}
/* nested nested nested links */

#sidebar .nav .nav .nav .nav>li>a {
    font-size: 11px;
    padding-bottom: 2px;
    padding-left: 70px;
    padding-top: 4px;
}
/* active and hover links */

#sidebar .nav>.active>a,
#sidebar .nav>.locked-active>a,
#sidebar .nav>li>a:hover,
#sidebar .nav>li>a:focus {
    text-decoration: none;
    /*
    background-color: rgb(125, 179, 168, 0.8);
    background-color: rgba(125, 179, 168, 0.8);
    border-color: rgb(45, 52, 55, 0.8);
    border-color: rgba(45, 52, 55, 0.8);
    color: white;
    */
    /* Bright Yellow */

    background-color: #eeea07;
    border-color: #eeea07;
    /* Grey */

    color: #2a2f32;
}
/* all active links */

#sidebar .nav>.active>a,
#sidebar .nav>.active:hover>a,
#sidebar .nav>.active:focus>a {
    font-weight: 600;
}
/* nested active links */

#sidebar .nav .nav>.active>a,
#sidebar .nav .nav>.active:hover>a,
#sidebar .nav .nav>.active:focus>a {
    font-weight: 400;
}
/* nested nested active links */

#sidebar .nav .nav .nav>.active>a,
#sidebar .nav .nav .nav>.active:hover>a,
#sidebar .nav .nav .nav>.active:focus>a {
    font-weight: 300;
}
/* nested nested active links */

#sidebar .nav .nav .nav>.active>a,
#sidebar .nav .nav .nav>.active:hover>a,
#sidebar .nav .nav .nav>.active:focus>a {
    font-weight: 300;
}
/* hide all (inactive) nested list */

#sidebar .nav ul.nav {
    display: none;
}
/* show active nested list */

#sidebar .nav>.active>ul.nav {
    display: block;
}
#sidebar.affix {
    top: 66px;
    position: fixed;
    bottom: 30px;
    height: auto;
    overflow-y: scroll;
}
#sidebar.affix-bottom {
    position: absolute;
}

/***********************************/
/* Content Styles
/***********************************/

/* Main Content Styles */

h1 {
    font-size: 40px !important;
    font-weight: 700 !important;
}

h1 span {
    margin-right: .3em;
}

#doc-content h1,
#doc-content .h1 {
    /* Sea Green */
    border-bottom: 2px solid #70ab9b;
    font-size: 36px;
    margin-top: 24px;
    padding-bottom: 5px;
}

h2 {
    font-size: 32px !important;
    font-weight: 700 !important;
}

h5, .h5 {
    border-bottom: 1px solid #d3d3d3;
    font-size: 16px;
    padding-bottom: 4px;
    font-style: italic;
}

.anchorjs-link .anchorjs-icon {
    color: #A1A8AD;
    text-decoration: none;
}
.anchorjs-link:hover .anchorjs-icon {
    color: #519387;
    text-decoration: none;
}

h1:hover > .anchorjs-link,
h2:hover > .anchorjs-link,
h3:hover > .anchorjs-link,
h4:hover > .anchorjs-link,
h5:hover > .anchorjs-link,
.anchorjs-link:focus {
    opacity: 1 !important;
    transition: color 0.16s linear 0s;
    text-decoration: none;
}

.chapter > p:first-of-type,
.preface > p:first-of-type {
    font-size: 21px;
    font-weight: 300;
    line-height: 1.4;
    margin-bottom: 20px;
}

#doc-content {
    padding: 0 20px 85px 10px;
}

div.procedure, div.table {
    margin-top:-50px;
    padding-top: 60px;
}

div.procedure-title, div.table-title {
    margin: 6px 0 8px;
}

div.procedure-inner {
    border-color: lightslategray;
    border-left: 6px solid lightslategray;
    border-style: dotted dotted dotted solid;
    border-width: 1px 1px 1px 6px;
    margin: 15px 0 10px;
    padding: 10px 15px 10px 10px;
}

.author {
    display: inline;
}

.table {
    font-size: 14px;
}

div.simplelist {
    margin-bottom: 10px;
    width: 100%;
    font-size: 15px;
}

/* Title Styles */

.procedure-title > a, .procedure-title > a:hover {
    color: lightslategray;
    font-size: 14pt;
    font-weight: 400;
}

.itemizedlist-title {
    font-size: 18px;
    font-weight: 600;
    margin: 12px 0 6px;
}

.figure-title {
    font-weight: bold;
    margin: 16px 0 4px;
    text-align: center;
}

.table-title {
    font-size: 12pt;
    font-weight: 700;
}

.variablelist-title {
    font-weight: bold;
    margin: 10px 0;
    text-decoration: underline;
}

/* Code Styles */

.btn-copy-cmdline,
.btn-copy-codelisting {
    /* White */

    background-color: #fff;
    /* Light Grey */

    border: 1px solid #e1e1e8;
    border-radius: 0 4px;
    color: #777;
    display: block;
    font-size: 12px;
    padding: 5px 8px;
    position: absolute;
    right: 5px;
    top: 5px;
    z-index: 10;
}

pre.prettyprint {
    border: 1px solid #ccc;
    padding: 9.5px;
    font-size: 12px;
}

.zero-clipboard {
    display: block;
    position: relative;
}
.zeroclipboard-is-hover {
    /* Light Sea Green */

    background-color: #6faa9b;
    border-color: #6faa9b;
    color: #fff;
    cursor: pointer;
}

.ui-effects-transfer {
    border: 1px dotted black;
    background-color: yellow;
    opacity: 0.4;
}

/* Modal Dialog Styles */

#doc-content .modal h1.title {
    font-size: 40px !important;
    font-weight: 500 !important;
    margin: 14px 0 5px;
}
#doc-content .modal h2.subtitle {
    font-size: 26px !important;
    font-weight: 400 !important;
    margin-bottom: 26px;
}
#doc-content .modal h3.author {
    font-size: 14px !important;
    font-style: italic;
    font-weight: 100 !important;
    margin: 4px 0 5px 18px;
}
#doc-content .modal .affiliation .orgname {
    display: block;
    font-size: 20px !important;
    font-weight: 400 !important;
    margin: 20px 0 0 0;
}
#doc-content .modal .affiliation .address p {
    font-size: 16px !important;
    font-weight: 100 !important;
    margin: 4px 0;
}
#doc-content .modal .copyright {
    display: none;
}
#doc-content .modal .copyright {
    display: none;
}
#doc-content .modal .abstract .abstract-title {
    font-size: 20px !important;
    font-weight: 400 !important;
}
#doc-content .modal .abstract > p {
    margin: 10px 0 5px 20px;
    font-size: 16px !important;
    font-weight: 100 !important;
}

/* Image Styles */

.fancybox > img {
    cursor: zoom-in;
}
a.fancybox {
    text-decoration: none;
}

#cboxTitle {
    color: #519387;
    font-size: 14px;
    font-weight: 700;
}

#cboxOverlay{
    background: none repeat scroll 0 0 rgba(66, 130, 116, 0.6);
}

img.img-responsive {
    margin-bottom: 20px;
}

/* Index Styles */

.indexdiv > h3 {
    border-bottom: 2px dotted lightgrey;
    padding-bottom: 5px;
}
.indexdiv > dl {
    margin-left: 30px;
}
.indexdiv dl {
    margin-bottom: 5px;
}
.indexdiv dt {
    margin: 5px 0 2px;
}
.indexdiv dd {
    margin-left: 35px;
}
.indexdiv .indexterm {
    font-weight: 200;
}

/* Reference Styles */

.refnamediv h2 {
    display: none;
}

.refsect1 h2,
.refsynopsisdiv h2 {
    font-size: 20px !important;
    font-weight: 400 !important;
}

.refnamediv p {
    font-size: 32px !important;
    font-weight: 700 !important;
}

/***********************************/
/* Footer Styles
/***********************************/

.back-to-top {
    position: fixed;
    bottom: 55px;
    right: 5px;
    display: none;
    z-index: 15;
}

#footer {
    display: none;
}

.footer {
    /* Light Grey */
    background-color: #f5f5f5;

    /* Medium Grey */
    border-top: 1px solid #ACB5BD;
    bottom: 0;
    font-size: 12px;
    height: 30px;
    padding-top: 4px;
    position: fixed;
    width: 100%;
    z-index: 100;
}

.footer h3 {
    margin: 0;
}

.footer a:hover {
    text-decoration: none;
}

.footer-item {
    line-height: 22px;
    margin-left: 10px;
}

.footer-item.highlighted {
    /* Orange */
    color: #f7a540;
}

.footer-item.highlighted:hover {
    /* Dark Orange */
    color: #c97208;
}

.footer span {
    /* Grey */
    color: #2a2f32;
    margin-bottom: 0;
}

.footer .footer-left {
    float: left;
}

.footer .footer-right {
    float: right;
}

/***********************************/

  </style><meta name="viewport" content="width=device-width, initial-scale=1"><title>Guide to OpenIG</title><script src="https://code.jquery.com/jquery-1.11.2.min.js" type="text/javascript"></script><script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js" type="text/javascript"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><script type="text/javascript">
     /*
 * The contents of this file are subject to the terms of the Common Development and
 * Distribution License (the License). You may not use this file except in compliance with the
 * License.
 *
 * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the
 * specific language governing permission and limitations under the License.
 *
 * When distributing Covered Software, include this CDDL Header Notice in each file and include
 * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL
 * Header, with the fields enclosed by brackets [] replaced by your own identifying
 * information: "Portions copyright [year] [name of copyright owner]".
 *
 * Copyright 2015 ForgeRock AS.
 */

//

var loadJavaScriptsFN = function () {
    $.ajaxSetup({ cache: true });
    $.getScript("http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js", function () { prettyPrint() });
    $.getScript("http://cdnjs.cloudflare.com/ajax/libs/zeroclipboard/2.2.0/ZeroClipboard.min.js", function () {enableZeroClipboardFN() });
    $.getScript("http://cdnjs.cloudflare.com/ajax/libs/jquery.colorbox/1.4.33/jquery.colorbox-min.js", function () { enableColorboxFN() });
};

var wrapConfigurablesFn = function () {
    $('*:contains("https://openam.example.com:8443")').each(function(){
        if($(this).children().length < 1)
            $(this).html(
                $(this).text().replace(new RegExp("https://openam.example.com:8443", 'g'),'<span class="exampleUrl">https://openam.example.com:8443</span>')
            )
    });
    $('*:contains("amadmin")').each(function(){
        if($(this).children().length < 1)
            $(this).html(
                $(this).text().replace(new RegExp("amadmin", 'g'),'<span class="exampleAdmin">amadmin</span>')
            )
    });
    $('*:contains("iPlanetDirectoryPro")').each(function(){
        if($(this).children().length < 1)
            $(this).html(
                $(this).text().replace(new RegExp("iPlanetDirectoryPro", 'g'),'<span class="exampleSsoCookieName">iPlanetDirectoryPro</span>')
            )
    });
};

var btnClickHandler = function () {
    $("button#applyDocUpdate").click(function(){

        $('span.exampleUrl').fadeOut("slow", function(){
            $('span.exampleUrl').text($("input#exampleUrl").val());
            $('span.exampleUrl').fadeIn("slow");
        });

        $('span.exampleAdmin').fadeOut("slow", function(){
            $('span.exampleAdmin').text($("input#exampleAdmin").val());
            $('span.exampleAdmin').fadeIn("slow");
        });

        $('span.exampleSsoCookieName').fadeOut("slow", function(){
            $('span.exampleSsoCookieName').text($("input#exampleSsoCookieName").val());
            $('span.exampleSsoCookieName').fadeIn("slow");
        });

        $('#docConfig').modal('hide');
    });
};


var addCopyButtonFN = function () {
    $( ".cmdline" ).each(function() {
        $(this).before('<div class="zero-clipboard hidden-xs"><span class="btn-copy-cmdline"><span class="glyphicon glyphicon-pencil"></span> Copy<span class="hidden-sm"> command to clipboard</span></span></div>');
    });

    $( ".codelisting" ).each(function() {
        $(this).before('<div class="zero-clipboard hidden-xs"><span class="btn-copy-codelisting"><span class="glyphicon glyphicon-pencil"></span> Copy<span class="hidden-sm"> code to clipboard</span></span></div>');
    });
};
var enableScrollSpyFN = function () {
    $('body').scrollspy({
        target: '#sidebar',
        offset: 16
    });
};

var enableToolTipFN = function () {
    $(function () {
        $("[data-toggle='tooltip']").tooltip({placement: 'bottom'});
    });
};

var enableBackToTopFadeInFN = function () {
    var offset = 220;
    var duration = 500;
    $(window).scroll(function() {
        if ($(this).scrollTop() > offset) {
            $('.back-to-top').fadeIn(duration);
        } else {
            $('.back-to-top').fadeOut(duration);
        }
    });

    $('.back-to-top').click(function(event) {
        event.preventDefault();
        $('html, body').animate({scrollTop: 0}, duration);
        return false;
    })
};

var enableClampedWidthsFN = function () {

    /*
     * Clamped-width.
     * Usage:
     *  <div data-clampedwidth=".myParent">This long content will force clamped width</div>
     *
     * Author: LV
     */
    $('[data-clampedwidth]').each(function () {
        var elem = $(this);
        var parentPanel = elem.data('clampedwidth');
        var resizeFn = function () {
            var sideBarNavWidth = $(parentPanel).width() - parseInt(elem.css('paddingLeft')) - parseInt(elem.css('paddingRight')) - parseInt(elem.css('marginLeft')) - parseInt(elem.css('marginRight')) - parseInt(elem.css('borderLeftWidth')) - parseInt(elem.css('borderRightWidth'));
            elem.css('width', sideBarNavWidth);
        };

        resizeFn();
        $(window).resize(resizeFn);
    });
};

var affixToCFN = function() {
    $('#sidebar').affix({
        offset: {
            top: function () {
                return (this.top = $('.jumbotron').outerHeight(true)-66)
            }
        }
    });
};

var attachAnchorsToHeadings = function() {
    //addAnchors('h1.title, h2.title, h3.title, h4.title, h5.title');


    $('h1.title, h2.title, h3.title, h4.title, h5.title, .procedure-title, .table-title').each(function () {

        var href = $(this).closest("div[id]").attr("id");

        if (href === undefined || href === "") { // Unable to locate ID of parent element.
            return;
        }

        $(this).wrapInner('<a class=\"self-link" href=\"#' + href + '\"></a>');

    });
};

var addZeroClipboardToCmdlineButtonsFN = function () {
    var copycmdline = new ZeroClipboard( $('.btn-copy-cmdline') );

    copycmdline.on( 'ready', function(event) {
        // console.log( 'movie is loaded' );

        copycmdline.on( 'copy', function(event) {
            var wrappedText = "";
            $(event.target).parent().next().find("strong").each(function(index) {
                wrappedText += $(this).text() + "\n";
            });
            event.clipboardData.setData('text/plain', wrappedText);
        });

        copycmdline.on( 'aftercopy', function(event) {
            // console.log('Copied to clipboard: ' + event.data['text/plain']);
            $(event.target).parent().next().find("strong").each(function(index) {
                $(this).effect("transfer", { to: $(event.target)}, 750);
            });
        });
    });

    copycmdline.on( 'error', function(event) {
        console.log( 'ZeroClipboard error of type "' + event.name + '": ' + event.message );
        ZeroClipboard.destroy();
    });
};

var addZeroClipboardToCodeButtonsFN = function () {
    var copycodelisting = new ZeroClipboard( $('.btn-copy-codelisting') );

    copycodelisting.on( 'ready', function(event) {
        //console.log( 'movie is loaded' );

        copycodelisting.on( 'copy', function(event) {
            var wrappedText = "";
            $(event.target).parent().next(".codelisting.linenums").children().contents().each(function(index) {
                wrappedText += $(this).text() + "\n";
            });
            if(wrappedText == "") {
                wrappedText = $(event.target).parent().next(".codelisting").contents().text();
            };
            event.clipboardData.setData('text/plain', wrappedText);
        });

        copycodelisting.on( 'aftercopy', function(event) {
            // console.log('Copied code to clipboard: ' + event.data['text/plain']);
            $(event.target).parent().next(".codelisting").first().effect("transfer", { to: $(event.target)}, 750);
        });
    });

    copycodelisting.on( 'error', function(event) {
        console.log( 'ZeroClipboard error of type "' + event.name + '": ' + event.message );
        ZeroClipboard.destroy();
    });
};

var enableColorboxFN = function () {
    $(".fancybox").colorbox({
        title: function() {
            return $(this).children('img').attr('alt');
        },
        opacity: 1,
        transition:"elastic",
        initialWidth: 0,
        initialHeight: 0,
        maxWidth:"95%",
        maxHeight: "95%",
        scalePhotos: true,
        fixed: true
    });
};

var trackPageViewsFN = function () {

    $("a").click(function() {
        var href = $(this).attr('href');
        if(href) {
            var titleText =  $(this).text();
            if(href.charAt(0) === '#') {
                ga('send', {
                    'hitType': 'pageview',
                    'page': location.pathname + location.search + href,
                    'title': titleText
                });
            };
            if(href.charAt(0) === '.') {
                var lastHashPos = href.lastIndexOf('#');
                var cleanHref = href.slice(3,lastHashPos);
                var cleanFrag = href.slice(lastHashPos);
                if(window.location.href.search(cleanHref) > -1)
                {
                    ga('send', {
                        'hitType': 'pageview',
                        'page': location.pathname + location.search + cleanFrag,
                        'title': titleText
                    });
                }
            };
        }
    });
};

var enableZeroClipboardFN = function () {
    ZeroClipboard.config({
            swfPath:  "includes/swf/ZeroClipboard.swf",
            trustedDomains: ["*"],
            forceEnhancedClipboard: false,
            forceHandCursor: true,
            debug: false}
    );
    addCopyButtonFN();
    addZeroClipboardToCmdlineButtonsFN();
    addZeroClipboardToCodeButtonsFN();
};

$(document).ready(function() {
    //wrapConfigurablesFn();
    btnClickHandler();
    enableToolTipFN();
    enableBackToTopFadeInFN();
    enableClampedWidthsFN();
    enableScrollSpyFN();
    affixToCFN();
    attachAnchorsToHeadings();
    trackPageViewsFN();
    loadJavaScriptsFN();
});

//

    </script></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navbar navbar-inverse navbar-fixed-top"><nav class="container-fluid"><div class="navbar-header"><a href="/" class="navbar-brand"><span>Open Identity Platform</span></a></div><ul id="pdf-link" class="nav navbar-nav navbar-right hidden-xs"><li><a href="../../OpenIG-Gateway-Guide.pdf" target="_blank"><span class="glyphicon glyphicon-save"></span> Download PDF Version</a></li></ul></nav></div><div class="jumbotron"><div class="container-fluid"><h1>Guide to OpenIG <span></span><small></small></h1><p></p></div></div><div class="left-shape-content"></div><div class="container-fluid"><div class="row"><div class="col-sm-3 hidden-xs"><div id="sidebar" data-clampedwidth=".col-sm-3"><h4 class="toc-title">Guide to OpenIG <br><small class="toc-subtitle"></small></h4><ul class="nav nav-stacked"><li><a href="#preface">Preface</a><ul class="nav nav-stacked"><li><a href="#d0e115">1. Who Should Use this Guide</a></li><li><a href="#formatting-conventions">2. Formatting Conventions</a></li><li><a href="#accessing-doc-online">3. Accessing Documentation Online</a></li><li><a href="#joining-the-community">4. Joining the Open Identity Platform Community</a></li></ul></li><li><a href="#chap-overview">1. Solutions Overview</a><ul class="nav nav-stacked"><li><a href="#sso-for-any-app">1.1. Extend SSO To Any Application</a></li><li><a href="#federate-any-app">1.2. Federate Enabling Applications</a></li><li><a href="#standards-based-policy-enforcement">1.3. Implement Standards Based Policy Enforcement</a></li></ul></li><li><a href="#chap-howitworks">2. How OpenIG Works</a><ul class="nav nav-stacked"><li><a href="#how-it-works-short">2.1. How It Works In A Nutshell</a></li><li><a href="#how-it-works-detail">2.2. How It Works In Detail</a><ul class="nav nav-stacked"><li><a href="#d0e279">2.2.1. OpenIG Core (Reverse Proxy)</a></li><li><a href="#d0e284">2.2.2. Exchange</a></li><li><a href="#d0e292">2.2.3. Dispatcher</a></li><li><a href="#d0e297">2.2.4. Chain</a></li><li><a href="#d0e308">2.2.5. Handlers</a></li><li><a href="#d0e329">2.2.6. Filters</a></li><li><a href="#d0e393">2.2.7. Configuration</a></li><li><a href="#d0e398">2.2.8. Heaplets</a></li><li><a href="#d0e403">2.2.9. Services</a></li><li><a href="#d0e408">2.2.10. Federation Service (Federation Gateway)</a></li></ul></li></ul></li><li><a href="#chap-quickstart">3. Getting Started</a><ul class="nav nav-stacked"><li><a href="#d0e423">3.1. Before You Begin</a></li><li><a href="#d0e436">3.2. Installation Steps</a></li><li><a href="#d0e527">3.3. Configuration Steps</a></li><li><a href="#d0e564">3.4. Try It Out</a></li></ul></li><li><a href="#chap-install">4. Installing OpenIG</a></li><li><a href="#chap-container">5. Configuring Deployment Containers</a><ul class="nav nav-stacked"><li><a href="#tomcat">5.1. Tomcat</a><ul class="nav nav-stacked"><li><a href="#d0e731">5.1.1. Tomcat &amp; MySQL/JNDI Configuration</a></li><li><a href="#d0e763">5.1.2. Tomcat &amp; Cookie Domains</a></li><li><a href="#d0e777">5.1.3. Tomcat &amp; SSL</a></li></ul></li><li><a href="#jetty">5.2. Jetty</a></li><li><a href="#jboss">5.3. JBoss</a></li></ul></li><li><a href="#chap-usecases">6. Detailed Use Cases</a><ul class="nav nav-stacked"><li><a href="#portal-app-login">6.1. Portal Application Login</a></li><li><a href="#am-integration">6.2. OpenAM Integration</a></li><li><a href="#sp-initiated-sso">6.3. Federation Gateway SP Initiated SAML2 SSO</a></li><li><a href="#idp-initiated-sso">6.4. Federation Gateway IDP Initiated SAML2 SSO</a></li><li><a href="#saml2-pep">6.5. Standards Based SAML2 Agent</a></li></ul></li><li><a href="#chap-gateway-tutorial">7. Tutorial With WordPress</a><ul class="nav nav-stacked"><li><a href="#d0e1188">7.1. Detailed Flow</a></li><li><a href="#d0e1233">7.2. Setup Summary</a></li><li><a href="#d0e1257">7.3. Installing OpenIG</a></li><li><a href="#d0e1266">7.4. Configuring the Browser Host</a></li><li><a href="#d0e1301">7.5. Configuring OpenIG &amp; Trying It Out</a></li><li><a href="#d0e1344">7.6. Login with Hard Coded Credentials</a></li><li><a href="#d0e1368">7.7. Login with Credentials From a Flat File</a></li><li><a href="#d0e1439">7.8. Login with Credentials From MySQL</a></li></ul></li><li><a href="#chap-password-capture-replay-tutorial">8. Tutorial On OpenAM Password Capture &amp; Replay</a><ul class="nav nav-stacked"><li><a href="#d0e1484">8.1. Detailed Flow</a></li><li><a href="#d0e1523">8.2. Setup Summary</a></li><li><a href="#d0e1540">8.3. Setup Details</a><ul class="nav nav-stacked"><li><a href="#d0e1545">8.3.1. OpenAM server</a></li><li><a href="#d0e1569">8.3.2. Tomcat Agent Profile</a></li><li><a href="#d0e1593">8.3.3. Password Capture Configuration</a></li><li><a href="#d0e1614">8.3.4. Tomcat Installation</a></li><li><a href="#d0e1625">8.3.5. Policy Agent installation</a></li><li><a href="#d0e1644">8.3.6. Gateway Configuration</a></li><li><a href="#d0e1677">8.3.7. Trying It Out</a></li></ul></li></ul></li><li><a href="#chap-federation">9. Using the Federation Gateway</a><ul class="nav nav-stacked"><li><a href="#federation-installation">9.1. Installation Overview</a></li><li><a href="#federation-configuration-files">9.2. Configuration File Overview</a></li><li><a href="#federation-configuring">9.3. Configuring the Federation Service</a></li><li><a href="#federation-config-json">9.4. Config.json Sample</a></li><li><a href="#federation-example-settings">9.5. Example Settings</a></li><li><a href="#federation-idp-metadata">9.6. Identity Provider Metadata</a></li></ul></li><li><a href="#chap-federation-tutorial">10. Tutorial For the Federation Gateway</a><ul class="nav nav-stacked"><li><a href="#fed-tutorial-before-you-start">10.1. Before You Start</a></li><li><a href="#fed-tutorial-configure-openam">10.2. Configuring OpenAM</a></li><li><a href="#fed-tutorial-configure-federation">10.3. Configuring OpenIG For Federation</a></li><li><a href="#fed-tutorial-testing">10.4. Trying It Out</a></li></ul></li><li><a href="#chap-gateway-templates">11. Configuration Templates</a><ul class="nav nav-stacked"><li><a href="#template-proxy-capture">11.1. Proxy &amp; Capture</a></li><li><a href="#template-simple-login">11.2. Simple Login Form</a></li><li><a href="#template-login-cookie">11.3. Login Form With Cookie From Login Page</a></li><li><a href="#template-login-extract-cookie-filters">11.4. Login Form With Extract Filter &amp; Cookie Filter</a></li><li><a href="#template-login-hidden-value">11.5. Login Which Requires a Hidden Value From the Login Page</a></li><li><a href="#template-http-and-https">11.6. HTTP &amp; HTTPS Application</a></li><li><a href="#template-multiple-apps">11.7. Multiple Applications</a></li><li><a href="#template-am-integration-headers">11.8. OpenAM Integration With Headers</a></li><li><a href="#template-owa-online">11.9. Microsoft Online Outlook Web Access</a></li></ul></li><li><a href="#chap-customizing">12. Customizing OpenIG</a><ul class="nav nav-stacked"><li><a href="#extension-points">12.1. Key Extension Points</a></li><li><a href="#custom-filter">12.2. Implementing a Filter</a></li><li><a href="#custom-handler">12.3. Implementing a Handler</a></li><li><a href="#custom-heap-config">12.4. Heap Object Configuration</a></li><li><a href="#custom-servlets-filters">12.5. Including Servlets and Servlet Filters</a></li><li><a href="#custom-sample-filter">12.6. Sample Filter</a></li></ul></li><li><a href="#chap-troubleshooting">13. Troubleshooting</a><ul class="nav nav-stacked"><li><a href="#d0e2535">13.1. Object not found in heap</a></li><li><a href="#d0e2546">13.2. Could not find local configuration file</a></li><li><a href="#d0e2557">13.3. Unexpected character (x) at position 1103</a></li><li><a href="#d0e2568">13.4. The values in the flat file are incorrect</a></li><li><a href="#d0e2573">13.5. Problem accessing URL</a></li><li><a href="#d0e2590">13.6. StaticResponseHandler results in a blank page</a></li><li><a href="#d0e2598">13.7. OpenIG is not logging users in</a></li></ul></li><li><a href="#d0e2607">Index</a></li></ul></div></div><div id="doc-content" class="col-sm-9"><div class="titlepage modal fade" id="myModal"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">X</span></button><h4 class="modal-title">About this document</h4></div><div class="modal-body"><div><div><h1 class="title">Guide to OpenIG </h1></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Paul</span> <span class="surname">Bryan</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Mark</span> <span class="surname">Craig</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Jamie</span> <span class="surname">Nelson</span></h3></div></div></div><div><p class="copyright">Copyright &copy; 2011-2012 ForgeRock AS</p></div><div><a href="legalnotice.html">Legal Notice</a></div><div><p class="pubdate">Last updated: July&nbsp;29,&nbsp;2024</p></div></div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><div lang="en" class="preface" id="preface"><div class="titlepage"><div><div><h1 class="title">Preface</h1></div></div></div><p>This guide shows you how to install and configure OpenIG, a
 high-performance reverse proxy server with specialized session
 management and credential replay functionality.</p><div class="section" id="d0e115"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.&nbsp;Who Should Use this Guide</h2></div></div></div><p>This guide is written for access management designers and
  administrators who build, deploy, and maintain identity gateways for
  their organizations. This guide covers the tasks you might perform once
  or repeat throughout the life cycle of an OpenIG release used in your
  organization.</p><p>You do not need to be an OpenIG wizard to learn something from
  this guide, though a background in access management and maintaining
  web application software can help. You do need some background in
  managing services on your operating systems and in your application
  servers. You can nevertheless get started with this guide, and then
  learn more as you go along.</p></div><div lang="en" class="section" id="formatting-conventions"><div class="titlepage"><div><div><h2 class="title" style="clear: both">2.&nbsp;Formatting Conventions</h2></div></div></div><p>
  Most examples in the documentation are created in GNU/Linux or Mac OS X
  operating environments.

  If distinctions are necessary between operating environments,
  examples are labeled with the operating environment name in parentheses.

  To avoid repetition file system directory names are often given
  only in UNIX format as in <code class="filename">/path/to/server</code>,
  even if the text applies to <code class="filename">C:\path\to\server</code> as well.
 </p><p>
  Absolute path names usually begin with the placeholder
  <code class="filename">/path/to/</code>.

  This path might translate to <code class="filename">/opt/</code>,
  <code class="filename">C:\Program Files\</code>, or somewhere else on your system.
 </p><p>
  Command line, terminal sessions are formatted as follows:
 </p><pre class="cmdline prettyprint">$ <strong>echo $JAVA_HOME</strong>
<em>/path/to/jdk</em></pre><p>
  Command output is sometimes formatted for narrower, more readable output
  even though formatting parameters are not shown in the command.
  In the following example,
  the query string parameter <code class="literal">_prettyPrint=true</code> is omitted
  and some of the output is replaced with an ellipsis (<code class="literal">...</code>):
 </p><pre class="cmdline prettyprint">
$ <strong>curl https://bjensen:hifalutin@opendj.example.com:8443/users/newuser</strong>
<em>{
  "_rev" : "000000005b337348",
  "_id" : "newuser",
  ...
}</em>
 </pre><p>
  Program listings are formatted as follows:
 </p><pre class="codelisting prettyprint">
class Test {
    public static void main(String [] args)  {
        System.out.println("This is a program listing.");
    }
}
 </pre></div><div lang="en" class="section" id="accessing-doc-online"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.&nbsp;Accessing Documentation Online</h2></div></div></div><p>
  Open Identity Platform core documentation, such as this document, aims to be
  technically accurate and complete with respect to the software documented.
 </p><div class="itemizedlist"><p>
   Core documentation therefore follows a three-phase review process
   designed to eliminate errors:
  </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
    Product managers and software architects review project documentation design
    with respect to the readers' software lifecycle needs.
   </p></li><li class="listitem"><p>
    Subject matter experts review proposed documentation changes for
    technical accuracy and completeness
    with respect to the corresponding software.
   </p></li><li class="listitem"><p>
    Quality experts validate implemented documentation changes
    for technical accuracy, completeness in scope,
    and usability for the readership.
   </p></li></ul></div><p>
  The review process helps to ensure that documentation published for
  a Open Identity Platform release is technically accurate and complete.
 </p><p>
  Fully reviewed, published core documentation is available at
  <a class="link" href="https://doc.openidentityplatform.org/" target="_blank">https://doc.openidentityplatform.org/</a>.
  Use this documentation when working with a Open Identity Platform release.
 </p><p>
  You can find pre-release draft documentation at the online
  <a class="link" href="https://github.com/OpenIdentityPlatform" target="_blank">community resource center</a>.
  Use this documentation when trying a nightly build.
 </p></div><div lang="en" class="section" id="joining-the-community"><div class="titlepage"><div><div><h2 class="title" style="clear: both">4.&nbsp;Joining the Open Identity Platform Community</h2></div></div></div><p>
  Visit the
  <a class="link" href="https://github.com/OpenIdentityPlatform" target="_blank">community resource center</a>
  where you can find information about each project,
  download nightly builds, browse the resource catalog,
  ask and answer questions on the forums, find community events near you,
  and of course get the source code as well.
 </p></div></div><div lang="en" class="chapter" id="chap-overview"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;1.&nbsp;Solutions Overview</h1></div></div></div><p>ForgeRock's Open Identity Gateway (OpenIG) provides the answer to
 three important challenges.</p><div class="section" id="sso-for-any-app"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.1.&nbsp;Extend SSO To Any Application</h2></div></div></div><p>In today's enterprise, more than 30% of web applications are
  incompatible with web access management (WAM) software. That is, unlike
  OpenAM with OpenIG, most web access management products lack the agent
  to protect the web applications, or the application is a legacy solution that
  does not follow standard protocols for single sign-on. This limits the return
  on the enterprise WAM investment and constrains what types of web applications
  can be protected.</p><p>ForgeRock's Open Identity Gateway addresses this problem by extending
  access management to encompass <span class="emphasis"><em>all</em></span> web applications.
  With OpenIG, OpenAM deployments can now be extended to be inclusive of those
  applications that do not integrate with policy agents alone. In addition,
  ForgeRock Open Identity Gateway interoperates, out-of-the-box, with all
  management solutions. Most importantly, your organization can on-board any
  web application without ever modifying or touching the target application
  again, significantly reducing the development and quality assurance required
  to protect web applications.</p></div><div class="section" id="federate-any-app"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.2.&nbsp;Federate Enabling Applications</h2></div></div></div><p>The expertise and cost required to add SAML2 support to web
  applications is a problem for many businesses. Those businesses not moving
  to a standard for exposing their applications to their customers see
  increased cost and maintenance due to the complexity of one-off proprietary
  integrations. They may also see a loss of business to those customers
  requiring a Federation standard for authentication. Sometimes, deploying
  a full access mangaement solution just to federate a few applications is 
  is too complex and costly, and
  building out their own solution by modifying their applications is just not
  possible.</p><div class="mediaobject" align="center" id="figure-federate-any-app"><a class="fancybox" href="images/federate-any-app.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_federate-any-app.png" align="middle" title="OpenIG lets you quickly federate any application."></a></div><p>OpenIG Federation Gateway allows businesses to add SAML2 support to
  their applications with little to no knowledge of the standard. In addition,
  there is no need to modify the application or install any plugin or agent on
  the application container.</p></div><div class="section" id="standards-based-policy-enforcement"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.3.&nbsp;Implement Standards Based Policy Enforcement</h2></div></div></div><p>In order to provide SSO, OpenAM policy enforcement points, the policy
  agents, have traditionally functioned as plugins for each application. The
  policy agents however use OpenAM specific APIs and protocols. In contrast,
  you can roll out OpenIG as an independent policy enforcement point that is
  built on the SAML2 standard.</p><div class="mediaobject" align="center" id="figure-standards-based-agent"><a class="fancybox" href="images/standards-based-agent.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_standards-based-agent.png" align="middle" title="OpenIG integrates well as a policy enforcement point with OpenAM and&#xA;    with other standards based solutions."></a></div><p>OpenIG Federation Gateway can replace policy agents with a standards
  based SAML2 compliant enforcement point.</p></div></div><div lang="en" class="chapter" id="chap-howitworks"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;2.&nbsp;How OpenIG Works</h1></div></div></div><a class="indexterm" name="d0e261"></a><p>This chapter provides a detailed look at OpenIG's components and how
 they work together.</p><div class="section" id="how-it-works-short"><div class="titlepage"><div><div><h2 class="title" style="clear: both">2.1.&nbsp;How It Works In A Nutshell</h2></div></div></div><p>The underlying core of ForgeRock Open Identity Gateway is based on a
  <a class="link" href="http://en.wikipedia.org/wiki/Reverse_proxy" target="_blank">reverse proxy architecture</a>. All HTTP traffic to each protected
  application is routed through OpenIG, enabling close inspection,
  transformation and filtering of each request.  By inspecting the traffic,
  OpenIG is able to intercept requests that would normally require the user to
  authenticate, obtain the user's login credentials, and send the necessary
  HTTP request to the target application, thereby logging in the user without
  modifying or installing anything on the application.  In its simplest form
  and basic configuration, OpenIG is a Java-based reverse proxy which runs as
  a web application.  Enable the Form-Filter replay module and OpenIG
  automatically log users in when a timeout or authentication page is detected.
  Additionally, enable the SAML2 service and OpenIG becomes a SAML2
  endpoint. In this mode of operation, OpenIG receives
  and verifies the SAML2 request and then logs the user directly
  into the target application.</p></div><div class="section" id="how-it-works-detail"><div class="titlepage"><div><div><h2 class="title" style="clear: both">2.2.&nbsp;How It Works In Detail</h2></div></div></div><p>The following modules make up OpenIG.</p><div class="section" id="d0e279"><div class="titlepage"><div><div><h3 class="title">2.2.1.&nbsp;OpenIG Core (Reverse Proxy)</h3></div></div></div><p>OpenIG core is a standard Java EE servlet implementation of a reverse
   proxy. The main function of OpenIG core is to act as a reverse proxy to the
   target application. When deployed in its base configuration, OpenIG can be
   used as a pure reverse proxy. The power of the OpenIG core comes in its
   ability to search, transform, and process HTTP traffic to and from the
   target application. This enables OpenIG to recognize login pages, submit
   login forms, transform or filter content, and even function as a Federation
   endpoint for the application.  All these features are possible without
   making any changes to the application's deployment container or the
   application itself.</p></div><div class="section" id="d0e284"><div class="titlepage"><div><div><h3 class="title">2.2.2.&nbsp;Exchange</h3></div></div></div><p>The <a href="../reference/index.html#Exchange" class="link">Exchange</a> is a
   wrapper around the HTTP request and response objects that pass through
   OpenIG. Every request or response being processed in OpenIG can be accessed
   or modified through the Exchange object.  In addition, arbitrary data can
   be set in the Exchange to facilitate the passing of data and state between
   filters and handlers.</p></div><div class="section" id="d0e292"><div class="titlepage"><div><div><h3 class="title">2.2.3.&nbsp;Dispatcher</h3></div></div></div><p>The Dispatcher may be thought of as the internal router of OpenIG.
   Every request that comes into OpenIG is analyzed and forwarded on to the
   configured processing chain of filters and handlers. A request may be
   forwarded based on the target host, URL, URL parameters, headers, cookies,
   or any other component of the request.</p></div><div class="section" id="d0e297"><div class="titlepage"><div><div><h3 class="title">2.2.4.&nbsp;Chain</h3></div></div></div><p>A <a href="../reference/index.html#Chain" class="link">Chain</a> is a
   combination of one or more Filters and a handler that process an incoming
   request from the Dispatcher. For example, the Dispatcher can process an
   incoming request with a URL parameter of <code class="literal">action=login</code>
   and forward the request to the Login Chain. The Login Chain executes a list
   of Filters and then calls a Handler. The Handler sends the request on to
   the target application or to another Chain for further processing.</p></div><div class="section" id="d0e308"><div class="titlepage"><div><div><h3 class="title">2.2.5.&nbsp;Handlers</h3></div></div></div><p>The final processing of every Chain ends in a call to a Handler. A
   Handler can simply call another Chain or it can send the request on to the
   target application. The following Handlers are shipped with OpenIG:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a href="../reference/index.html#ClientHandler" class="link">ClientHandler</a>:
     Sends the final request to the target application.</p></li><li class="listitem"><p><a href="../reference/index.html#StaticResponseHandler" class="link">StaticResponseHandler</a>: Used to send a response, such as a
     redirect, to a client during request processing.</p></li><li class="listitem"><p><a href="../reference/index.html#StaticResponseHandler" class="link">SequenceHandler</a>:
     Links together multiple handlers or chains during request
     processing.</p></li></ul></div></div><div class="section" id="d0e329"><div class="titlepage"><div><div><h3 class="title">2.2.6.&nbsp;Filters</h3></div></div></div><p>Filters are responsible for processing HTTP requests in OpenIG.
   Filters can be chained together to act on the input stream coming from the
   browser, or the  output stream returned back from the target application.
   A filter can do something as simple as logging the input and output stream
   or something more complex, such as processing login pages, fetching user
   attributes, or transforming content. There are multiple Filters shipped with
   OpenIG that can be combined in chains to provide very extensible request and
   response processing features. Custom filters can also be written using the
   Java SPIs. The following is a list of Filters shipped with OpenIG:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a href="../reference/index.html#CookieFilter" class="link">CookieFilter</a>:
     The default behavior of OpenIG is to accept and forward all cookies.
     Since this is not always the desirable behavior, the CookieFilter, when
     configured, allows you to suppress, manage, and relay cookies.</p></li><li class="listitem"><p><a href="../reference/index.html#CaptureFilter" class="link">CaptureFilter</a>:
     Captures the HTTP requests being processed by OpenIG. Capture can be used
     for audit purposes and may also be very useful when analyzing an
     application or troubleshooting a misbehaving OpenIG. Logs are written to
     a flat file on the OpenIG host.</p></li><li class="listitem"><p><a href="../reference/index.html#HeaderFilter" class="link">HeaderFilter</a>:
     The default behavior of OpenIG is to accept and forward all headers.
     The HeaderFilter can be configured to add additional headers or remove
     headers on both the HTTP request and the response. It can also be
     configured to parse and set header values in OpenIG context to allow
     filters access to the header attributes. This feature is used most
     commonly when OpenIG is integrated with OpenAM and being fronted by a
     policy agent.</p></li><li class="listitem"><p><a href="../reference/index.html#AssignmentFilter" class="link">AssignmentFilter</a>:
     Sets values in the HTTP request and response.</p></li><li class="listitem"><p><a href="../reference/index.html#StaticRequestFilter" class="link">StaticRequestFilter</a>: Creates and sends HTTP GET and POST requests.
     The request can be formed using parameters from previous processing or
     statically configured values.</p></li><li class="listitem"><p><a href="../reference/index.html#EntityExtractFilter" class="link">EntityExtractFilter</a>: Searches for specific content with the body
     of the requests. For example, it can be used to extract hidden form
     parameters in a login page, which are needed in the login request.</p></li><li class="listitem"><p><a href="../reference/index.html#ExceptionFilter" class="link">ExceptionFilter</a>:
     Sends users to configured URLs when errors or exceptions occur during
     request processing or user interactions.</p></li><li class="listitem"><p><a href="../reference/index.html#SwitchFilter" class="link">SwitchFilter</a>:
     Conditionally diverts the exchange to another handler.</p></li><li class="listitem"><p><a href="../reference/index.html#HttpBasicAuthFilter" class="link">HttpBasicAuthFilter</a>: Performs HTTP basic authentication to the
     target application per <a class="link" href="http://www.ietf.org/rfc/rfc2617.txt" target="_blank">RFC 2617</a>.</p></li><li class="listitem"><p><a href="../reference/index.html#FileAttributesFilter" class="link">FileAttributesFilter</a>: Looks up attributes in a flat file with the
     specified key. The attributes are added to the exchange to be used by
     subsequent filters or handlers.</p></li><li class="listitem"><p><a href="../reference/index.html#SqlAttributesFilter" class="link">SqlAttributesFilter</a>: Executes an SQL prepared statement with
     configured parameters. The result is added to the exchange to be used by
     subsequent filters or handlers.</p></li></ul></div></div><div class="section" id="d0e393"><div class="titlepage"><div><div><h3 class="title">2.2.7.&nbsp;Configuration</h3></div></div></div><p>The configuration of OpenIG was designed to be very modular and
   self-contained. Each module within OpenIG stores its configuration in JSON
   representation, which is stored in flat files. The
   features of OpenIG can be configured by directly manipulating the JSON flat
   files.</p></div><div class="section" id="d0e398"><div class="titlepage"><div><div><h3 class="title">2.2.8.&nbsp;Heaplets</h3></div></div></div><p>Every OpenIG module which has JSON configuration also has a Heaplet
   associated with it. Each module's Heaplet is responsible for reading the
   JSON configuration and creating that module's configuration in OpenIG's
   runtime heap. Each module can then read its configuration from the heap as
   well as make shared configuration information available to other
   modules.</p></div><div class="section" id="d0e403"><div class="titlepage"><div><div><h3 class="title">2.2.9.&nbsp;Services</h3></div></div></div><p>The Services model was designed to allow the integration of value
   added features, such as Federation, without requiring them to be tightly
   bound to the OpenIG implementation. SAML2 is the add on 
   service shipping with OpenIG today.</p></div><div class="section" id="d0e408"><div class="titlepage"><div><div><h3 class="title">2.2.10.&nbsp;Federation Service (Federation Gateway)</h3></div></div></div><p>When the Federation Service is enabled, OpenIG acts as the
   Service Provider in a Circle of Trust with a SAML2 compliant Identity
   Provider. The Federation service supports both IDP and SP initiated SAML2
   profiles. The Federation Gateway may be a Service Provider in the classic
   Federation use case where the IDP and SP are different companies or domains.
   The OpenIG SP can also be a standards based alternative to an OpenAM policy
   agent for internal enterprise applications that want to move away from
   installing agents with web and web application servers.</p></div></div></div><div lang="en" class="chapter" id="chap-quickstart"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;3.&nbsp;Getting Started</h1></div></div></div><p>This chapter provides instructions to get OpenIG up and running on
 Jetty, configured to execute the WordPress samples at our hosted WordPress
 deployment. This allows you to quickly see how OpenIG works and provides hands
 on experience with a few key features. If you are looking for more general
 installation and configuration instructions for your deployment or would
 like to use a container other than Jetty, start with the chapter on <a href="../gateway-guide/index.html#chap-install" class="link"><em class="citetitle">Installing
 OpenIG</em></a>.</p><div class="section" id="d0e423"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.1.&nbsp;Before You Begin</h2></div></div></div><p>For the remainder of this chapter, <code class="literal">$HOME</code> is the
  location of the home directory of the user running the web application
  container, where Jetty, OpenIG and the Samples are unpacked.</p><p>Make sure you have the correct Java environment installed. If necessary,
  download and install <a class="link" href="http://www.oracle.com/technetwork/java/javase/downloads/jdk6-jsp-136632.html" target="_blank">Sun Java SE JDK 6 Update 21</a> or later. At this time these are the only
  versions of any JDK supported with OpenIG.</p></div><div class="section" id="d0e436"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.2.&nbsp;Installation Steps</h2></div></div></div><div class="procedure"><div class="procedure-inner"><ol class="procedure" type="1"><li class="step"><p><a class="link" href="http://www.forgerock.org/openig.html" target="_blank">Download</a> and if necessary unpack the gateway
    .war file.</p></li><li class="step"><p>Download and unzip the <a class="link" href="http://openig.forgerock.org/forgerock-sample-configs.zip" target="_blank">OpenIG
    sample configuration files</a>.</p></li><li class="step"><p>Download and unzip <a class="link" href="http://dist.codehaus.org/jetty/jetty-hightide-7.1.6/jetty-hightide-7.1.6.v20100715.zip" target="_blank">Jetty 7.1.6 Hightide</a>.</p></li><li class="step"><p>Copy the OpenIG .war file as <code class="filename">root.war</code> to the
    <code class="filename">webapps/</code> directory in Jetty.</p><p>When copied to this location along with the
    <code class="filename">root.xml</code> file below, Jetty automatically deploys OpenIG
    on startup.</p><pre class="cmdline prettyprint">$ cp $HOME/gateway-*.war $HOME/jetty-hightide-7.1.6/webapps/root.war</pre></li><li class="step"><p>Copy the <code class="filename">WordPressLogin.json</code> gateway
    configuration file to
    <code class="filename">$HOME/.ForgeRock/OpenIG/config.json</code>. By default,
    OpenIG looks for <code class="filename">config.json</code> in the
    <code class="filename">$HOME/.ForgeRock/OpenIG/</code> directory.</p><pre class="cmdline prettyprint">$ cp $HOME/forgerock-sample-configs/WordPressLogin.json
 $HOME/.ForgeRock/OpenIG/config.json</pre></li><li class="step"><p>Create
    <code class="filename">$HOME/jetty-hightide-7.1.6/contexts/root.xml</code> with the
    following content. This tells Jetty to deploy OpenIG in the root
    context:</p><pre class="codelisting prettyprint">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN"
  "http://www.eclipse.org/jetty/configure.dtd"&gt;
&lt;Configure class="org.eclipse.jetty.webapp.WebAppContext"&gt;
    &lt;Set name="contextPath"&gt;/&lt;/Set&gt;
    &lt;Set name="war"&gt;&lt;SystemProperty name="jetty.home"
      default="."/&gt;/webapps/root.war&lt;/Set&gt;
    &lt;Set name="extractWAR"&gt;true&lt;/Set&gt;
    &lt;Set name="copyWebDir"&gt;false&lt;/Set&gt;
    &lt;Set name="defaultsDescriptor"&gt;&lt;SystemProperty name="jetty.home"
      default="."/&gt;/etc/webdefault.xml&lt;/Set&gt;
&lt;/Configure&gt;</pre></li><li class="step"><p>If you are managing multiple
    applications in one domain you must turn on domain cookies in Jetty. This
    can be done by adding the following property to
    <code class="filename">$JETTY_HOME/contexts/root.xml</code> or to
    <code class="filename">$JETTY_HOME/etc/jetty.xml</code>. Note that any changes to
    <code class="filename">jetty.xml</code> impact all web applications running in the
    container.</p><pre class="codelisting prettyprint">&lt;Get name="sessionHandler"&gt;
    &lt;Get name="sessionManager"&gt;
        &lt;Set name="sessionDomain"&gt;.forgerock.com&lt;Set&gt;
    &lt;Get&gt;
&lt;Get&gt;</pre></li><li class="step"><p>Start Jetty in the background:</p><pre class="cmdline prettyprint">$ $HOME/jetty-hightide-7.1.6/bin/jetty.sh start</pre><p>Or start Jetty in the foreground:</p><pre class="cmdline prettyprint">$ java -jar $HOME/jetty-hightide-7.1.6/start.jar</pre></li></ol></div></div></div><div class="section" id="d0e527"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.3.&nbsp;Configuration Steps</h2></div></div></div><p>So far you have deployed the gateway web application in the root
  context of Jetty on port 8080. Since the gateway is a reverse proxy you must
  make sure all traffic from your browser to
  <code class="literal">http://demo.forgerock.com:8080/wordpress/</code> goes through the
  gateway. The quickest way to do this is to add an entry to your
  <code class="filename">/etc/hosts</code> file on UNIX systems or
  <code class="filename">%SystemRoot%\system32\drivers\etc\hosts</code> on Windows. See
  <a class="link" href="http://en.wikipedia.org/wiki/Hosts_(file)" target="_blank">Wikipedia</a> for more information on host files. If you are running
  OpenIG and the browser on the same host, add this entry to the hosts file on
  the OpenIG host.</p><pre class="codelisting prettyprint">127.0.0.1 demo.forgerock.com</pre><p>If you are running the browser and OpenIG on separate hosts, you must
  add the IP address of the host running OpenIG. For example, if OpenIG is
  running on a host with IP Address of 10.0.1.5:</p><pre class="codelisting prettyprint">10.0.1.5 demo.forgerock.com</pre><div class="panel panel-success"><div class="panel-heading"><h3 class="panel-title">Tip</h3></div><div class="panel-body"><p>Some browsers cache IP address resolutions, even after clearing all
   browsing data. It might be necessary to restart the browser if you are
   changing IP addresses of named hosts. The simplest way to make sure you have
   configured your DNS or host settings properly is to stop OpenIG and
   make sure you cannot reach the target application. If you can still reach
   it, you should double check your host settings. You should also make sure
   your name resolution is configured to check your host files before DNS.
   This configuration can be found in <code class="filename">/etc/nsswitch.conf</code>
   for most UNIX systems. Make sure <code class="literal">files</code> is listed before
   <code class="literal">dns</code>.</p></div></div></div><div class="section" id="d0e564"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.4.&nbsp;Try It Out</h2></div></div></div><p><a class="link" href="http://demo.forgerock.com:8080/wordpress/" target="_top">http://demo.forgerock.com:8080/wordpress</a> should take you to the
  WordPress portal hosted at ForgeRock. When you click the login link, you are
  automatically logged in by OpenIG with the user name
  <code class="literal">george</code>.</p><p>What's happening behind the scenes?</p><p>When your browser goes to
  <code class="literal">http://demo.forgerock.com:8080/wordpress/</code>, it is actually
  connecting to OpenIG deployed on Jetty. OpenIG is configured to proxy all
  traffic it receives to the target application at
  <code class="literal">http://demo.forgerock.com:8080/wordpress/</code>. For this
  example, OpenIG is watching for the login page from WordPress. When it sees
  the login page, it creates and POSTs the login form for WordPress on behalf
  of the user. Since this is just a sample, the credentials for the user are
  hard coded in the gateway configuration file. In a real deployment, the
  credentials may come from a database, directory, flat file, HTTP headers,
  SAML assertion,or an OpenAM policy agent.</p></div></div><div lang="en" class="chapter" id="chap-install"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;4.&nbsp;Installing OpenIG</h1></div></div></div><a class="indexterm" name="d0e588"></a><div class="itemizedlist"><p>Before you install OpenIG, make sure you have the right version of Java,
  and install and configure the web container.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Make sure you have the correct Java environment installed.</p><pre class="cmdline prettyprint">$ java -version
java version "1.6.0_24"
Java(TM) SE Runtime Environment (build 1.6.0_24-b07-334-9M3326)
Java HotSpot(TM) 64-Bit Server VM (build 19.1-b02-334, mixed mode)</pre></li><li class="listitem"><p>Refer to the chapter on <a href="../gateway-guide/index.html#chap-container" class="link"><em class="citetitle">Configuring
   Deployment Containers</em></a> to ensure you have properly
   installed and configured your web application container and are running a
   supported version of Java.</p></li></ul></div><p>For the remainder of this chapter <code class="literal">$HOME</code> refers to
 the home directory of the user running the web container where you install
 OpenIG.</p><div class="procedure" id="download-install-configure"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;4.1.&nbsp;Download, Install, &amp; Configure</div><ol class="procedure" type="1"><li class="step"><p><a class="link" href="http://www.forgerock.org/openig.html" target="_blank">Download</a> and if necessary unpack the gateway
   .war file.</p></li><li class="step"><p>Deploy the .war to the root context of the web application
   container.</p></li><li class="step"><p>Copy the <a href="../gateway-guide/index.html#template-proxy-capture" class="link">proxy and capture</a>
   template. You can jump straight to a configuration template that best
   matches your application, but it is highly recommended you start with the
   basic proxy template.</p></li><li class="step"><p>Copy the template to
   <code class="filename">$HOME/.ForgeRock/OpenIG/config.json</code>. Replace the
   <code class="literal">TARGETIP</code> tag in <code class="filename">config.json</code> with
   the IP address and port number of your target application.</p></li><li class="step"><p>Modify DNS or host file settings so the name of your target
   application resolves to the IP address of OpenIG. Be sure to restart your
   browser after making this change.</p></li><li class="step"><p>Start the web container where OpenIG is deployed and browse to the
   target application. OpenIG should now proxy all traffic to the
   application.</p></li><li class="step"><p>To ensure the browser is going through OpenIG, stop the OpenIG web
   container, and verify you cannot reach the application. You can also look
   in the OpenIG capture log to verify the traffic is going through OpenIG.
   The location for this log is set in <code class="filename">config.json</code>, by
   default <code class="filename">/tmp/gateway.log</code>.
   </p></li></ol></div></div></div><div lang="en" class="chapter" id="chap-container"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;5.&nbsp;Configuring Deployment Containers</h1></div></div></div><a class="indexterm" name="d0e660"></a><div class="itemizedlist"><p>This section provides installation and configuration tips. The
  following containers are supported.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Tomcat 6.x and 7.x</p></li><li class="listitem"><p>Jetty 6.x and 7.x</p></li><li class="listitem"><p>Glassfish 2.x and 3.x</p></li><li class="listitem"><p>JBoss 5.x</p></li><li class="listitem"><p>Weblogic 10.x</p></li></ul></div><div class="section" id="tomcat"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5.1.&nbsp;Tomcat</h2></div></div></div><a class="indexterm" name="d0e686"></a><div class="itemizedlist"><p>Tomcat reference links:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://tomcat.apache.org/tomcat-6.0-doc" target="_blank">Tomcat Documentation</a></p></li><li class="listitem"><p><a class="link" href="http://tomcat.apache.org/tomcat-6.0-doc/ssl-howto.html" target="_blank">Configuring Tomcat for HTTPS</a>
    </p></li><li class="listitem"><p><a class="link" href="http://www.owasp.org/index.php/Securing_tomcat" target="_blank">Hardening Tomcat for production</a></p></li></ul></div><p>Download and install <a class="link" href="http://www.oracle.com/technetwork/java/javase/downloads/jdk6-jsp-136632.html" target="_blank">Sun Java SE JDK 6 Update 21</a> or later. At this time these are the only
  versions of any JDK supported with OpenIG.</p><p>Download and install <a class="link" href="http://tomcat.apache.org/download-60.cgi" target="_blank">Tomcat 6</a> or
  <a class="link" href="http://tomcat.apache.org/download-70.cgi" target="_blank">Tomcat 7</a>.</p><p><code class="literal">$TOMCAT_HOME</code> refers to the location where you have
  installed Tomcat.</p><p>Configure Tomcat to listen on the same port and protocol of the
  application you are protecting with OpenIG. If your application listens on
  both an HTTP and an HTTPS port you must configure Tomcat to do so as well.
  If you are installing to run the samples you do not have to modify the Tomcat
  port configuration since both the Tomcat default and the samples use port
  8080.</p><p>To configure Tomcat to use a port other than 8080 modify the defaults
  in <code class="filename">$TOMCAT_HOME/conf/server.xml</code>. The quickest way to do
  this is to search for the default value of 8080 and replace it with the new
  port number.</p><div class="section" id="d0e731"><div class="titlepage"><div><div><h3 class="title">5.1.1.&nbsp;Tomcat &amp; MySQL/JNDI Configuration</h3></div></div></div><p>If OpenIG accesses an SQL database you must <a class="link" href="http://tomcat.apache.org/tomcat-6.0-doc/jndi-resources-howto.html" target="_blank">configure Tomcat for JNDI</a>. Once you have Tomcat configured you must
   add the jar for the database, and set up a JNDI data source and a reference
   to that data source in your web application. The following steps are for
   the MySQL Connector/J.</p><p>Download the 
    <a class="link" href="http://dev.mysql.com/downloads/connector/j" target="_blank">MySQL JDBC Driver
    Connector/J</a>. Add it to the class path by copying it to
    <code class="filename">$TOMCAT_HOME/lib</code>.
   </p><p>Add a JNDI data source for your MySQL server and database in
   <code class="filename">$TOMCAT_HOME/conf/context.xml</code>.</p><pre class="codelisting prettyprint">&lt;Resource name="jdbc/forgerock" auth="Container" type="javax.sql.DataSource"
 maxActive="100" maxIdle="30" maxWait="10000"
 username="admin" password="11111111" driverClassName="com.mysql.jdbc.Driver"
 url="jdbc:mysql://localhost:3306/databasename"/&gt;</pre><p>Add a resource reference to the data source in
   <code class="filename">$TOMCAT_HOME/conf/web.xml</code>.</p><pre class="codelisting prettyprint">&lt;resource-ref&gt;
    &lt;description&gt;MySQL Connection&lt;description&gt;
    &lt;res-ref-name&gt;jdbc/forgerock&lt;res-ref-name&gt;
    &lt;res-type&gt;javax.sql.DataSource&lt;res-type&gt;
    &lt;res-auth&gt;Container&lt;res-auth&gt;
&lt;resource-ref&gt;</pre></div><div class="section" id="d0e763"><div class="titlepage"><div><div><h3 class="title">5.1.2.&nbsp;Tomcat &amp; Cookie Domains</h3></div></div></div><p>If you use OpenIG for more than a single application and those
   applications are on different hosts, you must configure Tomcat to set domain
   cookies. To do this add the following to your
   <code class="filename">$TOMCAT_HOME/conf/Catalina/<em class="replaceable"><code>server</code></em>/root.xml</code> file.</p><pre class="codelisting prettyprint">&lt;Context sessionCookieDomain=".forgerock.com" /&gt;</pre></div><div class="section" id="d0e777"><div class="titlepage"><div><div><h3 class="title">5.1.3.&nbsp;Tomcat &amp; SSL</h3></div></div></div><p>To get Tomcat up quickly on an SSL port you can add an entry similar
   to the following in <code class="filename">$TOMCAT_HOME/conf/server.xml</code>.</p><pre class="codelisting prettyprint">&lt;Connector port="443" protocol="HTTP/1.1" SSLEnabled="true"
    maxThreads="150" scheme="https" secure="true"
    address="10.0.1.6"
    clientAuth="false" sslProtocol="TLS" keystorePass="11111111"/&gt;</pre><p>You must also have to make sure you have create a key store along with
   a self-signed certificate. You can do that with the following UNIX
   command:</p><pre class="cmdline prettyprint">$ keytool -genkey -alias tomcat -keyalg RSA</pre></div></div><div class="section" id="jetty"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5.2.&nbsp;Jetty</h2></div></div></div><a class="indexterm" name="d0e796"></a><div class="itemizedlist"><p>Jetty reference links:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://wiki.eclipse.org/Jetty/Starting" target="_blank">Jetty
    Documentation</a></p></li><li class="listitem"><p><a class="link" href="http://wiki.eclipse.org/Jetty/Howto/Port80" target="_blank">Running Jetty on
    port 80</a></p></li><li class="listitem"><p><a class="link" href="http://wiki.eclipse.org/Jetty/Howto/Deploy_Web_Applications" target="_blank">Deploying Web Applications</a></p></li></ul></div><p>Download and install <a class="link" href="http://www.oracle.com/technetwork/java/javase/downloads/jdk6-jsp-136632.html" target="_blank">Sun Java SE JDK 6 Update 21</a> or later. At this time these are the only
  versions of any JDK supported with OpenIG.</p><p>Download and install <a class="link" href="http://wiki.eclipse.org/Jetty/Starting/Downloads" target="_blank">Jetty</a>.
  The install directory is referred to as <code class="literal">$JETTY_HOME</code>
  from now on.</p><p>Configure Jetty to listen on the same port and protocol of the
  application you are protecting with OpenIG. If you are configuring OpenIG for
  the samples you do not have to modify the Jetty port configuration since
  the default for Jetty is 8080 and the samples use port 8080.</p><p>To configure Jetty to use a port other than 8080 you must modify
  the default <code class="filename">$JETTY_HOME/etc/jetty.xml</code>. The quickest way
  to do that is to search for the default value of 8080 and replace it with the
  new port number. The simplest way to get Jetty running on ports below 1024 is
  to run the Jetty process as root. This is only appropriate for sample
  purposes. Do not run Jetty as root in production.</p><p>If the application your are protecting is configured on an HTTPS port,
  you must configure Jetty for HTTPS as well.</p><p>If you are managing multiple applications in one domain you will need
  to turn on domain cookies in Jetty. This can be done by adding the following
  property to <code class="filename">$JETTY_HOME/contexts/root.xml</code> or to
  <code class="filename">$JETTY_HOME/etc/jetty.xml</code>. Note that any changes to
  <code class="filename">jetty.xml</code> impact all web applications running in the
  container.</p><pre class="codelisting prettyprint">&lt;Get name="sessionHandler"&gt;
    &lt;Get name="sessionManager"&gt;
        &lt;Set name="sessionDomain"&gt;example.com&lt;Set&gt;
    &lt;Get&gt;
&lt;Get&gt;</pre><p>If OpenIG accesses an SQL database you must <a class="link" href="http://wiki.eclipse.org/Jetty/Feature/JNDI" target="_blank">configure Jetty for
  JNDI</a> or use the <a class="link" href="http://docs.codehaus.org/display/JETTY/Hightide+Documentation" target="_blank">Jetty Hightide distribution</a>, which comes pre-configured for JNDI.
  Once you have Jetty configured you must add the jar for the database, and set
  up a JNDI data source and a reference to that data source in your web
  application. The following steps are for the MySQL Connector/J.</p><p>Download the <a class="link" href="http://dev.mysql.com/downloads/connector/j" target="_blank">MySQL JDBC Driver
  Connector/J</a> Add it to the Jetty class path by copying it to
  <code class="filename">$JETTY_HOME/lib/jndi</code>.</p><p>Add a JNDI data source for your MySQL server and database in
  <code class="filename">$JETTY_HOME/etc/jetty.xml</code>.</p><pre class="codelisting prettyprint">&lt;New id="jdbc/forgerock" class="org.eclipse.jetty.plus.jndi.Resource"&gt;
  &lt;Arg&gt;&lt;Arg&gt;
  &lt;Arg&gt;jdbc/forgerock&lt;Arg&gt;
  &lt;Arg&gt;
    &lt;New class="com.mysql.jdbc.jdbc2.optional.MysqlConnectionPoolDataSource"&gt;
      &lt;Set name="Url"&gt;jdbc:mysql://localhost:3306/databasename&lt;Set&gt;
      &lt;Set name="User"&gt;mysqladmin&lt;Set&gt;
      &lt;Set name="Password"&gt;11111111&lt;Set&gt;
    &lt;New&gt;
  &lt;Arg&gt;
&lt;New&gt;</pre><p>Add a resource reference to the data source in
  <code class="filename">$JETTY_HOME/etc/webdefault.xml</code>.</p><pre class="codelisting prettyprint">&lt;resource-ref&gt;
    &lt;description&gt;My DataSource Reference&lt;description&gt;
    &lt;res-ref-name&gt;jdbc/forgerock&lt;res-ref-name&gt;
    &lt;res-type&gt;javax.sql.DataSource&lt;res-type&gt;
    &lt;res-auth&gt;Container&lt;res-auth&gt;
 &lt;resource-ref&gt;</pre></div><div class="section" id="jboss"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5.3.&nbsp;JBoss</h2></div></div></div><a class="indexterm" name="d0e887"></a><div class="itemizedlist"><p>JBoss reference links:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://www.jboss.org/jbossas/docs/5-x" target="_blank">JBOSS 5
    Documentation</a></p></li><li class="listitem"><p><a class="link" href="http://www.jboss.org/jbossas/docs/6-x" target="_blank">JBOSS 6
    Documentation</a></p></li><li class="listitem"><p><a class="link" href="http://www.jboss.org/jbossas/docs/5-x/admin-console-quick-start.html" target="_blank">Admin Console Quick Start Guide</a></p></li></ul></div><p>Download and install <a class="link" href="http://www.oracle.com/technetwork/java/javase/downloads/jdk6-jsp-136632.html" target="_blank">Sun Java SE JDK 6 Update 21</a> or later. At this time these are the only
  versions of any JDK supported with OpenIG.</p><p>Download and install the community version of <a class="link" href="http://sourceforge.net/projects/jboss/files/JBoss/JBoss-5.1.0.GA" target="_blank">JBoss 5.1</a>. $JBOSS_HOME refers to the location you have installed
  JBoss. The assumption in this chapter is that you run the default server
  configuration.</p><p>Configure JBoss to listen on the same port and protocol of the
  application you are protecting with OpenIG. If your application listens on
  both an HTTP and an HTTPS port you must configure JBoss to do so as well. If
  you are installing to run the samples you do not have to modify the JBoss
  port configuration since both the Joss default and the samples use port
  8080.</p><p>To configure JBoss to use a port other than 8080 modify
  <code class="filename">server.xml</code> under your server configuration. For example,
  if you are using the default server configuration,
  <code class="filename">server.xml</code> is
  <code class="filename">$JBOSS_HOME/server/default/deploy/jbossweb.sar/server.xml</code>.
  The quickest way to do this is to search for the default value of 8080 and
  replace it with the new port number.</p><p>If OpenIG accesses an SQL database you must configure JBoss for JNDI.
  Once you have JBOSS configured you must add the jar  for the database, and
  set up a JNDI data source and a reference to that data source in your web
  application. The following steps are for the MySQL Connector/J.</p><p>Download the <a class="link" href="http://dev.mysql.com/downloads/connector/j" target="_blank">MySQL JDBC Driver
  Connector/J</a> Add it to the JBoss class path by copying it to
  <code class="filename">$JBOSS_HOME/server/default/lib</code>.</p><p>Add a JNDI data source for your MySQL server and database in
  <code class="filename">$JBOSS_HOME/server/default/deploy/mysql-ds.xml</code>.</p><pre class="codelisting prettyprint">&lt;datasources&gt;
  &lt;local-tx-datasource&gt;
    &lt;jndi-name&gt;jdbc/forgerock&lt;jndi-name&gt;
    &lt;connection-url&gt;jdbc:mysql://localhost:3306/databasename&lt;connection-url&gt;
    &lt;driver-class&gt;com.mysql.jdbc.Driver&lt;driver-class&gt;
    &lt;user-name&gt;admin&lt;user-name&gt;
    &lt;password&gt;11111111&lt;password&gt;
    &lt;min-pool-size&gt;5&lt;min-pool-size&gt;
    &lt;max-pool-size&gt;20&lt;max-pool-size&gt;
    &lt;idle-timeout-minutes&gt;5&lt;idle-timeout-minutes&gt;
    &lt;exception-sorter-class-name&gt;
com.mysql.jdbc.integration.jboss.ExtendedMysqlExceptionSorter
    &lt;exception-sorter-class-name&gt;
    &lt;valid-connection-checker-class-name&gt;
com.mysql.jdbc.integration.jboss.MysqlValidConnectionChecker
    &lt;valid-connection-checker-class-name&gt;
  &lt;local-tx-datasource&gt;
&lt;datasources&gt;</pre><p>Add a resource reference to the data source in
  <code class="filename">$JBOSS_HOME/server/default/deployers/jbossweb.deployer/web.xml</code>.</p><pre class="codelisting prettyprint">&lt;resource-ref&gt;
    &lt;description&gt;MySQL Connection&lt;description&gt;
    &lt;res-ref-name&gt;jdbc/forgerock&lt;res-ref-name&gt;
    &lt;res-type&gt;javax.sql.DataSource&lt;res-type&gt;
    &lt;res-auth&gt;Container&lt;res-auth&gt;
&lt;resource-ref&gt;</pre></div></div><div lang="en" class="chapter" id="chap-usecases"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;6.&nbsp;Detailed Use Cases</h1></div></div></div><p>This chapter diagrams and describes common use case request and
 response flows.</p><div class="section" id="portal-app-login"><div class="titlepage"><div><div><h2 class="title" style="clear: both">6.1.&nbsp;Portal Application Login</h2></div></div></div><a class="indexterm" name="d0e965"></a><p>The figure below illustrates a sample flow with a description of each
  request from the browser to the back end application. This flow is taken from
  the <a href="../gateway-guide/index.html#chap-gateway-tutorial" class="link"><em class="citetitle">Tutorial With
  WordPress</em></a>. Try the tutorial yourself to learn how
  OpenIG works. The Flat-File attribute store contains only one set of
  credentials. OpenIG makes the assumption this user is logging into the
  sample application. In a real deployment OpenIG would look up the user
  credentials using its own session, a SAML2 assertion, or a header from an
  OpenAM policy agent. Use cases that follow show examples of these types
  of deployments.</p><div class="mediaobject" align="center" id="figure-portal-app-login"><a class="fancybox" href="images/portal-app-login.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_portal-app-login.png" align="middle" title="This image diagrams seven steps comprising a portal&#xA;    application login."></a></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>User accesses the Portal.</p></li><li class="listitem"><p>Gateway intercepts request, finds no login page and passes it
    through.</p></li><li class="listitem"><p>Portal finds no local session and redirects to its login page for
    authentication.</p></li><li class="listitem"><p>Gateway intercepts the redirect, finds a match for the login page,
    fetches the credentials from the flat file.</p></li><li class="listitem"><p>Gateway creates the login form and POSTs it to the Portal login
    page.</p></li><li class="listitem"><p>Portal validates the credentials and redirects to the user's home
    page.</p></li><li class="listitem"><p>Gateway passes the request through to the browser.</p></li></ol></div></div><div class="section" id="am-integration"><div class="titlepage"><div><div><h2 class="title" style="clear: both">6.2.&nbsp;OpenAM Integration</h2></div></div></div><a class="indexterm" name="d0e1005"></a><p>The figure below illustrates OpenIG integrated into an OpenAM
  deployment. In this deployment OpenIG is running in a container
  that is protected by an OpenAM policy agent. The agent is configured to
  forward a header, with the subject (user) of the single sign-on session, to
  OpenIG. OpenIG then uses the subject as the login credentials, or uses the
  subject as a reference to look up the login credentials in a database or
  directory. The HR application is integrated into the SSO deployment without
  an agent or any modification to the application or its deployment
  configuration.</p><div class="mediaobject" align="center" id="figure-am-integration"><a class="fancybox" href="images/am-integration.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_am-integration.png" align="middle" title="This image diagrams eight steps comprising a login integrated&#xA;    with OpenAM."></a></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>User browses to the Portal.</p></li><li class="listitem"><p>OpenAM plugin intercepts the request, finds no valid
    OpenAM session, redirects the user to the OpenAM login pages.</p></li><li class="listitem"><p>OpenAM logs in the user and redirects back to the Portal.</p></li><li class="listitem"><p>OpenAM plugin finds a valid session, request goes through, OpenIG
    passes the request through to the Portal.
    </p></li><li class="listitem"><p>Portal finds no local session, redirects to the Portal login
    page.</p></li><li class="listitem"><p>OpenIG inspects the redirect, finds a match for the login page,
    creates the login form, and POSTs it to the Portal.</p></li><li class="listitem"><p>Portal validates the credentials and redirects to the Portal
    page.</p></li><li class="listitem"><p>Gateway passes the request through to the browser.</p></li></ol></div></div><div class="section" id="sp-initiated-sso"><div class="titlepage"><div><div><h2 class="title" style="clear: both">6.3.&nbsp;Federation Gateway SP Initiated SAML2 SSO</h2></div></div></div><a class="indexterm" name="d0e1044"></a><p>The figure below illustrates the OpenIG Federation Gateway providing
  SAML2 endpoint features acting as Service Provider in an SP initiated single
  sign-on configuration. In this sample, company myHR is an outsourced provider
  of HR services and has started seeing increased demand for SAML2 support in
  their core application. The companies to which they outsource are refusing
  proprietary means of authentication and demanding the widely accepted SAML2
  standard. myHR is not in a position to modify their application to support
  SAML2 nor do they have the time or money to integrate and deploy all of
  OpenAM. With OpenIG Federation Gateway, myHR deploys OpenIG in front of their
  HR application, configures it as a SAML2 endpoint for SP initiated SSO,
  and configures it to log users into the HR application upon successful
  verification of the SAML2 assertion from their customers.</p><div class="mediaobject" align="center" id="figure-sp-initiated-sso"><a class="fancybox" href="images/sp-initiated-sso.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_sp-initiated-sso.png" align="middle" title="This image diagrams the nine steps of service provider initiated&#xA;    SAML2 single sign on."></a></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The user accesses the HR application through a bookmark in the
    browser.</p></li><li class="listitem"><p>Federation Gateway inspects the request, no match is found for the
    HR application's login page so the request goes through.</p></li><li class="listitem"><p>HR application finds no HR session, sends a redirect to its login
    page.</p></li><li class="listitem"><p>Federation Gateway intercepts the redirect, finds a match for the
    login page, issues an SP initiated SSO SAML2 request to Company.com's
    IDP.</p></li><li class="listitem"><p>The IDP at Company.com receives the SAML2 AuthN request and
    authenticates the user.</p></li><li class="listitem"><p>After authenticating the user the IDP sends a SAML2 POST to
    OpenIG.</p></li><li class="listitem"><p>Federation Gateway validates the assertion and makes the assertion
    attributes available to the OpenIG login chain.</p></li><li class="listitem"><p>OpenIG login chain gets the user credentials and POSTs the login form
    to the application.</p></li><li class="listitem"><p>The HR application verifies the credentials and redirects to its
    home page.</p></li></ol></div></div><div class="section" id="idp-initiated-sso"><div class="titlepage"><div><div><h2 class="title" style="clear: both">6.4.&nbsp;Federation Gateway IDP Initiated SAML2 SSO</h2></div></div></div><a class="indexterm" name="d0e1086"></a><p>The figure below illustrates the Federation Gateway providing SAML2
  endpoint features acting as a Service Provider in a IDP initiated single
  sign-on configuration.</p><div class="mediaobject" align="center" id="figure-idp-initiated-sso"><a class="fancybox" href="images/idp-initiated-sso.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_idp-initiated-sso.png" align="middle" title="This image diagrams the five steps of identity provider initiated&#xA;    SAML2 single sign on."></a></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>User clicks the HR link on the company portal and is redirected to
    the company IDP for authentication.</p></li><li class="listitem"><p>IDP sends an AuthN Response to the HR application.</p></li><li class="listitem"><p>Federation Gateway receives the POST, validates the assertion, and
    makes the attributes available to the OpenIG login chain.
    </p></li><li class="listitem"><p>OpenIG login chain retrieves the user credentials and POSTs the login
    form to the myHR application.</p></li><li class="listitem"><p>HR application validates the credentials and redirects to the main
    page of the application.</p></li></ol></div></div><div class="section" id="saml2-pep"><div class="titlepage"><div><div><h2 class="title" style="clear: both">6.5.&nbsp;Standards Based SAML2 Agent</h2></div></div></div><a class="indexterm" name="d0e1116"></a><p>The figure below illustrates the Federation Gateway as a standards
  based replacement for OpenAM policy agents.</p><div class="mediaobject" align="center" id="figure-saml2-pep"><a class="fancybox" href="images/saml2-pep.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_saml2-pep.png" align="middle" title="This image diagrams the nine steps showing how OpenIG Federation&#xA;    Gateway works as a SAML2 based policy enforcement point."></a></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The user accesses an internal Payroll application.</p></li><li class="listitem"><p>Federation Gateway inspects the request, no match is found for the
    Payroll application's login page so the request goes through.</p></li><li class="listitem"><p>Payroll application finds no Payroll session, sends a redirect to its
    login page.</p></li><li class="listitem"><p>Federation Gateway intercepts the redirect, finds a match for the
    login page, issues an SP initiated SSO SAML2 request to OpenAM at
    Company.com.</p></li><li class="listitem"><p>OpenAM at Company.com receives the SAML2 AuthN and authenticates
    the user.</p></li><li class="listitem"><p>After authenticating the user OpenAM sends a SAML2 POST to
    OpenIG.</p></li><li class="listitem"><p>Federation Gateway validates the assertion and makes the assertion
    attributes available to the OpenIG login chain.</p></li><li class="listitem"><p>OpenIG login chain gets the user credentials and POSTs the login
    form to the application.</p></li><li class="listitem"><p>The Payroll application verifies the credentials and redirects to its
    home page.</p></li></ol></div></div></div><div lang="en" class="chapter" id="chap-gateway-tutorial"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;7.&nbsp;Tutorial With WordPress</h1></div></div></div><a class="indexterm" name="d0e1159"></a><div class="itemizedlist"><p>This tutorial gives you hands on experience with the basic features of
  OpenIG. You install the Gateway in your network and point it to an
  installation of the WordPress Portal hosted at <a class="link" href="http://demo.forgerock.com:8080/wordpress" target="_blank">http://demo.forgerock.com:8080/wordpress</a>. The tutorial progresses
  through the following steps and explains what is happening by walking you
  through OpenIG configuration.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Pure reverse proxy mode to the Portal</p></li><li class="listitem"><p>Login with hard coded credentials</p></li><li class="listitem"><p>Login with credentials from a flat file</p></li><li class="listitem"><p>Login with credentials from MySQL</p></li></ul></div><p>Before you begin the tutorial, read the chapter on <a href="../gateway-guide/index.html#chap-howitworks" class="link"><em class="citetitle">How OpenIG
 Works</em></a>.</p><div class="section" id="d0e1188"><div class="titlepage"><div><div><h2 class="title" style="clear: both">7.1.&nbsp;Detailed Flow</h2></div></div></div><p>The figure and the steps below detail the flow between the browser,
  OpenIG and the portal for a basic login sequence to the portal. The
  key concept to understand is all requests to the application are routed
  through OpenIG by modifying the DNS entry for the target application.
  OpenIG can then be configured to intercept specific pages, such as
  login pages, and create requests to log the user in.</p><div class="mediaobject" align="center" id="figure-gateway-tutorial"><a class="fancybox" href="images/gateway-tutorial.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_gateway-tutorial.png" align="middle" title="This diagram shows the flow of requests during user login."></a></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>User browses to the Portal, browser host makes a DNS request to get
    the IP address for <code class="literal">demo.forgerock.com</code>, DNS returns the
    IP address of OpenIG.</p></li><li class="listitem"><p>Browser sends the request to OpenIG.</p></li><li class="listitem"><p>OpenIG inspects the request, finds no login page match.</p></li><li class="listitem"><p>OpenIG forwards the original request to the Portal.</p></li><li class="listitem"><p>Portal finds no local application session and redirects to the Portal
    login page.</p></li><li class="listitem"><p>OpenIG intercepts the redirect, inspects the request, finds a login
    page match.</p></li><li class="listitem"><p>OpenIG creates the login form.</p></li><li class="listitem"><p>OpenIG POSTs the login form to the Portal.</p></li><li class="listitem"><p>Portal validates the login and redirects to the Portal end user
    page.</p></li><li class="listitem"><p>OpenIG receives the final redirect and passes it back to the
    Browser.</p></li></ol></div></div><div class="section" id="d0e1233"><div class="titlepage"><div><div><h2 class="title" style="clear: both">7.2.&nbsp;Setup Summary</h2></div></div></div><div class="itemizedlist"><p>To keep things simple, these instructions assume you are running OpenIG
   and the Browser on a single host.  If they are on separate hosts, make sure
   the host or DNS changes impact the Browser host. This tutorial also assumes
   Jetty 7 for the container, but you can use any supported container.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>OpenIG IP address 10.0.1.1 (substitute your OpenIG's IP
    address)</p></li><li class="listitem"><p>Jetty 7 listening on port 8080</p></li><li class="listitem"><p>OpenIG deployed under the root context</p></li><li class="listitem"><p>DNS or <code class="filename">/etc/hosts</code> pointing
    <code class="literal">demo.forgerock.com</code> to 10.0.1.1 (substitute your OpenIG's
    IP address)</p></li></ul></div></div><div class="section" id="d0e1257"><div class="titlepage"><div><div><h2 class="title" style="clear: both">7.3.&nbsp;Installing OpenIG</h2></div></div></div><p>See <a href="../gateway-guide/index.html#chap-quickstart" class="link"><em class="citetitle">Getting
  Started</em></a> for instructions, and have your container listen
  on port 8080.</p></div><div class="section" id="d0e1266"><div class="titlepage"><div><div><h2 class="title" style="clear: both">7.4.&nbsp;Configuring the Browser Host</h2></div></div></div><p>With OpenIG running, configure the browser to go through OpenIG to
  get to the Portal. To do this we need to modify DNS or
  <code class="filename">/etc/hosts</code> so <code class="literal">demo.forgerock.com</code>
  points to the IP address of the host running OpenIG. If you are using
  <code class="filename">/etc/hosts</code> be sure to check that the naming services
  for your host check checking files before DNS. On UNIX systems this is
  configured in <code class="filename">/etc/nsswitch.conf</code>. Assuming OpenIG
  is running on 10.0.1.1, the <code class="filename">/etc/hosts</code> entry should be
  the following:</p><pre class="literallayout">10.0.1.1   demo.forgerock.com</pre><p>Before continuing please verify your name to IP address changes are
  working properly. The simplest way to do this is to ping
  <code class="literal">demo.forgerock.com</code>. You should see the following if you
  have properly configured your name to IP mapping:</p><pre class="cmdline prettyprint">$ ping demo.forgerock.com
ping demo.forgerock.com
PING demo.forgerock.com (10.0.1.1): 56 data bytes
64 bytes from 10.0.1.1: icmp_seq=0 ttl=64 time=0.053 ms</pre><p>If the ping command returns the actual address of
  <code class="literal">demo.forgerock.com</code>, you need to recheck your
  settings.</p></div><div class="section" id="d0e1301"><div class="titlepage"><div><div><h2 class="title" style="clear: both">7.5.&nbsp;Configuring OpenIG &amp; Trying It Out</h2></div></div></div><p>For the remainder of this document, <code class="literal">$HOME</code> refers to
  the location where you unzipped your sample configuration files.</p><p>Download and unzip the <a class="link" href="http://openig.forgerock.org/forgerock-sample-configs.zip" target="_top">sample
  configuration files</a>. If you installed through quick start you already
  have the configuration files downloaded and installed.</p><p>Copy <code class="filename">WordPressProxyOnly.json</code> to
  <code class="filename">$HOME/.ForgeRock/OpenIG/config.json</code>. By default, OpenIG
  looks for <code class="filename">$HOME/.ForgeRock/OpenIG/config.json</code> for its
  configuration. You must restart the OpenIG container when making any change
  to the configuration file.</p><pre class="cmdline prettyprint">$ cp $HOME/forgerock-sample-configs/WordPressProxyOnly.json
 $HOME/.ForgeRock/OpenIG/config.json
$ jetty.sh restart</pre><p>To try out the first sample browse to <a class="link" href="http://demo.forgerock.com:8080/wordpress" target="_blank">http://demo.forgerock.com:8080/wordpress</a>. You should see the WordPress
  Portal home page. If you click on the login link you should be prompted to
  login to the application as if you were accessing it directly. To verify you
  are actually going through OpenIG, stop the OpenIG container, refresh your
  browser and try to access the application again. If you still see the
  application, make sure your DNS or host files are configured to point to
  OpenIG instead of the Portal. You can login to the Portal with user name
  <code class="literal">george</code> and password <code class="literal">costanza</code>. The next
  section shows how to configure OpenIG to intercept the login page and
  automatically log you in when it sees that you have clicked the login
  link.</p><p>To see what is happening behind the scenes, take a look at
  <code class="filename">$HOME/.ForgeRock/OpenIG/config.json</code>. Look for the
  HandlerServlet. This is the servlet entry point to OpenIG. The HandlerServlet
  passes the request off to another handler which may be a chain of filters
  and handlers. In the pure proxy case there is no special logic to execute so
  it hands off to the ClientHandler. The job of the ClientHandler is to send
  the request on to the target. Since there are no chains called before the
  ClientHandler, the request passes through to the target untouched.</p></div><div class="section" id="d0e1344"><div class="titlepage"><div><div><h2 class="title" style="clear: both">7.6.&nbsp;Login with Hard Coded Credentials</h2></div></div></div><p>Now that OpenIG can proxy all traffic to and from the application, the
  next step is to configure OpenIG to intercept the login page, and POST the
  login form to the Portal.</p><pre class="cmdline prettyprint">$ cp $HOME/forgerock-sample-configs/WordPressLogin.json
 $HOME/.ForgeRock/OpenIG/config.json
$ jetty.sh restart</pre><p>As you changed the OpenIG configuration file, you must restart the
  OpenIG container. After restarting you should be able to go to <a class="link" href="http://demo.forgerock.com:8080/wordpress" target="_top">http://demo.forgerock.com:8080/wordpress</a>, click on the login link,
  and be logged in as the user george without entering your credentials. OpenIG
  has intercepted the request for the login page, created the login form, and
  POSTed the request to the Portal.</p><p>To see what is happening behind the scenes, take a look at
  <code class="filename">$HOME/.ForgeRock/OpenIG/config.json</code>. This time you
  notice the HandlerServlet is calling the DispatchHandler. The DispatchHandler
  has a condition which checks for the presence of
  <code class="filename">wp-login.php</code> (the login page) in the URI path. If the
  condition is false (no login page), the ClientHandler is called sending the
  request on to the Portal. If the condition is true, OpenIG has found the
  login page, and calls the LoginChain for further processing. The LoginChain
  calls its filter, the LoginRequestFilter, which creates the login form, and
  then calls the ClientHandler to send the form to the Portal. If you look at
  the LoginRequestFilter, you notice it defines the method, URI, and form
  parameters for the request which is sent by the ClientHandler. In the form
  parameters you see the hard coded credentials, which are used to log you in
  as the user <code class="literal">george</code>.</p></div><div class="section" id="d0e1368"><div class="titlepage"><div><div><h2 class="title" style="clear: both">7.7.&nbsp;Login with Credentials From a Flat File</h2></div></div></div><p>Hard coding login credentials is great for a sample, but not realistic
  when it comes to a production deployment. In this next section you see how
  OpenIG can be configured to fetch the user's credentials from an external
  source, such as a directory or a database. For this sample, you use a flat
  file and the FileAttributesFilter. The key to look up the user in the flat
  file is hard coded, but you can understand how the key could come from
  something in the incoming request, such as an HTTP header, a session cookie,
  or even a SAML assertion.</p><p>For this sample you must modify the file attribute in the
  <a href="../reference/index.html#FileAttributesFilter" class="link">FileAttributesFilter</a>
  object in <code class="filename">config.json</code> to reflect the location of the
  sample flat file. The location of the user file shipped with the samples is
  <code class="filename">forgerock-sample-configs/userfile</code>.</p><pre class="cmdline prettyprint">$ cp $HOME/forgerock-sample-configs/WordPressLoginFile.json
 $HOME/.ForgeRock/OpenIG/config.json
$ jetty.sh restart</pre><p>After restarting the container, check that you can go to <a class="link" href="http://demo.forgerock.com:8080/wordpress" target="_blank">http://demo.forgerock.com:8080/wordpress</a> and be logged in as the user
  <code class="literal">george</code> without seeing the login page. To verify the login
  credentials are being picked up from the flat file, change george's password,
  restart OpenIG, and try the login page again. You should get a login failed
  page. If you would like to log in as a different user, look for the value
  attribute in <code class="filename">config.json</code>, replace
  <code class="literal">george@seinfeld.com</code> with
  <code class="literal">kramer@seinfeld.com</code>.  Both <code class="literal">george</code> and
  <code class="literal">kramer</code> have accounts on the Portal so you can log in with
  either.</p><p>To see what is happening behind the scenes, take a look at
  <code class="filename">$HOME/.ForgeRock/OpenIG/config.json</code>. For this sample,
  you added one additional filter to the LoginChain and made a slight
  modification to the LoginRequestFilter. Take a look at the LoginChain and you
  can see the filters attribute now has the value of
  <code class="literal">["FileAttributesFilter","LoginRequestFilter" ]</code>.  When the
  LoginChain is executed the FileAttributesFilter will be called prior to the
  LoginRequestFilter. The FileAttributesFilter sets the results of its lookup
  in the <a href="../reference/index.html#Exchange" class="link">Exchange</a> accessible
  through the <a href="../reference/index.html#Exchange" class="link">Expressions</a>
  <code class="literal">${exchange.credentials.<em class="replaceable"><code>xxx</code></em>}</code>
  where <em class="replaceable"><code>xxx</code></em> is the name of any one of the values
  from the flat file. Now take a look at the form attribute in the
  LoginRequestFilter. The hard coded values for log and password have been
  replaced with <code class="literal">["${exchange.credentials.username}"]</code> and
  <code class="literal">["${exchange.credentials.password}"]</code>.
  </p></div><div class="section" id="d0e1439"><div class="titlepage"><div><div><h2 class="title" style="clear: both">7.8.&nbsp;Login with Credentials From MySQL</h2></div></div></div><p>This sample fetches the login credentials from MySQL.
  You must have access to an instance of MySQL in order to execute this sample.
  If you do not have access or just want to see how the SqlAttributesFilter
  works, just read the rest of this section.</p><p>For this sample you must configure your container for JNDI and MySQL.
  See the chapter on <a href="../gateway-guide/index.html#chap-container" class="link"><em class="citetitle">Configuring
  Deployment Containers</em></a> for instructions on configuring
  containers for use with JNDI and MySQL. You also must create an entry for a
  user and create a query which returns a result with user name and password
  attributes. The query in the sample assumes there is a table named
  <code class="literal">users</code>, with attributes <code class="literal">username</code> and
  <code class="literal">password</code>. The parameter passed into the prepared statement
  is <code class="literal">email=george@seinfeld.com</code>.</p><pre class="cmdline prettyprint">$ cp $HOME/forgerock-sample-configs/WordPressLoginSQL.json
 $HOME/.ForgeRock/OpenIG/config.json
$ jetty.sh restart</pre><p>To see what is happening behind the scenes, take a look at
  <code class="filename">$HOME/.ForgeRock/OpenIG/config.json</code>. For this sample, 
  you replaced the FileAttributesFilter with the SqlAttributesFilter. The only
  difference between the filters is how they retrieve the attribute value pairs
  to set in the <a href="../reference/index.html#Exchange" class="link">Exchange</a>. Once the
  values are set in the Exchange, the LoginRequestFilter accesses them in the
  exact same way.</p></div></div><div lang="en" class="chapter" id="chap-password-capture-replay-tutorial"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;8.&nbsp;Tutorial On OpenAM Password Capture &amp; Replay</h1></div></div></div><a class="indexterm" name="d0e1477"></a><p>This tutorial walks you through an OpenAM integration with OpenAM's
 password capture and replay feature. This feature of OpenAM is typically used
 to integrate with Outlook Web Access or Sharepoint by capturing the password
 during OpenAM authentication, encrypting it, adding to the session, which is
 later decrypted and used for Basic Authentication to OWA or Sharepoint.
 This tutorial shows how you can configure OpenIG to use the user name and
 password from the OpenAM Authentication to log the user into WordPress.
 This is also how you would achieve OWA or Sharepoint integration.</p><div class="section" id="d0e1484"><div class="titlepage"><div><div><h2 class="title" style="clear: both">8.1.&nbsp;Detailed Flow</h2></div></div></div><p>The figure below illustrates the flow of requests for a user logging
  into OpenAM and then being logged into WordPress with the user name and
  password from the OpenAM login session.</p><div class="mediaobject" align="center" id="figure-password-capture-replay-tutorial"><a class="fancybox" href="images/password-capture-replay-tutorial.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_password-capture-replay-tutorial.png" align="middle" title="This diagram shows the flow of requests during user login."></a></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>User authenticates to OpenAM establishing a session, OpenAM is
    configured to capture the password, encrypt it, and then store it
    in the user's session.</p></li><li class="listitem"><p>User browses to a WordPress page requiring authentication.</p></li><li class="listitem"><p>OpenAM Agent intercepts the request, validates the user session,
    and populates HTTP headers with the user name and encrypted password
    from the session.</p></li><li class="listitem"><p>Agent passes the original request with populated headers to
    OpenIG.</p></li><li class="listitem"><p>OpenIG inspects the request, does not find a match for the
    WordPress login page, so forwards the request on.</p></li><li class="listitem"><p>WordPress finds no application session and redirects to its
    login page.</p></li><li class="listitem"><p>OpenIG intercepts, sees the login page, creates the login form
    with the user name and decrypted password from the headers inserted by
    the Agent.</p></li><li class="listitem"><p>WordPress validates the login form, returns an application
    session and the user's home page.</p></li><li class="listitem"><p>WordPress home page returned to the user.</p></li></ol></div></div><div class="section" id="d0e1523"><div class="titlepage"><div><div><h2 class="title" style="clear: both">8.2.&nbsp;Setup Summary</h2></div></div></div><p>OpenAM is installed on
  <code class="literal">http://www.idp.com:8888/openam</code>. WordPress hosted on the
  ForgeRock demo site at <a class="link" href="http://demo.forgerock.com:8080/wordpress" target="_blank">http://demo.forgerock.com:8080/wordpress</a>, populated with a sample
  user <code class="literal">george</code> with password <code class="literal">costanza</code>.
  OpenIG is deployed on an instance of Tomcat protected by an OpenAM J2EE
  agent. The J2EE agent is configured for cross domain SSO, and to add the user
  name and replay password headers to the HTTP requests.</p></div><div class="section" id="d0e1540"><div class="titlepage"><div><div><h2 class="title" style="clear: both">8.3.&nbsp;Setup Details</h2></div></div></div><p>This section assumes you are familiar with the components
  involved.</p><div class="section" id="d0e1545"><div class="titlepage"><div><div><h3 class="title">8.3.1.&nbsp;OpenAM server</h3></div></div></div><p>Install and configure OpenAM on
   <code class="literal">http://www.idp.com:8888/openam</code> with the default
   configuration. You can install OpenAM with your configuration, but
   be sure to substitute in the tutorial accordingly.</p><p>Create a sample user with user name <code class="literal">george</code>
   and password <code class="literal">constanza</code>.</p><p>To test, startup OpenAM and make sure you can login with the
   user name <code class="literal">george</code> and password
   <code class="literal">constanza</code>.</p></div><div class="section" id="d0e1569"><div class="titlepage"><div><div><h3 class="title">8.3.2.&nbsp;Tomcat Agent Profile</h3></div></div></div><div class="itemizedlist"><p>Create the J2EE agent profile with the following settings:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Server URL http://www.idp.com:8888/openam</p></li><li class="listitem"><p>Agent URL http://demo.forgerock.com:8080/agentapp</p></li><li class="listitem"><p>Under Global settings change the Agent filter mode from
     ALL to SSO_ONLY</p></li><li class="listitem"><p>Under Application &gt; Session Attributes Processing change
     the Session Attribute Fetch Mode from none to HTTP_Header</p></li><li class="listitem"><p>Under Application &gt; Session Attributes Processing &gt;
     Session Attribute Mappings add UserToken=username and
     sunIdentityUserPassword=password</p></li><li class="listitem"><p>Under SSO &gt; Cross Domain SSO select the Enabled checkbox.
     If you have installed OpenAM in the forgerock.com domain you do not
     need to enable cross domain SSO.</p></li></ul></div></div><div class="section" id="d0e1593"><div class="titlepage"><div><div><h3 class="title">8.3.3.&nbsp;Password Capture Configuration</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>In the OpenAM console under Access Control &gt; Realm &gt;
      Authentication click "All Core Settings" and add
      com.sun.identity.authentication.spi.ReplayPasswd to the
      Authentication Post Processing Classes.</p></li><li class="listitem"><p>Run <span class="command"><strong>java -classpath amserver.jar:opensso-sharedlib.jar
      com.sun.identity.common.DESGenKey</strong></span>
      to generate a shared key for the OpenAM Authentication plugin and
      OpenIG. As an example, if you have OpenAM installed under $HOME on
      Tomcat you would run the command <span class="command"><strong>java -classpath
      $HOME/tomcat7/webapps/openam/WEB-INF/lib/amserver.jar:$HOME/tomcat7/webapps/openam/WEB-INF/lib/opensso-sharedlib.jar
      com.sun.identity.common.DESGenKey</strong></span>.</p></li><li class="listitem"><p>In the OpenAM console under Configuration &gt; Servers and Sites
      click on your server name, go to Advanced and add
      com.sun.am.replaypasswd.key with the value of the key generated
      in the previous step.</p><p>You must restart the OpenAM server after changing Advanced
      properties.</p></li></ul></div></div><div class="section" id="d0e1614"><div class="titlepage"><div><div><h3 class="title">8.3.4.&nbsp;Tomcat Installation</h3></div></div></div><p>Install on OpenIG host listening on port 8080.</p><p><code class="filename">/etc/hosts</code> or equivalent with a
    mapping of demo.forgerock.com to 127.0.0.1. This example
    assumes the browser and OpenIG are on the same host. If the
    browser is on a different host you must create a mapping so that
    all requests to demo.forgerock.com are resolved to the OpenIG
    host.</p><p>To test, startup Tomcat and make sure you can browse
    to http://demo.forgerock.com:8080 and get the Tomcat home page.
    If you get a different page, then you have not modified your host
    file settings correctly. demo.forgerock.com should resolve to either
    localhost or the host OpenIG where is running.</p></div><div class="section" id="d0e1625"><div class="titlepage"><div><div><h3 class="title">8.3.5.&nbsp;Policy Agent installation</h3></div></div></div><p>Install on the OpenIG host on Tomcat at
    http://demo.forgerock.com:8080</p><p>OpenSSO server URL: http://www.idp.com:8888/openam</p><p>Install agent filter in global web.xml true</p><p>Agent URL: http://demo.forgerock.com:8080/agentapp</p><p>To test, startup Tomcat and browse to the request headers
    example at
    http://demo.forgerock.com:8080/examples/servlets/servlet/RequestHeaderExample.
    You should be redirected to OpenAM for authentication. Once logged in
    as user <code class="literal">george</code> with password
    <code class="literal">constanza</code> you should be redirected back to the
    examples page and be able to see the user name and replay password
    headers. The user name header should be george, the password header
    should be encrypted.</p></div><div class="section" id="d0e1644"><div class="titlepage"><div><div><h3 class="title">8.3.6.&nbsp;Gateway Configuration</h3></div></div></div><p>See <a href="../gateway-guide/index.html#chap-install" class="link"><em class="citetitle">Installing
   OpenIG</em></a> for instructions, and have your
   container listen on port 8080. Install OpenIG in the root context by
   removing the existing root context directory
   <code class="filename">$HOME/tomcat/webapps/ROOT/</code> and then renaming the OpenIG
   .war to <code class="filename">$HOME/tomcat/webapps/ROOT.war</code>.</p><p>Download the <a class="link" href="http://openig.forgerock.org/WordPressDecryptHeaderLogin.json" target="_top">WordPressDecryptHeaderLogin.json</a> configuration file, and use it to
   replace <code class="filename">$HOME/.ForgeRock/OpenIG/config.json</code>.</p><p>Search for and replace <code class="literal">DESKEY</code> with the key
   generated when you enabled the password capture feature in OpenAM.</p><p>Restart OpenIG after making changes to
   <code class="filename">config.json</code>.</p></div><div class="section" id="d0e1677"><div class="titlepage"><div><div><h3 class="title">8.3.7.&nbsp;Trying It Out</h3></div></div></div><p>Browse to WordPress. If you are not already logged into OpenAM you
   should be redirected to the OpenAM login page. You should login with user
   name <code class="literal">george</code> and password <code class="literal">constanza</code>.
   After login you should be redirected back to the WordPress portal homepage.
   Now click on the login link and OpenIG logs you in as George Costanza.</p><p>To see what is happening behind the scenes, take a look at
   <code class="filename">$HOME/.ForgeRock/OpenIG/config.json</code>. Look for the
   HandlerServlet. This is the servlet entry point to OpenIG. Notice it is
   calling the DispatchHandler. The DispatchHandler has a condition which
   checks for the presence of <code class="filename">wp-login.php</code> (the login
   page) in the URI path. If the condition is false (no login page), the
   ClientHandler is called sending the request on to the WordPress. If the
   condition is true, the Gateway has found the login page, and calls the
   LoginChain for further processing. The LoginChain calls its filters, the
   CryptoFilter, which looks for the replay password header and decrypts it,
   the LoginRequestFilter, which creates the login form, and then calls the
   ClientHandler to send the form to the WordPress. If you look at the
   LoginRequestFilter, you notice it defines the method, URI, and form
   parameters for the request which is sent by the ClientHandler. In the
   form parameters you see the user name and password retrieved from the user
   name and replay password headers in the HTTP request. These headers are
   created by the OpenAM agent from the user's OpenAM session and the replay
   password header is decrypted by the CryptoFilter prior to the
   LoginRequestFilter being executed.</p></div></div></div><div lang="en" class="chapter" id="chap-federation"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;9.&nbsp;Using the Federation Gateway</h1></div></div></div><p>The Federation component of OpenIG is a standards based
 authentication service used by OpenIG to validate a user and retrieve
 key attributes of the user in order to log them into the target
 applications.</p><div class="orderedlist"><p>There are two ways the Federation Service can be invoked:</p><ol class="orderedlist" type="1"><li class="listitem"><p>IDP initiated SSO, where the remote Identity Provider sends an
    unsolicited Authentication statement to OpenIG
   </p></li><li class="listitem"><p>SP initiated SSO where OpenIG calls the Federation Service to
    initiate Federated SSO with the Identity provider
   </p></li></ol></div><p>In either case, the job of the Federation Service is to validate the
 user and pass the required attributes to OpenIG to log the user into
 target applications.</p><p>See the <a href="../gateway-guide/index.html#chap-federation-tutorial" class="link"><em class="citetitle">Tutorial For the
 Federation Gateway</em></a> for hands on experience with the
 Federation Gateway.</p><div class="section" id="federation-installation"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.1.&nbsp;Installation Overview</h2></div></div></div><a class="indexterm" name="d0e1722"></a><div class="itemizedlist"><p>This section is a summary of the steps needed to prepare OpenIG to
   act as a Federation endpoint for your target application.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Install the OpenIG Federation .war.</p></li><li class="listitem"><p>Configure OpenIG to log users into the target application.
    Getting this to work before configuring Federation makes the
    process much simpler to troubleshoot if anything goes wrong.</p></li><li class="listitem"><p>Add Federation configuration to the OpenIG configuration file.</p></li><li class="listitem"><p>Add the assertion and subject mappings, optional redirect URI and
    optional logout URI to the Federation configuration.</p></li><li class="listitem"><p>Export the Identity Provider MetaData from the remote Identity
     Provider or use the meta data from the OpenAM generated fedlet.
    </p></li><li class="listitem"><p>Import OpenIG metadata to your Identity Provider.</p></li></ul></div></div><div class="section" id="federation-configuration-files"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.2.&nbsp;Configuration File Overview</h2></div></div></div><a class="indexterm" name="d0e1751"></a><p>The Federation service is configured by modifying the OpenIG
  <code class="filename">config.json</code> and Federation specific XML files located
  in the home directory of the effective user running the web application
  container housing OpenIG. The home directory of this user is referred to as
  <code class="filename">$HOME_DIR</code> in this document. By default, the
  Federation service looks in <code class="filename">$HOME_DIR/.ForgeRock/OpenIG/</code>
  for <code class="filename">config.json</code> and
  <code class="filename">$HOME_DIR/.ForgeRock/SAML/</code> for the Federation XML
  configuration.</p><div class="variablelist"><p>The following is a description of the files:</p><dl class="variablelist"><dt><span class="term"><code class="filename">$HOME_DIR/.ForgeRock/OpenIG/config.json</code></span></dt><dd><p>This is the core configuration file for OpenIG. You must configure
     both this file and the XML files specific to the Federation Service.
     The reason there are two sets of configuration files is the Federation
     Service is based on the openFed library from the OpenAM open source
     project. The openFed library and the Federation configuration files are
     taken directly from the OpenFM release. In order to get the Federation
     Service configured you must tag swap the XML files. If you are familiar
     with the workflow in the OpenAM console you can generate a Fedlet and
     directly copy the configuration files into
     <code class="filename">$HOME_DIR/.ForgeRock/SAML/</code>.</p></dd><dt><span class="term"><code class="filename">$HOME_DIR/.ForgeRock/SAML/FederationConfig.properties</code></span></dt><dd><p>Advanced features of the openFed library. The defaults suffice in
     most deployments.</p></dd><dt><span class="term"><code class="filename">$HOME_DIR/.ForgeRock/SAML/gateway.cot</code></span></dt><dd><p>Circle of trust for OpenIG and the Identity Provider.</p></dd><dt><span class="term"><code class="filename">$HOME_DIR/.ForgeRock/SAML/idp.xml</code></span></dt><dd><p>This file is not included with the Federation Service XML. It must
     be generated by the Identity Provider and copied into the configuration
     directory.</p></dd><dt><span class="term"><code class="filename">$HOME_DIR/.ForgeRock/SAML/idp-extended.xml</code></span></dt><dd><p>Standard extensions for the Identity Provider.</p></dd><dt><span class="term"><code class="filename">$HOME_DIR/.ForgeRock/SAML/sp.xml</code>, </span><span class="term"><code class="filename">$HOME_DIR/.ForgeRock/SAML/sp-extended.xml</code></span></dt><dd><p>These are the standard metadata and metadata extensions for the
     OpenIG Federation Service.</p></dd></dl></div></div><div class="section" id="federation-configuring"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.3.&nbsp;Configuring the Federation Service</h2></div></div></div><a class="indexterm" name="d0e1827"></a><p>The simplest way to configure the OpenIG Federation Gateway is to use
  the OpenAM task wizard to generate a Fedlet and then use the Fedlet
  configuration files in the Gateway configuration directory. If you use the
  Fedlet configuration files, simply unpack <code class="filename">Fedlet.war</code>
  and copy all the files listed above into
  <code class="filename">$HOME_DIR/.ForgeRock/SAML/</code>. You do not have to modify
  the files to do basic IDP and SP initiated SSO with OpenIG. Note that the
  sample Federation Gateway <code class="filename">config.json</code> templates uses
  <code class="literal">/saml</code> as the URI so your Fedlet endpoint should be
  specified as <code class="literal"><em class="replaceable"><code>protocol</code></em>://<em class="replaceable"><code>host</code></em>.<em class="replaceable"><code>domain</code></em>:<em class="replaceable"><code>port</code></em>/saml</code>.</p><p>If you do not use the Fedlet wizard, then follow the instructions for
  the unconfigured Fedlet and then copy the Fedlet configuration files to the
  <code class="filename">$HOME_DIR/.ForgeRock/SAML/</code> directory. You must also
  export the metadata from the IDP and copy it to <code class="filename">idp.xml</code>
  in the same directory.</p></div><div class="section" id="federation-config-json"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.4.&nbsp;Config.json Sample</h2></div></div></div><p>The following sample configuration is from the tutorial on federating
  WordPress. The sample configuration receives a SAML assertion from OpenAM
  and then logs the user into WordPress using the user name and password from
  the assertion.</p><p>The following excerpt of the Federation Service JSON is from the OpenIG
  <code class="filename">config.json</code> file. All fields are mandatory except
  <code class="literal">logoutURI</code>. The <code class="literal">logoutURI</code> is only
  necessary if your configuration uses the single logout feature.</p><pre class="codelisting prettyprint">{
    "name": "FederationServlet",
    "type": "org.forgerock.openig.saml.FederationServlet",
    "config": {
        "assertionMapping": {
            "userName":"uid",
            "password":"userPassword" 
        },
        "subjectMapping":"subjectName",
        "sessionIndexMapping":"sessionIndex",
        "redirectURI":"/login",
        "logoutURI":"/logout"
        "assertionConsumerEndpoint":"fedletapplication",
        "SPinitiatedSSOEndpoint":"SPInitiatedSSO",
        "singleLogoutEndpoint":"fedletSlo"
   }
}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">name</span></dt><dd><p>Name of the Federation Service within the OpenIG runtime.
     This value should not be modified.</p></dd><dt><span class="term">type</span></dt><dd><p>Classname of the Federation Servlet. This value should not be
     modified.</p></dd><dt><span class="term">asertionMapping</span></dt><dd><p>The <code class="literal">assertionMapping</code> defines how to transform the
     attributes from the incoming assertion to attribute value pairs in the
     session. Each entry in the <code class="literal">assertionMapping</code> is of the
     form <code class="literal"><em class="replaceable"><code>attributeName</code></em>:<em class="replaceable"><code>assertionName</code></em></code>. The
     <em class="replaceable"><code>attributeName</code></em> represents the name of the
     attribute set in the session. The <em class="replaceable"><code>assertionName</code></em>
     is used to fetch the value from the incoming assertion, which becomes the
     value in the session. The following statements correspond to the sample
     shown above.</p><p>If the incoming assertion contains the statement:</p><pre class="literallayout">uid = jojo</pre><pre class="literallayout">userPassword = 123456789</pre><p>Then the following values are set in the session:</p><pre class="literallayout">userName = jojo</pre><pre class="literallayout">password = 123456789</pre><p>Notice that you must also modify attributeMap in the
     <code class="filename">$HOME_DIR/.ForgeRock/SAML/sp-extended.xml</code> to match
     the assertion mapping configured in the IDP metadata.</p></dd><dt><span class="term">subjectMapping</span></dt><dd><p>The value contained in the assertion subject is set as the value of
     the attribute <code class="literal">subjectName</code> in the session.</p></dd><dt><span class="term">redirectURI</span></dt><dd><p>The <code class="literal">redirectURI</code> should be set to the page the
     Form-Filter recognizes as the login page for the target application.
     This is how OpenIG and the Federation service work together to provide
     single sign-on. When OpenIG detects the target application's login page,
     it redirects to the Federation Service. Once the Federation Service
     validates the SAML exchanges with the IDP and sets the required session
     attributes, it redirect back to the target application's login page.
     This allows the Form-Filter to finish the job of logging in the user by
     retrieving the necessary user data from the session and creating a login
     form for the application.</p></dd><dt><span class="term">logoutURI</span></dt><dd><p>The <code class="literal">logoutURI</code> should be set to the URI which logs
     the user out of  the target application. This attribute is only needed if
     your application uses the single log-out feature of the Identity
     Provider.</p></dd><dt><span class="term">assertionConsumerEndpoint</span></dt><dd><p>The default value of <code class="literal">fedletapplication</code> is the same
     as the Fedlet. If you modify this attribute you must change the metadata
     to match.</p></dd><dt><span class="term">SPinitiatedSSOEndpoint</span></dt><dd><p>The default value is <code class="literal">SPInitiatedSSO</code>. If you
     modify this attribute you must change the metadata to match.</p></dd><dt><span class="term">singleLogoutEndpoint</span></dt><dd><p>The default value of <code class="literal">fedletSLO</code> is the same as the
     Fedlet. If you modify this attribute you must change the metadata to
     match.</p></dd></dl></div></div><div class="section" id="federation-example-settings"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.5.&nbsp;Example Settings</h2></div></div></div><p>Application myportal requires a form with userName and password for
  login. The userName for myportal is the mail attribute at the user's Identity
  Provider. The password for myportal is the mailPassword at the Identity
  Provider. The incoming SAML2 assertion sent by the Identity Provider contains
  the mail and mailPassword attributes. The Federation Service validates the
  incoming assertion, sets the userName and password in the HttpSession to the
  values of mail and mailPassword from the assertion, and redirects the user
  to <code class="literal">/myportal/login</code>. The LoginRequest Filter then retrieves
  the login values from the session and creates the form to log the user into
  myportal.</p><pre class="codelisting prettyprint">{
    "name": "FederationServlet",
    "type": "org.forgerock.openig.saml.FederationServlet",
    "config": {
            "assertionMapping": {
                 "userName":"mail",
                 "password":"mailPassword"
            }
            "redirectURI":"/myportal/login",
            "logoutURI":"/myportal/logout" 
    }
}</pre><pre class="codelisting prettyprint">{
    "name": "LoginRequest",
    "type": "StaticRequestFilter",
    "config": {
        "method": "POST",
        "uri": "https://10.10.0.5/login",
        "form": {
            "userName": [${exchange.session.userName}],
            "password": [${exchange.session.password}],
        }   
    }   
}</pre></div><div class="section" id="federation-idp-metadata"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.6.&nbsp;Identity Provider Metadata</h2></div></div></div><p>The Identity Provider metadata must be in
  <code class="filename">$HOME_DIR/.ForgeRock/SAML/idp.xml</code> directory. See the 
  documentation for your Identity Provider for instructions on how to get the
  metadata.</p><p>To export Identity Provider metadata from OpenAM, run a command such
  as the following.</p><pre class="cmdline prettyprint">$ ssoadm
 export-entity
 -u amadmin
 -f /tmp/pass
 -y http://www.idp.com:8080/openam
 -m /tmp/idp.xml</pre></div></div><div lang="en" class="chapter" id="chap-federation-tutorial"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;10.&nbsp;Tutorial For the Federation Gateway</h1></div></div></div><a class="indexterm" name="d0e2027"></a><p>This tutorial expands on the <a href="../gateway-guide/index.html#chap-gateway-tutorial" class="link"><em class="citetitle">Tutorial With
 WordPress</em></a> by showing you how to configure OpenIG
 as a SAML2 Federation endpoint to log the user into WordPress. When you
 complete this tutorial you will have configured OpenAM to send a SAML2
 assertion to OpenIG and configured OpenIG to validate the assertion and to
 use the <code class="literal">mail</code> and <code class="literal">employeenumber</code>
 attribute values from the assertion to log the user into WordPress.</p><div class="section" id="fed-tutorial-before-you-start"><div class="titlepage"><div><div><h2 class="title" style="clear: both">10.1.&nbsp;Before You Start</h2></div></div></div><p>Follow the <a href="../gateway-guide/index.html#chap-gateway-tutorial" class="link"><em class="citetitle">Tutorial With
  WordPress</em></a>, and make sure you can login to WordPress
  before continuing this tutorial.</p></div><div class="section" id="fed-tutorial-configure-openam"><div class="titlepage"><div><div><h2 class="title" style="clear: both">10.2.&nbsp;Configuring OpenAM</h2></div></div></div><p>For this sample and the test URIs, OpenAM is configured on
  <code class="literal">http://www.idp.com:8888/openam</code>. You can of course use any
  configuration, but be sure to substitute the proper values for the test
  URLs.</p><p>Use the OpenAM Console task wizard to create a Fedlet with the Name
  gateway and the Destination URL
  <code class="literal">http://demo.forgerock.com:8080/saml</code>. Configure the
  Attributes Mapping to contain the <code class="literal">mail</code> and
  <code class="literal">employeenumber</code> attributes.</p><p>Create a user with <code class="literal">mail</code> attribute
  <code class="literal">george</code> and
  <code class="literal">employeenumber costanza</code>.</p></div><div class="section" id="fed-tutorial-configure-federation"><div class="titlepage"><div><div><h2 class="title" style="clear: both">10.3.&nbsp;Configuring OpenIG For Federation</h2></div></div></div><p>Download the <a class="link" href="http://openig.forgerock.org/FederationWordpress.json" target="_blank">Federation
  to WordPress Sample Config File</a> and copy it to
  <code class="filename">$HOME/.ForgeRock/OpenIG/config.json</code>, overwriting the
  <code class="filename">config.json</code> from the WordPress tutorial.</p><p>Assuming <code class="filename">Fedlet.zip</code> from the previous step is
  found in <code class="filename">$HOME/openam/myfedlets/Fedlet.zip</code> extract the
  Fedlet configuration files using the following commands:</p><pre class="cmdline prettyprint">$ cd $HOME/openam/myfedlets
$ unzip Fedlet.zip
$ jar xvf Fedlet.war conf</pre><p>Create a <code class="filename">$HOME/.ForgeRock/SAML/</code> directory,
  and copy the Fedlet configuration to the new directory.</p><pre class="cmdline prettyprint">$ mkdir $HOME/.ForgeRock/SAML
$ cp conf/* $HOME/.ForgeRock/SAML
$ ls $HOME/.ForgeRock/SAML
FederationConfig.properties    idp-extended.xml        sp-extended.xml
fedlet.cot                     idp.xml                 sp.xm</pre></div><div class="section" id="fed-tutorial-testing"><div class="titlepage"><div><div><h2 class="title" style="clear: both">10.4.&nbsp;Trying It Out</h2></div></div></div><p>For IDP initiated SSO <a class="link" href="http://www.idp.com:8888/openam/idpssoinit?NameIDFormat=urn:oasis:names:tc:SAML:2.0:nameid-format:transient&amp;metaAlias=/idp&amp;spEntityID=gateway&amp;binding=urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" target="_blank">click this link</a>
  </p><p>For SP initiated SSO either browse to <a class="link" href="http://demo.forgerock.com:8080/wordpress/" target="_blank">http://demo.forgerock.com:8080/wordpress/</a> and click the login link,
  or <a class="link" href="http://demo.forgerock.com:8080/saml/SPInitiatedSSO?metaAlias=/sp&amp;idpEntityID=http://www.idp.com:8888/openam&amp;binding=urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" target="_blank">click this link</a>
  </p><p>To understand what is happening behind the scenes, take a look at
  <code class="filename">$HOME/.ForgeRock/OpenIG/config.json</code>. The HandlerServlet
  is no longer the entry point to OpenIG processing. If you look for the
  servletObject at the end of the file you see the HandlerServlet has been
  replaced by the DispatchServlet. The DispatchServlet provides an internal
  routing mechanism based on the incoming URI. The DispatchServlet looks at
  the incoming URI and dispatches to the FederationServlet when the SAML URI
  is found, otherwise it dispatches to the HandlerServlet as in the previous
  sample. This allows the FederationServlet to process the incoming assertion,
  set the attributes from the assertion in the HTTPSession, which then allows
  the normal chain of filter processing, through the HandlerServlet, to pick up
  the credentials and log the user into the target application.</p></div></div><div lang="en" class="chapter" id="chap-gateway-templates"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;11.&nbsp;Configuration Templates</h1></div></div></div><p>This chapter contains templates of common configurations. Start with one
 of our templates and then modify to suit your deployment. Read the summary of
 each template to find the right match for your application. If you are not
 sure about the characteristics of your application, start with the basic
 Application Capture template. This template allows you to setup basic proxying
 and capture the traffic of the login sequence in a flat file, which then
 allows you to analyze the application and subsequently choose the right
 template or add your own configuration.</p><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>All templates have the <a href="../reference/index.html#CaptureFilter" class="link">CaptureFilter</a>
    enabled by default. Remove the capture filter from the outgoing chain
    before running the gateway in production. Capturing is typically used only
    for initial development or debugging and may rapidly fill up your available
    disk space if left enabled.</p></li><li class="listitem"><p>Substitute the <code class="literal">TARGETIP</code> tag with the IP address of
    your application.</p></li><li class="listitem"><p>Modify the <code class="literal">LoginRequest</code> filter to match the form
    required for login by your target application.</p></li></ul></div></div></div><div class="section" id="template-proxy-capture"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.1.&nbsp;Proxy &amp; Capture</h2></div></div></div><a class="indexterm" name="d0e2166"></a><p>Proxies all requests and captures them in a flat file. Use this
  template if you need to analyze the traffic for your application. Simply
  change the <code class="literal">baseURI</code> to be that of the target application,
  restart OpenIG, and login to the application. The entire sequence is logged
  to the flat file.</p><pre class="codelisting prettyprint">{
    "heap": {
        "objects": [
            {
                "name": "HandlerServlet",
                "comment": "Transforms Servlet request to handler request.",
                "type": "HandlerServlet",
                "config": {
                    "handler": "DispatchHandler"
                }
            },
            {
                "name": "DispatchHandler",
                "type": "DispatchHandler",
                "config": {
                    "bindings": [
                        {
                            "condition": "${exchange.request.uri.scheme == 'http'}",
                            "handler": "OutgoingChain",
                            "baseURI": "http://TARGETIP"
                        },
                        {
                            "condition": "${exchange.request.uri.path == '/login'}",
                            "handler": "LoginChain",
                            "baseURI": "https://TARGETIP"
                        },
                        {
                            "handler": "OutgoingChain",
                            "baseURI": "https://TARGETIP"
                        }
                    ]
                }
            },
            {
                "name": "LoginChain",
                "type": "Chain",
                "config": {
                    "filters": [],
                    "handler": "OutgoingChain"
                }
            },
            {
                "name": "OutgoingChain",
                "type": "Chain",
                "config": {
                    "filters": [
                        "CaptureFilter"
                    ],
                    "handler": "ClientHandler"
                }
            },
            {
                "name": "CaptureFilter",
                "type": "CaptureFilter",
                "config": {
                    "captureEntity": false,
                    "file": "/tmp/gateway.log"
                }
            },
            {
                "name": "ClientHandler",
                "comment": "Sends all requests to remote servers.",
                "type": "ClientHandler",
                "config": {}
            }
        ]
    },
    "servletObject": "HandlerServlet"
}</pre></div><div class="section" id="template-simple-login"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.2.&nbsp;Simple Login Form</h2></div></div></div><a class="indexterm" name="d0e2183"></a><p>Logs the user into the target application with hard-coded user name
  and password. This template intercepts the login page request and replaces
  it with the login form.</p><pre class="codelisting prettyprint">{
  "heap": {
    "objects": [
    {
        "name": "HandlerServlet",
        "comment": "Entry point that transforms Servlet request to handler request.",
        "type": "HandlerServlet",
        "config": {
            "handler": "DispatchHandler",
            "baseURI":"http://TARGETIP"
        }
    },
    {       
        "name": "DispatchHandler",
        "type": "DispatchHandler",
        "config": {
            "bindings": [   
                {                       
                    "condition": "${exchange.request.uri.path == '/login'}",
                    "handler": "LoginChain",
                }, 
                {                       
                    "handler": "OutgoingChain",
                }, 
            ]   
        }   
    },
    {
        "name": "LoginChain",
        "type": "Chain",
        "config": {
            "filters": ["LoginRequest"],
            "handler": "OutgoingChain" 
        }   
    },
    {   
        "name": "LoginRequest",
        "type": "StaticRequestFilter",
        "config": {
            "method": "POST",
            "uri": "https://TARGETIP/login",
            "form": {
                "USER": ["myusername"],
                "PASSWORD": ["mypassword"],
            }   
        }   
    },
    {
        "name": "OutgoingChain",
        "type": "Chain",
        "config": {
            "filters": ["CaptureFilter"],
            "handler": "ClientHandler" 
        }   
    },
    {   
        "name": "CaptureFilter",
        "type": "CaptureFilter",
        "config": {
            "captureEntity": false,
            "file": "/tmp/gateway.log",
        }       
    },
    {
        "name": "ClientHandler",
        "comment": "Responsible for sending all requests to remote servers.",
        "type": "ClientHandler",
        "config": {
            }
        }
    ]
  },
  "servletObject": "HandlerServlet",
}
</pre></div><div class="section" id="template-login-cookie"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.3.&nbsp;Login Form With Cookie From Login Page</h2></div></div></div><a class="indexterm" name="d0e2197"></a><p>For applications that expect a cookie from the login page to be sent
  in the login request form. This templates allows the login page request to
  go through to the target, intercepts the response, then creates the login
  form and adds the intercepted cookie to the POST.</p><pre class="codelisting prettyprint">{
  "heap": {
    "objects": [
    {
        "name": "HandlerServlet",
        "comment": "Entry point that transforms Servlet request to handler request.",
        "type": "HandlerServlet",
        "config": {
            "handler": "DispatchHandler",
            "baseURI":"http://TARGETIP"
        }
    },
    {       
        "name": "DispatchHandler",
        "type": "DispatchHandler",
        "config": {
            "bindings": [   
                {                       
                    "condition": "${exchange.request.uri.path == '/eum/login'}",
                    "handler": "LoginChain",
                }, 
                {                       
                    "handler": "OutgoingChain",
                }, 
            ]   
        }   
    },
    {
        "name": "LoginChain",
        "type": "Chain",
        "config": {
            "filters": ["SwitchFilter"],
            "handler": "OutgoingChain" 
        }   
    },
    {
        "name": "SwitchFilter",
        "type": "SwitchFilter",
        "config": {
            "onResponse": [
                {
                    "handler": "LoginRequestHandler"
                }
            ]
        }
    },
    {
        "name": "LoginRequestHandler",
        "type": "Chain",
        "config": {
            "filters": ["LoginRequest"],
            "handler": "OutgoingChain" 
        }   
    },
    {   
        "name": "LoginRequest",
        "type": "StaticRequestFilter",
        "config": {
            "method": "POST",
            "uri": "https://TARGETIP/login",
            "form": {
                "USER": ["myusername"],
                "PASSWORD": ["mypassword"],
            }   
            "headers": {
                "cookie": ["${exchange.response.headers['Set-Cookie'][0]}"],
            }   
        }   
    },
    {
        "name": "OutgoingChain",
        "type": "Chain",
        "config": {
            "filters": ["CaptureFilter"],
            "handler": "ClientHandler" 
        }   
    },
    {   
        "name": "CaptureFilter",
        "type": "CaptureFilter",
        "config": {
            "captureEntity": false,
            "file": "/tmp/gateway.log",
        }       
    },
    {
        "name": "ClientHandler",
        "comment": "Responsible for sending all requests to remote servers.",
        "type": "ClientHandler",
        "config": {
            }
        }
    ]
  },
  "servletObject": "HandlerServlet",
}
</pre></div><div class="section" id="template-login-extract-cookie-filters"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.4.&nbsp;Login Form With Extract Filter &amp; Cookie Filter</h2></div></div></div><a class="indexterm" name="d0e2211"></a><p>For applications that return the login page when the user tries to
  access a page without a valid session. This template shows how to use the
  <code class="literal">ExtractFilter</code> to find the login page on the response and
  use the <code class="literal">CookieFilter</code> to ensure the cookies from the
  application are replayed on each request. The sample application in this
  template is OpenAM. If you change the <code class="literal">TARGETIP:PORT</code> to be
  the IP address of OpenAM, the <code class="literal">TARGETDN:PORT</code> to be the
  fully qualified name and port of OpenAM and modify <code class="literal">USERNAME</code>
  and <code class="literal">PASSWORD</code> in the <code class="literal">LoginRequest</code> you
  automatically log <code class="literal">USERNAME</code> into OpenAM.</p><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>Without the <code class="literal">CookieFilter</code> in the
   <code class="literal">OutgoingChain</code> the cookie set in the login page response
   would not get set in the browser since that request is intercepted before
   it gets to the browser. The simplest way to deal with this situation is to
   let OpenIG manage all the cookies by enabling the
   <code class="literal">CookieFilter</code>. The side effect of OpenIG managing
   cookies is none of the cookies are sent to the browser, but are managed
   locally by OpenIG.</p></div></div><pre class="codelisting prettyprint">{
  "heap": {
    "objects": [
    {
        "name": "HandlerServlet",
        "comment": "Entry point that transforms Servlet request to handler request.",
        "type": "HandlerServlet",
        "config": {
            "handler": "FindLoginPageChain",
            "baseURI":"http://TARGETIP:PORT"
        }
    },
    {
        "name": "FindLoginPageChain",
        "type": "Chain",
        "config": {
            "filters": ["IsLoginPage","FindLoginPage"],
            "handler": "OutgoingChain" 
        }   
    },
    {
        "name": "FindLoginPage",
        "type": "EntityExtractFilter",
        "config": {
            "messageType": "response",
            "target": "${exchange.isLoginPage}",
            "bindings": [
                 {
                     "key": "found",
                     "pattern": "OpenAM\s\(Login\)",
                     "template": "true"
                 }
             ]
          }
    },
    {
        "name": "IsLoginPage",
        "type": "SwitchFilter",
        "config": {
            "onResponse": [
                 {
                    "condition": "${exchange.isLoginPage.found == 'true'}",
                     "handler": "LoginChain"
                 }
             ]
          }
    },
    {
        "name": "LoginChain",
        "type": "Chain",
        "config": {
            "filters": ["LoginRequest"],
            "handler": "OutgoingChain"
        }
    },
    {   
        "name": "LoginRequest",
        "type": "StaticRequestFilter",
        "config": {
            "method": "POST",
            "uri": "http://TARGETIP:PORT/openam/UI/Login"
            "form": {
                "IDToken0":[""]
                "IDToken1":["USERNAME"]
                "IDToken2":["PASSWORD"]
                "IDButton":["Log+In"]
                "encoded":["false"]
            },   
            "headers": {
                "host":["TARGETFQDN:PORT"]
            }   
            
        }   
    },
   {
        "name": "OutgoingChain",
        "type": "Chain",
        "config": {
            "filters": ["CookieFilter","CaptureFilter"],
            "handler": "ClientHandler" 
        }   
    },
            {
                "name": "CookieFilter",
                "type": "CookieFilter",
                "config": {
                }
         },

    {   
        "name": "CaptureFilter",
        "type": "CaptureFilter",
        "config": {
            "captureEntity": true,
            "file": "/tmp/gateway.log",
        }       
    },
    {
    "name": "LogSink",
    "comment": "Default sink for logging information.",
    "type": "ConsoleLogSink",
    "config": {
        "level": "DEBUG",
    }
}
    {
        "name": "ClientHandler",
        "comment": "Responsible for sending all requests to remote servers.",
        "type": "ClientHandler",
        "config": {
            }
        }
    ]
  },
  "servletObject": "HandlerServlet",
}
</pre></div><div class="section" id="template-login-hidden-value"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.5.&nbsp;Login Which Requires a Hidden Value From the Login Page</h2></div></div></div><a class="indexterm" name="d0e2261"></a><p>Extracts a hidden value from the login page and includes it in the
  login form POSTed to the target application.</p><pre class="codelisting prettyprint">{
  "heap": {
    "objects": [
    {
        "name": "HandlerServlet",
        "comment": "Entry point that transforms Servlet request to handler request.",
        "type": "HandlerServlet",
        "config": {
            "handler": "DispatchHandler",
            "baseURI":"http://TARGETIP"
        }
    },
    {       
        "name": "DispatchHandler",
        "type": "DispatchHandler",
        "config": {
            "bindings": [   
                {                       
                    "condition": "${exchange.request.uri.path == '/login'}",
                    "handler": "LoginChain",
                }, 
                {                       
                    "handler": "OutgoingChain",
                }, 
            ]   
        }   
    },
    {
        "name": "LoginChain",
        "type": "Chain",
        "config": {
            "filters": ["HiddenValueExtract","LoginRequest"],
            "handler": "OutgoingChain" 
        }   
    },
    {
	"name": "HiddenValueExtract",
	"type": "EntityExtractFilter",
	"config": {
	    "messageType": "response",
	    "target": "${exchange.hiddenValue}",
	    "bindings": [
		{
		    "key": "value",
		    "pattern": "wpLoginToken\"\s.*value=\"(.*)\"",
		    "template": "$1"
		}
	    ]
	}
    },
    {   
        "name": "LoginRequest",
        "type": "StaticRequestFilter",
        "config": {
            "method": "POST",
            "uri": "https://TARGETIP/login",
            "form": {
                "USER": ["myusername"],
                "PASSWORD": ["mypassword"],
                "hiddenValue": ["${exchange.hiddenValue.value}"],
            }   
        }   
    },
    {
        "name": "OutgoingChain",
        "type": "Chain",
        "config": {
            "filters": ["CaptureFilter"],
            "handler": "ClientHandler" 
        }   
    },
    {   
        "name": "CaptureFilter",
        "type": "CaptureFilter",
        "config": {
            "captureEntity": false,
            "file": "/tmp/gateway.log",
        }       
    },
    {
        "name": "ClientHandler",
        "comment": "Responsible for sending all requests to remote servers.",
        "type": "ClientHandler",
        "config": {
            }
        }
    ]
  },
  "servletObject": "HandlerServlet",
}
</pre></div><div class="section" id="template-http-and-https"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.6.&nbsp;HTTP &amp; HTTPS Application</h2></div></div></div><a class="indexterm" name="d0e2275"></a><p>Proxies traffic to an application listening on ports 80 and 443. The
  assumption is the application uses HTTPS for authentication and HTTP for the
  general application features. Assuming the login will all take place on
  port 443, you will need to add the login filters and handlers to the
  <code class="literal">LoginChain</code>. To get started quickly, modify the
  <code class="literal">baseURI</code> to be the <code class="literal">IPAddress</code> of your
  target application. This should allow you to proxy all traffic to the
  application. Then add the logic for the <code class="literal">LoginChain</code> using
  the flow from one of the login templates.</p><pre class="codelisting prettyprint">{
  "heap": {
    "objects": [
    {
        "name": "HandlerServlet",
        "comment": "Entry point that transforms Servlet request to handler request.",
        "type": "HandlerServlet",
        "config": {
            "handler": "DispatchHandler",
        }
    },
    {       
        "name": "DispatchHandler",
        "type": "DispatchHandler",
        "config": {
            "bindings": [   
                {                       
                    "condition": "${exchange.request.uri.scheme == 'http'}",
                    "handler": "OutgoingChain",
                    "baseURI":"http://TARGETIP"
                },  
                {                       
                    "condition": "${exchange.request.uri.path == '/login'}",
                    "handler": "LoginChain",
                    "baseURI":"https://TARGETIP"
                }, 
                {                       
                    "handler": "OutgoingChain",
                    "baseURI":"https://TARGETIP"
                }, 
            ]   
        }   
    },
    {
        "name": "LoginChain",
        "type": "Chain",
        "config": {
            "filters": [],
            "handler": "OutgoingChain" 
        }   
    },
    {
        "name": "OutgoingChain",
        "type": "Chain",
        "config": {
            "filters": ["CaptureFilter"],
            "handler": "ClientHandler" 
        }   
    },
    {   
        "name": "CaptureFilter",
        "type": "CaptureFilter",
        "config": {
            "captureEntity": false,
            "file": "/tmp/gateway.log",
        }       
    },
    {
        "name": "ClientHandler",
        "comment": "Responsible for sending all requests to remote servers.",
        "type": "ClientHandler",
        "config": {
            }
        }
    ]
  },
  "servletObject": "HandlerServlet",
}
</pre></div><div class="section" id="template-multiple-apps"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.7.&nbsp;Multiple Applications</h2></div></div></div><a class="indexterm" name="d0e2301"></a><p>Shows how a single OpenIG configuration can proxy to multiple
  applications on different IPs and ports. This template is setup to proxy to
  both the WordPress and MediaWiki hosted samples. OpenIG must be setup to
  listen on both ports 8080 and 8181. The <code class="literal">DispatchHandler</code> is
  used to route each incoming request to either the WordPress chain or the
  MediaWiki chain.</p><pre class="codelisting prettyprint">{
  "heap": {
    "objects": [
    {
        "name": "HandlerServlet",
        "type": "HandlerServlet",
        "config": {
            "handler": "DispatchHandler"
        }
    },
    {       
        "name": "DispatchHandler",
        "type": "DispatchHandler",
        "config": {
            "bindings": [   
                {                       
                    "condition": "${exchange.request.uri.host == 'demo.forgerock.com'}",
                    "handler": "WordPressLoginChain",
                    "baseURI":"http://109.73.67.52:8080",
                },  
                {                       
                    "condition": "${exchange.request.uri.host == 'demo.forgerock.com'}",
                    "handler": "MediaWikiLoginChain",
                    "baseURI":"http://109.73.67.52:8181"
                }
            ]   
        }   
    },
    {
        "name": "WordPressLoginChain",
        "type": "Chain",
        "config": {
            "filters": [],
            "handler": "OutgoingChain"
        }   
    },
    {
        "name": "MediaWikiLoginChain",
        "type": "Chain",
        "config": {
            "filters": [],
            "handler": "OutgoingChain"
        }   
    },
    {
        "name": "OutgoingChain",
        "type": "Chain",
        "config": {
            "filters": ["CaptureFilter"],
            "handler": "ClientHandler"
        }   
    },
    {   
        "name": "CaptureFilter",
        "type": "CaptureFilter",
        "config": {
            "captureEntity": false,
            "file": "/tmp/gateway.log"
        }       
    },
    {
        "name": "ClientHandler",
        "comment": "Responsible for sending all requests to remote servers.",
        "type": "ClientHandler",
        "config": {
        }
    }
  ]
},
  "servletObject": "HandlerServlet",
}
</pre></div><div class="section" id="template-am-integration-headers"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.8.&nbsp;OpenAM Integration With Headers</h2></div></div></div><p>Logs the user into the target application using the headers passed down
  from an OpenAM policy agent. This template assumes the user name and
  password are passed down by the OpenAM policy agent as headers. If the
  header passed in contains only a user name or subject and requires a lookup to
  an external data source, you must add an attribute filter to the chain to
  retrieve the credentials.</p><pre class="codelisting prettyprint">{
  "heap": {
    "objects": [
    {
        "name": "HandlerServlet",
        "comment": "Entry point that transforms Servlet request to handler request.",
        "type": "HandlerServlet",
        "config": {
            "handler": "DispatchHandler",
            "baseURI":"http://TARGETIP"
        }
    },
    {       
        "name": "DispatchHandler",
        "type": "DispatchHandler",
        "config": {
            "bindings": [   
                {                       
                    "condition": "${exchange.request.uri.path == '/login'}",
                    "handler": "LoginChain",
                }, 
                {                       
                    "handler": "OutgoingChain",
                }, 
            ]   
        }   
    },
    {
        "name": "LoginChain",
        "type": "Chain",
        "config": {
            "filters": ["LoginRequest"],
            "handler": "OutgoingChain" 
        }   
    },
    {   
        "name": "LoginRequest",
        "type": "StaticRequestFilter",
        "config": {
            "method": "POST",
            "uri": "https://TARGETIP/login",
            "form": {
                "USER": ["${exchange.request.headers['username'][0]}"],
                "PASSWORD": ["${exchange.request.headers['password'][0]}"],
            }   
        }   
    },
    {
        "name": "OutgoingChain",
        "type": "Chain",
        "config": {
            "filters": ["CaptureFilter"],
            "handler": "ClientHandler" 
        }   
    },
    {   
        "name": "CaptureFilter",
        "type": "CaptureFilter",
        "config": {
            "captureEntity": false,
            "file": "/tmp/gateway.log",
        }       
    },
    {
        "name": "ClientHandler",
        "comment": "Responsible for sending all requests to remote servers.",
        "type": "ClientHandler",
        "config": {
            }
        }
    ]
  },
  "servletObject": "HandlerServlet",
}
</pre></div><div class="section" id="template-owa-online"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.9.&nbsp;Microsoft Online Outlook Web Access</h2></div></div></div><a class="indexterm" name="d0e2327"></a><p>A sample template used to log a user into Microsoft Online Outlook Web
  Access. This template shows how you would use the Gateway and the OpenAM
  password capture feature to integrate with OWA. You can follow the
  <a href="../gateway-guide/index.html#chap-password-capture-replay-tutorial" class="link">Tutorial On Password Capture
  &amp; Replay</a> tutorial and substitute this template.</p><pre class="codelisting prettyprint">{
    "heap": {
        "objects": [
            {
                "name": "LogSink",
                "comment": "Default sink for logging information.",
                "type": "ConsoleLogSink",
                "config": {
                    "level": "DEBUG",
                }
            },
            {
                "name": "HandlerServlet",
                "type": "HandlerServlet",
                "config": {
                    "handler": "DispatchHandler",
                    "baseURI":"https://65.55.171.158"
                }
            },
            {
                "name": "DispatchHandler",
                "type": "DispatchHandler",
                "config": {
                    "bindings": [
                        {
                            "condition": "${exchange.request.uri.path == '/owa/auth/logon.aspx'}",
                            "handler": "LoginChain",
                        },
                        {
                            "handler": "OutgoingChain",
                        }
                    ]
                }
            },
            {
                "name": "LoginChain",
                "type": "Chain",
                "config": {
                    "filters": ["CryptoHeaderFilter","LoginRequest"],
                    "handler": "OutgoingChain"
                }
            },
            {   
                "name": "CryptoHeaderFilter",
                "type": "CryptoHeaderFilter",
                "config": {
                    "messageType":"REQUEST",
                    "operation":"DECRYPT",
                    "algorithm":"DES/ECB/NoPadding",
                    "key":"DESKEY",
                    "keyType":"DES",
                    "charSet":"utf-8",
                    "headers": ["password"],
                },
            },
            {  
                "name": "LoginRequest",
                "type": "StaticRequestFilter",
                "config": {
                    "method": "POST",
                    "uri": "https://65.55.171.158/owa/auth/owaauth.dll",
                    "headers" : {
                        "Host": ["red001.mail.microsoftonline.com"],
                        "Content-Type": ["Content-Type:application/x-www-form-urlencoded"],
                    }
                    "form": {
                        "destination": ["https://red001.mail.microsoftonline.com/owa/"],
                        "forcedownlevel": ["0"],
                        "trusted": ["0"],
                        "username": ["${exchange.request.headers['username'][0]}"],
                        "password": ["${exchange.request.headers['password'][0]}"],
                        "isUtf8": ["1"],
                    }
                }
            },
            {
                "name": "OutgoingChain",
                "type": "Chain",
                "config": {
                    "filters": ["HeaderFilter","CaptureFilter"],
                    "handler": "ClientHandler"
                }
            },
            {
                "name": "HeaderFilter",
                "type": "HeaderFilter",
                "config": {
                    "messageType":"REQUEST",
                    "remove": ["password","username"],
                 }
            },
            {
                "name": "CaptureFilter",
                "type": "CaptureFilter",
                "config": {
                    "captureEntity": false,
                    "file": "/tmp/gateway.log",
                }
            },
            {
                "name": "ClientHandler",
                "type": "ClientHandler",
                "config": {
                }
            },
        ]
    },
    "servletObject": "HandlerServlet",
}
</pre></div></div><div lang="en" class="chapter" id="chap-customizing"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;12.&nbsp;Customizing OpenIG</h1></div></div></div><p>OpenIG includes a complete, stable <a class="link" href="http://openig.forgerock.org/apidocs/index.html" target="_blank">application
 programming interface</a>, designed to allow you to customize OpenIG
 as required. Customizing OpenIG can be necessary if you need to perform
 complex server interactions or intensive data transformations, and stock
 handlers, filters and <a href="../reference/index.html#Expressions" class="link">expressions</a> provided
 by the gateway are too basic to meet the task.</p><div class="section" id="extension-points"><div class="titlepage"><div><div><h2 class="title" style="clear: both">12.1.&nbsp;Key Extension Points</h2></div></div></div><a class="indexterm" name="d0e2356"></a><p>The two primary extension points are the interfaces: <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/filter/Filter.html" target="_blank">Filter</a> (for processing a request and/or response en
  route) and <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/handler/Handler.html" target="_blank">Handler</a> (for generating responses from requests).
  These interfaces are similar to the Java Enterprise Edition
  <code class="literal">Filter</code> and <code class="literal">Servlet</code> interfaces, with
  some differences in the semantics of messages. While you can simply implement
  these interfaces, there are also included convenience classes: <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/filter/GenericFilter.html" target="_blank">GenericFilter</a> and <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/handler/GenericHandler.html" target="_blank">GenericHandler</a> that you can use if you intend to make
  your extensions configurable through the OpenIG configuration
  resource.</p><p>OpenIG also allows standard Java Enterprise Edition servlets and
  servlet filters to be embedded in the gateway, with initialization parameters
  supplied through through the OpenIG configuration resource.</p></div><div class="section" id="custom-filter"><div class="titlepage"><div><div><h2 class="title" style="clear: both">12.2.&nbsp;Implementing a Filter</h2></div></div></div><a class="indexterm" name="d0e2386"></a><p>The <code class="literal">Filter</code> interface exposes a <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/filter/Filter.html#filter(org.forgerock.openig.http.Exchange,%20org.forgerock.openig.handler.Handler)" target="_blank">filter</a> method, which takes an <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/http/Exchange.html" target="_blank">Exchange</a> object and the <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/filter/Chain.html" target="_blank">Chain</a> of remaining filters and handler to dispatch to. Initially,
  <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/http/Exchange.html#request" target="_blank">exchange.request</a> contains the request to be filtered. To pass the
  request to the next filter or handler in the chain, the filter calls
  <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/filter/Chain.html#handle(org.forgerock.openig.http.Exchange)" target="_blank">chain.handle(exchange)</a>. After this call, <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/http/Exchange.html#response" target="_blank">exchange.response</a> contains the response that can be filtered.</p><p>A filter might elect not to pass the request to the next filter or
  handler, and instead handle the request itself. It can achieve this by
  merely avoiding a call to <code class="literal">chain.handle(exchange)</code> and
  creating its own response object in the exchange. The filter is also at
  liberty to replace a response with another of its own. A filter can exist in
  more than one chain, therefore should make no assumptions or correlations
  using the chain it is supplied. The only valid use of a chain by a filter
  is to call its <code class="literal">handle</code> method to dispatch the exchange to
  the rest of the chain.</p><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>If an existing response exists in the exchange object and the filter
   intends to replace it with its own, it must first check to see if the
   existing response has an <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/http/Message.html#entity" target="_blank">entity</a>, and if it does, must call its <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/io/BranchingInputStream.html#close()" target="_blank">close</a> method in order to signal that the processing of the response
   from a remote server is complete.</p></div></div></div><div class="section" id="custom-handler"><div class="titlepage"><div><div><h2 class="title" style="clear: both">12.3.&nbsp;Implementing a Handler</h2></div></div></div><a class="indexterm" name="d0e2434"></a><p>The <code class="literal">Handler</code> interface exposes a <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/handler/Handler.html#handle(org.forgerock.openig.http.Exchange)" target="_blank">handle</a> method, which takes an <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/http/Exchange.html#response" target="_blank">Exchange</a> object. It processes the request in
  <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/http/Exchange.html#request" target="_blank">exchange.request</a> and produces a response in <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/http/Exchange.html#response" target="_blank">exchange.response</a>. A handler can elect to dispatch the exchange to
  another handler or chain.</p><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>If an existing response exists in the exchange object and the filter
   intends to replace it with its own, it must first check to see if the
   existing response has an <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/http/Message.html#entity" target="_blank">entity</a>, and if it does, must call its <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/io/BranchingInputStream.html#close()" target="_blank">close</a> method in order to signal that the processing of the response
   from a remote server is complete.</p></div></div></div><div class="section" id="custom-heap-config"><div class="titlepage"><div><div><h2 class="title" style="clear: both">12.4.&nbsp;Heap Object Configuration</h2></div></div></div><a class="indexterm" name="d0e2468"></a><p>Objects are added to the heap and supplied with configuration artifacts
  at initialization time. To be integrated with the configuration, a class must
  have an accompanying implementation of the <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/heap/Heaplet.html" target="_blank">Heaplet</a> interface. The easiest and most common way of exposing the
  heaplet is to extend the <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/heap/NestedHeaplet.html" target="_blank">NestedHeaplet</a> class in a nested class in the class you want to create
  and initialize and implementing its <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/heap/GenericHeaplet.html#create()" target="_blank">create</a> method.</p><p>Within the <code class="literal">create</code> method, you can access the
  object's configuration through the <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/heap/GenericHeaplet.html#config" target="_blank">config</a> field.</p></div><div class="section" id="custom-servlets-filters"><div class="titlepage"><div><div><h2 class="title" style="clear: both">12.5.&nbsp;Including Servlets and Servlet Filters</h2></div></div></div><a class="indexterm" name="d0e2495"></a><p>A servlet or servlet filter can be added as a heap object by including
  it in the classpath, and identifying it in the OpenIG heap configuration as
  an <a href="../reference/index.html#Servlet" class="link">javax.servlet.http.HttpServlet</a> or <a href="../reference/index.html#ServletFilter" class="link">javax.servlet.Filter</a> type, providing any appropriate initialization
  parameters. A servlet can be dispatched directly by the <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/gateway/GatewayServlet.html" target="_blank">gateway servlet</a>, and servlets and filters can be flexibly dispatched
  to through a <a class="link" href="http://openig.forgerock.org/apidocs/org/forgerock/openig/servlet/DispatchServlet.html" target="_blank">DispatchServlet</a>.</p></div><div class="section" id="custom-sample-filter"><div class="titlepage"><div><div><h2 class="title" style="clear: both">12.6.&nbsp;Sample Filter</h2></div></div></div><p>The following sample filter sets an arbitrary header in the incoming
  request and outgoing response.</p><pre class="codelisting prettyprint linenums lang-java">package com.example.filter;

// Java Standard Edition
import java.io.IOException;

// OpenIG Core Library
import org.forgerock.openig.filter.Chain;
import org.forgerock.openig.filter.GenericFilter;
import org.forgerock.openig.handler.HandlerException;
import org.forgerock.openig.heap.HeapException;
import org.forgerock.openig.heap.NestedHeaplet;
import org.forgerock.openig.http.Exchange;
import org.forgerock.openig.model.ModelException;

public class HelloWorldFilter extends GenericFilter {

    public String name;
    public String value;

    @Override
    public void filter(Exchange exchange, Chain chain)
            throws HandlerException, IOException {
        exchange.request.headers.put(name, value); // set header in request
        chain.handle(exchange); // pass to remaining filters &amp; handler in chain
        exchange.response.headers.put(name, value); // set header in response
    }

    public static class Heaplet extends NestedHeaplet {

        @Override
        public Object create() throws HeapException, ModelException {
            HelloWorldFilter filter = new HelloWorldFilter();
            filter.name = config.get("name").required().asString(); // required
            filter.value = config.get("value").required().asString(); // req'd
            return filter;
        }
    }
}</pre><p>The corresponding heap object configuration is as follows.</p><pre class="codelisting prettyprint">{
     "name": "HelloWorldFilter",
     "type": "com.example.filter.HelloWorldFilter",
     "config": {
         "name": "X-Hello",
         "value": "World" 
     }
}</pre></div></div><div lang="en" class="chapter" id="chap-troubleshooting"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;13.&nbsp;Troubleshooting</h1></div></div></div><a class="indexterm" name="d0e2530"></a><p>This chapter covers common problems and their solutions.</p><div class="section" id="d0e2535"><div class="titlepage"><div><div><h2 class="title" style="clear: both">13.1.&nbsp;Object not found in heap</h2></div></div></div><pre class="cmdline prettyprint">HTTP ERROR 500
org.forgerock.openig.model.NodeException:
 ['file:/Users/george/.ForgeRock/OpenIG/config.json'].heap.objects[2]
  .config.filterObjects[0]: object not found in heap
at org.forgerock.openig.heaplet.HeapUtil.getRequiredObject(HeapUtil.java:54)
at org.forgerock.openig.filter.Chain$Heaplet.create(Chain.java:49)</pre><p>You have a filter specified in the filterObjects list in the Chain
  object that is not in <code class="filename">config.json</code>.  Make sure you have
  added an entry for the Filter and have correctly spelled its name in the
  filterObjects list.</p></div><div class="section" id="d0e2546"><div class="titlepage"><div><div><h2 class="title" style="clear: both">13.2.&nbsp;Could not find local configuration file</h2></div></div></div><pre class="cmdline prettyprint">HTTP ERROR 500
Problem accessing /. Reason:

 could not find local configuration file at
 /var/root/.ForgeRock/OpenIG/config.json or bootstrap file at
 /var/root/.ForgeRock/OpenIG/_private_var_folders_...webinf.json</pre><p>OpenIG could not find its configuration file in the home directory of
  the user running the container where OpenIG is deployed, in this case
  <code class="filename">/var/root/.ForgeRock/OpenIG/config.json</code>.
  As you can see from the error message, OpenIG looks in a secondary location
  determined at runtime by the container. The secondary location is only
  necessary if you are running more than one OpenIG on a single host and your
  instances do not share a single configuration.</p></div><div class="section" id="d0e2557"><div class="titlepage"><div><div><h2 class="title" style="clear: both">13.3.&nbsp;Unexpected character (x) at position 1103</h2></div></div></div><pre class="cmdline prettyprint">HTTP ERROR 500
Problem accessing /. Reason:

Unexpected character (x) at position 1103</pre><p>This error usually means a missing double quote or a missing bracket
  in the configuration file.  Use a JSON editor or JSON validation tool
  such as <a class="link" href="http://jsonlint.com/" target="_blank">JSONLint</a> to make sure your JSON is valid.</p></div><div class="section" id="d0e2568"><div class="titlepage"><div><div><h2 class="title" style="clear: both">13.4.&nbsp;The values in the flat file are incorrect</h2></div></div></div><p>Ensure the flat file is readable by the user running the container for
  OpenIG. Values are all characters, including space and tabs, between the
  separator, so make sure the values are not padded with spaces.</p></div><div class="section" id="d0e2573"><div class="titlepage"><div><div><h2 class="title" style="clear: both">13.5.&nbsp;Problem accessing URL</h2></div></div></div><pre class="cmdline prettyprint">HTTP ERROR 500

Problem accessing /myURL . Reason:

java.lang.String cannot be cast to java.util.List
Caused by:
java.lang.ClassCastException: java.lang.String cannot be cast to java.util.List
at org.forgerock.openig.filter.LoggingFilter.writeHeaders(LoggingFilter.java:132
at org.forgerock.openig.filter.LoggingFilter.logResponse(LoggingFilter.java:119)
at org.forgerock.openig.filter.LoggingFilter.filter(LoggingFilter.java:86)
at org.forgerock.openig.filter.Chain.handle(Chain.java:54)</pre><p>This error is typically encountered when using the <a href="../reference/index.html#AssignmentFilter" class="link">AssignmentFilter</a> and
  setting a string value for one of the Headers. All headers are stored in
  Lists so the header must be addressed with a subscript. For example, if you
  try to set <code class="literal">exchange.request.headers['Location']</code> for a
  redirect in the response object, you should instead set
  <code class="literal">exchange.request.headers['Location'][0]</code>. A header without
  a subscript leads to the error above.</p></div><div class="section" id="d0e2590"><div class="titlepage"><div><div><h2 class="title" style="clear: both">13.6.&nbsp;StaticResponseHandler results in a blank page</h2></div></div></div><p>You must define an entity for the response. For example:</p><pre class="codelisting prettyprint">{
    "name": "AccessDeniedHandler",
    "type": "org.forgerock.openig.handler.StaticResponseHandler",
    "config": {
        "status": 403,
        "reason": "Forbidden",
        "entity": "&lt;html&gt;&lt;h2&gt;User does not have permission&lt;h2&gt;html&gt;"
    }
}</pre></div><div class="section" id="d0e2598"><div class="titlepage"><div><div><h2 class="title" style="clear: both">13.7.&nbsp;OpenIG is not logging users in</h2></div></div></div><p>If you are proxying to more than one application in multiple DNS
  domains, you must make sure your container is enabled for domain cookies.
  See the chapter on <a href="../gateway-guide/index.html#chap-container" class="link"><em class="citetitle">Configuring
  Deployment Containers</em></a> for details on your specific
  container.</p></div></div><div class="index" id="d0e2607"><div class="titlepage"><div><div><h1 class="title">Index</h1></div></div></div><div xmlns:xlink="http://www.w3.org/1999/xlink" class="index"><div class="indexdiv"><h3>A</h3><dl><dt id="ientry-d0e261">Architecture, <a class="indexterm" href="#chap-howitworks">How OpenIG Works</a></dt></dl></div><div class="indexdiv"><h3>C</h3><dl><dt id="ientry-d0e1751">Configuration</dt><dd><dl><dt>Federation, <a class="indexterm" href="#federation-configuration-files">Configuration File Overview</a>, <a class="indexterm" href="#federation-configuring">Configuring the Federation Service</a></dt><dt>HTTP &amp; HTTPS, <a class="indexterm" href="#template-http-and-https">HTTP &amp; HTTPS Application</a></dt><dt>Login with cookie, <a class="indexterm" href="#template-login-cookie">Login Form With Cookie From Login Page</a></dt><dt>Login with filter, <a class="indexterm" href="#template-login-extract-cookie-filters">Login Form With Extract Filter &amp; Cookie Filter</a></dt><dt>Login with hidden value, <a class="indexterm" href="#template-login-hidden-value">Login Which Requires a Hidden Value From the Login Page</a></dt><dt>Microsoft Online Outlook Web Access, <a class="indexterm" href="#template-owa-online">Microsoft Online Outlook Web Access</a></dt><dt>Multiple applications, <a class="indexterm" href="#template-multiple-apps">Multiple Applications</a></dt><dt>Proxy &amp; capture, <a class="indexterm" href="#template-proxy-capture">Proxy &amp; Capture</a></dt><dt>Simple login form, <a class="indexterm" href="#template-simple-login">Simple Login Form</a></dt></dl></dd><dt id="ientry-d0e660">Containers</dt><dd><dl><dt>JBoss, <a class="indexterm" href="#jboss">JBoss</a></dt><dt>Jetty, <a class="indexterm" href="#jetty">Jetty</a></dt><dt>Supported, <a class="indexterm" href="#chap-container">Configuring Deployment Containers</a></dt><dt>Tomcat, <a class="indexterm" href="#tomcat">Tomcat</a></dt></dl></dd><dt id="ientry-d0e2356">Customizations</dt><dd><dl><dt>Extension points, <a class="indexterm" href="#extension-points">Key Extension Points</a></dt><dt>Filters, <a class="indexterm" href="#custom-filter">Implementing a Filter</a></dt><dt>Handlers, <a class="indexterm" href="#custom-handler">Implementing a Handler</a></dt><dt>Heap objects, <a class="indexterm" href="#custom-heap-config">Heap Object Configuration</a></dt><dt>Servlets, <a class="indexterm" href="#custom-servlets-filters">Including Servlets and Servlet Filters</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>I</h3><dl><dt id="ientry-d0e588">Installation, <a class="indexterm" href="#chap-install">Installing OpenIG</a></dt><dd><dl><dt>Federation, <a class="indexterm" href="#federation-installation">Installation Overview</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>T</h3><dl><dt id="ientry-d0e2530">Troubleshooting, <a class="indexterm" href="#chap-troubleshooting">Troubleshooting</a></dt><dt id="ientry-d0e1159">Tutorials</dt><dd><dl><dt>Basic features, <a class="indexterm" href="#chap-gateway-tutorial">Tutorial With WordPress</a></dt><dt>Capture &amp; relay passwords, <a class="indexterm" href="#chap-password-capture-replay-tutorial">Tutorial On OpenAM Password Capture &amp; Replay</a></dt><dt>Federation, <a class="indexterm" href="#chap-federation-tutorial">Tutorial For the Federation Gateway</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>U</h3><dl><dt id="ientry-d0e965">Use cases, <a class="indexterm" href="#portal-app-login">Portal Application Login</a>, <a class="indexterm" href="#am-integration">OpenAM Integration</a>, <a class="indexterm" href="#sp-initiated-sso">Federation Gateway SP Initiated SAML2 SSO</a>, <a class="indexterm" href="#idp-initiated-sso">Federation Gateway IDP Initiated SAML2 SSO</a>, <a class="indexterm" href="#saml2-pep">Standards Based SAML2 Agent</a></dt></dl></div></div></div></div><a href="#" class="back-to-top hidden-xs"><button type="button" class="btn btn-primary btn-default"><span class="glyphicon glyphicon-chevron-up"></span></button></a></div></div><div class="footer"><div class="container-fluid"><div class="footer-left"><span class="footer-item">Copyright &copy;
              2011-2012&nbsp;
              ForgeRock AS;&nbsp;
              &nbsp;
              &nbsp;
          </span></div><div class="footer-right"><a target="_blank" class="footer-item snap-left" href="legalnotice.html"><i class="glyphicon glyphicon-briefcase"></i> Legal Notice</a><a target="_blank" class="footer-item snap-left" href="https://github.com/OpenIdentityPlatform/OpenAM/issues"><i class="glyphicon glyphicon-ok-sign"></i> Feedback</a><a target="_blank" class="footer-item snap-left" href="#" data-toggle="modal" data-target="#myModal"><i class="glyphicon glyphicon-info-sign"></i> About</a></div></div></div></body></html>