<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang>
<head>
<!-- Generated by javadoc -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>org.opends.server.backends.jeb (OpenDJ Directory Services Project 4.9.4-SNAPSHOT API)</title>
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="org.opends.server.backends.jeb (OpenDJ Directory Services Project 4.9.4-SNAPSHOT API)";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../org/opends/server/backends/jdbc/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../../../org/opends/server/backends/pdb/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?org/opends/server/backends/jeb/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<p><a href="../../../../../org/opends/server/types/PublicAPI.html" title="annotation in org.opends.server.types">@PublicAPI</a>(<a href="../../../../../org/opends/server/types/PublicAPI.html#stability--">stability</a>=<a href="../../../../../org/opends/server/types/StabilityLevel.html#PRIVATE">PRIVATE</a>)
</p>
<h1 title="Package" class="title">Package&nbsp;org.opends.server.backends.jeb</h1>
<div class="docSummary">
<div class="block">Contains the code for the Directory Server backend that uses the Berkeley DB
 Java Edition as the repository for storing entry and index information.</div>
</div>
<p>See:&nbsp;<a href="#package.description">Description</a></p>
</div>
<div class="contentContainer">
<ul class="blockList">
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Class Summary table, listing classes, and an explanation">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../org/opends/server/backends/jeb/AttributeIndex.html" title="class in org.opends.server.backends.jeb">AttributeIndex</a></td>
<td class="colLast">Deprecated
<div class="block"><span class="deprecationComment">since OPENDJ-2337 Remove old JE local-db backend code and JE changelog</span></div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../org/opends/server/backends/jeb/AttributeIndex.KeyComparator.html" title="class in org.opends.server.backends.jeb">AttributeIndex.KeyComparator</a></td>
<td class="colLast">Deprecated
<div class="block"><span class="deprecationComment">since OPENDJ-1591 Migrate matching rules</span></div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../org/opends/server/backends/jeb/JEBackend.html" title="class in org.opends.server.backends.jeb">JEBackend</a></td>
<td class="colLast">
<div class="block">Class defined in the configuration for this backend type.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../org/opends/server/backends/jeb/JEStorage.html" title="class in org.opends.server.backends.jeb">JEStorage</a></td>
<td class="colLast">
<div class="block">Berkeley DB Java Edition (JE for short) database implementation of the <a href="../../../../../org/opends/server/backends/pluggable/spi/Storage.html" title="interface in org.opends.server.backends.pluggable.spi"><code>Storage</code></a> engine.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../org/opends/server/backends/jeb/VLVKeyComparator.html" title="class in org.opends.server.backends.jeb">VLVKeyComparator</a></td>
<td class="colLast">Deprecated
<div class="block"><span class="deprecationComment">since OPENDJ-1591 Migrate matching rules</span></div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<a name="package.description">
<!--   -->
</a>
<h2 title="Package org.opends.server.backends.jeb Description">Package org.opends.server.backends.jeb Description</h2>
<div class="block">Contains the code for the Directory Server backend that uses the Berkeley DB
 Java Edition as the repository for storing entry and index information.
 <BR><BR>

 <H3>On-disk Representation</H3>
 <P>
 First it is important to understand JE (Java Edition) terminology.  A JE
 database environment has similarities to a database in the relational
 database world. Each environment can have multiple databases, which are
 similar to tables in a relational database.  A JE environment is identified
 by the file system directory in which it is stored.  A JE database is
 identified by a unique name within its environment.  Multiple databases in
 the same environment may be updated within the same transaction, but
 transactions cannot span environments.
 <P>
 In this description, database means a JE database.
 <P>
 Each instance of this backend creates a single JE environment to store its
 data.  Unlike previous versions of Directory Server, environments are not
 shared by backend instances.  The backend does support multiple base DNs,
 so it is still possible for data under multiple suffixes to share the same
 database environment, by declaring those suffixes as base DNs of a single
 JE backend instance.
 <P>
 The data for a base DN is kept in a set of databases, so that a database
 contains data for only one base DN.  Each database name is prefixed by
 the base DN it belongs to, where the DN is simplified by preserving only
 letters and digits.
 <P>
 For example, if you were to use the DbDump utility to list the databases
 in the environment corresponding to a backend instance containing the base
 DN dc=example,dc=com, you might see the following:
 <pre>
 dc_example_dc_com_cn.equality
 dc_example_dc_com_cn.presence
 dc_example_dc_com_cn.substring
 dc_example_dc_com_dn2id
 dc_example_dc_com_givenName.equality
 dc_example_dc_com_givenName.presence
 dc_example_dc_com_givenName.substring
 dc_example_dc_com_id2children
 dc_example_dc_com_id2entry
 dc_example_dc_com_id2subtree
 dc_example_dc_com_mail.equality
 dc_example_dc_com_mail.presence
 dc_example_dc_com_mail.substring
 dc_example_dc_com_member.equality
 dc_example_dc_com_sn.equality
 dc_example_dc_com_sn.presence
 dc_example_dc_com_sn.substring
 dc_example_dc_com_telephoneNumber.equality
 dc_example_dc_com_telephoneNumber.presence
 dc_example_dc_com_telephoneNumber.substring
 dc_example_dc_com_uid.equality
 </pre>
 <H4>Database Relocation</H4>
 <P>
 The data is stored in a format which is independent of system architecture,
 and is also independent of file system location because it contains no
 pathnames.  The backend, and its backups, can be copied, moved and restored
 to a different location, within the same system or a different system.
 <P>
 <H4>The Entry ID</H4>
 <P>
 Each entry to be stored in the backend is assigned a 64-bit integer
 identifier called the entry ID.  The first entry to be created is entry ID 1,
 the second is entry ID 2, etc.  This ensures that the ID for any given entry
 is always greater than its superiors.  The backend takes care to preserve
 this invariant, in particular during Modify DN operations where an entry
 can be given a new superior.  Clients have come to expect child entries to
 be returned after their parent in search results, and the backend can ensure
 this by returning entries in ID order.
 <P>
 On disk, an entry ID is stored in eight bytes in big-endian format (from
 most significant byte to least significant byte).  This enables binary
 copy of the backend from one system to another, regardless of the system
 architecture.
 <P>
 Currently, IDs of deleted entries are not reused.  The use of a 64-bit
 integer means it is implausible that the entry ID space will be exhausted.
 <P>
 <P>
 <H4>The entry database (id2entry)</H4>
 <P>
 Entries are stored in the id2entry database.  The key to the database is
 the entry ID, and the value is an ASN.1 encoding of the entry contents.
 The default JE btree key comparator is used for the entry database,
 such that cursoring through the database will return entries in order of
 entry ID.  When the backend starts it is able to determine the last
 assigned entry ID by reading the last key value in the entry database.
 <P>
 The format of the entry on disk is described by the following ASN.1.
 <P>
 <pre>
 DatabaseEntry ::= [APPLICATION 0] IMPLICIT SEQUENCE {
  uncompressedSize        INTEGER,      -- A zero value means not compressed.
  dataBytes               OCTET STRING  -- Optionally compressed encoding of
                                           the data bytes.
 }

 ID2EntryValue ::= DatabaseEntry
  -- Where dataBytes contains an encoding of DirectoryServerEntry.

 DirectoryServerEntry ::= [APPLICATION 1] IMPLICIT SEQUENCE {
  dn                      LDAPDN,
  objectClasses           SET OF LDAPString,
  userAttributes          AttributeList,
  operationalAttributes   AttributeList
 }
 </pre>
 <P>
 Entry compression is optional and can be switched on or off at any time.
 Switching on entry compression only affects future writes, therefore the
 database can contain a mixture of compressed and not-compressed records.
 Either record type can be read regardless of the configuration setting.
 The compression algorithm is the default ZLIB implementation provided by the
 Java platform.
 <P>
 The ASN1 types have application tags to allow for future extensions.
 The types may be extended with additional fields where this makes sense,
 or additional types may be defined.
 <P>
 <H5>The entry count record</H5>
 <P>
 Previous versions of Directory Server provide the current number of entries
 stored in the backend.  JE does not maintain database record counts,
 requiring a full key traversal to count the number of records in a database,
 which is too time consuming for large numbers of entries.
 <P>
 For this reason the backend maintains its own count of the number of
 entries in the entry database, storing this count in the special record
 whose key is entry ID zero.
 <P>
 <P>
 <H4>The DN database (dn2id)</H4>
 <P>
 Although each entry's DN is stored in the entry database, we need to be
 able to retrieve entries by DN.  The dn2id database key is the normalized
 DN and the value is the entry ID corresponding to the DN.  A normalized DN
 is one which may be compared for equality with another using a standard
 string comparison function.  A given DN can have numerous string
 representations, due to insignificant whitespace, or insignificant case of
 attribute names, etc., but it has only one normalized form.  Use of the
 normalized form enables efficient key comparison.
 <P>
 A custom btree key comparator is applied to the DN database, which orders
 the keys such that a given entry DN comes after the DNs of its superiors,
 and ensures that the DNs below a given base DN are contiguous.  This
 ordering is used to return entries for a non-indexed subtree or
 single level search.  The comparator is just like the default lexicographic
 comparator except that it compares in reverse byte order.
 <P>
 For example, a cursor iteration through a range of the DN database might
 look like this:
 <pre>
 dc=example,dc=com
 ou=people,dc=example,dc=com
 uid=user.1000,ou=people,dc=example,dc=com
 uid=user.2000,ou=people,dc=example,dc=com
 uid=user.3000,ou=people,dc=example,dc=com
 uid=user.4000,ou=people,dc=example,dc=com
 uid=user.100,ou=people,dc=example,dc=com
 uid=user.1100,ou=people,dc=example,dc=com
 uid=user.2100,ou=people,dc=example,dc=com
 </pre>
 <P>
 At first, it may seem strange that user.1100 comes after user.1000 but it
 becomes clear when considering the values in reverse byte order, since
 0011.resu is indeed greater than 0001.resu.
 <P>
 <H4>Index Databases</H4>
 <P>
 Index databases are used to efficiently process search requests.  The system
 indexes, id2children and id2subtree, are dedicated to processing one-level
 and subtree search scope respectively.  Then there are configurable
 attribute indexes to process components of a search filter.  Each index
 record maps a key to an Entry ID List.
 <P>
 <P>
 <H5>Entry ID List</H5>
 <P>
 An entry ID list is a set of entry IDs, arranged in order of ID.  On disk,
 the list is a concatenation of the 8-byte entry ID values, where the first
 ID is the lowest.  The number of IDs in the list can be obtained by dividing
 the total number of bytes by eight.
 <P>
 <P>
 <H5>Index Entry Limit</H5>
 <P>
 In some cases, the number of entries indexed by a given key is so large
 that the cost of maintaining the list during entry updates outweighs the
 benefit of the list during search processing.  Each index therefore has
 a configurable entry limit.  Whenever a list reaches the entry limit, it is
 replaced with a zero length value to indicate that the list is no longer
 maintained.
 <P>
 <P>
 <H5>Children Index (id2children)</H5>
 <P>
 The children index is a system index which maps the ID of any non-leaf entry
 to entry IDs of the immediate children of the entry. This index is used to
 get the set of entries within the scope of a one-level search.
 <P>
 <P>
 <H5>Subtree Index (id2subtree)</H5>
 <P>
 The subtree index is a system index which maps the ID of any non-leaf entry
 to entry IDs of all descendants of the entry. This index is used to get the
 set of entries within the scope of a subtree search.
 <P>
 <P>
 <H5>Attribute Equality Index</H5>
 <P>
 An attribute equality index maps the value of an attribute to entry IDs of
 all entries containing that attribute value. The database key is the
 attribute value after it has been normalized by the equality matching rule
 for that attribute.  This index is used to get the set of entries matching
 an equality filter.
 <P>
 <P>
 <H5>Attribute Presence Index</H5>
 <P>
 An attribute presence index contains a single record which has entry IDs
 of all entries containing a value of the attribute. This index is used to get
 the set of entries matching an attribute presence filter.
 <P>
 <P>
 <H5>Attribute Substring Index</H5>
 <P>
 An attribute substring index maps a substring of an attribute value to entry
 IDs of all entries containing that substring in one or more of its values of
 the attribute.  This index is used to get a set of entries that are
 candidates for matching a subtring filter.
 <P>
 The length of substrings in the index is configurable.  For example, let's
 say the configured substring length is three, and there is an entry
 containing the attribute value ABCDE.  The ID for this entry would be
 indexed by the keys ABC BCD CDE DE E.  To find entries containing a short
 substring such as DE, iterate through all keys with prefix DE.  To find
 entries containing a longer substring such as BCDE, read keys BCD and CDE.
 <P>
 <P>
 <H5>Attribute Ordering Index</H5>
 <P>
 An attribute ordering index is similar to an equality index in that it maps
 the value of an attribute to entry IDs of all entries containing that
 attribute value.  However, the values are normalized by the ordering matching
 rule for the attribute rather than the equality matching rule, and the
 btree key comparator is set to the ordering matching rule comparator.  This
 index is used to get the set of entries matching inequality filters
 (less-than-or-equal, greater-than-or-equal).</div>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../org/opends/server/backends/jdbc/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../../../org/opends/server/backends/pdb/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?org/opends/server/backends/jeb/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2011&#x2013;2025. All rights reserved.</small></p>
</body>
</html>
