<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <style type="text/css">
   /*
* The contents of this file are subject to the terms of the Common Development and
* Distribution License (the License). You may not use this file except in compliance with the
* License.
*
* You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the
* specific language governing permission and limitations under the License.
*
* When distributing Covered Software, include this CDDL Header Notice in each file and include
* the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL
* Header, with the fields enclosed by brackets [] replaced by your own identifying
* information: "Portions copyright [year] [name of copyright owner]".
*
* Copyright 2015 ForgeRock AS.
* Portions copyright 2024 3A Systems LLC.
*/

/***********************************/
/* Imported Styles
/***********************************/

@import url(https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,300,400,700);
@import url(https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css);
@import url(https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css);
/* @import url(https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css); */
@import url(https://cdnjs.cloudflare.com/ajax/libs/jquery.colorbox/1.4.33/example1/colorbox.css);

/***********************************/
/* General Styles
/***********************************/

html {
    height: 100%;
}

body {
    /* Dark Grey */

    color: #2a2f32;
    font-family: 'Open Sans', "proxima-nova", sans-serif;
}

a {
    /* Sea Green */
    color: #519387;
}

a.link[href^="http"] {
    background-image: url("includes/logos/Icon_External_Link.png");
    background-position: top right;
    background-repeat: no-repeat;
    padding-right: 15px;
    margin-right: 2px;
}

a.self-link, a.self-link:hover, a.self-link:active {
    color: inherit;
    text-decoration: none;
}

a[href].self-link:hover::after
{
    -moz-osx-font-smoothing: grayscale;
    content: "\e144";
    color: #519387;
    display: inline-block;
    font-family: "Glyphicons Halflings";
    font-size: 75%;
    font-style: normal;
    line-height: 1;
    padding-left: 5px;
    position: relative;
    top: 1px;
}


li.L0,
li.L1,
li.L2,
li.L3,
li.L5,
li.L6,
li.L7,
li.L8 {
    list-style-type: decimal !important
}

.section,
.chapter,
.preface,
.glossary,
.refentry,
.reference,
.appendix,
.index,
.titlepage h2,
.titlepage h3,
.titlepage h4,
.titlepage h5 {
    padding-top: 60px;
    margin-top: -50px;
}

.left-shape-content {
    background: url("includes/logos/left-shape-4.png") no-repeat scroll 0 0 rgba(0, 0, 0, 0);
    float: left;
    height: 566px;
    position: fixed;
    width: 57px;
    top: 60%;
    z-index: -1;
}

/***********************************/
/* Bootstrap Override Styles
/***********************************/

/* Button Styles */

.btn-primary {
    /* Sea Green */
    background-color: #519387;

    /* Dark Sea Green */
    border-color: #488378;
    color: #fff;
}

.btn-default {
    background-color: #A1A8AD;
    border-color: #8a9298;
    color: #ffffff;
}

.btn-default:hover,
.btn-default:focus,
.btn-default.focus,
.btn-default:active,
.btn-default.active,
.open > .dropdown-toggle.btn-default {
    background-color: #3f4b54;
    border-color: #1B2025;
    color: #ffffff;
}

/* Tooltip Styles */

.tooltip.in {
    opacity: 0.95;
}

.tooltip.bottom .tooltip-arrow {
    border-bottom-color: #519387;
}

.tooltip-inner {
    background-color: #519387;
}

/* List Styles */

.dl-horizontal dt {
    white-space: normal;
    padding: 0 3px 0 0;
    width: 200px;
}

.dl-horizontal dd {
    border-bottom: 1px dotted rgb(125, 179, 168);
    border-bottom: 1px dotted rgba(125, 179, 168, 0.8);
    margin-bottom: 18px;
    margin-left: 210px;
}

.dl-horizontal {
    border-top: 1px dotted rgb(125, 179, 168);
    border-top: 1px dotted rgba(125, 179, 168, 0.9);
    padding-top: 10px;
}

.variablelist dt {
    margin: 18px 0 5px 15px;
}

.variablelist dd {
    border-bottom: 1px dotted rgba(125, 179, 168, 0.8);
    margin: 5px 0 5px 30px;
}

.variablelist > dl {
    border-top: 1px dotted rgba(125, 179, 168, 0.8);
}


/***********************************/
/* Redirect Page Styles
/***********************************/

.index-redirect,
.index-redirect body {
    height: 100%;
    background-color: #333;
    font-family: 'Open Sans', "proxima-nova", sans-serif;
}
.index-redirect body {
    color: #fff;
    text-align: center;
}
.index-redirect .container {
    display: table;
    vertical-align: middle;
    height: 100%;
}
.index-redirect .btn-primary {
    /* Sea Green */
    background-color: #519387;

    /* Dark Sea Green */
    border-color: #488378;
    color: #fff;
}
.index-redirect .cover-heading {
    font-weight: 400 !important;
}
.index-redirect .vertical-center-row {
    display: table-cell;
    vertical-align: middle;
}

/***********************************/
/* Header Styles
/***********************************/

.navbar-brand {
    padding: 7px 15px;
    display: flex;
    align-items: center;
}
.navbar-brand > img {
    height: 100%;
}

.navbar.navbar-inverse.navbar-fixed-top {
    box-shadow: 0 0 10px 2px #111;
}
.nav > li > a {
    font-weight: 200;
}

/***********************************/
/* Banner Styles
/***********************************/

.jumbotron {
    /* Sea Green */
    background: url("includes/logos/hero-bg-01.png") no-repeat scroll left top #519387;
    color: white;
    box-shadow: 0 0 10px 2px grey;
    margin-top: 50px;
    padding: 0 0 10px;
}
.jumbotron small {
    color: white;
}
.jumbotron p {
    font-size: 12px;
    font-weight: 400;
    margin-bottom: 5px;
}
.jumbotron h1 {
    font-size: 23px !important;
    font-weight: 300 !important;
}

/***********************************/
/* Table of Contents Styles
/***********************************/

#sidebar .nav>li>a {
    /* Light Grey */

    color: #777;
    border-left: 4px solid transparent;
    padding: 4px 10px;
    font-size: 13px;
    font-weight: 400;
}
/* nested links */

#sidebar .nav .nav>li>a {
    padding-top: 2px;
    padding-bottom: 2px;
    padding-left: 30px;
    font-size: 12px;
}
/* nested nested links */

#sidebar .nav .nav .nav>li>a {
    font-size: 11px;
    padding-bottom: 2px;
    padding-left: 50px;
    padding-top: 4px;
}
/* nested nested nested links */

#sidebar .nav .nav .nav .nav>li>a {
    font-size: 11px;
    padding-bottom: 2px;
    padding-left: 70px;
    padding-top: 4px;
}
/* active and hover links */

#sidebar .nav>.active>a,
#sidebar .nav>.locked-active>a,
#sidebar .nav>li>a:hover,
#sidebar .nav>li>a:focus {
    text-decoration: none;
    /*
    background-color: rgb(125, 179, 168, 0.8);
    background-color: rgba(125, 179, 168, 0.8);
    border-color: rgb(45, 52, 55, 0.8);
    border-color: rgba(45, 52, 55, 0.8);
    color: white;
    */
    /* Bright Yellow */

    background-color: #eeea07;
    border-color: #eeea07;
    /* Grey */

    color: #2a2f32;
}
/* all active links */

#sidebar .nav>.active>a,
#sidebar .nav>.active:hover>a,
#sidebar .nav>.active:focus>a {
    font-weight: 600;
}
/* nested active links */

#sidebar .nav .nav>.active>a,
#sidebar .nav .nav>.active:hover>a,
#sidebar .nav .nav>.active:focus>a {
    font-weight: 400;
}
/* nested nested active links */

#sidebar .nav .nav .nav>.active>a,
#sidebar .nav .nav .nav>.active:hover>a,
#sidebar .nav .nav .nav>.active:focus>a {
    font-weight: 300;
}
/* nested nested active links */

#sidebar .nav .nav .nav>.active>a,
#sidebar .nav .nav .nav>.active:hover>a,
#sidebar .nav .nav .nav>.active:focus>a {
    font-weight: 300;
}
/* hide all (inactive) nested list */

#sidebar .nav ul.nav {
    display: none;
}
/* show active nested list */

#sidebar .nav>.active>ul.nav {
    display: block;
}
#sidebar.affix {
    top: 66px;
    position: fixed;
    bottom: 30px;
    height: auto;
    overflow-y: scroll;
}
#sidebar.affix-bottom {
    position: absolute;
}

/***********************************/
/* Content Styles
/***********************************/

/* Main Content Styles */

h1 {
    font-size: 40px !important;
    font-weight: 700 !important;
}

h1 span {
    margin-right: .3em;
}

#doc-content h1,
#doc-content .h1 {
    /* Sea Green */
    border-bottom: 2px solid #70ab9b;
    font-size: 36px;
    margin-top: 24px;
    padding-bottom: 5px;
}

h2 {
    font-size: 32px !important;
    font-weight: 700 !important;
}

h5, .h5 {
    border-bottom: 1px solid #d3d3d3;
    font-size: 16px;
    padding-bottom: 4px;
    font-style: italic;
}

.anchorjs-link .anchorjs-icon {
    color: #A1A8AD;
    text-decoration: none;
}
.anchorjs-link:hover .anchorjs-icon {
    color: #519387;
    text-decoration: none;
}

h1:hover > .anchorjs-link,
h2:hover > .anchorjs-link,
h3:hover > .anchorjs-link,
h4:hover > .anchorjs-link,
h5:hover > .anchorjs-link,
.anchorjs-link:focus {
    opacity: 1 !important;
    transition: color 0.16s linear 0s;
    text-decoration: none;
}

.chapter > p:first-of-type,
.preface > p:first-of-type {
    font-size: 21px;
    font-weight: 300;
    line-height: 1.4;
    margin-bottom: 20px;
}

#doc-content {
    padding: 0 20px 85px 10px;
}

div.procedure, div.table {
    margin-top:-50px;
    padding-top: 60px;
}

div.procedure-title, div.table-title {
    margin: 6px 0 8px;
}

div.procedure-inner {
    border-color: lightslategray;
    border-left: 6px solid lightslategray;
    border-style: dotted dotted dotted solid;
    border-width: 1px 1px 1px 6px;
    margin: 15px 0 10px;
    padding: 10px 15px 10px 10px;
}

.author {
    display: inline;
}

.table {
    font-size: 14px;
}

div.simplelist {
    margin-bottom: 10px;
    width: 100%;
    font-size: 15px;
}

/* Title Styles */

.procedure-title > a, .procedure-title > a:hover {
    color: lightslategray;
    font-size: 14pt;
    font-weight: 400;
}

.itemizedlist-title {
    font-size: 18px;
    font-weight: 600;
    margin: 12px 0 6px;
}

.figure-title {
    font-weight: bold;
    margin: 16px 0 4px;
    text-align: center;
}

.table-title {
    font-size: 12pt;
    font-weight: 700;
}

.variablelist-title {
    font-weight: bold;
    margin: 10px 0;
    text-decoration: underline;
}

/* Code Styles */

.btn-copy-cmdline,
.btn-copy-codelisting {
    /* White */

    background-color: #fff;
    /* Light Grey */

    border: 1px solid #e1e1e8;
    border-radius: 0 4px;
    color: #777;
    display: block;
    font-size: 12px;
    padding: 5px 8px;
    position: absolute;
    right: 5px;
    top: 5px;
    z-index: 10;
}

pre.prettyprint {
    border: 1px solid #ccc;
    padding: 9.5px;
    font-size: 12px;
}

.zero-clipboard {
    display: block;
    position: relative;
}
.zeroclipboard-is-hover {
    /* Light Sea Green */

    background-color: #6faa9b;
    border-color: #6faa9b;
    color: #fff;
    cursor: pointer;
}

.ui-effects-transfer {
    border: 1px dotted black;
    background-color: yellow;
    opacity: 0.4;
}

/* Modal Dialog Styles */

#doc-content .modal h1.title {
    font-size: 40px !important;
    font-weight: 500 !important;
    margin: 14px 0 5px;
}
#doc-content .modal h2.subtitle {
    font-size: 26px !important;
    font-weight: 400 !important;
    margin-bottom: 26px;
}
#doc-content .modal h3.author {
    font-size: 14px !important;
    font-style: italic;
    font-weight: 100 !important;
    margin: 4px 0 5px 18px;
}
#doc-content .modal .affiliation .orgname {
    display: block;
    font-size: 20px !important;
    font-weight: 400 !important;
    margin: 20px 0 0 0;
}
#doc-content .modal .affiliation .address p {
    font-size: 16px !important;
    font-weight: 100 !important;
    margin: 4px 0;
}
#doc-content .modal .copyright {
    display: none;
}
#doc-content .modal .copyright {
    display: none;
}
#doc-content .modal .abstract .abstract-title {
    font-size: 20px !important;
    font-weight: 400 !important;
}
#doc-content .modal .abstract > p {
    margin: 10px 0 5px 20px;
    font-size: 16px !important;
    font-weight: 100 !important;
}

/* Image Styles */

.fancybox > img {
    cursor: zoom-in;
}
a.fancybox {
    text-decoration: none;
}

#cboxTitle {
    color: #519387;
    font-size: 14px;
    font-weight: 700;
}

#cboxOverlay{
    background: none repeat scroll 0 0 rgba(66, 130, 116, 0.6);
}

img.img-responsive {
    margin-bottom: 20px;
}

/* Index Styles */

.indexdiv > h3 {
    border-bottom: 2px dotted lightgrey;
    padding-bottom: 5px;
}
.indexdiv > dl {
    margin-left: 30px;
}
.indexdiv dl {
    margin-bottom: 5px;
}
.indexdiv dt {
    margin: 5px 0 2px;
}
.indexdiv dd {
    margin-left: 35px;
}
.indexdiv .indexterm {
    font-weight: 200;
}

/* Reference Styles */

.refnamediv h2 {
    display: none;
}

.refsect1 h2,
.refsynopsisdiv h2 {
    font-size: 20px !important;
    font-weight: 400 !important;
}

.refnamediv p {
    font-size: 32px !important;
    font-weight: 700 !important;
}

/***********************************/
/* Footer Styles
/***********************************/

.back-to-top {
    position: fixed;
    bottom: 55px;
    right: 5px;
    display: none;
    z-index: 15;
}

#footer {
    display: none;
}

.footer {
    /* Light Grey */
    background-color: #f5f5f5;

    /* Medium Grey */
    border-top: 1px solid #ACB5BD;
    bottom: 0;
    font-size: 12px;
    height: 30px;
    padding-top: 4px;
    position: fixed;
    width: 100%;
    z-index: 100;
}

.footer h3 {
    margin: 0;
}

.footer a:hover {
    text-decoration: none;
}

.footer-item {
    line-height: 22px;
    margin-left: 10px;
}

.footer-item.highlighted {
    /* Orange */
    color: #f7a540;
}

.footer-item.highlighted:hover {
    /* Dark Orange */
    color: #c97208;
}

.footer span {
    /* Grey */
    color: #2a2f32;
    margin-bottom: 0;
}

.footer .footer-left {
    float: left;
}

.footer .footer-right {
    float: right;
}

/***********************************/

  </style><meta name="viewport" content="width=device-width, initial-scale=1"><title>OpenIDM Integrator's Guide</title><script src="https://code.jquery.com/jquery-1.11.2.min.js" type="text/javascript"></script><script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js" type="text/javascript"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="description" content="Guide to configurating and integrating OpenIDM into identity management solutions. The OpenIDM project offers flexible, open source services for automating management of the identity life cycle."><script type="text/javascript">
     /*
 * The contents of this file are subject to the terms of the Common Development and
 * Distribution License (the License). You may not use this file except in compliance with the
 * License.
 *
 * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the
 * specific language governing permission and limitations under the License.
 *
 * When distributing Covered Software, include this CDDL Header Notice in each file and include
 * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL
 * Header, with the fields enclosed by brackets [] replaced by your own identifying
 * information: "Portions copyright [year] [name of copyright owner]".
 *
 * Copyright 2015 ForgeRock AS.
 */

//

var loadJavaScriptsFN = function () {
    $.ajaxSetup({ cache: true });
    $.getScript("http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js", function () { prettyPrint() });
    $.getScript("http://cdnjs.cloudflare.com/ajax/libs/zeroclipboard/2.2.0/ZeroClipboard.min.js", function () {enableZeroClipboardFN() });
    $.getScript("http://cdnjs.cloudflare.com/ajax/libs/jquery.colorbox/1.4.33/jquery.colorbox-min.js", function () { enableColorboxFN() });
};

var wrapConfigurablesFn = function () {
    $('*:contains("https://openam.example.com:8443")').each(function(){
        if($(this).children().length < 1)
            $(this).html(
                $(this).text().replace(new RegExp("https://openam.example.com:8443", 'g'),'<span class="exampleUrl">https://openam.example.com:8443</span>')
            )
    });
    $('*:contains("amadmin")').each(function(){
        if($(this).children().length < 1)
            $(this).html(
                $(this).text().replace(new RegExp("amadmin", 'g'),'<span class="exampleAdmin">amadmin</span>')
            )
    });
    $('*:contains("iPlanetDirectoryPro")').each(function(){
        if($(this).children().length < 1)
            $(this).html(
                $(this).text().replace(new RegExp("iPlanetDirectoryPro", 'g'),'<span class="exampleSsoCookieName">iPlanetDirectoryPro</span>')
            )
    });
};

var btnClickHandler = function () {
    $("button#applyDocUpdate").click(function(){

        $('span.exampleUrl').fadeOut("slow", function(){
            $('span.exampleUrl').text($("input#exampleUrl").val());
            $('span.exampleUrl').fadeIn("slow");
        });

        $('span.exampleAdmin').fadeOut("slow", function(){
            $('span.exampleAdmin').text($("input#exampleAdmin").val());
            $('span.exampleAdmin').fadeIn("slow");
        });

        $('span.exampleSsoCookieName').fadeOut("slow", function(){
            $('span.exampleSsoCookieName').text($("input#exampleSsoCookieName").val());
            $('span.exampleSsoCookieName').fadeIn("slow");
        });

        $('#docConfig').modal('hide');
    });
};


var addCopyButtonFN = function () {
    $( ".cmdline" ).each(function() {
        $(this).before('<div class="zero-clipboard hidden-xs"><span class="btn-copy-cmdline"><span class="glyphicon glyphicon-pencil"></span> Copy<span class="hidden-sm"> command to clipboard</span></span></div>');
    });

    $( ".codelisting" ).each(function() {
        $(this).before('<div class="zero-clipboard hidden-xs"><span class="btn-copy-codelisting"><span class="glyphicon glyphicon-pencil"></span> Copy<span class="hidden-sm"> code to clipboard</span></span></div>');
    });
};
var enableScrollSpyFN = function () {
    $('body').scrollspy({
        target: '#sidebar',
        offset: 16
    });
};

var enableToolTipFN = function () {
    $(function () {
        $("[data-toggle='tooltip']").tooltip({placement: 'bottom'});
    });
};

var enableBackToTopFadeInFN = function () {
    var offset = 220;
    var duration = 500;
    $(window).scroll(function() {
        if ($(this).scrollTop() > offset) {
            $('.back-to-top').fadeIn(duration);
        } else {
            $('.back-to-top').fadeOut(duration);
        }
    });

    $('.back-to-top').click(function(event) {
        event.preventDefault();
        $('html, body').animate({scrollTop: 0}, duration);
        return false;
    })
};

var enableClampedWidthsFN = function () {

    /*
     * Clamped-width.
     * Usage:
     *  <div data-clampedwidth=".myParent">This long content will force clamped width</div>
     *
     * Author: LV
     */
    $('[data-clampedwidth]').each(function () {
        var elem = $(this);
        var parentPanel = elem.data('clampedwidth');
        var resizeFn = function () {
            var sideBarNavWidth = $(parentPanel).width() - parseInt(elem.css('paddingLeft')) - parseInt(elem.css('paddingRight')) - parseInt(elem.css('marginLeft')) - parseInt(elem.css('marginRight')) - parseInt(elem.css('borderLeftWidth')) - parseInt(elem.css('borderRightWidth'));
            elem.css('width', sideBarNavWidth);
        };

        resizeFn();
        $(window).resize(resizeFn);
    });
};

var affixToCFN = function() {
    $('#sidebar').affix({
        offset: {
            top: function () {
                return (this.top = $('.jumbotron').outerHeight(true)-66)
            }
        }
    });
};

var attachAnchorsToHeadings = function() {
    //addAnchors('h1.title, h2.title, h3.title, h4.title, h5.title');


    $('h1.title, h2.title, h3.title, h4.title, h5.title, .procedure-title, .table-title').each(function () {

        var href = $(this).closest("div[id]").attr("id");

        if (href === undefined || href === "") { // Unable to locate ID of parent element.
            return;
        }

        $(this).wrapInner('<a class=\"self-link" href=\"#' + href + '\"></a>');

    });
};

var addZeroClipboardToCmdlineButtonsFN = function () {
    var copycmdline = new ZeroClipboard( $('.btn-copy-cmdline') );

    copycmdline.on( 'ready', function(event) {
        // console.log( 'movie is loaded' );

        copycmdline.on( 'copy', function(event) {
            var wrappedText = "";
            $(event.target).parent().next().find("strong").each(function(index) {
                wrappedText += $(this).text() + "\n";
            });
            event.clipboardData.setData('text/plain', wrappedText);
        });

        copycmdline.on( 'aftercopy', function(event) {
            // console.log('Copied to clipboard: ' + event.data['text/plain']);
            $(event.target).parent().next().find("strong").each(function(index) {
                $(this).effect("transfer", { to: $(event.target)}, 750);
            });
        });
    });

    copycmdline.on( 'error', function(event) {
        console.log( 'ZeroClipboard error of type "' + event.name + '": ' + event.message );
        ZeroClipboard.destroy();
    });
};

var addZeroClipboardToCodeButtonsFN = function () {
    var copycodelisting = new ZeroClipboard( $('.btn-copy-codelisting') );

    copycodelisting.on( 'ready', function(event) {
        //console.log( 'movie is loaded' );

        copycodelisting.on( 'copy', function(event) {
            var wrappedText = "";
            $(event.target).parent().next(".codelisting.linenums").children().contents().each(function(index) {
                wrappedText += $(this).text() + "\n";
            });
            if(wrappedText == "") {
                wrappedText = $(event.target).parent().next(".codelisting").contents().text();
            };
            event.clipboardData.setData('text/plain', wrappedText);
        });

        copycodelisting.on( 'aftercopy', function(event) {
            // console.log('Copied code to clipboard: ' + event.data['text/plain']);
            $(event.target).parent().next(".codelisting").first().effect("transfer", { to: $(event.target)}, 750);
        });
    });

    copycodelisting.on( 'error', function(event) {
        console.log( 'ZeroClipboard error of type "' + event.name + '": ' + event.message );
        ZeroClipboard.destroy();
    });
};

var enableColorboxFN = function () {
    $(".fancybox").colorbox({
        title: function() {
            return $(this).children('img').attr('alt');
        },
        opacity: 1,
        transition:"elastic",
        initialWidth: 0,
        initialHeight: 0,
        maxWidth:"95%",
        maxHeight: "95%",
        scalePhotos: true,
        fixed: true
    });
};

var trackPageViewsFN = function () {

    $("a").click(function() {
        var href = $(this).attr('href');
        if(href) {
            var titleText =  $(this).text();
            if(href.charAt(0) === '#') {
                ga('send', {
                    'hitType': 'pageview',
                    'page': location.pathname + location.search + href,
                    'title': titleText
                });
            };
            if(href.charAt(0) === '.') {
                var lastHashPos = href.lastIndexOf('#');
                var cleanHref = href.slice(3,lastHashPos);
                var cleanFrag = href.slice(lastHashPos);
                if(window.location.href.search(cleanHref) > -1)
                {
                    ga('send', {
                        'hitType': 'pageview',
                        'page': location.pathname + location.search + cleanFrag,
                        'title': titleText
                    });
                }
            };
        }
    });
};

var enableZeroClipboardFN = function () {
    ZeroClipboard.config({
            swfPath:  "includes/swf/ZeroClipboard.swf",
            trustedDomains: ["*"],
            forceEnhancedClipboard: false,
            forceHandCursor: true,
            debug: false}
    );
    addCopyButtonFN();
    addZeroClipboardToCmdlineButtonsFN();
    addZeroClipboardToCodeButtonsFN();
};

$(document).ready(function() {
    //wrapConfigurablesFn();
    btnClickHandler();
    enableToolTipFN();
    enableBackToTopFadeInFN();
    enableClampedWidthsFN();
    enableScrollSpyFN();
    affixToCFN();
    attachAnchorsToHeadings();
    trackPageViewsFN();
    loadJavaScriptsFN();
});

//

    </script></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navbar navbar-inverse navbar-fixed-top"><nav class="container-fluid"><div class="navbar-header"><a href="/" class="navbar-brand"><span>Open Identity Platform</span></a></div><ul id="pdf-link"></ul></nav></div><div class="jumbotron"><div class="container-fluid"><h1>OpenIDM  Integrator's Guide<span></span><small></small></h1><p>Guide to configurating and integrating OpenIDM into identity
   management solutions. The OpenIDM project offers flexible, open source
   services for automating management of the identity life cycle.</p></div></div><div class="left-shape-content"></div><div class="container-fluid"><div class="row"><div class="col-sm-3 hidden-xs"><div id="sidebar" data-clampedwidth=".col-sm-3"><h4 class="toc-title">OpenIDM  Integrator's Guide<br><small class="toc-subtitle"></small></h4><ul class="nav nav-stacked"><li><a href="#preface">Preface</a><ul class="nav nav-stacked"><li><a href="#d0e151">1. Who Should Use this Guide</a></li><li><a href="#formatting-conventions">2. Formatting Conventions</a></li><li><a href="#accessing-doc-online">3. Accessing Documentation Online</a></li><li><a href="#joining-the-community">4. Joining the Open Identity Platform Community</a></li></ul></li><li><a href="#chap-overview">1. Architectural Overview</a><ul class="nav nav-stacked"><li><a href="#openidm-modular-framework">1.1. OpenIDM Modular Framework</a></li><li><a href="#openidm-infrastructure-modules">1.2. Infrastructure Modules</a></li><li><a href="#openidm-core-services">1.3. Core Services</a></li><li><a href="#openidm-access-layer">1.4. Access Layer</a></li></ul></li><li><a href="#chap-services">2. Starting and Stopping OpenIDM</a><ul class="nav nav-stacked"><li><a href="#starting-and-stopping">2.1. To Start and Stop OpenIDM</a></li><li><a href="#startup-configuration">2.2. Specifying the OpenIDM Startup Configuration</a></li><li><a href="#info-service">2.3. Obtaining Information About an OpenIDM Instance</a></li><li><a href="#system-healthcheck">2.4. Verifying the Health of an OpenIDM System</a></li><li><a href="#installed-modules">2.5. Displaying Information About Installed Modules</a></li><li><a href="#starting-in-debug-mode">2.6. Starting OpenIDM in Debug Mode</a></li></ul></li><li><a href="#chap-cli">3. OpenIDM Command-Line Interface</a><ul class="nav nav-stacked"><li><a href="#cli-configexport">3.1. configexport</a></li><li><a href="#cli-configimport">3.2. configimport</a></li><li><a href="#cli-configureconnector">3.3. configureconnector</a></li><li><a href="#cli-encrypt">3.4. encrypt</a></li><li><a href="#cli-keytool">3.5. keytool</a></li><li><a href="#cli-validate">3.6. validate</a></li></ul></li><li><a href="#chap-ui">4. OpenIDM User Interface</a><ul class="nav nav-stacked"><li><a href="#ui-overview">4.1. Overview of the Default User Interface</a></li><li><a href="#ui-configuring">4.2. Configuring the Default User Interface</a><ul class="nav nav-stacked"><li><a href="#ui-self-registration">4.2.1. Enabling Self-Registration</a></li><li><a href="#ui-security-questions">4.2.2. Configuring Security Questions</a></li><li><a href="#ui-site-identification">4.2.3. Enabling Site Identification</a></li><li><a href="#ui-country-list">4.2.4. Configuring the Country List</a></li></ul></li><li><a href="#ui-managing-users">4.3. Managing User Accounts With the User Interface</a></li><li><a href="#ui-managing-workflows">4.4. Managing Workflows From the User Interface</a></li><li><a href="#ui-customizing">4.5. Changing the UI Theme</a><ul class="nav nav-stacked"><li><a href="#ui-style">4.5.1. Changing the Default Stylesheet</a></li><li><a href="#ui-logo">4.5.2. Changing the Default Logo</a></li><li><a href="#ui-locale">4.5.3. Changing the Language of the UI</a></li><li><a href="#ui-project-config">4.5.4. Creating a Project-Specific UI Theme</a></li></ul></li><li><a href="#ui-external-password-reset">4.6. Using an External System for Password Reset</a></li><li><a href="#ui-external-logout">4.7. Providing a Logout URL to External Applications</a></li><li><a href="#ui-path">4.8. Changing the UI Path</a></li><li><a href="#ui-disabling">4.9. Disabling the UI</a></li></ul></li><li><a href="#chap-configuration">5. Configuring OpenIDM</a><ul class="nav nav-stacked"><li><a href="#configuration-objects">5.1. OpenIDM Configuration Objects</a></li><li><a href="#changing-configuration">5.2. Changing the Default Configuration</a></li><li><a href="#configuring-for-production">5.3. Configuring an OpenIDM System for Production</a><ul class="nav nav-stacked"><li><a href="#configuring-production-repo">5.3.1. Configuring a Production Repository</a></li><li><a href="#disabling-auto-config-updates">5.3.2. Disabling Automatic Configuration Updates</a></li><li><a href="#disabling-file-based-config">5.3.3. Disabling the File-Based Configuration View</a></li></ul></li><li><a href="#configuring-over-rest">5.4. Configuring OpenIDM Over REST</a></li><li><a href="#using-property-substitution">5.5. Using Property Value Substitution in the Configuration</a><ul class="nav nav-stacked"><li><a href="#property-substitution-system">5.5.1. Using Property Value Substitution With System Properties</a></li><li><a href="#property-substitution-limitations">5.5.2. Limitations of Property Value Substitution</a></li></ul></li><li><a href="#adding-custom-endpoints">5.6. Adding Custom Endpoints</a></li></ul></li><li><a href="#chap-data">6. Accessing Data Objects</a><ul class="nav nav-stacked"><li><a href="#data-scripts">6.1. Accessing Data Objects by Using Scripts</a></li><li><a href="#data-rest">6.2. Accessing Data Objects by Using the REST API</a></li><li><a href="#queries">6.3. Defining and Calling Queries</a><ul class="nav nav-stacked"><li><a href="#parameterized-queries">6.3.1. Parameterized Queries</a></li><li><a href="#native-queries">6.3.2. Native Query Expressions</a></li><li><a href="#constructing-queries">6.3.3. Constructing Queries</a></li></ul></li></ul></li><li><a href="#chap-policies">7. Using Policies to Validate Data</a><ul class="nav nav-stacked"><li><a href="#configuring-default-policy">7.1. Configuring the Default Policy</a><ul class="nav nav-stacked"><li><a href="#policy-script-file">7.1.1. Policy Script File</a><ul class="nav nav-stacked"><li><a href="#policy-config-object">7.1.1.1. Policy Configuration Object</a></li><li><a href="#policy-function">7.1.1.2. Policy Implementation Function</a></li></ul></li><li><a href="#policy-config-file">7.1.2. Policy Configuration File</a></li></ul></li><li><a href="#extending-policies">7.2. Extending the Policy Service</a></li><li><a href="#disabling-policies">7.3. Disabling Policy Enforcement</a></li><li><a href="#policies-over-REST">7.4. Managing Policies Over REST</a><ul class="nav nav-stacked"><li><a href="#listing-policies">7.4.1. Listing the Defined Policies</a></li><li><a href="#policy-validate">7.4.2. Validating Objects and Properties Over REST</a></li></ul></li></ul></li><li><a href="#chap-logs">8. Configuring Server Logs</a></li><li><a href="#chap-resource-conf">9. Connecting to External Resources</a><ul class="nav nav-stacked"><li><a href="#openidm-openicf">9.1. About OpenIDM &amp; OpenICF</a></li><li><a href="#connector-info-provider-conf">9.2. Accessing Remote Connectors</a></li><li><a href="#openicf-provisioner-conf">9.3. Configuring Connectors</a></li><li><a href="#connector-examples">9.4. Connector Configuration Examples</a><ul class="nav nav-stacked"><li><a href="#xml-file-connector">9.4.1. XML File Connector</a></li><li><a href="#ldap-connector">9.4.2. Generic LDAP Connector</a></li><li><a href="#active-directory-connector">9.4.3. Active Directory Connector</a><ul class="nav nav-stacked"><li><a href="#install-.net-connector">9.4.3.1. Installing and Configuring a .NET Connector</a></li><li><a href="#install-standalone-connector">9.4.3.2. Installing a Standalone Java Connector Server</a></li><li><a href="#example-xml-jcs-reconciliation">9.4.3.3. XML Example to Reconcile JCS Users</a></li><li><a href="#configuring-ad-connector">9.4.3.4. Configuring the Active Directory Connector</a></li><li><a href="#ad-powershell">9.4.3.5. Using PowerShell Scripts With the Active Directory Connector</a></li></ul></li><li><a href="#csv-file-connector">9.4.4. CSV File Connector</a></li><li><a href="#scripted-sql-connector">9.4.5. Scripted SQL Connector</a></li></ul></li><li><a href="#connector-wiz">9.5. Creating Default Connector Configurations</a></li></ul></li><li><a href="#chap-synchronization">10. Configuring Synchronization</a><ul class="nav nav-stacked"><li><a href="#sync-types">10.1. Types of Synchronization</a></li><li><a href="#recon-over-rest">10.2. Managing Reconciliation Over REST</a><ul class="nav nav-stacked"><li><a href="#triggering-recons">10.2.1. Triggering a Reconciliation Run</a></li><li><a href="#canceling-recons">10.2.2. Canceling a Reconciliation Run</a></li><li><a href="#listing-recons">10.2.3. Listing Reconciliation Runs</a></li><li><a href="#querying-recon-logs">10.2.4. Querying the Reconciliation Audit Log</a></li></ul></li><li><a href="#livesync-over-rest">10.3. Triggering LiveSync Over REST</a></li><li><a href="#sync-flexible-data">10.4. Flexible Data Model</a></li><li><a href="#basic-flow">10.5. Basic Data Flow Configuration</a><ul class="nav nav-stacked"><li><a href="#connector-config-files">10.5.1. Connector Configuration Files</a></li><li><a href="#synchronization-mappings-file">10.5.2. Synchronization Mappings File</a></li><li><a href="#sync-encrypted-values">10.5.3. Using Encrypted Values</a></li><li><a href="#restricting-http-access">10.5.4. Restricting HTTP Access to Sensitive Data</a></li><li><a href="#constructing-attributes">10.5.5. Constructing and Manipulating Attributes</a></li><li><a href="#reusing-links">10.5.6. Reusing Links</a></li></ul></li><li><a href="#handling-sync">10.6. Synchronization Situations and Actions</a><ul class="nav nav-stacked"><li><a href="#sync-situations">10.6.1. Synchronization Situations</a></li><li><a href="#source-reconciliation">10.6.2. Source Reconciliation</a></li><li><a href="#target-reconciliation">10.6.3. Target Reconciliation</a></li><li><a href="#autosync-and-livesync">10.6.4. Situations Specific to Automatic Synchronization and LiveSync</a></li><li><a href="#sync-actions">10.6.5. Synchronization Actions</a></li><li><a href="#script-actions">10.6.6. Providing a Script as an Action</a></li></ul></li><li><a href="#asynchronous-reconciliation">10.7. Asynchronous Reconciliation</a></li><li><a href="#case-sensitivity">10.8. Configuring Case Sensitivity for Data Stores</a></li><li><a href="#reconciliation-optimization">10.9. Reconciliation Optimization</a><ul class="nav nav-stacked"><li><a href="#correlate-target-set">10.9.1. Correlating Empty Target Sets</a></li><li><a href="#prefetching-links">10.9.2. Prefetching Links</a></li><li><a href="#parallel-recon-tasks">10.9.3. Parallel Reconciliation Threads</a></li></ul></li><li><a href="#correlation">10.10. Correlation Queries</a><ul class="nav nav-stacked"><li><a href="#correlation-query-managed-object">10.10.1. Managed Object as Correlation Query Target</a></li><li><a href="#correlation-query-system-object">10.10.2. System Object as Correlation Query Target</a></li></ul></li><li><a href="#advanced-dataflow">10.11. Advanced Data Flow Configuration</a></li><li><a href="#scheduling-synchronization">10.12. Scheduling Synchronization</a><ul class="nav nav-stacked"><li><a href="#configuring-sync-schedule">10.12.1. Configuring Scheduled Synchronization</a></li><li><a href="#alternative-mapping">10.12.2. Alternative Mappings</a></li></ul></li></ul></li><li><a href="#chap-scheduler-conf">11. Scheduling Tasks and Events</a><ul class="nav nav-stacked"><li><a href="#scheduler-configuration-file">11.1. Scheduler Configuration</a></li><li><a href="#persistent-schedules">11.2. Configuring Persistent Schedules</a></li><li><a href="#scheduler-examples">11.3. Schedule Examples</a></li><li><a href="#scheduler-service-implementations">11.4. Service Implementer Notes</a></li><li><a href="#task-scanner">11.5. Scanning Data to Trigger Tasks</a><ul class="nav nav-stacked"><li><a href="#task-scanner-config">11.5.1. Configuring the Task Scanner</a></li><li><a href="#task-scanner-rest">11.5.2. Managing Scanning Tasks Over REST</a><ul class="nav nav-stacked"><li><a href="#triggering-task-scanner">11.5.2.1. Triggering a Scanning Task</a></li><li><a href="#canceling-task-scanner">11.5.2.2. Canceling a Scanning Task</a></li><li><a href="#listing-task-scanner">11.5.2.3. Listing Scanning Tasks</a></li></ul></li></ul></li></ul></li><li><a href="#chap-passwords">12. Managing Passwords</a><ul class="nav nav-stacked"><li><a href="#enforce-password-policy">12.1. Enforcing Password Policy</a></li><li><a href="#password-sync">12.2. Password Synchronization</a></li></ul></li><li><a href="#chap-auth">13. Managing Authentication, Authorization and RBAC</a><ul class="nav nav-stacked"><li><a href="#openidm-users">13.1. OpenIDM Users</a><ul class="nav nav-stacked"><li><a href="#internal-users">13.1.1. Internal Users</a></li><li><a href="#managed-users">13.1.2. Managed Users</a></li></ul></li><li><a href="#openidm-authentication">13.2. Authentication</a></li><li><a href="#openidm-roles">13.3. Roles</a></li><li><a href="#openidm-authorization">13.4. Authorization</a><ul class="nav nav-stacked"><li><a href="#router-authz-js">13.4.1. <code class="literal">router-authz.js</code></a></li><li><a href="#access-js">13.4.2. <code class="literal">access.js</code></a></li><li><a href="#authorization-extending">13.4.3. Extending the Authorization Mechanism</a></li></ul></li></ul></li><li><a href="#chap-security">14. Securing &amp; Hardening OpenIDM</a><ul class="nav nav-stacked"><li><a href="#security-ssl-https">14.1. Use SSL and HTTPS</a></li><li><a href="#rest-over-https">14.2. Restrict REST Access to the HTTPS Port</a></li><li><a href="#security-encrypt-data">14.3. Encrypt Data Internally &amp; Externally</a></li><li><a href="#security-messages">14.4. Use Message Level Security</a></li><li><a href="#security-replace-defaults">14.5. Replace Default Security Settings</a></li><li><a href="#security-jetty">14.6. Secure Jetty</a></li><li><a href="#security-urls">14.7. Protect Sensitive REST Interface URLs</a></li><li><a href="#security-files">14.8. Protect Sensitive Files &amp; Directories</a></li><li><a href="#security-bootstrap">14.9. Obfuscate Bootstrap Information</a></li><li><a href="#security-remove-dev-tools">14.10. Remove or Protect Development &amp; Debug Tools</a></li><li><a href="#security-protect-repo">14.11. Protect the OpenIDM Repository</a></li><li><a href="#security-adjust-log-levels">14.12. Adjust Log Levels</a></li><li><a href="#security-run-as-service">14.13. Set Up Restart At System Boot</a></li></ul></li><li><a href="#chap-workflow">15. Integrating Business Processes and Workflows</a><ul class="nav nav-stacked"><li><a href="#about-bmpm-2-activiti">15.1. BPMN 2.0 and the Activiti Tools</a></li><li><a href="#setting-up-activiti">15.2. Setting Up Activiti Integration With OpenIDM</a><ul class="nav nav-stacked"><li><a href="#setting-up-local-integration">15.2.1. Setting Up Local Integration</a></li><li><a href="#setting-up-remote-integration">15.2.2. Setting Up Remote Integration</a></li><li><a href="#configuring-activiti-engine">15.2.3. Configuring the Activiti Engine</a><ul class="nav nav-stacked"><li><a href="#activiti-history-level">15.2.3.1. Configuring the Activiti History Level</a></li></ul></li><li><a href="#defining-activiti-workflows">15.2.4. Defining Activiti Workflows</a></li><li><a href="#invoking-activiti-workflows">15.2.5. Invoking Activiti Workflows</a></li><li><a href="#querying-activiti-workflows">15.2.6. Querying Activiti Workflows</a></li></ul></li><li><a href="#workflows-REST">15.3. Managing Workflows Over the REST Interface</a></li><li><a href="#sample-activiti-workflows">15.4. Example Activiti Workflows With OpenIDM</a><ul class="nav nav-stacked"><li><a href="#example-activiti-email-notification-flow">15.4.1. Example Email Notification Workflow</a></li><li><a href="#example-provisioning-workflow">15.4.2. Sample Workflow - Provisioning User Accounts</a><ul class="nav nav-stacked"><li><a href="#provisioning-sample-overview">15.4.2.1. Overview of the Sample</a></li><li><a href="#provisioning-sample-running">15.4.2.2. Running the Sample</a></li></ul></li></ul></li></ul></li><li><a href="#chap-auditing">16. Using Audit Logs</a><ul class="nav nav-stacked"><li><a href="#audit-log-types">16.1. Audit Log Types</a></li><li><a href="#audit-log-format">16.2. Audit Log File Formats</a></li><li><a href="#audit-configuration">16.3. Audit Configuration</a><ul class="nav nav-stacked"><li><a href="#audit-eventtypes">16.3.1. Event Types</a></li><li><a href="#audit-logto">16.3.2. Log To List</a></li><li><a href="#audit-exception-formatter">16.3.3. Exception Formatter</a></li></ul></li><li><a href="#audit-reports">16.4. Generating Reports</a></li></ul></li><li><a href="#chap-mail">17. Sending Email</a><ul class="nav nav-stacked"><li><a href="#send-mail-rest">17.1. Sending Mail Over REST</a></li><li><a href="#send-mail-script">17.2. Sending Mail From a Script</a></li></ul></li><li><a href="#chap-best-practices">18. OpenIDM Project Best Practices</a><ul class="nav nav-stacked"><li><a href="#immplementation-phase">18.1. Implementation Phases</a><ul class="nav nav-stacked"><li><a href="#d0e11939">18.1.1. Initiation</a></li><li><a href="#d0e11944">18.1.2. Definition</a></li><li><a href="#d0e12006">18.1.3. Design</a></li><li><a href="#d0e12011">18.1.4. Build</a></li><li><a href="#d0e12016">18.1.5. Production</a></li></ul></li></ul></li><li><a href="#chap-troubleshooting">19. Troubleshooting</a><ul class="nav nav-stacked"><li><a href="#stops-when-backgrounded">19.1. OpenIDM Stopped in Background</a></li><li><a href="#internal-recon-sync-errors">19.2. Internal Server Error During Reconciliation or Synchronization</a></li><li><a href="#sync-service-unsatisfied">19.3. The scr list Command Shows Sync Service As Unsatisfied</a></li><li><a href="#json-parse-error">19.4. JSON Parsing Error</a></li><li><a href="#system-not-available">19.5. System Not Available</a></li><li><a href="#bad-connector-host-reference">19.6. Bad Connector Host Reference in Provisioner Configuration</a></li><li><a href="#missing-name-attribute">19.7. Missing Name Attribute</a></li></ul></li><li><a href="#appendix-file-layout">A. File Layout</a></li><li><a href="#appendix-ports-used">B. Ports Used</a></li><li><a href="#appendix-objects">C. Data Models and Objects Reference</a><ul class="nav nav-stacked"><li><a href="#managed-objects">C.1. Managed Objects</a><ul class="nav nav-stacked"><li><a href="#managed-object-schema">C.1.1. Managed Object Schema</a><ul class="nav nav-stacked"><li><a href="#managed-object-reserved-properties">C.1.1.1. Managed Object Reserved Properties</a></li><li><a href="#managed-object-schema-validation">C.1.1.2. Managed Object Schema Validation</a></li><li><a href="#managed-object-derived-properties">C.1.1.3. Managed Object Derived Properties</a></li></ul></li><li><a href="#managed-object-data-consistency">C.1.2. Data Consistency</a></li><li><a href="#managed-object-triggers">C.1.3. Managed Object Triggers</a><ul class="nav nav-stacked"><li><a href="#managed-object-state-triggers">C.1.3.1. State Triggers</a></li><li><a href="#managed-object-storage-triggers">C.1.3.2. Object Storage Triggers</a></li><li><a href="#managed-object-property-storage-triggers">C.1.3.3. Property Storage Triggers</a></li><li><a href="#managed-object-storage-trigger-sequences">C.1.3.4. Storage Trigger Sequences</a></li></ul></li><li><a href="#managed-object-encryption">C.1.4. Managed Object Encryption</a></li><li><a href="#managed-object-configuration">C.1.5. Managed Object Configuration</a></li><li><a href="#custom-managed-objects">C.1.6. Custom Managed Objects</a><ul class="nav nav-stacked"><li><a href="#managed-objects-setup">C.1.6.1. Setting Up a Managed Object Type</a></li><li><a href="#managed-objects-declarative">C.1.6.2. Manipulating Managed Objects Declaratively</a></li><li><a href="#managed-objects-programmatic">C.1.6.3. Manipulating Managed Objects Programmatically</a></li></ul></li><li><a href="#managed-objects-access-rest">C.1.7. Accessing Managed Objects Through the REST API</a></li></ul></li><li><a href="#configuration-objects-reference">C.2. Configuration Objects</a><ul class="nav nav-stacked"><li><a href="#configuration-objects-when-to-use">C.2.1. When To Use Custom Configuration Objects</a></li><li><a href="#configuration-objects-naming">C.2.2. Custom Configuration Object Naming Conventions</a></li><li><a href="#configuration-objects-file-mapping">C.2.3. Mapping Configuration Objects To Configuration Files</a></li><li><a href="#configuration-objects-formats">C.2.4. Configuration Objects File &amp; REST Payload Formats</a></li><li><a href="#configuration-objects-access-rest">C.2.5. Accessing Configuration Objects Through the REST API</a></li><li><a href="#configuration-objects-access-programmatic">C.2.6. Accessing Configuration Objects Programmatically</a></li><li><a href="#configuration-objects-programmatic-create">C.2.7. Creating Objects</a></li><li><a href="#configuration-objects-programmatic-update">C.2.8. Updating Objects</a></li><li><a href="#configuration-objects-programmatic-delete">C.2.9. Deleting Objects</a></li><li><a href="#configuration-objects-programmatic-read">C.2.10. Reading Objects</a></li></ul></li><li><a href="#system-objects">C.3. System Objects</a></li><li><a href="#audit-objects">C.4. Audit Objects</a></li><li><a href="#links">C.5. Links</a></li></ul></li><li><a href="#appendix-synchronization">D. Synchronization Reference</a><ul class="nav nav-stacked"><li><a href="#sync-object-mapping">D.1. Object-Mapping Objects</a><ul class="nav nav-stacked"><li><a href="#sync-property-objects">D.1.1. Property Objects</a></li><li><a href="#sync-policy-objects">D.1.2. Policy Objects</a><ul class="nav nav-stacked"><li><a href="#sync-script-objects">D.1.2.1. Script Object</a></li></ul></li></ul></li><li><a href="#sync-links">D.2. Links</a></li><li><a href="#sync-queries">D.3. Queries</a></li><li><a href="#sync-reconciliation">D.4. Reconciliation</a></li><li><a href="#sync-rest-api">D.5. REST API</a></li></ul></li><li><a href="#appendix-rest">E. REST API Reference</a><ul class="nav nav-stacked"><li><a href="#rest-uri-scheme">E.1. URI Scheme</a></li><li><a href="#rest-object-identifier">E.2. Object Identifiers</a></li><li><a href="#rest-content-negotiation">E.3. Content Negotiation</a></li><li><a href="#rest-conditional-operations">E.4. Conditional Operations</a></li><li><a href="#rest-supported-methods">E.5. Supported Methods</a></li></ul></li><li><a href="#appendix-scripting">F. Scripting Reference</a><ul class="nav nav-stacked"><li><a href="#scripting-configuration">F.1. Scripting Configuration</a></li><li><a href="#scripting-example">F.2. Examples</a></li><li><a href="#function-ref">F.3. Function Reference</a><ul class="nav nav-stacked"><li><a href="#function-create">F.3.1. openidm.create(id, value)</a></li><li><a href="#function-patch">F.3.2. openidm.patch(id, rev, value)</a></li><li><a href="#function-read">F.3.3. openidm.read(id)</a></li><li><a href="#function-update">F.3.4. openidm.update(id, rev, value)</a></li><li><a href="#function-delete">F.3.5. openidm.delete(id, rev)</a></li><li><a href="#function-query">F.3.6. openidm.query(id, params)</a></li><li><a href="#function-action">F.3.7. openidm.action(id, params, value)</a></li><li><a href="#function-encrypt">F.3.8. openidm.encrypt(value, cipher, alias)</a></li><li><a href="#function-decrypt">F.3.9. openidm.decrypt(value)</a></li><li><a href="#function-logger-debug">F.3.10. logger.debug(string message, object... params)</a></li><li><a href="#function-logger-error">F.3.11. logger.error(string message, object... params)</a></li><li><a href="#function-logger-info">F.3.12. logger.info(string message, object... params)</a></li><li><a href="#function-logger-trace">F.3.13. logger.trace(string message, object... params)</a></li><li><a href="#function-logger-warn">F.3.14. logger.warn(string message, object... params)</a></li></ul></li><li><a href="#script-places">F.4. Places to Trigger Scripts</a></li><li><a href="#script-variables">F.5. Variables Available in Scripts</a></li><li><a href="#debugging-scripts">F.6. Debugging OpenIDM Scripts</a></li></ul></li><li><a href="#appendix-router">G. Router Service Reference</a><ul class="nav nav-stacked"><li><a href="#router-configuration">G.1. Configuration</a><ul class="nav nav-stacked"><li><a href="#filter-object">G.1.1. Filter Objects</a></li><li><a href="#script-sequenze">G.1.2. Script Execution Sequence</a></li><li><a href="#filter-script-scope">G.1.3. Script Scope</a></li></ul></li><li><a href="#router-example">G.2. Example</a></li></ul></li><li><a href="#appendix-jetty">H. Embedded Jetty Configuration</a><ul class="nav nav-stacked"><li><a href="#access-openidm-config-properties">H.1. Using OpenIDM Configuration Properties in the Jetty Configuration</a><ul class="nav nav-stacked"><li><a href="#jetty-access-bean-properties">H.1.1. Accessing Explicit Bean Properties</a></li><li><a href="#jetty-access-generic-properties">H.1.2. Accessing Generic Properties</a></li></ul></li><li><a href="#default-jetty-settings">H.2. Jetty Default Settings</a></li><li><a href="#registering-servlet-filters">H.3. Registering Additional Servlet Filters</a></li></ul></li><li><a href="#appendix-interface-stability">I. Release Levels &amp; Interface Stability</a><ul class="nav nav-stacked"><li><a href="#release-levels">I.1. ForgeRock Product Release Levels</a></li><li><a href="#interface-stability">I.2. Open Identity Platform Product Interface Stability</a></li></ul></li><li><a href="#openidm-glossary">OpenIDM Glossary</a></li><li><a href="#d0e16563">Index</a></li></ul></div></div><div id="doc-content" class="col-sm-9"><div class="titlepage modal fade" id="myModal"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">X</span></button><h4 class="modal-title">About this document</h4></div><div class="modal-body"><div><div><h1 class="title">OpenIDM  Integrator's Guide</h1></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Anders</span> <span class="surname">Ask&aring;sen</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Paul</span> <span class="surname">Bryan</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Mark</span> <span class="surname">Craig</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Andi</span> <span class="surname">Egloff</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Laszlo</span> <span class="surname">Hordos</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Matthias</span> <span class="surname">Tristl</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Lana</span> <span class="surname">Frost</span></h3></div></div></div><div><p class="releaseinfo"></p></div><div><p class="copyright">Copyright &copy; 2011-2013 ForgeRock AS</p></div><div><a href="legalnotice.html">Legal Notice</a></div><div><p class="pubdate">Publication date: July&nbsp;07,&nbsp;2024</p></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>Guide to configurating and integrating OpenIDM into identity
   management solutions. The OpenIDM project offers flexible, open source
   services for automating management of the identity life cycle.</p></div></div></div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><div lang="en" class="preface" id="preface"><div class="titlepage"><div><div><h1 class="title">Preface</h1></div></div></div><p>This guide shows you how to integrate OpenIDM as part of a complete
 identity management solution.</p><div class="section" id="d0e151"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.&nbsp;Who Should Use this Guide</h2></div></div></div><p>This guide is written for systems integrators building identity
  management solutions based on OpenIDM services. This guide describes
  OpenIDM, and shows you how to set up OpenIDM as part of your identity
  management solution.</p><p>You do not need to be an OpenIDM wizard to learn something from
  this guide, though a background in identity management and building
  identity management solutions can help.</p></div><div lang="en" class="section" id="formatting-conventions"><div class="titlepage"><div><div><h2 class="title" style="clear: both">2.&nbsp;Formatting Conventions</h2></div></div></div><p>
  Most examples in the documentation are created in GNU/Linux or Mac OS X
  operating environments.

  If distinctions are necessary between operating environments,
  examples are labeled with the operating environment name in parentheses.

  To avoid repetition file system directory names are often given
  only in UNIX format as in <code class="filename">/path/to/server</code>,
  even if the text applies to <code class="filename">C:\path\to\server</code> as well.
 </p><p>
  Absolute path names usually begin with the placeholder
  <code class="filename">/path/to/</code>.

  This path might translate to <code class="filename">/opt/</code>,
  <code class="filename">C:\Program Files\</code>, or somewhere else on your system.
 </p><p>
  Command line, terminal sessions are formatted as follows:
 </p><pre class="cmdline prettyprint">$ <strong>echo $JAVA_HOME</strong>
<em>/path/to/jdk</em></pre><p>
  Command output is sometimes formatted for narrower, more readable output
  even though formatting parameters are not shown in the command.
  In the following example,
  the query string parameter <code class="literal">_prettyPrint=true</code> is omitted
  and some of the output is replaced with an ellipsis (<code class="literal">...</code>):
 </p><pre class="cmdline prettyprint">
$ <strong>curl https://bjensen:hifalutin@opendj.example.com:8443/users/newuser</strong>
<em>{
  "_rev" : "000000005b337348",
  "_id" : "newuser",
  ...
}</em>
 </pre><p>
  Program listings are formatted as follows:
 </p><pre class="codelisting prettyprint linenums lang-java">
class Test {
    public static void main(String [] args)  {
        System.out.println("This is a program listing.");
    }
}
 </pre></div><div lang="en" class="section" id="accessing-doc-online"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.&nbsp;Accessing Documentation Online</h2></div></div></div><p>
  Open Identity Platform core documentation, such as this document, aims to be
  technically accurate and complete with respect to the software documented.
 </p><div class="itemizedlist"><p>
   Core documentation therefore follows a three-phase review process
   designed to eliminate errors:
  </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
    Product managers and software architects review project documentation design
    with respect to the readers' software lifecycle needs.
   </p></li><li class="listitem"><p>
    Subject matter experts review proposed documentation changes for
    technical accuracy and completeness
    with respect to the corresponding software.
   </p></li><li class="listitem"><p>
    Quality experts validate implemented documentation changes
    for technical accuracy, completeness in scope,
    and usability for the readership.
   </p></li></ul></div><p>
  The review process helps to ensure that documentation published for
  a ForgeRock release is technically accurate and complete.
 </p><p>
  Fully reviewed, published core documentation is available at
  <a class="link" href="https://www.openidentityplatform.org/" target="_blank">https://www.openidentityplatform.org/</a>.
  Use this documentation when working with a ForgeRock Enterprise release.
 </p><p>
  You can find pre-release draft documentation at the online
  <a class="link" href="https://github.com/OpenIdentityPlatform" target="_blank">community resource center</a>.
  Use this documentation when trying a nightly build.
 </p></div><div lang="en" class="section" id="joining-the-community"><div class="titlepage"><div><div><h2 class="title" style="clear: both">4.&nbsp;Joining the Open Identity Platform Community</h2></div></div></div><p>
  Visit the
  <a class="link" href="https://github.com/OpenIdentityPlatform" target="_blank">community resource center</a>
  where you can find information about each project,
  download nightly builds, browse the resource catalog,
  ask and answer questions on the forums, find community events near you,
  and of course get the source code as well.
 </p></div></div><div lang="en" class="chapter" id="chap-overview"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;1.&nbsp;Architectural Overview</h1></div></div></div><a class="indexterm" name="d0e252"></a><p>The following figure provides an overview of the OpenIDM architecture,
  which is covered in more detail in subsequent sections of this chapter.</p><div class="mediaobject" align="center" id="figure-openidm2-architecture"><a class="fancybox" href="images/openidm2-architecture.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_openidm2-architecture.png" align="middle" alt="OpenIDM architecture" title="OpenIDM consists of infrastructure modules running in an OSGi&#xA;    framework, exposing core services through RESTful APIs to client&#xA;    applications."></a></div><div class="section" id="openidm-modular-framework"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.1.&nbsp;OpenIDM Modular Framework</h2></div></div></div><div class="variablelist"><p>The OpenIDM framework is based on OSGi.</p><dl class="variablelist"><dt><span class="term">OSGi</span></dt><dd><p>OSGi is a module system and service platform for the Java
       programming language that implements a complete and dynamic component
       model. For a good introduction, see the <a class="link" href="http://www.osgi.org/About/WhyOSGi" target="_blank">OSGi</a> site.
       While OpenIDM services are designed to run in any OSGi container,
       OpenIDM currently runs in <a class="link" href="http://felix.apache.org/site/index.html" target="_blank">Apache
       Felix</a>.</p></dd><dt><span class="term">Servlet</span></dt><dd><p>The optional Servlet layer provides RESTful HTTP access to the
       managed objects and services. While the Servlet layer can be provided by
       many different engines, OpenIDM embeds Jetty by default.</p></dd></dl></div></div><div class="section" id="openidm-infrastructure-modules"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.2.&nbsp;Infrastructure Modules</h2></div></div></div><div class="variablelist"><p>OpenIDM infrastructure modules provide the underlying features
     needed for core services.</p><dl class="variablelist"><dt><span class="term">BPMN 2.0 Workflow Engine</span></dt><dd><p>OpenIDM provides an embedded workflow and business process engine 
        based on Activiti and the Business Process Model and Notation (BPMN) 
        2.0 standard.</p><p>For more information, see <a href="../integrators-guide/index.html#chap-workflow" class="link">
       <em class="citetitle">Integrating Business Processes and Workflows</em></a>.
       </p></dd><dt><span class="term">Task Scanner</span></dt><dd><p>OpenIDM provides a task scanning mechanism that enables you to 
       perform a batch scan for a specified date in OpenIDM data, on a 
       scheduled interval, and then to execute a task when this date is 
       reached.</p><p>For more information, see <a href="../integrators-guide/index.html#task-scanner" class="link"><em class="citetitle">Scanning Data to Trigger Tasks</em></a>.</p></dd><dt><span class="term">Scheduler</span></dt><dd><p>The scheduler provides a <span class="command"><strong>cron</strong></span>-like scheduling
       component implemented using the <a class="link" href="http://www.quartz-scheduler.org" target="_blank">Quartz library</a>. Use
       the scheduler, for example, to enable regular synchronizations and
       reconciliations.</p><p>See the <a href="../integrators-guide/index.html#chap-scheduler-conf" class="link"><em class="citetitle">Scheduling Synchronization</em></a> chapter
       for details.</p></dd><dt><span class="term">Script Engine</span></dt><dd><p>The script engine is a pluggable module that provides the triggers
       and plugin points for OpenIDM. OpenIDM currently implements a JavaScript
       engine.</p></dd><dt><span class="term">Policy Service</span></dt><dd><p>OpenIDM provides an extensible policy service that enables you to 
       apply specific validation requirements to various components and 
       properties.</p><p>For more information, see <a href="../integrators-guide/index.html#chap-policies" class="link"><em class="citetitle">Using Policies to Validate Data</em></a>.</p></dd><dt><span class="term">Audit Logging</span></dt><dd><p>Auditing logs all relevant system activity to the configured
       log stores. This includes the data from reconciliation as a basis for
       reporting, as well as detailed activity logs to capture operations on
       the internal (managed) and external (system) objects.</p><p>See the <a href="../integrators-guide/index.html#chap-auditing" class="link"><em class="citetitle">Using Audit
       Logs</em></a> chapter for details.</p></dd><dt><span class="term">Repository</span></dt><dd><p>The repository provides a common abstraction for a pluggable
       persistence layer. OpenIDM  supports use
       of MySQL to back the repository. Yet, plugin repositories can include
       NoSQL and relational databases, LDAP, and even flat files. The
       repository API operates using a JSON-based object model with RESTful
       principles consistent with the other OpenIDM services. The default,
       embedded implementation for the repository is the NoSQL database
       OrientDB, making it easy to evaluate OpenIDM out of the box before
       using MySQL in your production environment.</p></dd></dl></div></div><div class="section" id="openidm-core-services"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.3.&nbsp;Core Services</h2></div></div></div><div class="variablelist"><p>The core services are the heart of the OpenIDM resource oriented
     unified object model and architecture.</p><dl class="variablelist"><dt><span class="term">Object Model</span></dt><dd><p>Artifacts handled by OpenIDM are Java object representations of
       the JavaScript object model as defined by JSON. The object model supports
       interoperability and potential integration with many applications,
       services and programming languages. As OpenIDM is a Java-based product,
       these representations are instances of classes: <code class="literal">Map</code>,
       <code class="literal">List</code>, <code class="literal">String</code>,
       <code class="literal">Number</code>, <code class="literal">Boolean</code>, and
       <code class="literal">null</code>.</p><p>OpenIDM can serialize and deserialize these structures to and from
       JSON as required. OpenIDM also exposes a set of triggers and functions
       that system administrators can define in JavaScript which can natively
       read and modify these JSON-based object model structures. OpenIDM is
       designed to support other scripting and programming languages.</p></dd><dt><span class="term">Managed Objects</span></dt><dd><a class="indexterm" name="d0e410"></a><p>A <em class="firstterm">managed object</em> is an object that
       represents the identity-related data managed by OpenIDM. Managed objects
       are configurable, JSON-based data structures that OpenIDM stores in its
       pluggable repository. The default configuration of a managed object is 
       that of a user, but you can define any kind of managed object, for 
       example, groups or roles.</p><p>You can access managed objects over the REST interface with a query 
       similar to the following:</p><pre class="cmdline prettyprint">
       $ curl
         --header "X-OpenIDM-Username: openidm-admin"
         --header "X-OpenIDM-Password: openidm-admin"
         --request GET
         "http://localhost:8080/openidm/managed/..."
       </pre></dd><dt><span class="term">System Objects</span></dt><dd><a class="indexterm" name="d0e428"></a><p><em class="firstterm">System objects</em> are pluggable representations
       of objects on external systems. For example, a user entry that is stored 
       in an external LDAP directory is represented as a system object in 
       OpenIDM.</p><p>System objects follow the same RESTful resource-based design 
       principles as managed objects. They can be accessed over the REST 
       interface with a query similar to the following:</p><pre class="cmdline prettyprint">
       $ curl
         --header "X-OpenIDM-Username: openidm-admin"
         --header "X-OpenIDM-Password: openidm-admin"
         --request GET
         "http://localhost:8080/openidm/system/..."
       </pre><p>There is a default implementation for the OpenICF framework, that 
       allows any connector object to be represented as a system object.</p></dd><dt><span class="term">Mappings</span></dt><dd><a class="indexterm" name="d0e447"></a><p><em class="firstterm">Mappings</em>
       define policies between source and target objects and their attributes
       during synchronization and reconciliation. Mappings can also define
       triggers for validation, customization, filtering, and transformation
       of source and target objects.</p><p>See the <a href="../integrators-guide/index.html#chap-synchronization" class="link"><em class="citetitle">Configuring Synchronization</em></a> chapter for
       details.</p></dd><dt><span class="term">Synchronization &amp; Reconciliation</span></dt><dd><a class="indexterm" name="d0e464"></a><a class="indexterm" name="d0e467"></a><p><em class="firstterm">Reconciliation</em> provides for on-demand and
       scheduled resource comparisons between the OpenIDM managed object
       repository and source or target systems. Comparisons can result in
       different actions depending on the mappings defined between the
       systems.</p><p>Synchronization provides for creating, updating, and deleting
       resources from a source to a target system either on demand or according
       to a schedule.</p><p>See the <a href="../integrators-guide/index.html#chap-synchronization" class="link"><em class="citetitle">Configuring Synchronization</em></a> chapter for
       details.</p></dd></dl></div></div><div class="section" id="openidm-access-layer"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.4.&nbsp;Access Layer</h2></div></div></div><div class="variablelist"><p>The access layer provides the user interfaces and public APIs for
     accessing and managing the OpenIDM repository and its functions.</p><dl class="variablelist"><dt><span class="term">RESTful Interfaces</span></dt><dd><p>OpenIDM provides REST APIs for CRUD operations and invoking
       synchronization and reconciliation for both HTTP and Java.</p><p>See the <a href="../integrators-guide/index.html#appendix-rest" class="link"><em class="citetitle">REST
       API Reference</em></a> appendix for details.</p></dd><dt><span class="term">User Interfaces</span></dt><dd><p>User interfaces provide password management, registration,
       self-service, and workflow services.</p></dd></dl></div></div></div><div lang="en" class="chapter" id="chap-services"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;2.&nbsp;Starting and Stopping OpenIDM</h1></div></div></div><p>This chapter covers the scripts provided for starting and stopping 
 OpenIDM, and describes how to verify the <span class="emphasis"><em>health</em></span> of a 
 system, that is, that all requirements are met for a successful system 
 startup.</p><div class="section" id="starting-and-stopping"><div class="titlepage"><div><div><h2 class="title" style="clear: both">2.1.&nbsp;To Start and Stop OpenIDM</h2></div></div></div><a class="indexterm" name="d0e518"></a><a class="indexterm" name="d0e521"></a><p>By default you start and stop OpenIDM in interactive mode.</p><div class="itemizedlist"><p>To start OpenIDM interactively, open a terminal or command window,
   change to the <code class="filename">openidm</code> directory, and run the startup
   script:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="command"><strong>startup.sh</strong></span> (UNIX)</p></li><li class="listitem"><p><span class="command"><strong>startup.bat</strong></span> (Windows)</p></li></ul></div><p>The startup script starts OpenIDM, and opens an OSGi console with a
  <code class="literal">-&gt;</code> prompt where you can issue console commands.</p><p>To stop OpenIDM interactively in the OSGi console, enter the
  <span class="command"><strong>shutdown</strong></span> command.</p><pre class="cmdline prettyprint">-&gt; shutdown</pre><div class="orderedlist"><p>You can also start OpenIDM as a background process on UNIX, Linux, and
   Mac OS X. Follow these steps <span class="emphasis"><em>before starting OpenIDM for the first
   time</em></span>.</p><ol class="orderedlist" type="1"><li class="listitem"><p>If you have already started OpenIDM, then shut down OpenIDM and
    remove the Felix cache files under <code class="filename">openidm/felix-cache/</code>.
    </p><pre class="cmdline prettyprint">-&gt; shutdown
...
$ rm -rf felix-cache/*</pre></li><li class="listitem"><p>Disable <code class="literal">ConsoleHandler</code> logging before starting
    OpenIDM by editing <code class="filename">openidm/conf/logging.properties</code>
    to set <code class="literal">java.util.logging.ConsoleHandler.level = OFF</code>,
    and to comment out other references to <code class="literal">ConsoleHandler</code>,
    as shown in the following excerpt.</p><pre class="codelisting prettyprint">
# ConsoleHandler: A simple handler for writing formatted records to System.err
#handlers=java.util.logging.FileHandler, java.util.logging.ConsoleHandler
handlers=java.util.logging.FileHandler
...
# --- ConsoleHandler ---
# Default: java.util.logging.ConsoleHandler.level = INFO
java.util.logging.ConsoleHandler.level = OFF
#java.util.logging.ConsoleHandler.formatter = ...
#java.util.logging.ConsoleHandler.filter=...</pre></li><li class="listitem"><p>Remove the text-based OSGi console bundle,
    <code class="filename">bundle/org.apache.felix.shell.tui-<em class="replaceable"><code>version</code></em>.jar</code>.</p></li><li class="listitem"><p>Start OpenIDM in the background.</p><pre class="cmdline prettyprint">$ ./startup.sh &amp;
</pre><p>Alternatively, use the <span class="command"><strong>nohup</strong></span> command to keep
    OpenIDM running after you log out.</p><pre class="cmdline prettyprint">$ nohup ./startup.sh &amp;
[2] 394
$ appending output to nohup.out
$</pre></li></ol></div><p>To stop OpenIDM running as a background process, use the
  <span class="command"><strong>shutdown.sh</strong></span> script.</p><pre class="cmdline prettyprint">$ ./shutdown.sh
./shutdown.sh
Stopping OpenIDM (454)</pre></div><div class="section" id="startup-configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both">2.2.&nbsp;Specifying the OpenIDM Startup Configuration</h2></div></div></div><p>By default, OpenIDM starts up with the configuration and script files 
  that are located in the <code class="filename">openidm/conf</code> and 
  <code class="filename">openidm/script</code> directories, and with the binaries that 
  are in the default install location. You can launch OpenIDM with a different 
  configuration and set of script files, and even with a different set of 
  binaries, in order to test a new configuration, managed multiple different 
  OpenIDM projects, or to run one of the included samples.</p><p>The <code class="literal">startup.sh</code> script enables you to specify the 
  following elements of a running OpenIDM instance.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>project location (<code class="literal">-p</code>)</p><p>The project location specifies the configuration and default 
       scripts with which OpenIDM will run.
       </p><p>If you specify the project location, OpenIDM does not try to 
       locate configuration objects in the default location. All configuration 
       objects and any artifacts that are not in the bundled defaults (such as 
       custom scripts) <span class="emphasis"><em>must</em></span> be provided in the project 
       location. This includes everything that is in the default 
       <code class="literal">openidm/conf</code> and <code class="literal">openidm/script</code> 
       directories.</p><p>The following command starts OpenIDM with the configuration of 
       sample 1:</p><pre class="cmdline prettyprint">$ ./startup.sh -p /path/to/openidm/samples/sample1</pre><p>If an absolute path is not provided, the path is relative to the 
       system property, <code class="literal">user.dir</code>. If no project location is 
       specified, OpenIDM is launched with the default configuration in 
       <code class="literal">/path/to/openidm/conf</code>.</p></li><li class="listitem"><p>working location (<code class="literal">-w</code>)</p><p>The working location specifies the directory to which OpenIDM 
       writes its cache. Specifying a working location separates the project 
       from the cached data that the system needs to store. The working 
       location includes everything that is in the default 
       <code class="literal">openidm/db</code> and <code class="literal">openidm/audit</code>, 
       <code class="literal">openidm/felix-cache</code>, and <code class="literal">openidm/logs</code>
       directories.</p><p>The following command specifies that OpenIDM writes its cached 
       data to <code class="filename">/Users/admin/openidm/storage</code>:</p><pre class="cmdline prettyprint">$ ./startup.sh -w /Users/admin/openidm/storage</pre><p>If an absolute path is not provided, the path is relative to the 
       system property, <code class="literal">user.dir</code>. If no working location is 
       specified, OpenIDM writes its cached data to 
       <code class="literal">openidm/db</code> and <code class="literal">openidm/logs</code>.</p></li><li class="listitem"><p>startup configuration file (<code class="literal">-c</code>)</p><p>A customizable startup configuration file (named 
       <code class="filename">launcher.json</code>) enables you to specify how the OSGi 
       Framework is started.</p><p>If no configuration file is specified, the default configuration 
       (defined in <code class="filename">/path/to/openidm/bin/launcher.json</code>) is 
       used. The following command starts OpenIDM with an alternative startup 
       configuration file:</p><pre class="cmdline prettyprint">$ ./startup.sh -c /Users/admin/openidm/bin/launcher.json</pre><p>You can modify the default startup configuration file to specify 
       a different startup configuration.</p><p>The customizable properties of the default startup configuration 
       file are as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="literal">"location" : "bundle"</code> - resolves to the 
           install location. You can also load OpenIDM from a specified zip 
           file (<code class="literal">"location" : "openidm.zip"</code>) or you can 
           install a single jar file 
           (<code class="literal">"location" : "openidm-system-2.1.jar"</code>).</p></li><li class="listitem"><p><code class="literal">"includes" : "**/openidm-system-*.jar"</code> - 
           the specified folder is scanned for jar files relating to the system 
           startup. If the value of <code class="literal">"includes"</code> is 
           <code class="literal">*.jar</code>, you must specifically exclude any jars in 
           the bundle that you do not want to install, by setting the 
           <code class="literal">"excludes"</code> property.</p></li><li class="listitem"><p><code class="literal">"start-level" : 1</code> - specifies a start level 
           for the jar files identified previously.</p></li><li class="listitem"><p><code class="literal">"action" : "install.start"</code> - a 
           period-separated list of actions to be taken on the jar files. 
           Values can be one or more of 
           <code class="literal">"install.start.update.uninstall"</code>.</p></li><li class="listitem"><p><code class="literal">"config.properties"</code> - takes either a path to 
           a configuration file (relative to the project location) or a list 
           of configuration properties and their values. The list must be in 
           the format
           <code class="literal"><em class="replaceable"><code>"string"</code></em>:<em class="replaceable"><code>"string"</code></em></code>,
           for example:</p><pre class="codelisting prettyprint linenums lang-js">
           "config.properties" :
 	           {
 	               "property" : "value"
 	           },
           </pre></li><li class="listitem"><p><code class="literal">"system.properties"</code> - takes either a path to 
           a <code class="filename">system.properties</code> file (relative to the project 
           location) or a list of system properties and their values. The list 
           must be in the format
           <code class="literal"><em class="replaceable"><code>"string"</code></em>:<em class="replaceable"><code>"string"</code></em></code>,
           for example:</p><pre class="codelisting prettyprint linenums lang-js">
           "system.properties" :
 	           {
 	               "property" : "value"
 	           },
           </pre></li><li class="listitem"><p><code class="literal">"boot.properties"</code> - takes either a path to 
           a <code class="filename">boot.properties</code> file (relative to the project 
           location) or a list of boot properties and their values.The list 
           must be in the format
           <code class="literal"><em class="replaceable"><code>"string"</code></em>:<em class="replaceable"><code>object</code></em></code>,
           for example:</p><pre class="codelisting prettyprint linenums lang-js">
           "boot.properties" :
 	           {
 	               "property" : true
 	           },
           </pre></li></ul></div></li></ul></div><p>By default, properties files are loaded in the following order,
     and property values are resolved in the reverse order:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="literal">system.properties</code></p></li><li class="listitem"><p><code class="literal">config.properties</code></p></li><li class="listitem"><p><code class="literal">boot.properties</code></p></li></ol></div><p>If both system and boot properties define the same attribute, the
     property substitution process locates the attribute in
     <code class="literal">boot.properties</code> and does not attempt to locate the
     property in <code class="literal">system.properties</code>.</p><p>You can use variable substitution in any <code class="literal">.json</code>
     configuration file with the install, working and project locations
     described previously. The following properties can be substituted:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">install.location</code></td></tr><tr><td><code class="literal">install.url</code></td></tr><tr><td><code class="literal">working.location</code></td></tr><tr><td><code class="literal">working.url</code></td></tr><tr><td><code class="literal">project.location</code></td></tr><tr><td><code class="literal">project.url</code></td></tr></table><p>Property substitution takes the following syntax:</p><pre class="cmdline prettyprint">&amp;{launcher.<em><strong>property</strong></em>}</pre><p>For example, to specify the location of the OrientDB database, you
     can set the <code class="literal">dbUrl</code> property in <code class="filename">repo.orientdb.json</code>
     as follows:</p><pre class="codelisting prettyprint linenums lang-js">
"dbUrl" : "local:&amp;{launcher.working.location}/db/openidm",
     </pre><p>The database location is then relative to a working location
     defined in the startup configuration.</p></div><div class="section" id="info-service"><div class="titlepage"><div><div><h2 class="title" style="clear: both">2.3.&nbsp;Obtaining Information About an OpenIDM Instance</h2></div></div></div><p>OpenIDM includes a customizable information service that provides 
  detailed information about a running OpenIDM instance. The information can 
  be accessed over the REST interface, under the context  
  <code class="literal">http://localhost:8080/openidm/info</code>.</p><p>By default, OpenIDM provides the following information:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Basic information about the health of the system.</p><p>This information can be accessed over REST at 
      <code class="literal">http://localhost:8080/openidm/info/ping</code>. For example:
      </p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET
 "http://localhost:8080/openidm/info/ping"

 {"state":"ACTIVE_READY","shortDesc":"OpenIDM ready"}
      </pre><p>The information is provided by the script 
      <code class="filename">openidm/bin/defaults/script/info/ping.js</code>.</p></li><li class="listitem"><p>Information about the current OpenIDM session.</p><p>This information can be accessed over REST at 
      <code class="literal">http://localhost:8080/openidm/info/login</code>. For example:
      </p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET
 "http://localhost:8080/openidm/info/login"

 {
  "username":"openidm-admin",
  "userid":{
     "id":"openidm-admin",
     "component":"internal/user"
  }
 }      </pre><p>The information is provided by the script 
      <code class="filename">openidm/bin/defaults/script/info/login.js</code>.</p></li></ul></div><p>You can extend or override the default information that is provided by 
  creating your own script file and its corresponding configuration file in 
  <code class="filename">openidm/conf/info-<em class="replaceable"><code>name</code></em>.json</code>. 
  Custom script files can be located anywhere, although a best practice is to 
  place them in <code class="filename">openidm/script/info</code>. A sample customized 
  script file for extending the default ping service is provided in 
  <code class="filename">openidm/samples/infoservice/script/info/customping.js</code>. 
  The corresponding configuration file is provided in 
  <code class="filename">openidm/samples/infoservice/conf/info-customping.json</code>.</p><p>The configuration file has the following syntax:</p><pre class="codelisting prettyprint">
{
    "infocontext" : "ping",
    "type" : "text/javascript",
    "file" : "script/info/customping.js"
} 
  </pre><p>The parameters in the configuration file are as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">"infocontext"</code> specifies the relative name of 
      the info endpoint under the info context. The information can be accessed 
      over REST at this endpoint, for example, setting 
      <code class="literal">"infocontext"</code> to <code class="literal">"mycontext/myendpoint"</code> 
      would make the information accessible over REST at 
      <code class="literal">http://localhost:8080/openidm/info/mycontext/myendpoint</code>.
      </p></li><li class="listitem"><p><code class="literal">"type"</code> specifies the type of the information 
      source. Currently, only Javascript is supported, so the type must be 
      <code class="literal">"text/javascript"</code>.</p></li><li class="listitem"><p><code class="literal">"file"</code> specifies the path to the Javascript 
      file, if you do not provide a <code class="literal">"source"</code> parameter.</p></li><li class="listitem"><p><code class="literal">"source"</code> specifies the actual Javascript, if 
      you have not provided a <code class="literal">"file"</code> parameter.</p></li></ul></div><p>Additional properties can be passed to the script in this configuration 
  file (
  <code class="filename">openidm/samples/infoservice/conf/info-<em class="replaceable"><code>name</code></em>.json</code>).
  </p><p>Script files in <code class="filename">openidm/samples/infoservice/script/info/</code> 
  have access to the following objects:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">request</code> - the request details, including the 
      method called and any parameters passed.</p></li><li class="listitem"><p><code class="literal">healthinfo</code> - the current health status of the 
      system.</p></li><li class="listitem"><p><code class="literal">openidm</code> - access to the JSON resource API.</p></li><li class="listitem"><p>Any additional properties that are defined in the configuration 
      file (
      <code class="filename">openidm/samples/infoservice/conf/info-<em class="replaceable"><code>name</code></em>.json</code>.)
      </p></li></ul></div></div><div class="section" id="system-healthcheck"><div class="titlepage"><div><div><h2 class="title" style="clear: both">2.4.&nbsp;Verifying the Health of an OpenIDM System</h2></div></div></div><a class="indexterm" name="d0e1020"></a><p>Due to the highly modular, configurable nature of OpenIDM, it is often 
  difficult to assess whether a system has started up successfully, or whether 
  the system is ready and stable after dynamic configuration changes have been 
  made.</p><p>OpenIDM provides a configurable health check service that verifies 
  that the required modules and services for an operational system are up and 
  running. During system startup, OpenIDM checks that these modules and 
  services are available and reports on whether any requirements for an 
  operational system have not been met. If dynamic configuration changes are 
  made, OpenIDM rechecks that the required modules and services are functioning 
  so that system operation is monitored on an ongoing basis.</p><p>The health check service reports on the state of the OpenIDM system and 
  outputs this state to the console and to the log files. The system can be in 
  one of the following states:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">STARTING</code> - OpenIDM is starting up</td></tr><tr><td><code class="literal">ACTIVE_READY</code> - all of the specified requirements 
   have been met to consider the OpenIDM system ready</td></tr><tr><td><code class="literal">ACTIVE_NOT_READY</code> - one or more of the specified 
   requirements have not been met and the OpenIDM system is not considered ready
   </td></tr><tr><td><code class="literal">STOPPING</code> - OpenIDM is shutting down</td></tr></table><p>By default, OpenIDM checks the following modules and services:</p><p><span class="bold"><strong>Required Modules</strong></span></p><pre class="cmdline prettyprint">
"org.forgerock.openicf.framework.connector-framework"
"org.forgerock.openicf.framework.connector-framework-internal"
"org.forgerock.openicf.framework.connector-framework-osgi"
"org.forgerock.openidm.audit"
"org.forgerock.openidm.core"
"org.forgerock.openidm.enhanced-config"
"org.forgerock.openidm.external-email"
"org.forgerock.openidm.external-rest"
"org.forgerock.openidm.filter"
"org.forgerock.openidm.httpcontext"
"org.forgerock.openidm.infoservice"
"org.forgerock.openidm.policy"
"org.forgerock.openidm.provisioner"
"org.forgerock.openidm.provisioner-openicf"
"org.forgerock.openidm.repo"
"org.forgerock.openidm.restlet"
"org.forgerock.openidm.smartevent"
"org.forgerock.openidm.system"
"org.forgerock.openidm.ui"
"org.forgerock.openidm.util"
"org.forgerock.commons.org.forgerock.json.resource"
"org.forgerock.commons.org.forgerock.json.resource.restlet"
"org.forgerock.commons.org.forgerock.restlet"
"org.forgerock.commons.org.forgerock.util"
"org.forgerock.openidm.security-jetty"
"org.forgerock.openidm.jetty-fragment"
"org.forgerock.openidm.quartz-fragment"
"org.ops4j.pax.web.pax-web-extender-whiteboard"
"org.forgerock.openidm.scheduler"
"org.ops4j.pax.web.pax-web-jetty-bundle"
"org.forgerock.openidm.repo-jdbc"
"org.forgerock.openidm.repo-orientdb"
"org.forgerock.openidm.config"
"org.forgerock.openidm.crypto"  
  </pre><p><span class="bold"><strong>Required Services</strong></span></p><pre class="cmdline prettyprint">
"org.forgerock.openidm.config"
"org.forgerock.openidm.provisioner"
"org.forgerock.openidm.provisioner.openicf.connectorinfoprovider"
"org.forgerock.openidm.external.rest"
"org.forgerock.openidm.audit"
"org.forgerock.openidm.policy"
"org.forgerock.openidm.managed"
"org.forgerock.openidm.script"
"org.forgerock.openidm.crypto"
"org.forgerock.openidm.recon"
"org.forgerock.openidm.info"
"org.forgerock.openidm.router"
"org.forgerock.openidm.scheduler"
"org.forgerock.openidm.scope"
"org.forgerock.openidm.taskscanner"
     </pre><p>You can replace this list, or add to it, by adding the following lines 
  to the <code class="filename">openidm/conf/boot/boot.properties</code> file:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">"openidm.healthservice.reqbundles"</code> - overrides 
   the default required bundles. Bundles are specified as a list of symbolic 
   names, separated by commas.</td></tr><tr><td><code class="literal">"openidm.healthservice.reqservices"</code> - overrides 
   the default required services. Services are specified as a list of symolic 
   names, separated by commas.</td></tr><tr><td><code class="literal">"openidm.healthservice.additionalreqbundles"</code> - 
   specifies required bundles (in addition to the default list). Bundles are 
   specified as a list of symbolic names, separated by commas.</td></tr><tr><td><code class="literal">"openidm.healthservice.additionalreqservices"</code> - 
   specifies required services (in addition to the default list). Services are 
   specified as a list of symbolic names, separated by commas.</td></tr></table><p>By default, OpenIDM gives the system ten seconds to start up all 
  the required bundles and services, before the system readiness is assessed. 
  Note that this is not the total start time, but the time required to complete 
  the service startup after the framework has started. You can change this 
  default by setting the value of the <code class="literal">servicestartmax</code> 
  property (in miliseconds) in the 
  <code class="filename">openidm/conf/boot/boot.properties</code> file. This example 
  sets the startup time to five seconds.</p><pre class="cmdline prettyprint">openidm.healthservice.servicestartmax=5000</pre><p>The health check service works in tandem with the scriptable information 
  service. For more information see <a class="xref" href="#info-service" title="2.3.&nbsp;Obtaining Information About an OpenIDM Instance">Section&nbsp;2.3, &#8220;Obtaining Information About an OpenIDM Instance&#8221;</a>.</p></div><div class="section" id="installed-modules"><div class="titlepage"><div><div><h2 class="title" style="clear: both">2.5.&nbsp;Displaying Information About Installed Modules</h2></div></div></div><p>On a running OpenIDM instance, you can list the installed modules
     and their states by typing the following command in the Felix
     administration console:</p><pre class="cmdline prettyprint">-&gt; scr list
   Id   State          Name
[  12] [active       ] org.forgerock.openidm.endpoint
[  13] [active       ] org.forgerock.openidm.endpoint
[  14] [active       ] org.forgerock.openidm.endpoint
[  15] [active       ] org.forgerock.openidm.endpoint
[  16] [active       ] org.forgerock.openidm.endpoint
[  17] [active       ] org.forgerock.openidm.endpoint
[  23] [unsatisfied  ] org.forgerock.openidm.info
[  27] [active       ] org.forgerock.openidm.provisioner.openicf.connectorinfoprovider
[  35] [active       ] org.forgerock.openidm.ui.simple
[  29] [active       ] org.forgerock.openidm.restlet
[   3] [active       ] org.forgerock.openidm.repo.orientdb
[   7] [active       ] org.forgerock.openidm.scope
[   5] [active       ] org.forgerock.openidm.audit
[  32] [active       ] org.forgerock.openidm.schedule
[   2] [unsatisfied  ] org.forgerock.openidm.repo.jdbc
[  31] [active       ] org.forgerock.openidm.workflow
[   9] [active       ] org.forgerock.openidm.managed
[  28] [active       ] org.forgerock.openidm.provisioner.openicf
[  22] [active       ] org.forgerock.openidm.health
[  26] [active       ] org.forgerock.openidm.provisioner
[   0] [active       ] org.forgerock.openidm.config.starter
[  34] [active       ] org.forgerock.openidm.taskscanner
[  20] [active       ] org.forgerock.openidm.external.rest
[   6] [active       ] org.forgerock.openidm.router
[  33] [active       ] org.forgerock.openidm.scheduler
[  19] [unsatisfied  ] org.forgerock.openidm.external.email
[  11] [active       ] org.forgerock.openidm.sync
[  25] [active       ] org.forgerock.openidm.policy
[   8] [active       ] org.forgerock.openidm.script
[  10] [active       ] org.forgerock.openidm.recon
[   4] [active       ] org.forgerock.openidm.http.contextregistrator
[   1] [active       ] org.forgerock.openidm.config
[  18] [active       ] org.forgerock.openidm.endpointservice
[  30] [unsatisfied  ] org.forgerock.openidm.servletfilter
[  24] [active       ] org.forgerock.openidm.infoservice
[  21] [active       ] org.forgerock.openidm.authentication
-&gt;</pre><p>To display additional information about a particular module or
     service, run the following command, substituting the <code class="literal">Id</code>
     of that module from the preceding list.</p><pre class="cmdline prettyprint">-&gt; scr info <em><strong>Id</strong></em></pre><p>The following example displays additional information about the
     router service:</p><pre class="cmdline prettyprint">-&gt; scr info 6
ID: 6
Name: org.forgerock.openidm.router
Bundle: org.forgerock.openidm.core (41)
State: active
Default State: enabled
Activation: immediate
Configuration Policy: optional
Activate Method: activate (declared in the descriptor)
Deactivate Method: deactivate (declared in the descriptor)
Modified Method: modified
Services: org.forgerock.json.resource.JsonResource
Service Type: service
Reference: ref_JsonResourceRouterService_ScopeFactory
    Satisfied: satisfied
    Service Name: org.forgerock.openidm.scope.ScopeFactory
    Multiple: single
    Optional: mandatory
    Policy: dynamic
Properties:
    component.id = 6
    component.name = org.forgerock.openidm.router
    felix.fileinstall.filename = file:/openidm/samples/sample1/conf/router.json
    jsonconfig = {
    "filters" : [
        {
            "onRequest" : {
                "type" : "text/javascript",
                "file" : "bin/defaults/script/router-authz.js"
            }
        },
        {
            "onRequest" : {
                "type" : "text/javascript",
                "file" : "bin/defaults/script/policyFilter.js"
            },
            "methods" : [
                "create",
                "update"
            ]
        }
    ]
}
    openidm.restlet.path = /
    service.description = OpenIDM internal JSON resource router
    service.pid = org.forgerock.openidm.router
    service.vendor = ForgeRock AS
-&gt;</pre></div><div class="section" id="starting-in-debug-mode"><div class="titlepage"><div><div><h2 class="title" style="clear: both">2.6.&nbsp;Starting OpenIDM in Debug Mode</h2></div></div></div><p>To debug custom libraries, you can start OpenIDM with the option to
     use the Java Platform Debugger Architecture (JPDA).</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Start OpenIDM with the <code class="literal">jpda</code> option:</p><pre class="cmdline prettyprint">$ cd /path/to/openidm
$ ./startup.sh jpda
./startup.sh
Using OPENIDM_HOME:   /Users/lana/openidm
Using OPENIDM_OPTS:   -Xmx1024m -Djava.compiler=NONE -Xnoagent -Xdebug -Xrunjdwp:transport=dt_socket,address=5005,server=y,suspend=n
Using LOGGING_CONFIG: -Djava.util.logging.config.file=/Users/lana/openidm/conf/logging.properties
Listening for transport dt_socket at address: 5005
Using boot properties at /Users/lana/openidm/conf/boot/boot.properties
OpenIDM version "2.1.0-SNAPSHOT" (revision: 2144)
-&gt; OpenIDM ready</pre><p>The relevant JPDA options are outlined in the startup script
             (<code class="literal">startup.sh</code>).</p></li><li class="listitem"><p>In your IDE, attach a Java debugger to the JVM via socket,
             on port 5005.</p></li></ul></div><div class="panel panel-danger"><div class="panel-heading"><h3 class="panel-title">Caution</h3></div><div class="panel-body"><p>This interface is internal and subject to change. If you depend
         on this interface, contact ForgeRock support.</p></div></div></div></div><div lang="en" class="chapter" id="chap-cli"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;3.&nbsp;OpenIDM Command-Line Interface</h1></div></div></div><p>OpenIDM includes a basic command-line interface that provides a number 
 of utilities for managing the OpenIDM instance.</p><p>All of the utilities are subcommands of the <code class="literal">cli.sh</code> 
 (UNIX) or <code class="literal">cli.bat</code> (Windows) scripts. To use the utilities, 
 you can either run them as subcommands, or launch the <span class="command"><strong>cli</strong></span> 
 script first, and then run the utility. For example, to run the 
 <span class="command"><strong>encrypt</strong></span> utility on a UNIX system:</p><pre class="cmdline prettyprint">$ cd /path/to/openidm
$ ./cli.sh
Using boot properties at /openidm/conf/boot/boot.properties
openidm# encrypt ....
 </pre><p>or</p><pre class="cmdline prettyprint">$ cd /path/to/openidm
$ ./cli.sh encrypt ...
 </pre><p>By default, the command-line utilities run with the properties defined 
 in <code class="filename">/path/to/openidm/conf/boot/boot.properties</code>.</p><p>The startup and shutdown scripts are not discussed in this chapter. For 
 information about these scripts, see <a href="../integrators-guide/index.html#chap-services" class="link"><em class="citetitle">Starting and 
 Stopping OpenIDM</em></a>.</p><p>The following sections describe the subcommands and their use. Examples 
 assume that you are running the commands on a UNIX system. For Windows 
 systems, use <span class="command"><strong>cli.bat</strong></span> instead of <span class="command"><strong>cli.sh</strong></span>.
 </p><div class="section" id="cli-configexport"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.1.&nbsp;configexport</h2></div></div></div><p>The <span class="command"><strong>configexport</strong></span> subcommand exports all 
  configuration objects to a specified location, enabling you to reuse a 
  system configuration in another environment. For example, you can test a 
  configuration in a development environment, then export it and import it 
  into a production environment. This subcommand also enables you to inspect 
  the active configuration of an OpenIDM instance.</p><p>OpenIDM must be running when you execute this command.</p><p>Usage is as follows:</p><pre class="cmdline prettyprint">
$ ./cli.sh configexport /<em><strong>export-location</strong></em>
  </pre><p>For example:</p><pre class="cmdline prettyprint">$ ./cli.sh configexport /tmp/conf</pre><p>Configuration objects are exported, as <code class="filename">.json</code> files, 
  to the specified directory. Configuration files that are present in this 
  directory are renamed as backup files, with a timestamp, for example, 
  <code class="filename">audit.json.2012-12-19T12-00-28.bkp</code>, and are not 
  overwritten. The following configuration objects are exported:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The internal repository configuration (<code class="filename">repo.orientdb.json
      </code> or <code class="filename">repo.jdbc.json</code>)</p></li><li class="listitem"><p>The log configuration (<code class="filename">audit.json</code>)</p></li><li class="listitem"><p>The authentication configuration (<code class="filename">authentication.json
      </code>)</p></li><li class="listitem"><p>The managed object configuration (<code class="filename">managed.json</code>)
      </p></li><li class="listitem"><p>The connector configuration (<code class="filename">provisioner.openicf-*.json
      </code>)</p></li><li class="listitem"><p>The router service configuration (<code class="filename">router.json</code>)
      </p></li><li class="listitem"><p>The scheduler service configuration (<code class="filename">scheduler.json</code>)
      </p></li><li class="listitem"><p>Any configured schedules (<code class="filename">schedule-*.json</code>)
      </p></li><li class="listitem"><p>The synchronization mapping configuration (<code class="filename">sync.json
      </code>)</p></li><li class="listitem"><p>If workflows are defined, the configuration of the workflow engine 
      (<code class="filename">workflow.json</code>) and the workflow access 
      configuration (<code class="filename">process-access.json</code>)</p></li><li class="listitem"><p>Any configuration files related to the user interface 
     (<code class="filename">ui-*.json</code>)</p></li><li class="listitem"><p>The configuration of any custom endpoints 
      (<code class="filename">endpoint-*.json</code>)</p></li><li class="listitem"><p>The policy configuration (<code class="filename">policy.json</code>)</p></li></ul></div></div><div class="section" id="cli-configimport"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.2.&nbsp;configimport</h2></div></div></div><p>The <span class="command"><strong>configimport</strong></span> subcommand imports configuration 
  objects from the specified directory, enabling you to reuse a system 
  configuration from another environment. For example, you can test a 
  configuration in a development environment, then export it and import it 
  into a production environment.</p><p>The command updates the existing configuration from the 
  <em class="replaceable"><code>import-location</code></em> over the OpenIDM REST interface. 
  By default, if configuration objects are present in the 
  <em class="replaceable"><code>import-location</code></em> and not in the existing 
  configuration, these objects are added. If configuration objects are present 
  in the existing location but not in the 
  <em class="replaceable"><code>import-location</code></em>, these objects are left untouched 
  in the existing configuration.</p><p>If you include the <code class="literal">--replaceAll</code> parameter, the 
  command wipes out the existing configuration and replaces it with the 
  configuration in the <em class="replaceable"><code>import-location</code></em>. Objects in 
  the existing configuration that are not present in the 
  <em class="replaceable"><code>import-location</code></em> are deleted.</p><p>Usage is as follows:</p><pre class="cmdline prettyprint">
$ ./cli.sh configimport [--replaceAll] /<em><strong>import-location</strong></em>
  </pre><p>For example:</p><pre class="cmdline prettyprint">
$ ./cli.sh configimport --replaceAll /tmp/conf
  </pre><p>Configuration objects are imported, as <code class="literal">.json</code> files, 
  from the specified directory to the <code class="filename">conf</code> directory. The 
  configuration objects that are imported are outlined in the corresponding 
  export command, described in the previous section.</p></div><div class="section" id="cli-configureconnector"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.3.&nbsp;configureconnector</h2></div></div></div><p>The <span class="command"><strong>configureconnector</strong></span> subcommand generates a 
  configuration for an OpenICF connector.</p><p>Usage is as follows:</p><pre class="cmdline prettyprint">$ ./cli.sh configureconnector <em><strong>connector-name</strong></em>
  </pre><p>Select the type of connector that you want to configure. The following 
  example configures a new XML connector.
  </p><pre class="cmdline prettyprint">$ ./cli.sh configureconnector myXmlConnector
Using boot properties at /openidm/conf/boot/boot.properties
Dec 11, 2012 10:35:37 AM org.restlet.ext.httpclient.HttpClientHelper start
INFO: Starting the HTTP client
0. CSV File Connector version 
1. LDAP Connector version 
2. org.forgerock.openicf.connectors.scriptedsql.ScriptedSQLConnector version 
3. XML Connector version 
4. Exit
Select [0..4]: 3
Edit the configuration file and run the command again. The configuration was 
  saved to /openidm/temp/provisioner.openicf-myXmlConnector.json
  </pre><p>The basic configuration is saved in a file named 
  <code class="filename">/openidm/temp/provisioner.openicf-<em class="replaceable"><code>connector-name</code></em>.json</code>.
  Edit the <code class="literal">configurationProperties</code> parameter in this file to 
  complete the connector configuration. For an XML connector, you can use the 
  schema definitions in sample 0 for an example configuration.</p><pre class="codelisting prettyprint linenums lang-js">
  "configurationProperties" : {
    "xmlFilePath" : "samples/sample0/data/resource-schema-1.xsd",
    "createFileIfNotExists" : false,
    "xsdFilePath" : "samples/sample0/data/resource-schema-extension.xsd",
    "xsdIcfFilePath" : "samples/sample0/data/xmlConnectorData.xml"
  },  
  </pre><p>For more information about the connector configuration properties, see 
  <a href="../integrators-guide/index.html#openicf-provisioner-conf" class="link"><em class="citetitle">Configuring Connectors</em></a>.</p><p>When you have modified the file, run the 
  <span class="command"><strong>configureconnector</strong></span> command again so that OpenIDM can pick 
  up the new connector configuration.</p><pre class="cmdline prettyprint">$ ./cli.sh configureconnector myXmlConnector
Using boot properties at /openidm/conf/boot/boot.properties
Configuration was found and picked up from:
      /openidm/temp/provisioner.openicf-myXmlConnector.json
Dec 11, 2012 10:55:28 AM org.restlet.ext.httpclient.HttpClientHelper start
INFO: Starting the HTTP client
...
  </pre><p>You can also configure connectors over the REST interface. For more 
  information, see <a href="../integrators-guide/index.html#connector-wiz" class="link"><em class="citetitle">Creating Default Connector Configurations</em></a>.</p></div><div class="section" id="cli-encrypt"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.4.&nbsp;encrypt</h2></div></div></div><p>The <span class="command"><strong>encrypt</strong></span> subcommand encrypts an input string, or 
  JSON object, provided at the command line. This subcommand can be used to 
  encrypt passwords, or other sensitive data, to be stored in the OpenIDM 
  repository. The encrypted value is output to standard output and provides 
  details of the cryptography key that is used to encrypt the data.</p><p>Usage is as follows:</p><pre class="cmdline prettyprint">
$ ./cli.sh encrypt [-j] <em><strong>string</strong></em>
  </pre><p>The <code class="literal">-j</code> option specifies that the string to be 
  encrypted is a JSON object. If you do not enter the string as part of the 
  command, the command prompts for the string to be encrypted. If you enter 
  the string as part of the command, any special characters, for example 
  quotation marks, must be escaped.</p><p>The following example encrypts a normal string value:</p><pre class="cmdline prettyprint">
$ ./cli.sh encrypt mypassword
Using boot properties at /openidm/conf/boot/boot.properties
Oct 23, 2012 2:00:03 PM org.forgerock.openidm.crypto.impl.CryptoServiceImpl activate
INFO: Activating cryptography service of type: JCEKS provider:
      location: security/keystore.jceks
Oct 23, 2012 2:00:03 PM org.forgerock.openidm.crypto.impl.CryptoServiceImpl activate
INFO: Available cryptography key: openidm-sym-default
Oct 23, 2012 2:00:03 PM org.forgerock.openidm.crypto.impl.CryptoServiceImpl activate
INFO: Available cryptography key: openidm-localhost
Oct 23, 2012 2:00:03 PM org.forgerock.openidm.crypto.impl.CryptoServiceImpl activate
INFO: Available cryptography key: openidm-local-openidm-forgerock-org
Oct 23, 2012 2:00:03 PM org.forgerock.openidm.crypto.impl.CryptoServiceImpl activate
INFO: CryptoService is initialized with 3 keys.
-----BEGIN ENCRYPTED VALUE-----
{
  "$crypto" : {
    "value" : {
      "iv" : "M2913T5ZADlC2ip2imeOyg==",
      "data" : "DZAAAM1nKjQM1qpLwh3BgA==",
      "cipher" : "AES/CBC/PKCS5Padding",
      "key" : "openidm-sym-default"
    },
    "type" : "x-simple-encryption"
  }
}
------END ENCRYPTED VALUE------
  </pre><p>The following example encrypts a JSON object. The input string must be 
  a valid JSON object.</p><pre class="cmdline prettyprint">
$ ./cli.sh encrypt -j {\"password\":\"myPassw0rd\"}
Using boot properties at /openidm/conf/boot/boot.properties
Oct 23, 2012 2:00:03 PM org.forgerock.openidm.crypto.impl.CryptoServiceImpl activate
INFO: Activating cryptography service of type: JCEKS provider:
      location: security/keystore.jceks
Oct 23, 2012 2:00:03 PM org.forgerock.openidm.crypto.impl.CryptoServiceImpl activate
INFO: Available cryptography key: openidm-sym-default
Oct 23, 2012 2:00:03 PM org.forgerock.openidm.crypto.impl.CryptoServiceImpl activate
INFO: Available cryptography key: openidm-localhost
Oct 23, 2012 2:00:03 PM org.forgerock.openidm.crypto.impl.CryptoServiceImpl activate
INFO: Available cryptography key: openidm-local-openidm-forgerock-org
Oct 23, 2012 2:00:03 PM org.forgerock.openidm.crypto.impl.CryptoServiceImpl activate
INFO: CryptoService is initialized with 3 keys.
-----BEGIN ENCRYPTED VALUE-----
{
  "$crypto" : {
    "value" : {
      "iv" : "M2913T5ZADlC2ip2imeOyg==",
      "data" : "DZAAAM1nKjQM1qpLwh3BgA==",
      "cipher" : "AES/CBC/PKCS5Padding",
      "key" : "openidm-sym-default"
    },
    "type" : "x-simple-encryption"
  }
}
------END ENCRYPTED VALUE------
  </pre><p>The following example prompts for a JSON object to be encrypted. In 
  this case, you need not escape the special characters.</p><pre class="cmdline prettyprint">
$ ./cli.sh encrypt -j 
Using boot properties at /openidm/conf/boot/boot.properties
Enter the Json value

&gt; Press ctrl-D to finish input
Start data input:
{"password":"myPassw0rd"}
^D
Oct 23, 2012 2:37:56 PM org.forgerock.openidm.crypto.impl.CryptoServiceImpl activate
INFO: Activating cryptography service of type: JCEKS provider:
      location: security/keystore.jceks
Oct 23, 2012 2:37:56 PM org.forgerock.openidm.crypto.impl.CryptoServiceImpl activate
INFO: Available cryptography key: openidm-sym-default
Oct 23, 2012 2:37:56 PM org.forgerock.openidm.crypto.impl.CryptoServiceImpl activate
INFO: Available cryptography key: openidm-localhost
Oct 23, 2012 2:37:56 PM org.forgerock.openidm.crypto.impl.CryptoServiceImpl activate
INFO: Available cryptography key: openidm-local-openidm-forgerock-org
Oct 23, 2012 2:37:56 PM org.forgerock.openidm.crypto.impl.CryptoServiceImpl activate
INFO: CryptoService is initialized with 3 keys.
-----BEGIN ENCRYPTED VALUE-----
{
  "$crypto" : {
    "value" : {
      "iv" : "6e0RK8/4F1EK5FzSZHwNYQ==",
      "data" : "gwHSdDTmzmUXeD6Gtfn6JFC8cAUiksiAGfvzTsdnAqQ=",
      "cipher" : "AES/CBC/PKCS5Padding",
      "key" : "openidm-sym-default"
    },
    "type" : "x-simple-encryption"
  }
}
------END ENCRYPTED VALUE------
  </pre></div><div class="section" id="cli-keytool"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.5.&nbsp;keytool</h2></div></div></div><a class="indexterm" name="d0e1433"></a><p>The <span class="command"><strong>keytool</strong></span> subcommand exports or imports 
   private key values.</p><p>The Java <span class="command"><strong>keytool</strong></span> command enables you to export and 
   import public keys and certificates, but not private keys. The OpenIDM 
   <span class="command"><strong>keytool</strong></span> subcommand provides this functionality.</p><p>Usage is as follows:</p><pre class="cmdline prettyprint">./cli.sh keytool [--export, --import] <em><strong>alias</strong></em>
  </pre><p>For example, to export the default OpenIDM symmetric key, run the 
  following command:</p><pre class="cmdline prettyprint">$ ./cli.sh keytool --export openidm-sym-default
Using boot properties at /openidm/conf/boot/boot.properties
Use KeyStore from: /openidm/security/keystore.jceks
Please enter the password: 
[OK] Secret key entry with algorithm AES
AES:606d80ae316be58e94439f91ad8ce1c0
  </pre><p>The default keystore password is <code class="literal">changeit</code>. You 
  should change this password after installation.</p><p>To import a new secret key named <em class="replaceable"><code>my-new-key</code></em>, 
  run the following command:</p><pre class="cmdline prettyprint">$ ./cli.sh keytool --import my-new-key
Using boot properties at /openidm/conf/boot/boot.properties
Use KeyStore from: /openidm/security/keystore.jceks
Please enter the password: 
Enter the key: 
AES:606d80ae316be58e94439f91ad8ce1c0
  </pre><p>If a secret key of that name already exists, OpenIDM returns the 
  following error:</p><pre class="cmdline prettyprint">"KeyStore contains a key with this alias"</pre></div><div class="section" id="cli-validate"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.6.&nbsp;validate</h2></div></div></div><a class="indexterm" name="d0e1479"></a><p>The <span class="command"><strong>validate</strong></span> subcommand validates all .json 
  configuration files in the <code class="filename">openidm/conf/</code> directory.</p><p>Usage is as follows:</p><pre class="cmdline prettyprint">
$ ./cli.sh validate
Using boot properties at /openidm/conf/boot/boot.properties
...................................................................
[Validating] Load JSON configuration files from:
[Validating] 	/openidm/conf
[Validating] audit.json .................................. SUCCESS
[Validating] authentication.json ......................... SUCCESS
[Validating] endpoint-getavailableuserstoassign.json ..... SUCCESS
[Validating] endpoint-getprocessesforuser.json ........... SUCCESS
[Validating] endpoint-gettasksview.json .................. SUCCESS
[Validating] endpoint-securityQA.json .................... SUCCESS
[Validating] endpoint-siteIdentification.json ............ SUCCESS
[Validating] endpoint-usernotifications.json ............. SUCCESS
[Validating] managed.json ................................ SUCCESS
[Validating] policy.json ................................. SUCCESS
[Validating] process-access.json ......................... SUCCESS
[Validating] provisioner.openicf-ldap.json ............... SUCCESS
[Validating] provisioner.openicf-xml.json ................ SUCCESS
[Validating] repo.orientdb.json .......................... SUCCESS
[Validating] router.json ................................. SUCCESS
[Validating] schedule-recon.json ......................... SUCCESS
[Validating] schedule-reconcile_systemXmlAccounts_managedUser.json  SUCCESS
[Validating] scheduler.json .............................. SUCCESS
[Validating] sync.json ................................... SUCCESS
[Validating] ui-configuration.json ....................... SUCCESS
[Validating] ui-countries.json ........................... SUCCESS
[Validating] ui-secquestions.json ........................ SUCCESS
[Validating] workflow.json ............................... SUCCESS
  </pre></div></div><div lang="en" class="chapter" id="chap-ui"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;4.&nbsp;OpenIDM User Interface</h1></div></div></div><p>OpenIDM provides a customizable, browser-based user interface. The 
 default user interface enables administrative users to create, modify and 
 delete user accounts. It provides role-based access to tasks based on BPMN2 
 workflows, and allows users to manage certain aspects of their own accounts, 
 including configurable self-service registration.</p><div class="section" id="ui-overview"><div class="titlepage"><div><div><h2 class="title" style="clear: both">4.1.&nbsp;Overview of the Default User Interface</h2></div></div></div><p>The default user interface is provided as a reference implementation 
  that demonstrates the capabilities of the REST API. You can modify certain 
  aspects of the default user interface according to the requirements of your 
  deployment. Note, however, that the default user interface is still evolving 
  and is not guaranteed to be compatible with the next OpenIDM release.</p><p>To access the user interface, install and start OpenIDM, then point 
  your browser to <a class="link" href="http://localhost:8080/openidmui" target="_top">http://localhost:8080/openidmui</a>.</p><p>Log in as the default administrative user (Login: openidm-admin, 
  Password: openidm-admin) or as an existing user in the repository. The 
  display differs, depending on the role of the user that has logged in.</p><p>For an administrative user (role <code class="literal">openidm-admin</code>), 
  two tabs are displayed - Dashboard and Users. The Dashboard tab lists any 
  tasks assigned to the user, processes available to be invoked, and any 
  notifications for that user. The Users tab provides an interface to manage 
  user entries (OpenIDM managed objects under <code class="literal">managed/user</code>).</p><div class="mediaobject" align="center"><a class="fancybox" href="images/ui-admin-view.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_ui-admin-view.png" align="middle" alt="OpenIDM UI Administrator View"></a></div><p>The <code class="literal">Profile</code> link enables the user to modify elements 
  of his user data. The <code class="literal">Change Security Data</code> link enables 
  the user to change his password and, optionally, to select a new security 
  question.</p><p>For a regular user (role <code class="literal">openidm-authorized</code>), the 
  Users tab is not displayed - so regular users cannot manage user accounts, 
  except for certain aspects of their own accounts.</p></div><div class="section" id="ui-configuring"><div class="titlepage"><div><div><h2 class="title" style="clear: both">4.2.&nbsp;Configuring the Default User Interface</h2></div></div></div><p>The following sections outline the configurable aspects of the default 
  user interface.</p><div class="section" id="ui-self-registration"><div class="titlepage"><div><div><h3 class="title">4.2.1.&nbsp;Enabling Self-Registration</h3></div></div></div><p>Self-registration (the ability for new users to create their own 
    accounts) is disabled by default. To enable self-registration, set 
    <code class="literal">"selfRegistration"</code> to <code class="literal">true</code> in 
    the <code class="filename">conf/ui-configuration.json</code> file.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "configuration" : {
        "selfRegistration" : true,
...    
    </pre><p>With <code class="literal">"selfRegistration" : true</code>, the following 
    capabilities are provided on the right-hand pane of the user interface:
    </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Register my account</td></tr><tr><td>Reset my password</td></tr></table><p>User objects created using self-registration automatically have the 
    role <code class="literal">openidm-authorized</code>.</p></div><div class="section" id="ui-security-questions"><div class="titlepage"><div><div><h3 class="title">4.2.2.&nbsp;Configuring Security Questions</h3></div></div></div><p>Security questions are disabled by default. To guard against 
    unauthorized access, you can specify that users be prompted with security 
    questions if they request a password reset. A default set of questions is 
    provided, but you can add to these, or overwrite them. 
    To enable security questions, set <code class="literal">"securityQuestions"</code> 
    to <code class="literal">true</code> in the 
    <code class="filename">conf/ui-configuration.json</code> file.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "configuration" : {
        "securityQuestions" : true,
...    
    </pre><p>Specify the list of questions to be asked in the 
    <code class="filename">conf/ui-secquestions.json</code> file.</p><p>Refresh your browser after this configuration change for the change 
    to be picked up by the UI.</p></div><div class="section" id="ui-site-identification"><div class="titlepage"><div><div><h3 class="title">4.2.3.&nbsp;Enabling Site Identification</h3></div></div></div><p>To ensure that users are entering their details onto the correct 
    site, you can enable site identification. Site identification provides a 
    preventative measure against phishing.
    </p><p>With site identification enabled, users are presented with a range of 
    images from which they can select. To enable site identification, set 
    <code class="literal">"siteIdentification"</code> to <code class="literal">true</code> 
    in the <code class="filename">conf/ui-configuration.json</code> file.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "configuration" : {
        "siteIdentification" : true,
...    
    </pre><p>Refresh your browser after this configuration change for the change 
    to be picked up by the UI.</p><p>A default list of four images is presented for site identification.
    The images are defined in the <code class="literal">siteImages</code> property in the
    <code class="filename">conf/ui-configuration.json</code> file:</p><pre class="codelisting prettyprint linenums lang-js">
"siteImages" : [
"images/passphrase/mail.png",
"images/passphrase/user.png",
"images/passphrase/report.png",
"images/passphrase/twitter.png"
],
...    
    </pre><p>
    The user selects one of these images, which is displayed on login. In 
    addition, the user enters a Site Phrase, which is displayed beneath the 
    site image on login. If either the site image, or site phrase is incorrect 
    or absent when the user logs in, the user is aware that he is not logging 
    in to the correct site.</p><p>You can change the default images, and include additional images, by
    placing image files in the <code class="filename">ui/extension/images</code> folder
    and modifying the <code class="literal">siteImages</code> property in the
    <code class="filename">ui-configuration.json</code> file to point to the new images.
    The following example assumes a file named <code class="filename">my-new-image.jpg</code>,
    located in <code class="filename">ui/extension/images</code>.
    </p><pre class="codelisting prettyprint linenums lang-js">
"siteImages" : [
"images/passphrase/mail.png",
"images/passphrase/user.png",
"images/passphrase/report.png",
"images/passphrase/twitter.png",
"images/my-new-image.jpg"
],
...
      </pre><p>Note that the default image files are located in
      <code class="filename">ui/default/admin/public/images/passphrase</code>.</p></div><div class="section" id="ui-country-list"><div class="titlepage"><div><div><h3 class="title">4.2.4.&nbsp;Configuring the Country List</h3></div></div></div><p>The default user profile includes the ability to specify the user's 
    country and state or province. To specify the countries that appear in 
    this drop down list, and their associated states or provinces, edit the 
    <code class="filename">conf/ui-countries.json</code> file. For example, to add 
    Norway to the list of countries, you would add the following to the 
    <code class="filename">conf/ui-countries.json</code> file:</p><pre class="codelisting prettyprint linenums lang-js">
        {
            "key" : "norway",
            "value" : "Norway",
            "states" : [
                {
                    "key" : "akershus",
                    "value" : "Akershus"
                },
                {
                    "key" : "aust-agder",
                    "value" : "Aust-Agder"
                },
                {
                    "key" : "buskerud",
                    "value" : "Buskerud"
                },
...
    </pre><p>Refresh your browser after this configuration change for the change 
    to be picked up by the UI.</p></div></div><div class="section" id="ui-managing-users"><div class="titlepage"><div><div><h2 class="title" style="clear: both">4.3.&nbsp;Managing User Accounts With the User Interface</h2></div></div></div><p>Only administrative users (with the role <code class="literal">openidm-admin</code>) 
 can add, modify, and delete user accounts. Regular users can modify certain 
 aspects of their own accounts.</p><div class="procedure" id="d0e1677"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;4.1.&nbsp;To Add a User Account</div><ol class="procedure" type="1"><li class="step"><p>Log into the user interface as an administrative user.</p></li><li class="step"><p>Select the Users tab.</p></li><li class="step"><p>Click Add User.</p></li><li class="step"><p>Complete the fields on the Create new account page.</p><p>Most of these fields are self-explanatory. Be aware that the user 
     interface is subject to policy validation, as described in <a href="../integrators-guide/index.html#chap-policies" class="link">
     <em class="citetitle">Using Policies to Validate Data</em></a>. So, for 
     example, the Email address must be of valid email address format, and 
     the Password must comply with the password validation settings that are 
     indicated in the panel to the right.</p><p>The Admin Role field reflects the roles that are defined in the 
     <code class="filename">ui-configuration.json</code> file. The roles are mapped as 
     follows:</p><pre class="codelisting prettyprint linenums lang-js">
"roles" : {
    "openidm-admin" : "Administrator",
    "openidm-authorized" : "User",
    "tasks-manager" : "Tasks Manager"
},     
     </pre><p>By default, a user can be assigned more than one role. Only users 
     with the <code class="literal">tasks-manager</code> role can assign tasks to any 
     candidate user for that task.</p></li></ol></div></div><div class="procedure" id="ui-update-account"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;4.2.&nbsp;To Update a User Account</div><ol class="procedure" type="1"><li class="step"><p>Log into the user interface as an administrative user.</p></li><li class="step"><p>Select the Users tab.</p></li><li class="step"><p>Click the Username of the user that you want to update.</p></li><li class="step"><p>On the user's profile page, modify the fields you want to change 
     and click Update.</p><p>The user account is updated in the internal repository.</p></li></ol></div></div><div class="procedure" id="d0e1729"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;4.3.&nbsp;To Reset a User's Password</div><p>Users can change their own passwords by following the Change Security 
   Data link in their profiles. This process requires that users know their 
   existing passwords.</p><p>In a situation where a user forgets his password, an administrator 
   can reset the password of that user without knowing the user's existing 
   password.</p><ol class="procedure" type="1"><li class="step"><p>Follow steps 1-3 in <a class="xref" href="#ui-update-account" title="Procedure&nbsp;4.2.&nbsp;To Update a User Account">Procedure&nbsp;4.2, &#8220;To Update a User Account&#8221;</a>.</p></li><li class="step"><p>On the user's profile page, click Change password.</p></li><li class="step"><p>Enter a new password that conforms to the password policy and click 
     Update.</p><p>The user password is updated in the repository.</p></li></ol></div></div><div class="procedure" id="d0e1749"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;4.4.&nbsp;To Delete a User Account</div><ol class="procedure" type="1"><li class="step"><p>Log into the user interface as an administrative user.</p></li><li class="step"><p>Select the Users tab.</p></li><li class="step"><p>Click the Username of the user that you want to delete.</p></li><li class="step"><p>On the user's profile page, click Delete.</p></li><li class="step"><p>Click OK to confirm the deletion.</p><p>The user is deleted from the internal repository.</p></li></ol></div></div></div><div class="section" id="ui-managing-workflows"><div class="titlepage"><div><div><h2 class="title" style="clear: both">4.4.&nbsp;Managing Workflows From the User Interface</h2></div></div></div><p>The user interface is integrated with the embedded Activiti worfklow 
  engine, enabling users to interact with workflows. Available workflows are 
  displayed under the Processes item on the Dashboard. In order for a workflow 
  to be displayed here, the workflow definition file must be present in the 
  <code class="filename">openidm/workflow</code> directory.</p><p>A sample workflow integration with the user interface is provided in 
  <code class="filename">openidm/samples/workflow</code>, and documented in <a href="../integrators-guide/index.html#example-provisioning-workflow" class="link"><em class="citetitle">Sample Workflow - 
  Provisioning User Accounts</em></a>. Follow the steps in that 
  sample for an understanding of how the workflow integration works.</p><p>Access to workflows is based on OpenIDM roles, and is configured in 
  the file <code class="filename">conf/process-access.json</code>. By default all users 
  with the role <code class="literal">openidm-authorized</code> or 
  <code class="literal">openidm-admin</code> can invoke any available workflow. The 
  default <code class="filename">process-access.json</code> file is as follows:</p><pre class="codelisting prettyprint linenums lang-js">
{
    "workflowAccess" : [
        {
            "propertiesCheck" : {
                "property" : "_id",
                "matches" : ".*",
                "requiresRole" : "openidm-authorized"
            }
        },
        {
            "propertiesCheck" : {
                "property" : "_id",
                "matches" : ".*",
                "requiresRole" : "openidm-admin"
            }
        }
    ]
}  
  </pre></div><div class="section" id="ui-customizing"><div class="titlepage"><div><div><h2 class="title" style="clear: both">4.5.&nbsp;Changing the UI Theme</h2></div></div></div><p>You can customize the theme of the default user interface to apply your 
  own branding. Note that at this stage, the default user interface is still 
  evolving. Customizations that you make to the <span class="emphasis"><em>functionality</em></span> 
  of the UI, are therefore not guaranteed to work in the next OpenIDM release.</p><p>By default the user interface reads the stylesheets and images from the
  <code class="filename">openidm/ui/default</code> directory. Modifications to the
  default theme should be made in the <code class="filename">openidm/ui/extension</code>
  directory. If you modify the files in the default directory, there is no
  guarantee that your changes will not be overwritten in the next OpenIDM
  release. The UI searches the <code class="literal">extension</code> directory first
  and applies any styles or images located in this directory.
  </p><div class="section" id="ui-style"><div class="titlepage"><div><div><h3 class="title">4.5.1.&nbsp;Changing the Default Stylesheet</h3></div></div></div><p>The default stylesheets are located in the
          <code class="filename">openidm/ui/default/admin/public/css</code> directory.
          To customize the stylesheets, copy them to
          <code class="filename">openidm/ui/extension/css</code>, and edit them according
          to your requirements.</p><p>The following example changes the background color of the input
          forms to green.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Copy the default stylesheets to <code class="filename">openidm/ui/extension/css</code>:</p><pre class="cmdline prettyprint">$ cd /path/to/openidm/ui/default/admin/public/
$ cp -r css ../../../extension/</pre></li><li class="listitem"><p>Edit the <code class="filename">openidm/ui/extension/css/user/config.less</code>
              file as follows:</p><pre class="cmdline prettyprint">@content-background: #99CC66;</pre></li><li class="listitem"><p>Refresh your browser window for the change to appear.</p></li></ol></div></div><div class="section" id="ui-logo"><div class="titlepage"><div><div><h3 class="title">4.5.2.&nbsp;Changing the Default Logo</h3></div></div></div><p>The default logo is located in the
            <code class="filename">openidm/ui/default/admin/public/images</code> directory.
            To customize the logo:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Add your own logo image file, named <code class="filename">logo.png</code>,
                to the directory <code class="filename">openidm/ui/extension/images</code>.
                </p></li><li class="listitem"><p>Refresh your browser window for the new logo to appear.</p></li></ol></div></div><div class="section" id="ui-locale"><div class="titlepage"><div><div><h3 class="title">4.5.3.&nbsp;Changing the Language of the UI</h3></div></div></div><p>Currently, the UI is provided only in US English. You can
        translate the UI and specify that your own locale is used. The
        following example shows how to translate the UI into French.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Copy the default locale to <code class="filename">openidm/ui/extension/locales</code>:</p><pre class="cmdline prettyprint">$ cd /path/to/openidm/ui/default/admin/public/
$ cp -r locales ../../../extension/</pre><p>The <code class="filename">extension/locales</code> folder now
                contains one locale, <code class="literal">en-US</code>.</p></li><li class="listitem"><p>Create a copy of the <code class="literal">en-US</code> locale, in
                a new folder named <code class="literal">fr-FR</code>.</p><pre class="cmdline prettyprint">$ cd /path/to/openidm/ui/extension/locales
$ cp -r en-US fr-FR </pre></li><li class="listitem"><p>Translate the values of the properties in the
                <code class="filename">fr-FR/translate.json</code> file. Do not translate
                the property names. For example:</p><pre class="cmdline prettyprint">...
"user" : {
    "user" : "Utilisateur"
    "login" : "Login",
    "profile" : "Profil",
....</pre></li><li class="listitem"><p>Change the UI configuration to use the new locale by
                setting the value of the <code class="literal">language</code> property
                in the <code class="filename">openidm/conf/ui-configuration.json</code>
                file, as follows:</p><pre class="cmdline prettyprint">"language" : "fr-FR",
                </pre></li><li class="listitem"><p>Refresh your browser window for the modification to be
                applied.</p></li></ol></div></div><div class="section" id="ui-project-config"><div class="titlepage"><div><div><h3 class="title">4.5.4.&nbsp;Creating a Project-Specific UI Theme</h3></div></div></div><p>You can create specific UI themes for different projects and
        then point a particular UI instance to use a defined theme on startup.
        To create a complete custom theme, follow these steps:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Shut down the OpenIDM instance, if it is running. In the
                Felix administration console, type:</p><pre class="cmdline prettyprint">shutdown
-&gt;</pre></li><li class="listitem"><p>Clear the <code class="literal">felix-cache</code> directory.</p><pre class="cmdline prettyprint">$ rm -rf felix-cache</pre></li><li class="listitem"><p>Copy the entire default UI theme to an accessible
                location. For example:</p><pre class="cmdline prettyprint">$ cd /path/to/openidm/ui
$ cp -r default ../new-project-theme</pre></li><li class="listitem"><p>In the copied theme, modify the required elements, as
                described in the previous sections. Note that nothing is copied
                to the extension folder in this case - changes are made in the
                copied theme.</p></li><li class="listitem"><p>In the <code class="literal">openidm/conf/boot/boot.properties</code>
                file, add the following line, specifying the location of the new
                theme. The path is relative to the installation root of the
                OpenIDM instance.</p><pre class="cmdline prettyprint">openidm.ui.fileinstall.dir=new-project-theme</pre></li><li class="listitem"><p>Restart OpenIDM.</p><pre class="cmdline prettyprint">$ cd /path/to/openidm
$ ./startup.sh</pre></li><li class="listitem"><p>Relaunch the UI in your browser. The UI is displayed with
                the new custom theme.</p></li></ol></div></div></div><div class="section" id="ui-external-password-reset"><div class="titlepage"><div><div><h2 class="title" style="clear: both">4.6.&nbsp;Using an External System for Password Reset</h2></div></div></div><p>By default, the password reset mechanism is handled
    internally, in OpenIDM. You can reroute password reset in the event that
    a user has forgotten his password, by specifying an external URL to which
    password reset requests are sent. Note that this URL applies to the
    password reset link on the login page only, not to the security data change
    facility that is available after a user has logged in.</p><p>To set an external URL to handle password reset, set the
    <code class="literal">passwordResetLink</code> parameter in the
    <code class="filename">conf/ui-configuration.json</code> file. The following example
    sets the <code class="literal">passwordResetLink</code> to
    <code class="literal">https://accounts.example.com/account/reset-password</code>.</p><pre class="cmdline prettyprint">passwordResetLink: "https://accounts.example.com/reset-password"</pre><p>The <code class="literal">passwordResetLink</code> parameter takes either an
    empty string as a value (which indicates that no external link is used) or
    a full URL to the external system that handles password reset requests.</p><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>External password reset and security questions for internal
    password reset are mutually exclusive. Therefore, if you set a value for the
    <code class="literal">passwordResetLink</code> parameter, users will not be prompted
    with any security questions, regardless of the setting of the
    <code class="literal">securityQuestions</code> parameter.</p></div></div></div><div class="section" id="ui-external-logout"><div class="titlepage"><div><div><h2 class="title" style="clear: both">4.7.&nbsp;Providing a Logout URL to External Applications</h2></div></div></div><p>By default, a UI session is invalidated when a user clicks on the
    Log out link. In certain situations your external applications might
    require a distinct logout URL to which users can be routed, to terminate
    their UI session.</p><p>The logout URL is <code class="literal">#logout</code>, appended to the UI URL,
    for example, <code class="literal">http://localhost:8080/openidmui/index.html#logout/</code>.
    </p><p>The logout URL effectively performs the same action as clicking on
    the Log out link of the UI.</p></div><div class="section" id="ui-path"><div class="titlepage"><div><div><h2 class="title" style="clear: both">4.8.&nbsp;Changing the UI Path</h2></div></div></div><p>By default, the UI is registered at a specific URL
        (<code class="literal"><em class="replaceable"><code>base-context</code></em>/openidmui</code>).
        To override the default URL and specify your own path, edit the
        <code class="filename">openidm/conf/ui.context-enduser.json</code>
        file, setting the <code class="literal">urlContextRoot</code> property to the
        new URL. For example, to change the path to
        <code class="literal"><em class="replaceable"><code>base-context</code></em>/exampleui</code>,
        edit the file as follows:</p><pre class="cmdline prettyprint">"urlContextRoot" : "/exampleui",</pre></div><div class="section" id="ui-disabling"><div class="titlepage"><div><div><h2 class="title" style="clear: both">4.9.&nbsp;Disabling the UI</h2></div></div></div><p>The UI is packaged as a separate bundle that can be disabled
        in the configuration before server startup. To disable the registration
        of the UI servlet, edit the <code class="filename">openidm/conf/ui.context-enduser.json</code>
        file, setting the <code class="literal">enabled</code> property to false:</p><pre class="cmdline prettyprint">"enabled" : false,</pre></div></div><div lang="en" class="chapter" id="chap-configuration"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;5.&nbsp;Configuring OpenIDM</h1></div></div></div><p>OpenIDM configuration is split between <code class="filename">.properties</code> and container
 configuration files, and also dynamic configuration objects. The majority
 of OpenIDM configuration files are stored under
 <code class="filename">openidm/conf/</code>, as described in the appendix listing the
 <a href="../integrators-guide/index.html#appendix-file-layout" class="link"><em class="citetitle">File
 Layout</em></a>.</p><p>OpenIDM stores configuration objects in its internal repository.
 You can manage the configuration by using either the REST access to the
 configuration objects, or by using the JSON file based views.</p><div class="section" id="configuration-objects"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5.1.&nbsp;OpenIDM Configuration Objects</h2></div></div></div><a class="indexterm" name="d0e2080"></a><a class="indexterm" name="d0e2085"></a><p>OpenIDM exposes internal configuration objects in JSON format.
      Configuration elements can be either single instance or multiple
      instance for an OpenIDM installation.</p><div class="itemizedlist" id="single-instance-configuration-objects"><div class="itemizedlist-title">Single Instance Configuration Objects</div><p>Single instance configuration objects correspond to services that have
   at most one instance per installation.</p><p>JSON file views of these configuration objects are named
   <code class="filename"><em class="replaceable"><code>object-name</code></em>.json</code>.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <code class="literal">audit</code> configuration specifies how audit
    events are logged.</p></li><li class="listitem"><p>The <code class="literal">authentication</code> configuration controls
    REST access.</p></li><li class="listitem"><p>The <code class="literal">endpoint</code> configuration controls any custom
    REST endpoints.</p></li><li class="listitem"><p>The <code class="literal">managed</code> configuration defines managed
          objects and their schemas.</p></li><li class="listitem"><p>The <code class="literal">policy</code> configuration defines the policy
      validation service.</p></li><li class="listitem"><p>The <code class="literal">process access</code> configuration defines access
      to any configured workflows.</p></li><li class="listitem"><p>The <code class="literal">repo.<em class="replaceable"><code>repo-type</code></em></code>
    configuration such as <code class="literal">repo.orientdb</code> or
    <code class="literal">repo.jdbc</code> configures the internal repository.</p></li><li class="listitem"><p>The <code class="literal">router</code> configuration specifies filters to
    apply for specific operations.</p></li><li class="listitem"><p>The <code class="literal">sync</code> configuration defines the mappings that
    OpenIDM uses when synchronizing and reconciling managed objects.</p></li><li class="listitem"><p>The <code class="literal">ui</code> configuration defines the configurable
       aspects of the default user interface.</p></li><li class="listitem"><p>The <code class="literal">workflow</code> configuration defines the
       configuration of the workflow engine.</p></li></ul></div><div class="itemizedlist" id="multiple-instance-configuration-objects"><div class="itemizedlist-title">Multiple Instance Configuration Objects</div><p>Multiple instance configuration objects correspond to services that
   can have many instances per installation. Configuration objects are named
   <code class="literal"><em class="replaceable"><code>objectname</code></em>/<em class="replaceable"><code>instancename</code></em></code>,
   for example, <code class="filename">provisioner.openicf/xml</code>.</p><p><span class="emphasis"><em>JSON file</em></span> views of these configuration objects 
   are named <code class="filename"><em class="replaceable"><code>objectname</code></em>-<em class="replaceable"><code>instancename</code></em>.json</code>, for example,
   <code class="filename">provisioner.openicf-xml.json.</code></p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Multiple <code class="literal">schedule</code> configurations can run
    reconciliations and other tasks on different schedules.</p></li><li class="listitem"><p>Multiple <code class="literal">provisioner.openicf</code> configurations
    correspond to the resources connected to OpenIDM.</p></li></ul></div></div><div class="section" id="changing-configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5.2.&nbsp;Changing the Default Configuration</h2></div></div></div><div class="itemizedlist"><p>When you change OpenIDM's configuration objects, take the following
         points into account.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>OpenIDM's authoritative configuration source is the internal
             repository. JSON files provide a view of the configuration objects,
             but do not represent the authoritative source.</p><p>OpenIDM updates JSON files after making configuration changes,
             whether those changes are made through REST access to configuration
             objects, or through edits to the JSON files.</p></li><li class="listitem"><p>OpenIDM recognizes changes to JSON files when it is running. OpenIDM
             <span class="emphasis"><em>must</em></span> be running when you delete configuration
             objects, even if you do so by editing the JSON files.</p></li><li class="listitem"><p>Avoid editing configuration objects directly in the internal
               repository. Rather edit the configuration over the REST API, or
               in the configuration JSON files to ensure consistent behavior
               and that operations are logged.</p></li><li class="listitem"><p>OpenIDM stores its configuration in the internal database by
               default. If you remove an OpenIDM instance and do not specifically
               drop the repository, the configuration remains in effect for a
               new OpenIDM instance that uses that repository. For testing or
               evaluation purposes, you can disable this <span class="emphasis"><em>persistent
               configuration</em></span> in the <code class="filename">conf/system.properties</code>
               file by uncommenting the following line:</p><pre class="codelisting prettyprint">
# openidm.config.repo.enabled=false
             </pre><p>Disabling persistent configuration means that OpenIDM will
                 store its configuration in memory only. You should not disable
                 persistent configuration in a production environment.</p></li></ul></div></div><div class="section" id="configuring-for-production"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5.3.&nbsp;Configuring an OpenIDM System for Production</h2></div></div></div><p>Out of the box, OpenIDM is configured to make it easy to install and
            evaluate. Specific configuration changes are required before you deploy
            OpenIDM in a production environment.</p><div class="section" id="configuring-production-repo"><div class="titlepage"><div><div><h3 class="title">5.3.1.&nbsp;Configuring a Production Repository</h3></div></div></div><p>By default, OpenIDM uses OrientDB for its internal repository
                so that you do not have to install a database in order to evaluate
                OpenIDM. Before you use OpenIDM in production, you must replace
                OrientDB with a supported repository.</p><p>For more information, see <a href="../install-guide/index.html#chap-repository" class="link"><em class="citetitle">Installing a Repository for Production</em></a> in
                the <em class="citetitle">Installation Guide</em>.</p></div><div class="section" id="disabling-auto-config-updates"><div class="titlepage"><div><div><h3 class="title">5.3.2.&nbsp;Disabling Automatic Configuration Updates</h3></div></div></div><p>By default, OpenIDM polls the JSON files in the
                <code class="literal">conf</code> directory periodically for any changes to
                the configuration. In a production system, it is recommended that
                you disable automatic polling for updates to prevent untested
                configuration changes from disrupting your identity service.</p><p>To disable automatic polling for configuration changes, edit the
                <code class="filename">conf/system.properties</code> file by uncommenting the
                following line:</p><pre class="codelisting prettyprint"># openidm.fileinstall.enabled=false</pre><p>Before you disable automatic polling, you must have started the
                OpenIDM instance at least once to ensure that the configuration has
                been loaded into the database.
            </p><p>Note that scripts are loaded each time the configuration calls the
                script. Modifications to scripts are therefore not applied
                dynamically. If you modify a script, you must either modify the
                configuration that calls the script, or restart the component that
                uses the modified script. You do not need to restart OpenIDM for
                script modifications to take effect.
            </p></div><div class="section" id="disabling-file-based-config"><div class="titlepage"><div><div><h3 class="title">5.3.3.&nbsp;Disabling the File-Based Configuration View</h3></div></div></div><p>To control configuration changes to the OpenIDM system, you
            disable the file-based configuration view and have OpenIDM read its
            configuration only from the repository. To disable the file-based
            configuration view, edit the <code class="filename">conf/system.properties</code>
            file to uncomment the following line:
            <code class="literal"># openidm.fileinstall.enabled=false</code>. </p></div></div><div class="section" id="configuring-over-rest"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5.4.&nbsp;Configuring OpenIDM Over REST</h2></div></div></div><a class="indexterm" name="d0e2305"></a><a class="indexterm" name="d0e2308"></a><p>OpenIDM exposes configuration objects under the
  <code class="literal">/openidm/config</code> context.</p><a class="indexterm" name="d0e2318"></a><p>You can list the configuration on the local host by performing a GET
  <code class="literal">http://localhost:8080/openidm/config</code>. The following
  example shows the default configuration for an OpenIDM instance started
  with Sample 1.</p><pre class="cmdline prettyprint">$ curl --request GET 
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 http://localhost:8080/openidm/config

{
    "configurations": [
        {
            "_id": "endpoint/getprocessesforuser",
            "pid": "endpoint.788f364e-d870-4f46-982a-793525fff6f0",
            "factoryPid": "endpoint"
        },
        {
            "_id": "provisioner.openicf/xml",
            "pid": "provisioner.openicf.90b18af9-fe27-45a2-a4ae-1056c04a4d31",
            "factoryPid": "provisioner.openicf"
        },
        {
            "_id": "ui/configuration",
            "pid": "ui.36bb2bf4-8e19-43d2-9df2-a0553ffac590",
            "factoryPid": "ui"
        },
        {
            "_id": "managed",
            "pid": "managed",
            "factoryPid": null
        },
        {
            "_id": "sync",
            "pid": "sync",
            "factoryPid": null
        },
        {
            "_id": "router",
            "pid": "router",
            "factoryPid": null
        },
        {
            "_id": "process/access",
            "pid": "process.44743c97-a01b-4562-85ad-8a2c9b89155a",
            "factoryPid": "process"
        },
        {
            "_id": "endpoint/siteIdentification",
            "pid": "endpoint.ef05a7f3-a420-4fbb-998c-02d283cae4d1",
            "factoryPid": "endpoint"
        },
        {
            "_id": "endpoint/securityQA",
            "pid": "endpoint.e2d87637-c918-4056-99a1-20f25c897066",
            "factoryPid": "endpoint"
        },
        {
            "_id": "scheduler",
            "pid": "scheduler",
            "factoryPid": null
        },
        {
            "_id": "ui/countries",
            "pid": "ui.acde0f4c-808f-45fb-9627-d7d2ca702e7c",
            "factoryPid": "ui"
        },
        {
            "_id": "org.apache.felix.fileinstall/openidm",
            "pid": "org.apache.felix.fileinstall.2dedea63-4592-4074-a709-ffa70f1e841d",
            "factoryPid": "org.apache.felix.fileinstall"
        },
        {
            "_id": "schedule/reconcile_systemXmlAccounts_managedUser",
            "pid": "schedule.f53b235a-862e-4e18-a3cf-10ae3cbabc1e",
            "factoryPid": "schedule"
        },
        {
            "_id": "workflow",
            "pid": "workflow",
            "factoryPid": null
        },
        {
            "_id": "endpoint/getavailableuserstoassign",
            "pid": "endpoint.d19da94f-bae3-4101-922c-fe47ea8616d2",
            "factoryPid": "endpoint"
        },
        {
            "_id": "repo.orientdb",
            "pid": "repo.orientdb",
            "factoryPid": null
        },
        {
            "_id": "audit",
            "pid": "audit",
            "factoryPid": null
        },
        {
            "_id": "endpoint/gettasksview",
            "pid": "endpoint.edcc1ff8-a7ba-4c46-8258-bf5216e85192",
            "factoryPid": "endpoint"
        },
        {
            "_id": "ui/secquestions",
            "pid": "ui.649e2c65-0cc7-4a0d-a6b1-95f4c5168bdc",
            "factoryPid": "ui"
        },
        {
            "_id": "org.apache.felix.fileinstall/activiti",
            "pid": "org.apache.felix.fileinstall.a0ba2f7d-bdb9-43b5-b84e-0e8feee6be72",
            "factoryPid": "org.apache.felix.fileinstall"
        },
        {
            "_id": "policy",
            "pid": "policy",
            "factoryPid": null
        },
        {
            "_id": "endpoint/usernotifications",
            "pid": "endpoint.e96d5319-6260-41db-af76-bd4e692b792d",
            "factoryPid": "endpoint"
        },
        {
            "_id": "org.apache.felix.fileinstall/ui",
            "pid": "org.apache.felix.fileinstall.89f8c6dd-f54e-46a4-bfda-1e76ac044c33",
            "factoryPid": "org.apache.felix.fileinstall"
        },
        {
            "_id": "authentication",
            "pid": "authentication",
            "factoryPid": null
        }
    ]
}</pre><p>Single instance configuration objects are located under
  <code class="literal">openidm/config/<em class="replaceable"><code>object-name</code></em></code>.
  The following example shows the default <code class="literal">audit</code>
  configuration.</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 http://localhost:8080/openidm/config/audit

{
    "eventTypes": {
        "activity": {
            "filter": {
                "actions": [
                    "create",
                    "update",
                    "delete",
                    "patch",
                    "action"
                ]
            }
        },
        "recon": {}
    },
    "logTo": [
        {
            "logType": "csv",
            "location": "audit",
            "recordDelimiter": ";"
        },
        {
            "logType": "repository"
        }
    ]
}</pre><p>Multiple instance configuration objects are found under
  <code class="literal">openidm/config/<em class="replaceable"><code>object-name</code></em>/<em class="replaceable"><code>instance-name</code></em></code>. The following example shows the
  configuration for the XML connector provisioner.</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 http://localhost:8080/openidm/config/provisioner.openicf/xml

{
    "name": "xmlfile",
    "connectorRef": {
        "bundleName":
            "org.forgerock.openicf.connectors.file.openicf-xml-connector",
        "bundleVersion": "",
        "connectorName": "com.forgerock.openicf.xml.XMLConnector"
    },
    "producerBufferSize": 100,
    "connectorPoolingSupported": true,
    "poolConfigOption": {
        "maxObjects": 10,
        "maxIdle": 10,
        "maxWait": 150000,
        "minEvictableIdleTimeMillis": 120000,
        "minIdle": 1
    },
    "operationTimeout": {
        "CREATE": -1,
        "TEST": -1,
        "AUTHENTICATE": -1,
        "SEARCH": -1,
        "VALIDATE": -1,
        "GET": -1,
        "UPDATE": -1,
        "DELETE": -1,
        "SCRIPT_ON_CONNECTOR": -1,
        "SCRIPT_ON_RESOURCE": -1,
        "SYNC": -1,
        "SCHEMA": -1
    },
    "configurationProperties": {
        "xsdIcfFilePath": "samples/sample1/data/resource-schema-1.xsd",
        "xsdFilePath": "samples/sample1/data/resource-schema-extension.xsd",
        "xmlFilePath": "samples/sample1/data/xmlConnectorData.xml"
    },
    "objectTypes": {
        "account": {
            "$schema": "http://json-schema.org/draft-03/schema",
            "id": "__ACCOUNT__",
            "type": "object",
            "nativeType": "__ACCOUNT__",
            "properties": {
                "description": {
                    "type": "string",
                    "nativeName": "__DESCRIPTION__",
                    "nativeType": "string"
                },
                "firstname": {
                    "type": "string",
                    "nativeName": "firstname",
                    "nativeType": "string"
                },
                "email": {
                    "type": "string",
                    "nativeName": "email",
                    "nativeType": "string"
                },
                "__UID__": {
                    "type": "string",
                    "nativeName": "__UID__"
                },
                "password": {
                    "type": "string",
                    "required": false,
                    "nativeName": "__PASSWORD__",
                    "nativeType": "JAVA_TYPE_GUARDEDSTRING",
                    "flags": [
                        "NOT_READABLE",
                        "NOT_RETURNED_BY_DEFAULT"
                    ]
                },
                "name": {
                    "type": "string",
                    "required": true,
                    "nativeName": "__NAME__",
                    "nativeType": "string"
                },
                "lastname": {
                    "type": "string",
                    "required": true,
                    "nativeName": "lastname",
                    "nativeType": "string"
                }
            }
        }
    },
    "operationOptions": {}
}</pre><p>You can change the configuration over REST by using an HTTP PUT request 
  to modify the required configuration object. The following example modifies 
  the <code class="filename">router.json</code> file to remove all filters, effectively 
  bypassing any policy validation.</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request PUT
 --data '{
          "filters" : [
             {
                "onRequest" : {
                   "type" : "text/javascript",
                   "file" : "bin/defaults/script/router-authz.js"
                }
              }
           ]
           }'
 "http://localhost:8080/openidm/config/router"
  </pre><p>See the <a href="../integrators-guide/index.html#appendix-rest" class="link"><em class="citetitle">REST API
  Reference</em></a> appendix for additional details and
  examples using REST access to update and patch objects.</p></div><div class="section" id="using-property-substitution"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5.5.&nbsp;Using Property Value Substitution in the Configuration</h2></div></div></div><p>In an environment where you have more than one OpenIDM instance, you 
  might require a configuration that is similar, but not identical, across the 
  different OpenIDM hosts. OpenIDM supports variable replacement in its 
  configuration which means that you can modify the effective configuration 
  according to the requirements of a specific environment or OpenIDM instance.</p><div class="itemizedlist"><p>Property substitution enables you to achieve the following:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Define a configuration that is specific to a single OpenIDM 
   instance, for example, setting the location of the keystore on a particular 
   host.</p></li><li class="listitem"><p>Define a configuration whose parameters vary between different 
   environments, for example, the URLs and passwords for test, development, 
   and production environments.</p></li><li class="listitem"><p>Disable certain capabilities on specific nodes. For example, 
   you might want to disable the workflow engine on specific instances.</p></li></ul></div><p>When OpenIDM starts up, it combines the system configuration, which 
  might contain specific environment variables, with the defined OpenIDM 
  configuration properties. This combination makes up the effective configuration 
  for that OpenIDM instance. By varying the environment properties, you can 
  change specific configuration items that vary between OpenIDM instances or 
  environments.</p><p>Property references are contained within the construct 
  <code class="literal">&amp;{ }</code>. When such references are found, OpenIDM replaces 
  them with the appropriate property value, defined in the 
  <code class="filename">boot.properties</code> file.</p><div class="example" id="d0e2394"><div class="example-title">Example&nbsp;5.1.&nbsp;</div><div class="example-contents"><p>The following example defines two separate OpenIDM environments - 
   a development environment and a production environment. You can specify the 
   environment at startup time and, depending on the environment, the database 
   URL is set accordingly.</p><p>The environments are defined by adding the following lines to the 
   <code class="filename">conf/boot.properties</code> file:</p><pre class="codelisting prettyprint linenums lang-js">
   PROD.location=production
   DEV.location=development
   </pre><p>The database URL is then specified as follows in the 
   <code class="filename">repo.orientdb.json</code> file:</p><pre class="codelisting prettyprint linenums lang-js">
    {
    "dbUrl" : "local:./db/&amp;{&amp;{environment}.location}-openidm",
    "user" : "admin",
    "poolMinSize" : 5,
    "poolMaxSize" : 20,
    ...
    }
   </pre><p>The effective database URL is determined by setting the 
   <code class="literal">OPENIDM_OPTS</code> environment variable when you start OpenIDM. 
   To use the production environment, start OpenIDM as follows:</p><pre class="cmdline prettyprint">
   $ export OPENIDM_OPTS="-Xmx1024m -Denvironment=PROD"
   $ ./startup.sh
   </pre><p>To use the development environment, start OpenIDM as follows:</p><pre class="cmdline prettyprint">
   $ export OPENIDM_OPTS="-Xmx1024m -Denvironment=DEV"
   $ ./startup.sh
   </pre></div></div><br class="example-break"><div class="section" id="property-substitution-system"><div class="titlepage"><div><div><h3 class="title">5.5.1.&nbsp;Using Property Value Substitution With System Properties</h3></div></div></div><p>You can use property value substitution in conjunction with the system 
  properties, to modify the configuration according to the system on which 
  the OpenIDM instance runs.</p><div class="example" id="d0e2427"><div class="example-title">Example&nbsp;5.2.&nbsp;</div><div class="example-contents"><p>The following example modifies the <code class="literal">audit.json</code> file so 
   that the log file is written to the user's directory. The 
   <code class="literal">user.home</code> property is a default Java System property.</p><pre class="codelisting prettyprint linenums lang-js">{
    "logTo" : [
        {
            "logType" : "csv",
            "location" : "&amp;{user.home}/audit",
            "recordDelimiter" : ";"
        }
    ]
}
   </pre></div></div><br class="example-break"><p>You can define <span class="emphasis"><em>nested</em></span> properties (that is a property 
 definition within another property definition) and you can combine system 
 properties and boot properties.</p><div class="example" id="d0e2443"><div class="example-title">Example&nbsp;5.3.&nbsp;</div><div class="example-contents"><p>The following example uses the <code class="literal">user.country</code> property, 
   a default Java System property. The example defines specific LDAP ports, 
   depending on the country (identified by the country code) in the 
   <code class="literal">boot.properties</code> file. The value of the LDAP port (set in 
   the <code class="literal">provisioner.openicf-ldap.json</code> file) depends on the 
   value of the <code class="literal">user.country</code> System property.</p><p>The port numbers are defined in the <code class="literal">boot.properties</code> 
   file as follows:</p><pre class="codelisting prettyprint linenums lang-js">
   openidm.NO.ldap.port=2389
   openidm.EN.ldap.port=3389
   openidm.US.ldap.port=1389</pre><p>The following extract from the 
   <code class="literal">provisioner.openicf-ldap.json</code> file shows how the value of 
   the LDAP port is eventually determined, based on the System property:</p><pre class="codelisting prettyprint linenums lang-js">
   "configurationProperties" :
   {
      "credentials" : "Passw0rd",
      "port" : "&amp;{openidm.&amp;{user.country}.ldap.port}",
      "principal" : "cn=Directory Manager",
      "baseContexts" :
         [
            "dc=example,dc=com"
         ],
      "host" : "localhost"
   }
   </pre></div></div><br class="example-break"></div><div class="section" id="property-substitution-limitations"><div class="titlepage"><div><div><h3 class="title">5.5.2.&nbsp;Limitations of Property Value Substitution</h3></div></div></div><div class="itemizedlist"><p>Note the following limitations when you use property value 
   substitution:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>You cannot reference complex objects or properties with syntaxes 
 other than String. Property values are resolved from the 
 <code class="literal">boot.properties</code> file or from the System properties and the 
 value of these properties is always in String format.</p><p>Property substitution of boolean values is currently only supported in 
 stringified format, that is, resulting in <code class="literal">"true"</code> or 
 <code class="literal">"false"</code>.
 </p></li><li class="listitem"><p>Substitution of encrypted property values is currently not 
 supported.</p></li></ul></div></div></div><div class="section" id="adding-custom-endpoints"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5.6.&nbsp;Adding Custom Endpoints</h2></div></div></div><p>You can customize OpenIDM to meet the specific requirements of your 
    deployment by adding your own RESTful endpoints. Endpoints are configured 
    in files named <code class="filename">conf/endpoint-<em class="replaceable"><code>name</code></em>.json</code>,
    where <em class="replaceable"><code>name</code></em> generally describes the purpose of the 
    endpoint.</p><p>A sample custom endpoint configuration is provided at 
    <code class="filename">openidm/samples/customendpoint</code>. The sample includes 
    two files:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">conf/endpoint-echo.json</code>, which provides the 
      configuration for the endpoint.</td></tr><tr><td><code class="filename">script/echo.js</code>, which is launched when the 
      endpoint is accessed.</td></tr></table><p>The structure of an endpoint configuration file is as follows:</p><pre class="codelisting prettyprint linenums lang-js">
{ 
  "context" : "endpoint/echo", 
  "type" : "text/javascript", 
  "file" : "script/echo.js" 
}    
    </pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">"context"</code></span></dt><dd><p>The URL context under which the endpoint is registered. 
          Currently this <span class="emphasis"><em>must</em></span> be under 
          <code class="literal">endpoint/</code>. An endpoint registered under the 
          context <code class="literal">endpoint/echo</code> is addressable over REST at 
          <code class="literal">http://localhost:8080/openidm/endpoint/echo</code> and 
          with the internal resource API, for example 
          <code class="literal">openidm.read("endpoint/echo")</code>.</p></dd><dt><span class="term"><code class="literal">"type"</code></span></dt><dd><p>The type of implementation. Currently only 
          <code class="literal">"text/javascript"</code> is supported.</p></dd><dt><span class="term"><code class="literal">"source"</code> or <code class="literal">"file</code></span></dt><dd><p>The actual script, inline, or a pointer to the file that 
          contains the script. The sample script, 
          (<code class="filename">samples/customendpoint/script/echo.js</code>) simply 
          returns the HTTP request when a request is made on that endpoint.
          </p></dd></dl></div><p>The endpoint script has a <code class="literal">request</code> variable 
    available in its scope. The request structure carries all the information 
    about the request, and includes the following properties:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">id</code></span></dt><dd><p>The local ID, without the <code class="literal">endpoint/</code> prefix, 
        for example, <code class="literal">echo</code>.</p></dd><dt><span class="term"><code class="literal">method</code></span></dt><dd><p>The requested operation, that is, <code class="literal">create</code>, 
          <code class="literal">read</code>, <code class="literal">update</code>, 
          <code class="literal">delete</code>, <code class="literal">patch</code>, 
          <code class="literal">query</code> or <code class="literal">action</code>.</p></dd><dt><span class="term"><code class="literal">params</code></span></dt><dd><p>The parameters that are passed in. For example, for an HTTP GET 
         with <code class="literal">?param=x</code>, the request contains 
         <code class="literal">"params":{"param":"x"}</code>.</p></dd><dt><span class="term"><code class="literal">parent</code></span></dt><dd><p>Provides the context for the invocation, including headers and 
          security.</p><p>Note that the interface for this context is still evolving and 
          may change in a future release.</p></dd></dl></div><p>A script implementation should check and reject requests for methods 
    that it does not support. For example, the following implementation 
    supports only the <code class="literal">read</code> method:</p><pre class="codelisting prettyprint linenums lang-js">
if (request.method == "read") {
    ...
} else {
    throw "Unsupported operation: " + request.method;
}
    </pre><p>The final statement in the script is the return value. Unlike for 
    functions, at this global scope there is no <code class="literal">return</code> 
    keyword. In the following example, the value of the last statement 
    (<code class="literal">x</code>) is returned.</p><pre class="codelisting prettyprint linenums lang-js">
var x = "Sample return"
functioncall();
x
    </pre><p>The following example uses the sample provided in 
    <code class="literal">openidm/samples/customendpoint</code> and shows the complete 
    request structure, which is returned by the query.</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET
 "http://localhost:8080/openidm/endpoint/echo?param=x"
{
  "type": "resource",
  "uuid": "21c5ddc6-a66e-464e-9fa4-9b777505799e",
  "params": {
    "param": "x"
  },
  "method": "query",
  "parent": {
    "path": "/openidm/endpoint/echo",
    "headers": {
      "Accept": "*/*",
      "User-Agent": "curl/7.21.4 ... OpenSSL/0.9.8r zlib/1.2.5",
      "Authorization": "Basic b3BlbmlkbS1hZG1pbjpvcGVuaWRtLWFkbWlu",
      "Host": "localhost:8080"
    },
    "query": {
      "param": "x"
    },
    "method": "GET",
    "parent": {
      "uuid": "bec97cbf-8618-42f8-a841-9f5f112538e9",
      "parent": null,
      "type": "root"
    },
    "type": "http",
    "uuid": "7fb3e0d9-5f56-4b15-b710-28f2147cf4b4",
    "security": {
      "openidm-roles": [
        "openidm-admin",
        "openidm-authorized"
      ],
      "username": "openidm-admin",
      "userid": {
        "component": "internal/user",
        "id": "openidm-admin"
      }
    }
  },
  "id": "echo"
} 
    </pre><p>You must protect access to any custom endpoints by configuring the 
    appropriate authorization for those contexts. For more information, see 
    the <a href="../integrators-guide/index.html#openidm-authorization" class="link">
    <em class="citetitle">Authorization</em></a> section.</p></div></div><div lang="en" class="chapter" id="chap-data"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;6.&nbsp;Accessing Data Objects</h1></div></div></div><a class="indexterm" name="d0e2679"></a><p>OpenIDM supports a variety of objects that can be addressed via
        a URL or URI. You can access data objects by using scripts (through the
        Resource API) or by using direct HTTP calls (through the REST API).</p><p>The following sections describe these two methods of accessing data
        objects, and provide information on constructing and calling data queries.
    </p><div class="section" id="data-scripts"><div class="titlepage"><div><div><h2 class="title" style="clear: both">6.1.&nbsp;Accessing Data Objects by Using Scripts</h2></div></div></div><a class="indexterm" name="d0e2691"></a><p>OpenIDM's uniform programming model means that all objects
            are queried and manipulated in the same way, using the Resource API.
            The URL or URI that is used to identify the target object for an
            operation depends on the object type. For an explanation of object
            types, see the <span class="olink">
            <em class="citetitle">Data Models and Objects Reference</em></span>.
            For more information about scripts and the objects available to
            scripts, see the <a href="../integrators-guide/index.html#appendix-scripting" class="link">
                <em class="citetitle">Scripting Reference</em></a>.</p><p>You can use the Resource API to obtain managed objects,
            configuration objects, and repository objects, as follows:</p><pre class="codelisting prettyprint linenums lang-js">
val = openidm.read("managed/organization/mysampleorg")
val = openidm.read("config/custom/mylookuptable")
val = openidm.read("repo/custom/mylookuptable")</pre><p>For information about constructing an object ID, see <a href="../integrators-guide/index.html#rest-uri-scheme" class="link">
            <em class="citetitle">URI Scheme</em></a> in the
            <em class="citetitle">REST API Reference</em>.</p><p>You can update entire objects with the <code class="literal">update()</code>
            function, as follows.</p><pre class="codelisting prettyprint linenums lang-js">
openidm.update("managed/organization/mysampleorg", mymap)
openidm.update("config/custom/mylookuptable", mymap)
openidm.update("repo/custom/mylookuptable", mymap)</pre><p>For managed objects, you can partially update an object with the
            <code class="literal">patch()</code> function.</p><pre class="codelisting prettyprint linenums lang-js">
openidm.patch("managed/organization/mysampleorg", rev, value)
        </pre><p>The <code class="literal">create()</code>, <code class="literal">delete()</code>, and
            <code class="literal">query()</code> functions work the same way.</p></div><div class="section" id="data-rest"><div class="titlepage"><div><div><h2 class="title" style="clear: both">6.2.&nbsp;Accessing Data Objects by Using the REST API</h2></div></div></div><p>OpenIDM provides RESTful access to data objects via a REST API.
            To access objects over REST, you can use a browser-based REST client,
            such as the <a class="link" href="https://chrome.google.com/webstore/detail/simple-rest-client/fhjcajmcbmldlhcimfajhfbgofnpcjmb" target="_top">
            Simple REST Client</a> for Chrome, or <a class="link" href="https://addons.mozilla.org/en-US/firefox/addon/restclient/" target="_top">
            RESTClient</a> for Firefox. Alternatively you can use the
            <a class="link" href="http://curl.haxx.se/" target="_blank"><span class="command"><strong>curl</strong></span></a> command-line utility.
        </p><p>For a comprehensive overview of the REST API, see the
        <a href="../integrators-guide/index.html#appendix-rest" class="link">
            <em class="citetitle">REST API Reference</em></a> appendix.</p><p>To obtain a managed object through the REST API, depending on your
            security settings and authentication configuration, perform an HTTP GET
            on the corresponding URL, for example
            <code class="literal">https://localhost:8443/openidm/managed/organization/mysampleorg</code>.</p><p>By default, the HTTP GET returns a JSON representation of the object.</p></div><div class="section" id="queries"><div class="titlepage"><div><div><h2 class="title" style="clear: both">6.3.&nbsp;Defining and Calling Queries</h2></div></div></div><p>OpenIDM supports an advanced query model that enables you to
            define queries, and to call them over the REST or Resource API.</p><div class="section" id="parameterized-queries"><div class="titlepage"><div><div><h3 class="title">6.3.1.&nbsp;Parameterized Queries</h3></div></div></div><p>Managed objects in the supported OpenIDM repositories can be
                accessed using a parameterized query mechanism. Parameterized
                queries on repositories are defined in the repository
                configuration (<code class="filename">repo.*.json</code>) and are called
                by their <code class="literal">_queryId</code>.</p><p>Parameterized queries provide security and portability for
            the query call signature, regardless of the back-end implementation.
            Queries that are exposed over the REST interface <span class="emphasis"><em>must</em></span>
            be parameterized queries to guard against injection attacks and other
            misuse. Queries on the officially supported repositories have been
            reviewed and hardened against injection attacks.</p><p>For system objects, support for parameterized queries is
            restricted to <code class="literal">_queryId=query-all-ids</code>. There is
            currently no support for user-defined parameterized queries on
            system objects. Typically, parameterized queries on system objects
            are not called directly over the REST interface, but are issued
            from internal calls, such as correlation queries.</p><p> A typical query definition is as follows:</p><pre class="cmdline prettyprint">"query-all-ids" : "select _openidm_id from ${unquoted:_resource}"</pre><p>To call this query, you would reference its ID, as follows:</p><pre class="cmdline prettyprint">?_queryId=query-all-ids</pre><p>The following example calls <code class="literal">query-all-ids</code> over
                the REST interface:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 "http://localhost:8080/openidm/managed/user/?_queryId=query-all-ids"
            </pre></div><div class="section" id="native-queries"><div class="titlepage"><div><div><h3 class="title">6.3.2.&nbsp;Native Query Expressions</h3></div></div></div><p>Native query expressions are supported for all managed
            objects and system objects, and can be called directly over
            the REST interface, rather than being defined in the
            repository configuration.</p><p>Native queries are intended specifically for internal
            callers, such as custom scripts, in situations where the
            parameterized query facility is insufficient. For example,
            native queries are useful if the query needs to be generated
            dynamically.</p><p>The query expression is specific to the target resource.
            For repositories, queries use the native language of the underlying
            data store. For system objects that are backed by OpenICF connectors,
            queries use the applicable query language of the system resource.</p><p>Native queries on the repository are made using the
                <code class="literal">_queryExpression</code> keyword. For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 "http://localhost:8080/openidm/managed/user?_queryExpression=select+*+from+managedobjects"
            </pre><p>Unlike parameterized queries, native queries are not portable
            and do not guard against injection attacks. Such query expressions
            should therefore not be used or made accessible over the REST interface
            or over HTTP, other than for development, and should be used only via
            the internal Resource API. For more information, see the section on
                <a href="../integrators-guide/index.html#security-urls" class="link">
                    <em class="citetitle">Protecting Sensitive REST Interface URLs</em></a>.
            </p><p>If you really need to expose native queries over HTTP, in a
                selective manner, you can design a custom endpoint to wrap
                such access.</p></div><div class="section" id="constructing-queries"><div class="titlepage"><div><div><h3 class="title">6.3.3.&nbsp;Constructing Queries</h3></div></div></div><p>The <code class="literal">openidm.query</code> function enables you
            to query OpenIDM resource objects for reconciliation processes
            and workflows. Query syntax is
            <code class="literal">openidm.query(id, params)</code>, where
            <code class="literal">id</code> specifies the object on which the query should
            be performed and <code class="literal">params</code> provides the parameters
            that are passed to the query. For example:</p><pre class="codelisting prettyprint linenums lang-js">
var params = {
    'query' : {
        'Equals': {
            'field' : 'uid',
            'values' : [
                id
            ]
        }
    }
};
var results = openidm.query("system/ScriptedSQL/account", params)
            </pre><p>OpenIDM supports nine query filters and a range of keywords
            that can be applied to these filters. Each filter takes a field
            and a list as value. The following filters are supported:</p><h4 id="d0e2863">Attribute Operations</h4><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">Equals</code> Filter</span></dt><dd><p>Determines whether the resource contains an
                        attribute that matches a specific attribute value.
                        </p><p>Returns <code class="literal">true</code> if the object
                        satisfies all selection criteria of the filter, otherwise
                        returns <code class="literal">false</code>.</p><p>For example:</p><pre class="codelisting prettyprint linenums lang-js">
{
    "Equals":{
        "field":"lastname",
            "values":[
                "Doe"
            ]
    }
}
                        </pre></dd><dt><span class="term"><code class="literal">ContainsAllValues</code> Filter</span></dt><dd><p>Determines whether the external resource
                            contains an attribute that has the same name as,
                            and contains all of the values of, the attribute
                            placed into the filter.
                            </p><p>Returns <code class="literal">true</code> if the object
                            satisfies all the selection criteria of the filter,
                            otherwise returns <code class="literal">false</code>.</p></dd></dl></div><h4 id="d0e2908">Comparable Attribute Operations</h4><p>Compares single-value attributes to a given filter.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">GreaterThan</code> Filter</span></dt><dd><p>Determines whether the attribute value of the
                         resource object is greater than the one provided in
                         the filter.
                        </p><p>Returns <code class="literal">true</code> if the object
                        value is greater, otherwise returns <code class="literal">false</code>.</p></dd><dt><span class="term"><code class="literal">GreaterThanOrEqual</code> Filter</span></dt><dd><p>Determines whether the attribute value of the
                                resource object is greater than or equal to the
                                one provided in the filter.</p><p>Returns <code class="literal">true</code> if the object
                                value is greater than or equal, otherwise
                                returns <code class="literal">false</code>.</p></dd><dt><span class="term"><code class="literal">LessThan</code> Filter</span></dt><dd><p>Determines whether the attribute value of the
                                resource object is less than the one provided in
                                the filter.
                            </p><p>Returns <code class="literal">true</code> if the object
                                value is less, otherwise returns
                                <code class="literal">false</code>.</p></dd><dt><span class="term"><code class="literal">LessThanOrEqual</code> Filter</span></dt><dd><p>Determines whether the attribute value of the
                                resource object is less than or equal to the one
                                provided in the filter.
                            </p><p>Returns <code class="literal">true</code> if the object
                                value is less than or equal, otherwise returns
                                <code class="literal">false</code>.</p></dd></dl></div><h4 id="d0e2977">String Attribute Operations</h4><p>Compares string values to a given filter.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">StartsWith</code> Filter</span></dt><dd><p>Returns attributes whose value starts with the
                        string specified in the filter.
                        </p></dd><dt><span class="term"><code class="literal">Contains</code> Filter</span></dt><dd><p>Returns attributes whose value contains the
                        string specified in the filter.</p></dd><dt><span class="term"><code class="literal">EndsWith</code> Filter</span></dt><dd><p>Returns attributes whose value ends with the
                        string specified in the filter.
                        </p></dd></dl></div><h4 id="d0e3006">Filter Operations</h4><p>Filter operations are used to construct more complex
                filters by comparing two filters from the preceding section
                or negating filters defined in the previous section.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">AND Filter</code></span></dt><dd><p>A filter that matches entries using the AND
                            boolean operator on two filters.</p><p>Example:</p><pre class="codelisting prettyprint linenums lang-js">{
 "query":{
   "AND":[
     {
        "Equals":{
            "field":"lastname",
            "values":[
               "Doe"
            ]
        }
     },
     {
         "Equals":{
             "field":"firstname",
             "values":[
                "John"
             ]
         }
     }
   ]
 }
}
                            </pre></dd><dt><span class="term"><code class="literal">OR Filter</code></span></dt><dd><p>A filter that matches entries using the OR
                            boolean operator on two filters.</p><p>Example:</p><pre class="codelisting prettyprint linenums lang-js">{
  "query":{
    "OR":[
      {
        "StartsWith":{
            "field":"lastname",
            "values":[
              "A"
            ]
        }
      },
      {
        "StartsWith":{
            "field":"lastname",
            "values":[
              "B"
            ]
        }
      }
    ]
  }
}
</pre></dd><dt><span class="term"><code class="literal">NOT Filter</code></span></dt><dd><p>A filter that filters out matched entries
                            by negating another filter.</p><p>Example:</p><pre class="codelisting prettyprint linenums lang-js">{
  "query":{
    "NOT":[
      {
        "Equals":{
          "field":"lastname",
          "values":[
            "Doe"
          ]
        }
      }
    ]
  }
}
</pre></dd></dl></div></div></div></div><div lang="en" class="chapter" id="chap-policies"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;7.&nbsp;Using Policies to Validate Data</h1></div></div></div><a class="indexterm" name="d0e3048"></a><p>OpenIDM provides an extensible policy service that enables you to 
  apply specific validation requirements to various components and properties. 
  The policy service provides a REST interface for reading policy requirements 
  and validating the properties of components against configured policies. 
  Objects and properties are validated automatically when they are created, 
  updated, or patched. Policies can be applied to user passwords, but also to 
  any kind of managed object.</p><p>The policy service enables you to do the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Read the configured policy requirements of a specific component.
     </p></li><li class="listitem"><p>Read the configured policy requirements of all components.</p></li><li class="listitem"><p>Validate a component object against the configured policies.</p></li><li class="listitem"><p>Validate the properties of a component against the configured 
     policies.</p></li></ul></div><p>A default policy applies to all managed objects. You can configure the 
  default policy to suit your requirements, or you can extend the policy 
  service by supplying your own scripted policies.</p><div class="section" id="configuring-default-policy"><div class="titlepage"><div><div><h2 class="title" style="clear: both">7.1.&nbsp;Configuring the Default Policy</h2></div></div></div><p>The default policy is configured in two files:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A policy script file 
        (<code class="filename">openidm/bin/defaults/script/policy.js</code>) which 
        defines each policy and specifies how policy validation is performed.
        </p></li><li class="listitem"><p>A policy configuration file 
        (<code class="filename">openidm/conf/policy.json</code>) which specifies which 
        policies are applicable to each resource.
        </p></li></ul></div><div class="section" id="policy-script-file"><div class="titlepage"><div><div><h3 class="title">7.1.1.&nbsp;Policy Script File</h3></div></div></div><p>The policy script file defines policy configuration in two parts:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A policy configuration object, which defines each 
        element of the policy.</p></li><li class="listitem"><p>A policy implementation function, which describes the 
        requirements that are enforced by that policy.</p></li></ul></div><p>Together, the configuration object and the implementation function 
      determine whether an object is valid in terms of the policy. The following 
      extract from the policy script file configures a policy that specifies 
      that the value of a property must contain a certain number of capital 
      letters.</p><pre class="codelisting prettyprint linenums lang-js">
...
            {   "policyId" : "at-least-X-capitals",
                "clientValidation": true,
                "policyExec" : "atLeastXCapitalLetters", 
                "policyRequirements" : ["AT_LEAST_X_CAPITAL_LETTERS"]
            },
...

function atLeastXCapitalLetters(fullObject, value, params, property) {
    var reg = /[(A-Z)]/g;
    if (typeof value !== "string" || !value.length || value.match(reg) 
        === null || value.match(reg).length &lt; params.numCaps) {
        return [ { 
                   "policyRequirement" : "AT_LEAST_X_CAPITAL_LETTERS", 
                   "params" : {
                     "numCaps": params.numCaps
                   } 
                  } 
               ];
    }
    return [];
}     
...     
      </pre><p>To enforce user passwords that contain at least one capital letter, 
      the previous policy ID is applied to the appropriate resource and the 
      required number of capital letters is defined in the policy configuration 
      file, as described in <a class="xref" href="#policy-config-file" title="7.1.2.&nbsp;Policy Configuration File">Section&nbsp;7.1.2, &#8220;Policy Configuration File&#8221;</a>.</p><div class="section" id="policy-config-object"><div class="titlepage"><div><div><h4 class="title">7.1.1.1.&nbsp;Policy Configuration Object</h4></div></div></div><p>Each element of the policy is defined in a policy configuration 
        object. The structure of a policy configuration object is as follows:
        </p><pre class="codelisting prettyprint linenums lang-js">
{   "policyId" : "minimum-length",
    "clientValidation": true,
    "policyExec" : "propertyMinLength",
    "policyRequirements" : ["MIN_LENGTH"]
}
      </pre><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">"policyId"</code> - a unique ID that enables the 
        policy to be referenced by component objects.</td></tr><tr><td><code class="literal">"clientValidation"</code> - indicates whether the 
        policy decision can be made on the client. When 
        <code class="literal">"clientValidation": true</code>, the source code for the 
        policy decision function is returned when the client requests the 
        requirements for a property.</td></tr><tr><td><code class="literal">"policyExec"</code> - the name of the function that 
        contains the policy implementation. For more information, see 
        <a class="xref" href="#policy-function" title="7.1.1.2.&nbsp;Policy Implementation Function">Section&nbsp;7.1.1.2, &#8220;Policy Implementation Function&#8221;</a>.</td></tr><tr><td><code class="literal">"policyRequirements"</code> - an array containing 
        the policy requirement ID of each requirement that is associated with 
        the policy. Typically, a policy will validate only one requirement, 
        but it can validate more than one.</td></tr></table></div><div class="section" id="policy-function"><div class="titlepage"><div><div><h4 class="title">7.1.1.2.&nbsp;Policy Implementation Function</h4></div></div></div><p>Each policy ID has a corresponding policy implementation 
        function that performs the validation. Functions take the following 
        form:</p><pre class="codelisting prettyprint linenums lang-js">
function &lt;name&gt;(fullObject, value, params, propName) {	
	&lt;implementation_logic&gt;
}
        </pre><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">fullObject</code> is the full resource object 
          that is supplied with the request.</td></tr><tr><td><code class="literal">value</code> is the value of the property that 
          is being validated.</td></tr><tr><td><code class="literal">params</code> refers to the 
          <code class="literal">"params"</code> array that is specified in the property's 
          policy configuration.</td></tr><tr><td><code class="literal">propName</code> is the name of the property that 
          is being validated.</td></tr></table><p>The following example shows the implementation function for the 
        <code class="literal">"required"</code> policy.</p><pre class="codelisting prettyprint linenums lang-js">
function required(fullObject, value, params, propName) {
    if (value === undefined) {
        return [ { "policyRequirement" : "REQUIRED" } ];
    }
    return [];
}          
        </pre></div></div><div class="section" id="policy-config-file"><div class="titlepage"><div><div><h3 class="title">7.1.2.&nbsp;Policy Configuration File</h3></div></div></div><p>The policy configuration file includes a pointer to the policy 
      script, and the configured policies for each component resource. The 
      following extract of the default policy configuration file shows how 
      the <code class="literal">at-least-X-capitals</code> policy is applied to user 
      passwords, with a default value of <code class="literal">1</code>.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "type" : "text/javascript",
    "file" : "bin/defaults/script/policy.js",
    "resources" : [
        {
            "resource" : "managed/user/*",
            "properties" : [
...
                {
                    "name" : "password",
                    "policies" : [
                        {
                            "policyId" : "required"
                        },
                        {
                            "policyId" : "not-empty"
                        },
                        {
                            "policyId" : "at-least-X-capitals",
                            "params" : {
                                "numCaps" : 1
                            }
                        },
                ...
           }
       ]
}     
      </pre><p>The configuration file includes the following properties:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">"type"</code> - specifies the type of policy 
          service. Currently, only <code class="literal">"text/javascript"</code> is 
          supported.</p></li><li class="listitem"><p><code class="literal">"file"</code> - provides the path to the policy 
          script file, relative to the OpenIDM installation directory.</p></li><li class="listitem"><p><code class="literal">"resources"</code> provides an array of resource 
          objects, in JSON format, that are subject to the policy service. 
          Resource objects are identified by the <code class="literal">"resource"</code> 
          parameter, which indicates the URI and supports wildcard syntax. For 
          example, <code class="literal">"managed/user/*"</code> indicates that the 
          policy applies to all objects under <code class="literal">/managed/user</code>. 
          Each resource has the following properties:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">"name"</code> - the name of the property to 
              which the policy is applied.</td></tr><tr><td><code class="literal">"policyID"</code> - the ID of the policy that 
              is applied to that property.</td></tr><tr><td><code class="literal">"params"</code> - any specific parameters 
              that apply to that policy ID.</td></tr></table></li></ul></div><p>You can specify that a particular policy does not apply to users 
      with specific OpenIDM roles by setting the <code class="literal">"exceptRoles"</code> 
      parameter of the policy ID. For example, the following extract from  
      <code class="filename">policy.json</code> specifies that the reauthorization 
      required policy definition does not apply to users with roles 
      <code class="literal">openidm-admin</code>, or <code class="literal">opendim-reg</code>.
      </p><pre class="codelisting prettyprint linenums lang-js">
...      
    {
        "policyId" : "re-auth-required",
        "params" : {
            "exceptRoles" : [
                "openidm-admin",
                "openidm-reg"
            ]
        }
    }      
...      
      </pre></div></div><div class="section" id="extending-policies"><div class="titlepage"><div><div><h2 class="title" style="clear: both">7.2.&nbsp;Extending the Policy Service</h2></div></div></div><p>You can extend the policy service by adding your own scripted 
    policies in <code class="filename">openidm/script</code> and referencing them in 
    the policy configuration file (<code class="filename">conf/policy.json</code>). 
    Avoid manipulating the default policy script file (in 
    <code class="literal">bin/defaults/script</code>) as doing so might result in 
    interoperability issues in a future release. To reference additional 
    policy scripts, set the <code class="literal">"additionalFiles"</code> property in 
    <code class="filename">conf/policy.json</code>.</p><p>The following example creates a custom policy that rejects 
    properties with null values. The policy is defined in a script named 
    <code class="literal">mypolicy.js</code>.</p><pre class="codelisting prettyprint linenums lang-js">
var policy = {   "policyId" : "notNull",
       "policyExec" : "notNull",  
       "policyRequirements" : ["NOT_NULL"]
}

addPolicy(policy);

function notNull(fullObject, value, params, property) {
   if (value == null) {
       return [ {"policyRequirement": "NOT_NULL"}];
   }
   return [];
} 
    </pre><p>The policy is referenced in the policy configuration file as follows:
    </p><pre class="codelisting prettyprint linenums lang-js">
{
    "type" : "text/javascript",
    "file" : "bin/defaults/script/policy.js",
    "additionalFiles" : ["script/mypolicy.js"],
    "resources" : [
        {
...
    </pre><p>You can also configure policies for managed object properties as 
    part of the property definition in the <code class="filename">conf/managed.json</code> 
    file. For example, the following extract of a managed.json file shows a 
    policy configuration for the <code class="literal">password</code> property.</p><pre class="codelisting prettyprint linenums lang-js">
...
"properties" : [
    {
        "name" : "password",
        "encryption" : {
            "key" : "openidm-sym-default"
        },
        "scope" : "private"
        "policies" : [
            {
                "policyId" : "required"
            },
            {
                "policyId" : "not-empty"
            },
            {
                "policyId" : "at-least-X-capitals",
                "params" : {
                "numCaps" : 1
                }
            }
        ]
    },
...
    </pre></div><div class="section" id="disabling-policies"><div class="titlepage"><div><div><h2 class="title" style="clear: both">7.3.&nbsp;Disabling Policy Enforcement</h2></div></div></div><p>Policy enforcement refers to the automatic validation of data in 
     the repository when it is created, updated, or patched. In certain 
     situations you might want to disable policy enforcement temporarily. You 
     might, for example, want to import existing data that does not meet the 
     validation requirements with the intention of cleaning up this data at a 
     later stage.</p><p>You can disable policy enforcement by setting 
     <code class="literal">openidm.policy.enforcement.enabled</code> to 
     <code class="literal">false</code> in the <code class="filename">conf/boot/boot.properties</code> 
     file. This setting disables policy enforcement in the back-end only, and 
     has no impact on direct policy validation calls to the Policy Service 
     (which the user interface makes to validate input fields). So, with policy 
     enforcement disabled, data added directly over REST is not subject to 
     validation, but data added with the UI is still subject to validation.
     </p><p>Disabling policy enforcement permanently in a production system is 
     not recommended.</p></div><div class="section" id="policies-over-REST"><div class="titlepage"><div><div><h2 class="title" style="clear: both">7.4.&nbsp;Managing Policies Over REST</h2></div></div></div><p>You can manage the policy service over the REST interface, by calling 
    the REST endpoint <code class="literal">http://localhost:8080/openidm/policy</code>, as 
    shown in the following examples.</p><div class="section" id="listing-policies"><div class="titlepage"><div><div><h3 class="title">7.4.1.&nbsp;Listing the Defined Policies</h3></div></div></div><p>The following REST call displays a list of all the defined 
      policies:
      </p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET
 "http://localhost:8080/openidm/policy"</pre><p>The policy objects are returned in JSON format, with one object 
      for each defined policy ID, for example:</p><pre class="cmdline prettyprint">{
  "resources": [
    {
      "resource": "managed/user/*",
      "properties": [
      {
        "policies": [
          {
            "policyId": "required",
            "policyFunction": "function required(fullObject, value, params, propName) {
              if (value === undefined) {
              return [{"policyRequirement":"REQUIRED"}];
                      }
              return [];
            }",
            "policyRequirements": [
              "REQUIRED"
            ]
          },
...</pre><p>To display the policies that apply to a specific component, include 
      the component name in the URL. For example, the following REST call 
      displays the policies that apply to managed users.
      </p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET
 "http://localhost:8080/openidm/policy/managed/user/*"</pre><pre class="cmdline prettyprint">
{
    "resource": "managed/user/*",
    "properties": [
        {
            "policies": [
                {
                    "policyId": "required",
                    "policyFunction": "
                        \nfunction required(fullObject, value, params, propName) {
                            \n    if (value === undefined) {
                            \n        return [{\"policyRequirement\":\"REQUIRED\"}];
                            \n    }
                            \n    return [];
                            \n}
                            \n",
                    "policyRequirements": [
                        "REQUIRED"
                    ]
                },
                {
                    "policyId": "not-empty",
                    "policyFunction": "
                    \nfunction notEmpty(fullObject, value, params, property) {
                    \n    if (typeof (value) !== \"string\" || !value.length) {
                    \n        return [{\"policyRequirement\":\"REQUIRED\"}];
                    \n    } else {
                    \n        return [];
                    \n    }
                    \n}
                    \n",
                    "policyRequirements": [
                        "REQUIRED"
                    ]
                },
                {
                    "policyId": "unique",
                    "policyRequirements": [
                        "UNIQUE"
                    ]
                },
...
}</pre></div><div class="section" id="policy-validate"><div class="titlepage"><div><div><h3 class="title">7.4.2.&nbsp;Validating Objects and Properties Over REST</h3></div></div></div><p>Use the <code class="literal">validateObject</code> action to verify that 
      an object adheres to the requirements of a policy.</p><p>The following example verifies that a new managed user object is 
      acceptable in terms of the policy requirements.</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST      
 --data '{"familyName":"Jones",
          "givenName":"Bob",
          "_id":"bjones",
          "phoneNumber":"0827878921",
          "passPhrase":null,
          "email":"bjones@example.com",
          "accountStatus":"active",
          "roles":"admin",
          "userName":"bjones@example.com",
          "password":"123"}' 
 "http://localhost:8080/openidm/policy/managed/user/bjones?_action=validateObject"

{"result":false,
 "failedPolicyRequirements":[
    {"policyRequirements":[
         {"policyRequirement":"AT_LEAST_X_CAPITAL_LETTERS",
             "params":{"numCaps":1}
         },
         {"policyRequirement":"MIN_LENGTH",
             "params":{"minLength":8}
         }
         ],
      "property":"password"
    }
  ]
}</pre><p>The result (<code class="literal">false</code>) indicates that the object 
      is not valid. The unfulfilled policy requirements are provided as part 
      of the response - in this case, the user password does not meet the 
      validation requirements.</p><p>Use the <code class="literal">validateProperty</code> action to verify that 
      a specific property adheres to the requirements of a policy.</p><p>The following example checks whether Barbara Jensen's new password 
      (<code class="literal">12345</code>) is acceptable.</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 --data '{ "password" : "12345" }' 
 "http://localhost:8080/openidm/policy/managed/user/bjensen?_action=validateProperty"
 
{
    "result": false,
    "failedPolicyRequirements": [
        {
            "policyRequirements": [
                {
                    "policyRequirement": "AT_LEAST_X_CAPITAL_LETTERS",
                    "params": {
                        "numCaps": 1
                    }
                },
                {
                    "policyRequirement": "MIN_LENGTH",
                    "params": {
                        "minLength": 8
                    }
                }
            ],
            "property": "password"
        }
    ]
}
      </pre><p>The result (<code class="literal">false</code>) indicates that the password 
      is not valid. The unfulfilled policy requirements are provided as part 
      of the response - in this case, the minimum length and the minimum 
      number of capital letters.</p><p>Validating a property that does fulfil the policy requirements 
      returns a <code class="literal">true</code> result, for example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 --data '{ "password" : "1NewPassword" }' 
 "http://localhost:8080/openidm/policy/managed/user/bjensen?_action=validateProperty"
 
{
    "result": true,
    "failedPolicyRequirements": []
}
      </pre></div></div></div><div lang="en" class="chapter" id="chap-logs"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;8.&nbsp;Configuring Server Logs</h1></div></div></div><a class="indexterm" name="d0e3372"></a><p>This chapter briefly describes server logging. For audit information,
 see the chapter on <a href="../integrators-guide/index.html#chap-auditing" class="link"><em class="citetitle">Using Audit
 Logs</em></a>.</p><p>You can configure logging by editing the
 <code class="filename">openidm/conf/logging.properties</code> file in
 OpenIDM.</p><p>The default configuration writes log messages in simple format to
 <code class="filename">openidm/logs/openidm*.log</code> files, rotating files when
 the size reaches 5 MB, and retaining up to 5 files. Also by default,
 OpenIDM writes all system and custom log messages to the files.</p><p>You can update the configuration to attach loggers to individual
 packages, setting the log level to one of the following values.</p><pre>
SEVERE (highest value)
WARNING
INFO
CONFIG
FINE
FINER
FINEST (lowest value)</pre><p>If you use <code class="literal">logger</code> functions in your scripts, then
 you can set the log level for the scripts:</p><pre class="literallayout">org.forgerock.openidm.script.javascript.JavaScript.level=<em class="replaceable"><code>level</code></em></pre><p> You can override the log level settings per script by using
 <code class="literal">org.forgerock.openidm.script.javascript.JavaScript.<em class="replaceable"><code>script-name</code></em>.level</code>.</p></div><div lang="en" class="chapter" id="chap-resource-conf"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;9.&nbsp;Connecting to External Resources</h1></div></div></div><a class="indexterm" name="d0e3416"></a><a class="indexterm" name="d0e3419"></a><a class="indexterm" name="d0e3422"></a><p>This chapter describes how to connect to external resources such
 as LDAP, Active Directory, flat files, and others. Configurations shown
 here are simplified to show essential aspects. Not all resources support
 all OpenIDM operations, however the resources shown here support
 most of the CRUD operations, and also reconciliation and LiveSync.</p><p>In OpenIDM, <em class="firstterm">resources</em> are external systems,
 databases, directory servers, and other sources of identity data to be managed
 and audited by the identity management system. OpenIDM connects to resources
 through the identity connector framework, <a class="link" href="http://openicf.forgerock.org/" target="_blank">OpenICF</a>. OpenICF aims to
 avoid the need to install agents to access resources, instead using the
 resources' native protocols. For example, OpenICF connects to database
 resources using the database's Java connection libraries or JDBC driver.
 It connects to directory servers over JNDI. It connects to UNIX systems
 by using <span class="command"><strong>ssh</strong></span>.</p><p>Connectors are configured through files named
 <code class="filename">openidm/conf/provisioner.openicf-<em class="replaceable"><code>name</code></em></code>
 where <em class="replaceable"><code>name</code></em> corresponds to the name of the
 connector. <span class="emphasis"><em>Do not include dash characters ( <code class="literal">-</code> )
 in the connector <em class="replaceable"><code>name</code></em>.</em></span> A number of 
 sample connectors are available in the <code class="filename">openidm/samples/provisioners
 </code> directory. To use these connectors, edit the configuration files 
 as required, and copy them to the <code class="filename">openidm/conf</code> directory.
 </p><div class="section" id="openidm-openicf"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.1.&nbsp;About OpenIDM &amp; OpenICF</h2></div></div></div><p>The following figure shows how OpenIDM can connect to resources
  through an OpenICF server. In most cases, the OpenICF server runs as part
  of OpenIDM.</p><div class="mediaobject" align="center" id="figure-openicfarch"><a class="fancybox" href="images/OpenICFArch.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_OpenICFArch.png" align="middle" alt="OpenICF architecture" title="The figure shows the basic architecture of OpenIDM with three&#xA;    connector servers, one built-in local Java connector server, and two&#xA;    remote, Java and .NET connector servers."></a></div><p>OpenICF provides a common service provider interface to allow identity
  services access to the resources that contain user information. OpenICF uses
  a connection server that can run as a local connector server inside OpenIDM,
  or as a remote connector server that is a standalone process.</p><p>A remote connector server is required when access libraries that cannot 
  be included as part of the OpenIDM process are needed. If a resource, such as 
  Microsoft ADSI, does not provide a connection library that can be included 
  inside the Java Virtual Machine, then OpenICF can use the native .dll with a 
  remote .NET connector server. (OpenICF connects to ADSI through a remote 
  connector server implemented as a .NET service.)</p><div class="panel panel-success"><div class="panel-heading"><h3 class="panel-title">Tip</h3></div><div class="panel-body"><p>Not only .NET connector servers but also Java connector servers can be 
   run as standalone, remote services. Run them as remote services for 
   scalability, or to have the service run in the cloud.</p><p>By default, and for convenience, OpenIDM includes a Java connector
   server that runs as a <code class="literal">"#LOCAL"</code> service.</p></div></div></div><div class="section" id="connector-info-provider-conf"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.2.&nbsp;Accessing Remote Connectors</h2></div></div></div><a class="indexterm" name="d0e3491"></a><p>When you configure remote connectors, you must use the connector info 
  provider service to connect through remote connector servers. The configuration is
  stored in the configuration file,
  <code class="filename">openidm/conf/provisioner.openicf.connectorinfoprovider.json</code>.
  A sample can be found under <code class="filename">openidm/samples/provisioners/</code>. 
  To use the file, edit it as required, and then copy it to the 
  <code class="filename">openidm/conf</code> directory.</p><p>The connector info provider service takes the following configuration:</p><pre class="codelisting prettyprint linenums lang-js">
{
  "connectorsLocation"     : string,
  "remoteConnectorServers" : [remoteConnectorServer objects]
}</pre><div class="variablelist"><div class="variablelist-title">Connector Info Provider Properties</div><dl class="variablelist"><dt><span class="term">connectorsLocation</span></dt><dd><p>string, optional</p><p>Specifies the directory where the OpenICF connectors are located. The
     default location is <code class="filename">openidm/connectors</code>.
     </p></dd><dt><span class="term"><a class="link" href="#remote-connector-server-object-properties" title="Remote Connector Server Properties">remoteConnectorServers</a></span></dt><dd><p>array of RemoteConnectorServer objects, optional</p><p>A list of remote connector servers managed by this service.</p></dd></dl></div><div class="variablelist" id="remote-connector-server-object-properties"><div class="variablelist-title">Remote Connector Server Properties</div><p>The following example shows a <code class="literal">remoteConnectorServer</code>
  object configuration.</p><pre class="codelisting prettyprint linenums lang-js">
{
  "name"               : "testServer",
  "host"               : "127.0.0.1",
  "port"               : 8759,
  "heartbeatInterval"  : 60,
  "useSSL"             : false,
  "timeout"            : 0,
  "key"                : "changeit",
  "trustManagers"      :
    [
       "X509TrustManager",
       "BlindTrustManager"
    ]
}</pre><p>OpenIDM supports the following remote connector server object
  properties.</p><dl class="variablelist"><dt><span class="term">name</span></dt><dd><p>string, required</p><p>The name of the remote connector server object. Used to identify the
    remote connector server in connector reference objects.</p></dd><dt><span class="term">host</span></dt><dd><p>string, required</p><p>Remote host to connect to.</p></dd><dt><span class="term">port</span></dt><dd><p>string, optional</p><p>
     Remote port to connect to. Default value: 8759</p></dd><dt><span class="term">heartbeatInterval</span></dt><dd><p>integer, optional</p><p>Specifies the interval, in seconds, at which heartbeat packets are 
    transmitted. If the connector server is unreachable, based on this heartbeat 
    interval, all services that use the connector server are made unavailable 
    until the connector server can be reached again. Default value: 60</p></dd><dt><span class="term">useSSL</span></dt><dd><p>boolean, optional</p><p>Specifies whether or not to use SSL to connect. Default value:
    <code class="literal">false</code></p></dd><dt><span class="term">timeout</span></dt><dd><p>integer, optional</p><p>Specifies the timeout (in milliseconds) to use for the connection.
    Default value: 0</p></dd><dt><span class="term">key</span></dt><dd><p>string, required</p><p>The secret key to use to authenticate to the remote connector
    server.</p></dd><dt><span class="term">trustManagers</span></dt><dd><p>not specified</p><p>Not implemented yet. The service uses the default JVM
    <code class="literal">TrustManager</code>.</p></dd></dl></div></div><div class="section" id="openicf-provisioner-conf"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.3.&nbsp;Configuring Connectors</h2></div></div></div><p>Connectors are configured through the OpenICF provisioner service. 
  Each connector configuration is stored in a file in the 
  <code class="filename">openidm/conf/</code> folder or under the same URL respectively. 
  Configuration files are named
  <code class="filename">openidm/conf/provisioner.openicf-<em class="replaceable"><code>name</code></em></code>
  where <em class="replaceable"><code>name</code></em> corresponds to the name of the
  connector. <span class="emphasis"><em>Do not include dash characters ( <code class="literal">-</code> )
  in the connector <em class="replaceable"><code>name</code></em>.</em></span> A number of 
  sample connectors are available in the <code class="filename">openidm/samples/provisioners
  </code> directory. To use these connectors, edit the configuration files 
  as required, and copy them to the <code class="filename">openidm/conf</code> directory.
  </p><p>The following example shows an OpenICF provisioner service
  configuration for an XML file resource.</p><pre class="codelisting prettyprint linenums lang-js">{
 "name"                    : "xml",
 "connectorRef"            : connector-ref-object,
 "poolConfigOption"        : pool-config-option-object,
 "operationTimeout"        : operation-timeout-object,
 "configurationProperties" : configuration-properties-object,
 "objectTypes"             : object-types-object,
 "operationOptions"        : operation-options-object
}</pre><div class="variablelist" id="connector-reference"><div class="variablelist-title">Connector Reference</div><p>The following example shows a connector reference object.</p><pre class="codelisting prettyprint linenums lang-js">
{
  "bundleName"       : "org.forgerock.openicf.connectors.file.xml",
  "bundleVersion"    : "",
  "connectorName"    : "com.forgerock.openicf.xml.XMLConnector",
  "connectorHostRef" : "host"
}</pre><dl class="variablelist"><dt><span class="term">bundleName</span></dt><dd><p>string, required</p><p>The <em class="replaceable"><code>ConnectorBundle-Name</code></em> of the OpenICF
     connector.</p></dd><dt><span class="term">bundleVersion</span></dt><dd><p>string, required</p><p>The <em class="replaceable"><code>ConnectorBundle-Version</code></em> of the
     OpenICF connector.</p></dd><dt><span class="term">connectorName</span></dt><dd><p>string, required</p><p>The Connector implementation class name.</p></dd><dt><span class="term">connectorHostRef</span></dt><dd><p>string, optional</p><p>The name of the RemoteConnectorServer object.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If the connector server is local and the connector .jar is
       installed in <code class="filename">openidm/bundle/</code> (currently not recommended), then the value
       must be
       <code class="literal">"osgi:service/org.forgerock.openicf.framework.api.osgi.ConnectorManager"</code>.</p></li><li class="listitem"><p>If the connector server is local and the connector .jar is
       installed in <code class="filename">openidm/connectors/</code>, then the value
       must be <code class="literal">"#LOCAL"</code>. This is currently the default location.</p></li></ul></div></dd></dl></div><div class="variablelist" id="pool-configuration-option"><div class="variablelist-title">Pool Configuration Option</div><p>The following example shows a pool configuration option object
   for the connection pool between OpenIDM and the OpenICF connector
   server.</p><pre class="codelisting prettyprint linenums lang-js">
{
  "maxObjects"                 : 10,
  "maxIdle"                    : 10,
  "maxWait"                    : 150000,
  "minEvictableIdleTimeMillis" : 120000,
  "minIdle"                    : 1
}</pre><dl class="variablelist"><dt><span class="term">maxObjects</span></dt><dd><p>Maximum number of idle and active objects.</p></dd><dt><span class="term">maxIdle</span></dt><dd><p>Maximum number of idle objects</p></dd><dt><span class="term">maxWait</span></dt><dd><p>The maximum time in milliseconds which the pool waits for an object
     before timing out. Zero means never time out.</p></dd><dt><span class="term">minEvictableIdleTimeMillis</span></dt><dd><p>Maximum time in milliseconds an object can be idle before it is
     removed. Zero means never time out.</p></dd><dt><span class="term">minIdle</span></dt><dd><p>The minimum number of idle objects.</p></dd></dl></div><div class="variablelist" id="operation-timeout"><div class="variablelist-title">Operation Timeout</div><p>This configuration sets the timeout per operation type.</p><pre class="codelisting prettyprint linenums lang-js">
{
  "CREATE"              : -1,
  "TEST"                : -1,
  "AUTHENTICATE"        : -1,
  "SEARCH"              : -1,
  "VALIDATE"            : -1,
  "GET"                 : -1,
  "UPDATE"              : -1,
  "DELETE"              : -1,
  "SCRIPT_ON_CONNECTOR" : -1,
  "SCRIPT_ON_RESOURCE"  : -1,
  "SYNC"                : -1,
  "SCHEMA"              : -1
}</pre><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>operation-name</code></em></span></dt><dd><p>Timeout in milliseconds</p><p>A value of <code class="literal">-1</code> disables the timeout.</p></dd></dl></div><div class="variablelist" id="configuration-properties"><div class="variablelist-title">Configuration Properties</div><p>This object contains the configuration for the connection between
   the connection server and the resource, and is therefore resource
   specific.</p><p>The following example shows a configuration properties object for
   the default XML sample resource connector.</p><pre class="codelisting prettyprint linenums lang-js">
{
  "xsdIcfFilePath": "samples/sample1/data/resource-schema-1.xsd",
  "xsdFilePath": "samples/sample1/data/resource-schema-extension.xsd",
  "xmlFilePath": "samples/sample1/data/xmlConnectorData.xml"
 }</pre><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>property</code></em></span></dt><dd><p>Individual properties depend on the type of connector.</p></dd></dl></div><div class="variablelist" id="object-types"><div class="variablelist-title">Object Types</div><a class="indexterm" name="d0e3813"></a><p>This configuration object specifies the supported object types. The
   property name defines the <code class="literal">objectType</code> used in the
   URI: <code class="literal">system/$<em class="replaceable"><code>systemName</code></em>/$<em class="replaceable"><code>objectType</code></em></code></p><p>The configuration is based on <a class="link" href="http://tools.ietf.org/html/draft-zyp-json-schema-03" target="_blank">JSON
   Schema</a> with extensions described below.</p><p>Attribute names which start and/or end with <code class="literal">__</code> are
   resource type specific attributes used by OpenICF for particular
   purposes, such as <code class="literal">__NAME__</code> as the naming attribute
   for objects on a resource.</p><pre class="codelisting prettyprint linenums lang-js">
{
  "account" :
  {
    "$schema" : "http://json-schema.org/draft-03/schema",
    "id" : "__ACCOUNT__",
    "type" : "object",
    "nativeType" : "__ACCOUNT__",
    "properties" :
    {
      "name" :
      {
        "type" : "string",
        "nativeName" : "__NAME__",
        "nativeType" : "JAVA_TYPE_PRIMITIVE_LONG",
        "flags" :
        [
          "NOT_CREATABLE",
          "NOT_UPDATEABLE",
          "NOT_READABLE",
          "NOT_RETURNED_BY_DEFAULT"
        ]
      },
      "groups" :
      {
        "type" : "array",
        "items" :
        {
          "type" : "string",
          "nativeType" : "string"
        },
        "nativeName" : "__GROUPS__",
        "nativeType" : "string",
        "flags" :
        [
          "NOT_RETURNED_BY_DEFAULT"
        ]
      },                
      "givenName" : {
         "type" : "string",
         "nativeName" : "givenName",
         "nativeType" : "string"
         },
    }
  }
}</pre><dl class="variablelist"><dt><span class="term">Object Level Extensions</span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">nativeType</span></dt><dd><p>string, optional</p><p>The native OpenICF object type.</p></dd></dl></div></dd><dt><span class="term">Property Level Extensions</span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">nativeType</span></dt><dd><p>string, optional</p><p>The native OpenICF attribute type.</p></dd><dt><span class="term">nativeName</span></dt><dd><p>string, optional</p><p>The native OpenICF attribute name.</p></dd><dt><span class="term">flags</span></dt><dd><p>string, optional</p><p>The native OpenICF attribute flags. The
        <em class="replaceable"><code>required</code></em> and
        <em class="replaceable"><code>multivalued</code></em> flags are defined by the JSON
        schema.</p><pre class="literallayout"><em class="replaceable"><code>required</code></em> = <code class="literal">"required" : true</code></pre><pre class="literallayout"><em class="replaceable"><code>multivalued</code></em> = <code class="literal">"type" : "array"</code></pre></dd></dl></div></dd></dl></div><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>Avoid using the dash character ( <code class="literal">-</code> ) in property
   names, like <code class="literal">last-name</code>, as dashes in names make
   JavaScript syntax more complex. If you cannot avoid the dash, then write
   <code class="literal">source['last-name']</code> instead of
   <code class="literal">source.last-name</code> in the java script scripts.</p></div></div><div class="variablelist" id="operation-options"><div class="variablelist-title">Operation Options</div><p>Operation options define how to act on specified operations.
   You can for example deny operations on specific resources to avoid
   OpenIDM accidentally updating a read-only resource during a synchronization
   operation.</p><pre class="codelisting prettyprint linenums lang-js">
{
  "SYNC" :
  {
    "denied" : true,
    "onDeny" : "DO_NOTHING",
    "objectFeatures" :
    {
      "__ACCOUNT__" :
      {
        "denied" : true,
        "onDeny" : "THROW_EXCEPTION",
        "operationOptionInfo" :
        {
          "$schema" : "http://json-schema.org/draft-03/schema",
          "id" : "FIX_ME",
          "type" : "object",
          "properties" :
          {
            "_OperationOption-float" :
            {
               "type" : "number",
               "nativeType" : "JAVA_TYPE_PRIMITIVE_FLOAT"
            }
          }
        }
      },
      "__GROUP__" :
      {
        "denied" : false,
        "onDeny" : "DO_NOTHING"
      }
    }
  }
}</pre><div class="itemizedlist"><p>The list of operations is as follows.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">AUTHENTICATE</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/AuthenticationApiOp.html" target="_blank">AuthenticationApiOp</a></p></li><li class="listitem"><p><code class="literal">CREATE</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/CreateApiOp.html" target="_blank">CreateApiOp</a></p></li><li class="listitem"><p><code class="literal">DELETE</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/DeleteApiOp.html" target="_blank">DeleteApiOp</a></p></li><li class="listitem"><p><code class="literal">GET</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/GetApiOp.html" target="_blank">GetApiOp</a></p></li><li class="listitem"><p><code class="literal">RESOLVEUSERNAME</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/ResolveUsernameApiOp.html" target="_blank">ResolveUsernameApiOp</a></p></li><li class="listitem"><p><code class="literal">SCHEMA</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/SchemaApiOp.html" target="_blank">SchemaApiOp</a></p></li><li class="listitem"><p><code class="literal">SCRIPT_ON_CONNECTOR</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/ScriptOnConnectorApiOp.html" target="_blank">ScriptOnConnectorApiOp</a></p></li><li class="listitem"><p><code class="literal">SCRIPT_ON_RESOURCE</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/ScriptOnResourceApiOp.html" target="_blank">ScriptOnResourceApiOp</a></p></li><li class="listitem"><p><code class="literal">SEARCH</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/SearchApiOp.html" target="_blank">SearchApiOp</a></p></li><li class="listitem"><p><code class="literal">SYNC</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/SyncApiOp.html" target="_blank">SyncApiOp</a></p></li><li class="listitem"><p><code class="literal">TEST</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/TestApiOp.html" target="_blank">TestApiOp</a></p></li><li class="listitem"><p><code class="literal">UPDATE</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/UpdateApiOp.html" target="_blank">UpdateApiOp</a></p></li><li class="listitem"><p><code class="literal">VALIDATE</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/ValidateApiOp.html" target="_blank">ValidateApiOp</a></p></li></ul></div><dl class="variablelist"><dt><span class="term">denied</span></dt><dd><p>boolean, optional</p><p>This property prevents operation execution if the value is
     <code class="literal">true</code>.</p></dd><dt><span class="term">onDeny</span></dt><dd><p>string, optional</p><p>If <code class="literal">denied</code> is <code class="literal">true</code>, then the
     service uses this value. Default value:
     <code class="literal">DO_NOTHING</code>.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">DO_NOTHING</code>: On operation the service does
       nothing.</p></li><li class="listitem"><p><code class="literal">THROW_EXCEPTION</code>: On operation the service
       throws a  <code class="literal">ForbiddenException</code> exception.</p></li></ul></div></dd></dl></div></div><div class="section" id="connector-examples"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.4.&nbsp;Connector Configuration Examples</h2></div></div></div><a class="indexterm" name="d0e4066"></a><p>This section explains provisioner configurations for common
  connectors. Also see <a class="xref" href="#connector-wiz" title="9.5.&nbsp;Creating Default Connector Configurations">Section&nbsp;9.5, &#8220;Creating Default Connector Configurations&#8221;</a> for instructions
  on interactively building connector configurations.</p><div class="section" id="xml-file-connector"><div class="titlepage"><div><div><h3 class="title">9.4.1.&nbsp;XML File Connector</h3></div></div></div><p>The following example shows an excerpt of the provisioner
   configuration for an XML file connector.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "connectorRef": {
        "connectorHostRef": "#LOCAL",
        "bundleName":
            "org.forgerock.openicf.connectors.file.file.openicf-xml-connector",
        "bundleVersion": "",
        "connectorName": "com.forgerock.openicf.xml.XMLConnector"
    }
}</pre><p>The connectorHostRef is optional if the connector server is
   local.</p><p>The configuration properties for the XML file connector set the
   relative path to the file containing the identity data, and also the paths
   to the XML schemas required.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "configurationProperties": {
        "xsdIcfFilePath": "samples/sample1/data/resource-schema-1.xsd",
        "xsdFilePath": "samples/sample1/data/resource-schema-extension.xsd",
        "xmlFilePath": "samples/sample1/data/xmlConnectorData.xml"
    }
}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">xmlFilePath</span></dt><dd><p>References the XML file containing account entries</p></dd><dt><span class="term">xsdIcfFilePath</span></dt><dd><p>References the XSD file defining schema common to all XML file
      resources. Do not change the schema defined in this file.</p></dd><dt><span class="term">xsdFilePath</span></dt><dd><p>References custom schema defining attributes specific to your
      project</p></dd></dl></div></div><div class="section" id="ldap-connector"><div class="titlepage"><div><div><h3 class="title">9.4.2.&nbsp;Generic LDAP Connector</h3></div></div></div><p>The following excerpt shows the <code class="literal">connectorRef</code>
   configuration property for connection to an LDAP server. When using the
   connect .jar provided in <code class="filename">openidm/connectors</code>, and
   when using a local connector server, the <code class="literal">connectorHostRef</code>
   property is optional.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "connectorRef": {
        "connectorHostRef": "#LOCAL",
        "connectorName": "org.identityconnectors.ldap.LdapConnector",
        "bundleName":
            "org.forgerock.openicf.connectors.ldap-connector",
        "bundleVersion": ""
    }
}</pre><p>The following excerpt shows settings for many connector configuration
   properties.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "accountSynchronizationFilter": null,
    "passwordAttributeToSynchronize": null,
    "synchronizePasswords": false,
    "removeLogEntryObjectClassFromFilter": true,
    "modifiersNamesToFilterOut": [],
    "passwordDecryptionKey": null,
    "credentials": "Passw0rd",
    "changeLogBlockSize": 100,
    "baseContextsToSynchronize": [
        "ou=People,dc=example,dc=com"
    ],
    "attributesToSynchronize": [
        "uid",
        "sn",
        "cn",
        "givenName",
        "mail",
        "description"
    ],
    "changeNumberAttribute": "changeNumber",
    "passwordDecryptionInitializationVector": null,
    "filterWithOrInsteadOfAnd": false,
    "objectClassesToSynchronize": [
        "inetOrgPerson"
    ],
    "port": 1389,
    "vlvSortAttribute": "uid",
    "passwordAttribute": "userPassword",
    "useBlocks": true,
    "maintainPosixGroupMembership": false,
    "failover": [],
    "ssl": false,
    "principal": "cn=Directory Manager",
    "baseContexts": [
        "dc=example,dc=com"
    ],
    "readSchema": true,
    "accountObjectClasses": [
        "top",
        "person",
        "organizationalPerson",
        "inetOrgPerson"
    ],
    "accountUserNameAttributes": [
        "uid",
        "cn"
    ],
    "host": "localhost",
    "groupMemberAttribute": "uniqueMember",
    "accountSearchFilter": null,
    "passwordHashAlgorithm": null,
    "usePagedResultControl": false,
    "blockSize": 100,
    "uidAttribute": "entryUUID",
    "maintainLdapGroupMembership": false,
    "respectResourcePasswordPolicyChangeAfterReset": false
}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">accountSynchronizationFilter</span></dt><dd><p>Used during synchronization actions to filter out LDAP
      accounts</p></dd><dt><span class="term">accountObjectClasses</span></dt><dd><p>The object classes used when creating new LDAP user objects.
      When specifying more than one object class, add each object class as its
      own property. For object classes that inherit from parents other than
      <code class="literal">top</code>, such as <code class="literal">inetOrgPerson</code>, specify
      all object classes in the class hierarchy.</p></dd><dt><span class="term">accountSearchFilter</span></dt><dd><p>Search filter that accounts must match</p></dd><dt><span class="term">accountUserNameAttributes</span></dt><dd><p>Attributes holding the account's user name. Used during
      authentication to find the LDAP entry matching the user name.</p></dd><dt><span class="term">attributesToSynchronize</span></dt><dd><p>List of attributes used during object synchronization. OpenIDM
      ignores change log updates that do not include any of the specified
      attributes. If empty, OpenIDM considers all changes.</p></dd><dt><span class="term">baseContexts</span></dt><dd><p>Base DNs for operations on the LDAP server</p></dd><dt><span class="term">baseContextsToSynchronize</span></dt><dd><p>Base DNs for entries taken into account during
      synchronization</p></dd><dt><span class="term">blockSize</span></dt><dd><p>Block size for simple paged results and VLV index searches,
      reflecting the maximum number of accounts retrieved at any one time</p></dd><dt><span class="term">changeLogBlockSize</span></dt><dd><p>Block size used when fetching change log entries</p></dd><dt><span class="term">changeNumberAttribute</span></dt><dd><p>Change log attribute containing the last change number</p></dd><dt><span class="term">credentials</span></dt><dd><p>Password to connect to the LDAP server</p></dd><dt><span class="term">failover</span></dt><dd><p>LDAP URLs specifying alternative LDAP servers to connect to if
      OpenIDM cannot connect to the primary LDAP server specified in the
      <code class="literal">host</code> and <code class="literal">port</code> properties</p></dd><dt><span class="term">filterWithOrInsteadOfAnd</span></dt><dd><p>In most cases, the filter to fetch change log entries is AND-based.
      If this property is set, the filter ORs the required change numbers
      instead.</p></dd><dt><span class="term">groupMemberAttribute</span></dt><dd><p>LDAP attribute holding members for non-POSIX static groups</p></dd><dt><span class="term">host</span></dt><dd><p>Primary LDAP server host name</p></dd><dt><span class="term">maintainLdapGroupMembership</span></dt><dd><p>If <code class="literal">true</code>, OpenIDM modifies group membership when
      entries are renamed or deleted.</p><p>In the sample LDAP connector configuration file provided with
      OpenIDM, this property is set to <code class="literal">false</code>. This means
      that LDAP group membership is not modified when entries are renamed or
      deleted in OpenIDM. To ensure that entries are removed from LDAP groups
      when the entries are deleted, set this property to <code class="literal">true</code>
      or enable referential integrity on the LDAP server. For OpenDJ, see
      <a class="link" href="http://docs.forgerock.org/en/opendj/2.6.0/admin-guide/index.html#referential-integrity" target="_top">
      <em class="citetitle">Configuring Referential Integrity</em></a> for more
      information.</p></dd><dt><span class="term">maintainPosixGroupMembership</span></dt><dd><p>If <code class="literal">true</code>, OpenIDM modifies POSIX group membership
      when entries are renamed or deleted.</p></dd><dt><span class="term">modifiersNamesToFilterOut</span></dt><dd><p>Use to avoid loops caused by OpenIDM's own changes</p></dd><dt><span class="term">objectClassesToSynchronize</span></dt><dd><p>OpenIDM synchronizes only entries having these object
      classes.</p></dd><dt><span class="term">passwordAttribute</span></dt><dd><p>Attribute to which OpenIDM writes the predefined PASSWORD
      attribute</p></dd><dt><span class="term">passwordAttributeToSynchronize</span></dt><dd><p>OpenIDM synchronizes password values on this attribute.</p></dd><dt><span class="term">passwordDecryptionInitializationVector</span></dt><dd><p>Initialization vector used to decrypt passwords when performing
      password synchronization</p></dd><dt><span class="term">passwordDecryptionKey</span></dt><dd><p>Key used to decrypt passwords when performing password
      synchronization</p></dd><dt><span class="term">passwordHashAlgorithm</span></dt><dd><p>Hash password values with the specified algorithm if the LDAP
      server stores them in clear text</p></dd><dt><span class="term">port</span></dt><dd><p>Primary LDAP server port number</p></dd><dt><span class="term">principal</span></dt><dd><p>Bind DN used to connect to the LDAP server</p></dd><dt><span class="term">readSchema</span></dt><dd><p>If <code class="literal">true</code>, read LDAP schema from the LDAP
      server.</p></dd><dt><span class="term">removeLogEntryObjectClassFromFilter</span></dt><dd><p>If <code class="literal">true</code>, the filter to fetch change log entries
      does not contain the <code class="literal">changeLogEntry</code> object class, and
      OpenIDM expects no entries with other object types in the change log.
      Default: <code class="literal">true</code></p></dd><dt><span class="term">respectResourcePasswordPolicyChangeAfterReset</span></dt><dd><p>If <code class="literal">true</code>, bind with the Password Expired and
      Password Policy controls, and throw
      <code class="literal">PasswordExpiredException</code> and other exceptions
      appropriately.</p></dd><dt><span class="term">ssl</span></dt><dd><p>If <code class="literal">true</code>, the specified port listens for
      LDAPS connections.</p></dd><dt><span class="term">synchronizePasswords</span></dt><dd><p>If <code class="literal">true</code>, synchronize passwords.</p></dd><dt><span class="term">uidAttribute</span></dt><dd><p>OpenIDM maps <code class="literal">uid</code> to the specified
      attribute.</p></dd><dt><span class="term">useBlocks</span></dt><dd><p>If <code class="literal">true</code>, use block-based LDAP controls like
      simple paged results and virtual list view.</p></dd><dt><span class="term">usePagedResultControl</span></dt><dd><p>If <code class="literal">true</code>, use simple paged results rather than
      virtual list view when both are available.</p></dd><dt><span class="term">vlvSortAttribute</span></dt><dd><p>Attribute used as the sort key for virtual list view</p></dd></dl></div><p>If you use the LDAP connector over SSL, you must set the
   <code class="literal">ssl</code> property to <code class="literal">true</code> in the provisioner
   configuration file. You must also specify the path to a truststore in the
   <code class="filename">system.properties</code> file. A truststore is provided by
   default at <code class="filename">openidm/security/truststore</code>. Add the
   following line to the <code class="filename">system.properties</code> file,
   substituting the path to your own truststore if you do not want to use the
   default.</p><pre class="codelisting prettyprint">
# Set the truststore
javax.net.ssl.trustStore=/path/to/openidm/security/truststore
   </pre></div><div class="section" id="active-directory-connector"><div class="titlepage"><div><div><h3 class="title">9.4.3.&nbsp;Active Directory Connector</h3></div></div></div><p>In contrast to most other connectors, the Active Directory connector
   is written not in Java, but instead in .NET. OpenICF should connect to
   Active Directory over ADSI, the native connection protocol for Active
   Directory. The connector therefore requires a connector server that has
   access to the ADSI .dll files.</p><div class="section" id="install-.net-connector"><div class="titlepage"><div><div><h4 class="title">9.4.3.1.&nbsp;Installing and Configuring a .NET Connector</h4></div></div></div><p>A .NET connector server is useful when an application is written
    in Java, but a connector bundle is written using C#. Because a Java application
    (for example, a J2EE application) cannot load C# classes, it is necessary to
    deploy the C# bundles under a .NET connector server. The Java application can
    communicate with the C# connector server over the network, and the C#
    connector server acts as a proxy to provide access to the C# bundles that are
    deployed within the C# connector server, to any authenticated application.
    </p><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The .NET connector server requires version 4.0.30319
                    of the .NET framework.</p></li><li class="listitem"><p>By default, the connector server outputs log messages to
                    <code class="filename">C:&gt; </code>. If you do not have permission to
                    write to the root of the hard drive, an error is generated.
                    To change the location of the log file, set the
                    <code class="literal">initializeData</code> parameter in the trace
                    settings of the configuration file.</p></li></ul></div></div></div><div class="procedure" id="d0e4445"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;9.1.&nbsp;Installing the .NET Connector Server</div><ol class="procedure" type="1"><li class="step"><p>Download the OPENICF .NET Connector Server from the OpenIDM download
     page under the ForgeRock <a class="link" href="http://forgerock.com/download-stack/" target="_blank">Open Stack download page</a>.
     </p></li><li class="step"><p>Execute ServiceInstall--dotnet.msi.
     </p></li><li class="step"><p>Complete the wizard.
     </p></li></ol></div></div><p>When the wizard has run, the Connector Server is installed as a
   Windows Service.</p><div class="procedure" id="d0e4462"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;9.2.&nbsp;Running the .NET Connector Server</div><p>The .NET Connector Server can be started one of two ways.
    </p><ol class="procedure" type="1"><li class="step"><p>In the Microsoft Service Console, go to <code class="literal">Start</code>, type 
     <code class="literal">Services</code>, <code class="literal">Services</code>.
     </p><p>or</p></li><li class="step"><p>In the command prompt, go to <code class="literal">Start</code>, type <code class="literal">cmd</code>,
     then <code class="literal">cmd</code> again.
     </p></li><li class="step"><p>Change the directory to the location where the Connector Server was installed.
     The default location is <code class="literal">Program Files/Identity Connectors/Connector Server</code>.
     </p></li><li class="step"><p>Enter <code class="literal">cd Program Files (x86)/Identity Connectors/Connector Server</code>.
     </p></li><li class="step"><p>Start the server with the following command: 
      </p><pre class="cmdline prettyprint">ConnectorServer.exe/run</pre><p>.
     </p></li></ol></div></div><div class="procedure" id="d0e4511"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;9.3.&nbsp;Configuring the .NET Connector Server</div><p>After starting the Microsoft Services Console, follow these steps to configure
     the .NET Connector Server.
     </p><ol class="procedure" type="1"><li class="step"><p>Check to see if the Connector Server is currently running. If so, stop it. 
      All configuration changes require that the Connector Server be stopped and
      restarted after the changes are saved.
      </p></li><li class="step"><p>At the command prompt (click <code class="literal">Start</code>, <code class="literal">Run</code>,
      then type <code class="literal">cmd</code>, set the key for the Connector Server by changing
      to the directory where the Connector Server was installed and executing the
      following command, using a string value for <code class="literal">newkey</code>:
      </p><pre class="cmdline prettyprint">ConnectorServer.exe /setkey &lt;newkey&gt;</pre><p>This key is used by clients connecting to the Connector Server.</p></li><li class="step"><p>Review the <code class="filename">ConnectorServer.exe.config</code> file to verify
      additional configuration, including the port, address, and SSL settings in
      the <code class="filename">AppSettings</code>.
     
     </p><pre class="cmdline prettyprint">&lt;add key="connectorserver.port" value="8759" /&gt;
&lt;add key="connectorserver.usessl" value="false" /&gt;
&lt;add key="connectorserver.certificatestorename" value="ConnectorServerSSLCertificate" /&gt;
&lt;add key="connectorserver.ipaddress" value="0.0.0.0" /&gt;
</pre><p>
      </p><p>The port can be set by changing the value of <code class="literal">connectorserver.port</code>.
      The listening socket can be bound to a particular address, or can be left as 0.0.0.0.
      </p><p>To configure the server to use SSL, set the value of
      <code class="literal">connectorserver.usessl</code> to <code class="literal">true</code> and set
      the value of <code class="filename">connectorserver.certifacatestorename</code> to
      the certificate store name.
      </p></li><li class="step"><p>Trace settings are also in the configuration file.
      </p><pre class="cmdline prettyprint">&lt;system.diagnostics&gt;
&lt;trace autoflush="true" indentsize="4"&gt;
&lt;listeners&gt;
&lt;remove name="Default" /&gt;
&lt;add name="myListener" type="System.Diagnostics.TextWriterTraceListener" 
initializeData="c:\connectorserver2.log" traceOutputOptions="DateTime"&gt;
&lt;filter type="System.Diagnostics.EventTypeFilter" initializeData="Information" /&gt;
&lt;/add&gt;
&lt;/listeners&gt;
&lt;/trace&gt;
&lt;/system.diagnostics&gt;
      </pre><p>The Connector Server uses the standard .NET trace mechanism. 
      For more information about the tracing options, see <a class="link" href="http://msdn.microsoft.com/en-us/library/15t15zda(v=vs.71).aspx" target="_blank">Microsoft's .NET documentation</a> for <code class="literal">System.Diagnostics</code>.
      </p><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>The default settings are a good starting point, but for less tracing, 
       you can change the EventTypeFilter's initializeData to "Warning" or "Error". 
       For very verbose logging you can set the value to "Verbose" or "All". The 
       amount of logging performed has a direct effect on the performance of the 
       Connector Servers, so be careful of the setting.
       </p></div></div></li><li class="step"><p>Download the AD Connector from the OpenIDM download page under the
      ForgeRock <a class="link" href="http://forgerock.com/download-stack/" target="_blank">Open Stack download page</a>.
      </p></li><li class="step"><p>Unzip the directory in the Connector Server folder.
      </p></li><li class="step"><p>Start the Connector Server service.
      </p></li></ol></div></div><div class="procedure" id="d0e4594"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;9.4.&nbsp;Configuring the .NET Connector Server with OpenIDM</div><p>When you configure remote connectors, you must use the connector 
     info provider service to connect through remote connector servers. 
     The configuration is stored in the configuration file, 
     <code class="filename">openidm/conf/provisioner.openicf.connectorinfoprovider.json</code>. 
     A sample can be found under <code class="literal">openidm/samples/provisioners/</code>.
     </p><ol class="procedure" type="1"><li class="step"><p>Make sure that OpenIDM is running and copy the 
      <code class="filename">provisioner.openicf.connectorinfoprovider.json</code> to 
      <code class="literal">/path/to/openidm/conf</code> and edit it as needed.
      </p><pre class="cmdline prettyprint">$ cd path/to/openidm
$ cp samples/provisioners/provisioner.openicf.connectorinfoprovider.json conf/
      </pre></li><li class="step"><p>Create the connector file <code class="filename">provisioner.openicf-ad.json</code> 
      in <code class="literal">conf/ directory</code>. The following is an example of what the
      <code class="literal">name</code>, <code class="literal">bundleVersion</code>, and a few other
      configuration properties will look like.
      </p><pre class="cmdline prettyprint">
      {
"name" : "ad",
"connectorRef" : {
"connectorHostRef" : "dotnet",
"connectorName" : "Org.IdentityConnectors.ActiveDirectory.ActiveDirectoryConnector",
"bundleName" : "ActiveDirectory.Connector",
"bundleVersion" : "1.0.0.0"
},
"poolConfigOption" : {
"maxObjects" : 10,
"maxIdle" : 10,
"maxWait" : 150000,
"minEvictableIdleTimeMillis" : 120000,
"minIdle" : 1
},
"operationTimeout" : {
"SYNC" : -1,
"TEST" : -1,
"SEARCH" : -1,
"RESOLVEUSERNAME" : -1,
"SCRIPT_ON_CONNECTOR" : -1,
"VALIDATE" : -1,
"DELETE" : -1,
"UPDATE" : -1,
"AUTHENTICATE" : -1,
"CREATE" : -1,
"SCRIPT_ON_RESOURCE" : -1,
"GET" : -1,
"SCHEMA" : -1
},
"configurationProperties" : {
"DirectoryAdminName" : "EXAMPLE\\Administrator",
"DirectoryAdminPassword" : {
"$crypto" : {
"value" : {
"iv" : "QJctjWJi9w2uPLsO2Pucfw==",
"data" : "Akqzk1PW0m9QP5cfOMIuYw==",
"cipher" : "AES/CBC/PKCS5Padding",
"key" : "openidm-sym-default"
},
"type" : "x-simple-encryption"
}
},
"ObjectClass" : "User",
"Container" : "dc=example,dc=com",
"CreateHomeDirectory" : true,
"LDAPHostName" : "10.0.0.2",
"SearchChildDomains" : false,
"DomainName" : "example",
"SyncGlobalCatalogServer" : null,
"SyncDomainController" : null,
"SearchContext" : ""
}</pre></li><li class="step"><p>Edit the <code class="literal">configurationProperties</code> according to your 
      setup and make sure that the <code class="literal">bundleVersion</code> is the same
      version as <code class="filename">ActiveDirectory.Connector.dll</code> in the Windows
      Connector Server folder. (Right click on the <code class="literal">dll</code>, 
      <code class="literal">properties</code>, <code class="literal">tab details</code>, and <code class="literal">Product 
      version</code>.)
      </p></li><li class="step"><p>Make sure the connector was installed properly using the following command:
      </p><pre class="cmdline prettyprint">scr list
      </pre><p>This should return all of the installed modules, including the following:
      </p><pre class="cmdline prettyprint">
[  24] [active       ] org.forgerock.openidm.provisioner.openicf</pre><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>The number may differ. Make sure to note the number returned.</p></div></div><p>Review the content of the connector using the following command, using 
      the number returned from the previous step:
      </p><pre class="cmdline prettyprint">scr info &lt;your number&gt;</pre></li><li class="step"><p>Create the <code class="filename">sync.json</code> file where you define mappings
      of various attributes and behaviors during reconciliation. The following is a 
      simple example of a <code class="filename">sync.json</code>.
      </p><pre class="cmdline prettyprint">{ 
"mappings" : [ 
{ 
"name" : "systemADAccounts_managedUser", 
"source" : "system/ad/account", 
"target" : "managed/user", 
"properties" : [ 
 { 
   "source" : "sAMAccountName", 
    "target" : "userName" 
 }, 
 { 
    "source" : "sn", 
    "target" : "lastname" 
 }, 
 { 
    "source" : "givenName", 
    "target" : "firstname" 
    } 
   ] 
  }
 ]
}</pre></li><li class="step"><p>Run the reconciliation with the following command. 
      </p><pre class="cmdline prettyprint">$ curl --header "X-OpenIDM-Username: openidm-admin" --header "X-OpenIDM-Password: 
openidm-admin" --request POST  "http://localhost:8080/openidm/recon?
_action=recon&amp;mapping=systemADAccounts_managedUser"</pre><p>This will return a reconciliation id similar to the following:
      </p><pre class="cmdline prettyprint">{"_id":"0629d920-e29f-4650-889f-4423632481ad"}</pre></li><li class="step"><p>Check the internal repository (OrientDB or MySQL) to make sure that
      the users were reconciled. For information about connecting to OrientDB,
      see <a href="../install-guide/index.html#before-you-begin-sample" class="link">
      <em class="citetitle">Before You Begin</em></a> in the
      <em class="citetitle">Installation Guide</em>. For information about using
      MySQL as a repository, see <a href="../install-guide/index.html#chap-repository" class="link">
      <em class="citetitle">Installing a Repository For Production</em></a> in the
      <em class="citetitle">Installation Guide</em>.
      </p></li></ol></div></div></div><div class="section" id="install-standalone-connector"><div class="titlepage"><div><div><h4 class="title">9.4.3.2.&nbsp;Installing a Standalone Java Connector Server</h4></div></div></div><p>It may be necessary to set up a remote Java Connector Server (JSC). This
    section provides directions for setting up the standalone connecter on
    Unix/Linux and Windows.
    </p><div class="procedure" id="d0e4717"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;9.5.&nbsp;Installing a Standalone Connector Server for Unix/Linux</div><ol class="procedure" type="1"><li class="step"><p>Download the OPENICF JAVA Connector Server from the OpenIDM
       download page under the ForgeRock <a class="link" href="http://forgerock.com/download-stack/" target="_blank">Open Stack download page</a>.
       </p></li><li class="step"><p>Run the terminal and unpack it. The following command will unzip the file
       in the current folder, so make sure to move to the appropriate location prior to
       running the command.
       </p><pre class="cmdline prettyprint">unzip openicf--java.zip</pre></li><li class="step"><p>Change the directory to OpenICF using the following command:
       </p><pre class="cmdline prettyprint">$ cd path/to/openicf</pre></li><li class="step"><p>If needed, secure the communication between OpenIDM and JCS. The JCS 
       uses a property called <code class="literal">secret key</code> to authenticate the connection. 
       The default secret key value is <code class="literal">changeit</code>. To change the value 
       of the secret key enter the following, replacing <code class="literal">newkey</code>
       with the your own string value:
       </p><pre class="cmdline prettyprint">java - cp "./lib/framework/*" org.identityconnectors.framework.server.Main 
       -setKey -key &lt;newkey&gt; -properties ./conf/ConnectorServer.properties</pre><p>
       </p></li><li class="step"><p>Review the <code class="filename">ConnectorServer.properties</code> in the 
       <code class="literal">/conf</code> directory, and make changes as necessary. The file 
       contains setting information, including things like ports, the allowance of 
       one/all IP addresses, and SSL. The file provides the required information to 
       update these settings.
       </p></li><li class="step"><p>Run the JCS.
       </p><pre class="cmdline prettyprint">java -cp "./lib/framework/*"
org.identityconnectors.framework.server.Main -run -properties 
./conf/ConnectorServer.properties</pre></li><li class="step"><p>If necessary, you can stop the JCS by pressing <code class="literal">^C</code>.
       </p></li></ol></div></div><div class="procedure" id="d0e4771"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;9.6.&nbsp;Installing a Standalone Connector Server for Windows</div><ol class="procedure" type="1"><li class="step"><p>Download the OPENICF JAVA Connector Server from the OpenIDM
       download page under the ForgeRock <a class="link" href="http://forgerock.com/download-stack/" target="_blank">Open Stack download
       page</a>.
       </p></li><li class="step"><p>Unpack the zip file in the desired location, for example 
       <code class="literal">C:\openicf</code>.
       </p></li><li class="step"><p>Run the command line (<code class="literal">Start</code>, type <code class="literal">cmd</code>,
       and <code class="literal">cmd</code>) and change the working directory to 
       <code class="literal">openicf\bin cd c:\openicf\bin</code>
       </p></li><li class="step"><p>Change the directory to OpenICF using the following command:
       </p><pre class="cmdline prettyprint">$ cd path/to/openicf</pre></li><li class="step"><p>If needed, secure the communication between OpenIDM and JCS. The JCS 
       uses a property called <code class="literal">secret key</code> to authenticate the connection. 
       The default secret key value is <code class="literal">changeit</code>. 
       </p><p>To change the value 
       of the secret key enter the following, replacing <code class="literal">newkey</code>
       with the your own string value:
       </p><pre class="cmdline prettyprint">/ConnectorServer.bat /setkey &lt;newkey&gt;</pre><p>
       </p></li><li class="step"><p>Review the <code class="filename">ConnectorServer.properties</code> in the 
       <code class="literal">/conf</code> directory, and make changes as necessary. The file 
       contains setting information, including things like ports, the allowance of 
       one/all IP addresses, and SSL. The file provides the required information to 
       update these settings.
       </p></li><li class="step"><p>If you would like the JCS to run as a Windows service, enter the following
       command.
       </p><pre class="cmdline prettyprint">./ConnecorServer.bat /install (for uninstalling use /uninstall )</pre><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>If you install JCS as a Windows service you can start/stop it by 
        Microsoft's Service Console (<code class="literal">Start</code>, type <code class="literal">Service</code>,
        and <code class="literal">Service</code>). The JCS service is called: 
        <code class="literal">OpenICFConnectorServerJava</code>.
        </p></div></div><p>Or</p><p>If you would like to run the JCS from command line, enter the following 
       command:
       </p><pre class="cmdline prettyprint">.\ConnectorServer.bat /run</pre></li><li class="step"><p>If necessary, stop the JCS by pressing <code class="literal">^C</code>.
       </p></li></ol></div></div><p>You can view the log files in the <code class="literal">openicf/logs</code> directory.
       </p><div class="section" id="example-mysql-jcs-reconciliation"><div class="titlepage"><div><div><h5 class="title">MySQL Database Example to Reconcile JCS Users</h5></div></div></div><p>This sample demonstrates using reconciliation of users stored in a MySQL 
      database on a remote machine. The JCS runs on the same machine as the MySQL 
      database and mediates the connection between OpenIDM and MySQL database.
      </p><div class="procedure" id="d0e4874"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;9.7.&nbsp;Configuring JCS</div><ol class="procedure" type="1"><li class="step"><p>Download <a class="link" href="http://www.mysql.com/downloads/connector/j/" target="_blank">MySQL JDBC Driver</a>.        
          </p></li><li class="step"><p>Unpack the <code class="filename">MySQL JDBC Driver</code> and copy the 
          <code class="filename">mysql-connector-java-5.1.22-bin.jar</code> to the
          <code class="literal">openicf/lib</code> directory.
          </p></li><li class="step"><p>Go to the <code class="literal">/tools</code> directory. The groovy scripts in the folder
         run on the JCS side. Copy them from <code class="literal">path/to/openidm/sample/sample3/tools</code>
         folder to <code class="literal">openicf/</code>.
          </p></li></ol></div></div><div class="procedure" id="d0e4907"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;9.8.&nbsp;Configuring OpenIDM for the MySQL Database Example</div><ol class="procedure" type="1"><li class="step"><p>Start OpenIDM. You can ignore errors like <code class="literal">cannot
          connect to database</code> and <code class="literal">cannot find jdbc driver</code>.
          These errors will be fixed once OpenIDM is configured and restarted.
          </p></li><li class="step"><p>Go to the <code class="filename">provisioner.openicf.connectorinfoprovider.json</code>
          to see information about your remote connector servers. Copy this file from 
          <code class="literal">openidm/samples/provisioners</code> to <code class="literal">openidm/conf</code>.
          </p><p>For Unix/Linux, enter the following in Terminal.
          </p><pre class="cmdline prettyprint">$ cd path/to/openidm
$ cp samples/provisioners/provisioner.openicf.connectorinfoprovider.json ./conf</pre><p>For Windows, enter the following on the command line.
          </p><pre class="cmdline prettyprint">c:\&gt; cd path/to/openidm
.\&gt; copy .\samples\provisioners\provisioner.openicf.connectorinfoprovider.json .\conf</pre></li><li class="step"><p>Edit the <code class="filename">provisioner.openicf.connectorinfoprovider.json</code>
          to meet your needs. The following is an example.
          </p><pre class="cmdline prettyprint">{ 
	    "connectorsLocation" : "connectors", 
	    "remoteConnectorServers" : [ 
	        { 
	            "name" : "mysql", 
	            "host" : "10.0.0.2", 
	            "port" : 8759, 
	            "useSSL" : false, 
	            "timeout" : 0, 
	            "key" : "password" 
	        } 
	    ], 
	}</pre></li><li class="step"><p>Copy all of the files from <code class="literal"> openidm/samples/sample3/conf</code>
           to <code class="literal">openidm/conf</code>.
          </p><p>For Unix/Linux, enter the following in Terminal.
          </p><pre class="cmdline prettyprint">$ cp -r ./samples/sample3/conf ./conf</pre><p>For Window, enter the following on the command line.
          </p><pre class="cmdline prettyprint">.\&gt; copy .\samples\sample3\conf\ .\conf\</pre></li><li class="step"><p>Edit the <code class="literal">provisioner.openicf-scriptedsql.json</code> to read
          like the following.
          </p><pre class="cmdline prettyprint">{ 
	    "name" : "hrdb", 
	    "connectorRef" : { 
	        "connectorHostRef" : "mysql", 
	        "bundleName" : "org.forgerock.openicf.connectors.db.openicf-scriptedsql
	        -connector", 
	        "bundleVersion" : "",
	        "connectorName" : "org.forgerock.openicf.scriptedsql.ScriptedSQLConnector" 
	    }, 
	    "producerBufferSize" : 100, 
	    "connectorPoolingSupported" : true, 
	    "poolConfigOption" : { 
	        "maxObjects" : 10, 
	        "maxIdle" : 10, 
	        "maxWait" : 150000, 
	        "minEvictableIdleTimeMillis" : 120000, 
	        "minIdle" : 1 
	    }, 
	    "operationTimeout" : { 
         "CREATE" : -1, 
	        "TEST" : -1, 
	        "AUTHENTICATE" : -1, 
	        "SEARCH" : -1, 
	        "VALIDATE" : -1, 
	        "GET" : -1, 
	        "UPDATE" : -1, 
	        "DELETE" : -1, 
	        "SCRIPT_ON_CONNECTOR" : -1, 
	        "SCRIPT_ON_RESOURCE" : -1, 
	        "SYNC" : -1, 
	        "SCHEMA" : -1 
	    }, 
	    "configurationProperties" : { 
	        "host" : "10.0.0.2", 
	        "port" : "3306", 
	        "user" : "root", 
	        "password" : { 
	            "$crypto" : { 
	                "value" : { 
	                    "iv" : "dsrEhCU45UakY6Uh9Jxfww==", 
	                    "data" : "X1+77+0I7Yog/6ZirsFSyg==", 
	                    "cipher" : "AES/CBC/PKCS5Padding", 
	                    "key" : "openidm-sym-default" 
	                }, 
	                "type" : "x-simple-encryption" 
	            } 
	        }, 
	        "database" : "HRDB", 
	        "autoCommit" : true, 
	        "reloadScriptOnExecution" : false, 
	        "keyColumn" : "uid", 
	        "jdbcDriver" : "com.mysql.jdbc.Driver", 
	        "jdbcConnectionUrl" : "jdbc:mysql://10.0.0.2:3306/HRDB", 
	        "jdbcUrlTemplate" : "jdbc:mysql://%h:%p/%d", 
	        "createScriptFileName" : "/home/tester/openicf/tools/CreateScript.groovy", 
	        "testScriptFileName" : "/home/tester/openicf/tools/TestScript.groovy", 
	        "searchScriptFileName" : "/home/tester/openicf/tools/SearchScript.groovy", 
	        "deleteScriptFileName" : "/home/tester/openicf/tools/DeleteScript.groovy", 
	        "updateScriptFileName" : "/home/tester/openicf/tools/UpdateScript.groovy", 
	        "syncScriptFileName" : "/home/tester/openicf/tools/SyncScript.groovy" 
	    }, 
	    "objectTypes" : { 
	        "group" : { 
	            "$schema" : "http://json-schema.org/draft-03/schema", 
	            "id" : "__GROUP__", 
	            "type" : "object", 
	            "nativeType" : "__GROUP__", 
	            "properties" : { 
	                "name" : { 
	                    "type" : "string", 
	                    "required" : true, 
	                    "nativeName" : "__NAME__", 
	                    "nativeType" : "string" 
	                }, 
	                "gid" : { 
	                    "type" : "string", 
	                    "required" : true, 
	                    "nativeName" : "gid", 
	                    "nativeType" : "string" 
	                }, 
	                "description" : { 
	                    "type" : "string", 
	                    "required" : false, 
	                    "nativeName" : "description", 
	                    "nativeType" : "string" 
	                } 
	            } 
	        }, 
	        "organization" : { 
	            "$schema" : "http://json-schema.org/draft-03/schema", 
	            "id" : "organization", 
	            "type" : "object", 
	            "nativeType" : "organization", 
	            "properties" : { 
	                "name" : { 
	                    "type" : "string", 
	                    "required" : true, 
	                    "nativeName" : "__NAME__", 
	                    "nativeType" : "string" 
	                }, 
	                "description" : { 
	                    "type" : "string", 
	                    "required" : false, 
	                    "nativeName" : "description", 
	                    "nativeType" : "string" 
	                } 
	            } 
	        }, 
	        "account" : { 
	            "$schema" : "http://json-schema.org/draft-03/schema", 
	            "id" : "__ACCOUNT__", 
	            "type" : "object", 
	            "nativeType" : "__ACCOUNT__", 
	            "properties" : { 
	                "firstName" : { 
	                    "type" : "string", 
	                    "nativeName" : "firstname", 
	                    "nativeType" : "string", 
	                    "required" : true 
	                }, 
	                "email" : { 
	                    "type" : "array", 
	                    "items" : { 
	                        "type" : "string", 
	                        "nativeType" : "string" 
	                    }, 
	                    "nativeName" : "email", 
	                    "nativeType" : "string" 
	                }, 
	                "__PASSWORD__" : { 
	                    "type" : "string", 
	                    "nativeName" : "password", 
	                    "nativeType" : "JAVA_TYPE_GUARDEDSTRING", 
	                    "flags" : [ 
	                        "NOT_READABLE", 
	                        "NOT_RETURNED_BY_DEFAULT" 
	                    ] 
	                }, 
	                "uid" : { 
	                    "type" : "string", 
	                    "nativeName" : "__NAME__", 
	                    "required" : true, 
	                    "nativeType" : "string" 
	                }, 
	                "fullName" : { 
	                    "type" : "string", 
	                    "nativeName" : "fullname", 
	                    "nativeType" : "string" 
	                }, 
	                "lastName" : { 
	                    "type" : "string", 
	                    "required" : true, 
	                    "nativeName" : "lastname", 
	                    "nativeType" : "string" 
	                }, 
	                "organization" : { 
	                    "type" : "string", 
	                    "required" : true, 
	                    "nativeName" : "organization", 
	                    "nativeType" : "string" 
	                } 
	            } 
	        } 
	    }, 
	    "operationOptions" : { } 
	}</pre></li><li class="step"><p>Verify that the following settings are correct.
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The value of <code class="literal">connectorHostRef : mysql</code> points
             to the property <code class="literal">name</code> of 
             <code class="filename">provisioner.openicf.connectorinfoprovider.json</code>. This 
             indicates which connectorinfoprovider to use.
             </p></li><li class="listitem"><p>The <code class="filename">bundleVersion : </code> must be
             exactly the same as <code class="filename">openicf-scriptedsql-connector-.jar</code>.
             on JCS <code class="literal">/bundles</code>. Unpack the <code class="literal">.jar</code>
             file, open <code class="filename">META-INF/MANIFEST.MF</code>, and search for the
             <code class="literal">Bundle-Version</code> property.
             </p></li><li class="listitem"><p>The path to groovy scripts should be <code class="literal">createScriptFileName : 
             /home/tester/openicf/tools/CreateScript.groovy</code>.
             </p><p>For Windows, the path will follow Unix notation. For example the path 
             could be <code class="literal">Program Files (x86)/openicf/tools/CreateScript.groovy</code>,
             which in Windows notation would be 
             <code class="literal">C:\Program Files (x86)\openicf\tools\CreateScript.groovy</code>.
             </p></li><li class="listitem"><p>All instances of the connection setting must be properly set,
             for example, <code class="literal">jdbcConnectionUrl : jdbc:mysql://10.0.0.2:3306/HRDB</code>.
             </p></li></ul></div></li><li class="step"><p>Restart OpenIDM to verify that all of the configuration changes have
          occurred. There should be no error message when OpenIDM is restarted. To check
          run the following.
          </p><pre class="cmdline prettyprint">src list</pre><p>This returns a list of installed modules, including the following:
          </p><pre class="cmdline prettyprint">[  17] [active       ] org.forgerock.openidm.provisioner.openicf</pre><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>The number may differ. Make sure to note the number returned.</p></div></div><p>When you have installed more connectors, there will be more OpenICF
          modules. If the state of the module is active, the module is installed properly.
          If the state is unsatisfied, then you have not configured it correctly and you
          must check your configuration. You can also check the content of installed module 
          (which could be handy if you have unsatisfied state and you want to see if the 
          content is the same as in <code class="filename">*.json</code> &#8211; to verify that the 
          configuration you just set was picked up). To list the content of the module 
          use the following with the number returned from the previous step:
          </p><pre class="cmdline prettyprint">scr info 17 &lt;your number&gt;</pre><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>You can also check the <code class="filename">provisioner.openicf.connectorinfoprovider</code>
           </p></div></div></li><li class="step"><p>Run reconciliation with the following command:
          </p><pre class="cmdline prettyprint">$ curl --header "X-OpenIDM-Username: openidm-admin"  
--header "X-OpenIDM-Password: openidm-admin"  --request POST 
"http://localhost:8080/openidm/recon?_action=recon&amp;mapping=systemHrdb_managedUser"</pre><p>This will return a reconciliation id similar to the following:
          </p><pre class="cmdline prettyprint">{"_id":"a5346543-db9a-4f8b-ba25-af2a1b576a54"}</pre></li><li class="step"><p>Check the internal repository (OrientDB or MySQL) to make sure that
             the users were reconciled. For information about connecting to OrientDB,
             see <a href="../install-guide/index.html#before-you-begin-sample" class="link">
             <em class="citetitle">Before You Begin</em></a> in the
             <em class="citetitle">Installation Guide</em>. For information about using
             MySQL as a repository, see <a href="../install-guide/index.html#chap-repository" class="link">
             <em class="citetitle">Installing a Repository For Production</em></a> in the
             <em class="citetitle">Installation Guide</em>.
             </p></li></ol></div></div></div></div><div class="section" id="example-xml-jcs-reconciliation"><div class="titlepage"><div><div><h4 class="title">9.4.3.3.&nbsp;XML Example to Reconcile JCS Users</h4></div></div></div><p>This sample demonstrates using reconciliation of users created in an XML 
      folder on a remote machine. The JCS provides a way for OpenIDM to pick up and 
      synchronize the OpenIDM repository with the remote XML user repository.
      </p><div class="procedure" id="d0e5087"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;9.9.&nbsp;Configuring JCS</div><ul class="procedure"><li class="step"><p>Copy the <code class="literal">openidm/samples/sample1/data</code> directory to
          a location on the JCS machine.
          </p></li></ul></div></div><div class="procedure" id="d0e5096"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;9.10.&nbsp;Configuring OpenIDM for the XML Example</div><ol class="procedure" type="1"><li class="step"><p>Start OpenIDM. You can ignore errors like <code class="literal">cannot
          connect to database</code> and <code class="literal">cannot find jdbc driver</code>.
          These errors will be fixed once OpenIDM has been configured and restarted.
          </p></li><li class="step"><p>Copy the <code class="literal">openidm/samples/sample1/conf</code> directory
          to <code class="literal">openidm/conf</code>. Overwrite any existing files.
          </p><p>For Unix/Linux, enter the following in a terminal window.
          </p><pre class="cmdline prettyprint">$ cd path/to/openidm
$ cp -r ./samples/sample1/conf ./conf</pre><p>For Windows, enter the following on the command line.
          </p><pre class="cmdline prettyprint">c:\&gt; cd path\to\openidm
.\&gt; copy .\samples\sample1\conf .\conf</pre></li><li class="step"><p>Copy the <code class="filename">openidm/samples/provisioners/provisioner.openicf.connectorinfoprovider.jso</code>
          to <code class="literal">openidm/conf</code>.
          </p><pre class="cmdline prettyprint">$ cp . samples/provisioners/provisioner.openicf.connectorinfoprovider.json ./conf</pre></li><li class="step"><p>Edit the <code class="literal">provisioner.openicf.connectorinfoprovider.json</code>
          to match your network setup. The following is an example of how it could look.
          </p><pre class="cmdline prettyprint">{ 
	    "connectorsLocation" : "connectors", 
	    "remoteConnectorServers" : [ 
	        { 
	            "name" : "xml", 
	            "host" : "10.0.0.2", 
	            "port" : 8759, 
	            "useSSL" : false, 
	            "timeout" : 0, 
	            "key" : "password" 
	        } 
	    ], 
	}</pre></li><li class="step"><p>Edit the <code class="literal">provisioner.openicf-xml.json</code> in the 
          <code class="literal">/conf</code> directory to read like the following.
          </p><pre class="cmdline prettyprint">{
    "name" : "xmlfile", 
    "connectorRef" : { 
        "connectorHostRef" : "xml", 
        "bundleName" : "org.forgerock.openicf.connectors.file.openicf-xml-connector", 
        "bundleVersion" : "",
        "connectorName" : "com.forgerock.openicf.xml.XMLConnector" 
    }, 
    "producerBufferSize" : 100, 
    "connectorPoolingSupported" : true, 
    "poolConfigOption" : { 
        "maxObjects" : 10, 
        "maxIdle" : 10, 
        "maxWait" : 150000, 
        "minEvictableIdleTimeMillis" : 120000, 
        "minIdle" : 1 
    }, 
    "operationTimeout" : { 
        "CREATE" : -1, 
        "TEST" : -1, 
        "AUTHENTICATE" : -1, 
        "SEARCH" : -1, 
        "VALIDATE" : -1, 
        "GET" : -1, 
        "UPDATE" : -1, 
        "DELETE" : -1, 
        "SCRIPT_ON_CONNECTOR" : -1, 
        "SCRIPT_ON_RESOURCE" : -1, 
        "SYNC" : -1, 
        "SCHEMA" : -1 
    }, 
    "configurationProperties" : { 
        "xsdIcfFilePath" : "/Program files (x86)/openicf/data/
        resource-schema-1.xsd", 
        "xsdFilePath" : "/Program Files (x86)/openicf/data/
        resource-schema-extension.xsd", 
        "xmlFilePath" : "/Program Files (x86)/openicf/data/xmlConnectorData.xml" 
    }, 
    "objectTypes" : { 
        "account" : { 
            "$schema" : "http://json-schema.org/draft-03/schema", 
            "id" : "__ACCOUNT__", 
            "type" : "object", 
            "nativeType" : "__ACCOUNT__", 
            "properties" : { 
                "description" : { 
                    "type" : "string", 
                    "nativeName" : "__DESCRIPTION__", 
                    "nativeType" : "string" 
                }, 
                "firstname" : { 
                    "type" : "string", 
                    "nativeName" : "firstname", 
                    "nativeType" : "string" 
                }, 
                "email" : { 
                    "type" : "array", 
                    "items" : { 
                        "type" : "string", 
                        "nativeType" : "string" 
                    }, 
                    "nativeName" : "email", 
                    "nativeType" : "string" 
                }, 
                "__UID__" : { 
                    "type" : "string", 
                    "nativeName" : "__UID__" 
                }, 
                "password" : { 
                    "type" : "string", 
                    "required" : false, 
                    "nativeName" : "__PASSWORD__", 
                    "nativeType" : "JAVA_TYPE_GUARDEDSTRING", 
                    "flags" : [ 
                        "NOT_READABLE", 
                        "NOT_RETURNED_BY_DEFAULT" 
                    ] 
                }, 
                "name" : { 
                    "type" : "string", 
                    "required" : true, 
                    "nativeName" : "__NAME__", 
                    "nativeType" : "string" 
                }, 
                "lastname" : { 
                    "type" : "string", 
                    "required" : true, 
                    "nativeName" : "lastname", 
                    "nativeType" : "string" 
                } 
            } 
        } 
    }, 
    "operationOptions" : { } 
}</pre></li><li class="step"><p>Verify that the following settings are correct.
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The value of <code class="literal">connectorHostRef : xml</code> points
             to the property <code class="literal">name</code> of 
             <code class="filename">provisioner.openicf.connectorinfoprovider.json</code>. This 
             indicates which connectorinfoprovider to use.
             </p></li><li class="listitem"><p>The <code class="filename">bundleVersion : </code> must be
             exactly the same as <code class="filename">openicf-scriptedsql-connector-.jar</code>.
             on JCS <code class="literal">/bundles</code>.
             </p></li><li class="listitem"><p>The path to <code class="literal">xsdIcfFilePath : /Program files (x86)/openicf/data/resource-schema-1.xs</code>
             </p></li></ul></div></li><li class="step"><p>Restart OpenIDM to verify that all of the configuration changes have
          occurred. There should be no error message when OpenIDM is restarted.
          To check, run the following command:</p><pre class="cmdline prettyprint">src list</pre><p>This returns a list of installed modules, including the following:
          </p><pre class="cmdline prettyprint">[  17] [active       ] org.forgerock.openidm.provisioner.openicf </pre><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>The number may differ. Make sure to note the number returned.</p></div></div><p>When you have installed more connectors, there will be more OpenIFC
          modules. If the state of the module is active, the module is installed properly.
          If the state is unsatisfied, then you have not configured it correctly and you
          must check your configuration. You can also check the content of installed
          modules. This can be useful if you have an unsatisfied state and you want to
          check that the content is the same as in the <code class="filename">*.json</code>
          file, to verify that the configuration change you made was picked up. To
          list the content of the module run the following command, with the number
          returned from the previous step:
          </p><pre class="cmdline prettyprint">scr info 17 &lt;your number&gt;</pre><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>You can also check the <code class="filename">provisioner.openicf.connectorinfoprovider</code>
           </p></div></div></li><li class="step"><p>Run reconciliation with the following command.
          </p><pre class="cmdline prettyprint">$ curl --header "X-OpenIDM-Username: openidm-admin" 
--header "X-OpenIDM-Password: openidm-admin" --request POST 
"http://localhost:8080/openidm/recon?_action=recon&amp;mapping=systemXmlfileAccounts_managedUser"</pre><p>This will return a reconciliation id similar to the following:
          </p><pre class="cmdline prettyprint">{"_id":"a5346543-db9a-4f8b-ba25-af2a1b576a54"}</pre></li><li class="step"><p>Check the internal repository (OrientDB or MySQL) to make sure that
             the users were reconciled. For information about connecting to OrientDB,
             see <a href="../install-guide/index.html#before-you-begin-sample" class="link">
             <em class="citetitle">Before You Begin</em></a> in the
             <em class="citetitle">Installation Guide</em>. For information about using
             MySQL as a repository, see <a href="../install-guide/index.html#chap-repository" class="link">
             <em class="citetitle">Installing a Repository For Production</em></a> in the
             <em class="citetitle">Installation Guide</em>.
             </p></li></ol></div></div></div><div class="section" id="configuring-ad-connector"><div class="titlepage"><div><div><h4 class="title">9.4.3.4.&nbsp;Configuring the Active Directory Connector</h4></div></div></div><p>A sample Active Directory Connector configuration file is provided 
    in <code class="filename">opendim/samples/provisioners/provisioner.openicf-ad.json</code>. 
    The following excerpt shows the configuration for the connector.
    </p><pre class="codelisting prettyprint linenums lang-js">
{
    "connectorHostRef": "dotnet",
    "connectorName":
        "Org.IdentityConnectors.ActiveDirectory.ActiveDirectoryConnector",
    "bundleName": "ActiveDirectory.Connector",
    "bundleVersion": "1.0.0.6109"
}</pre><p>The <code class="literal">connectorHostRef</code> must point by name to an
   existing connector info provider configuration, that you store in
   <code class="filename">openidm/conf/provisioner.openicf.connectorinfoprovider.json</code>.
   The <code class="literal">connectorHostRef</code> property is required as the Active
   Directory connector must be installed on a .NET connector server, which is
   always "remote" relative to OpenIDM.</p><p>The following excerpt shows the configuration for the connector
   info provider.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "connectorsLocation": "connectors",
    "remoteConnectorServers": [
        {
            "name": "dotnet",
            "host": "10.0.0.10",
            "port": 8759,
            "useSSL": false,
            "timeout": 0,
            "key": "Passw0rd"
        }
    ]
}</pre><p>The following excerpt shows typical configuration properties.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "DirectoryAdminName": "EXAMPLE\\Administrator",
    "DirectoryAdminPassword": "passw0rd",
    "ObjectClass": "User",
    "Container": "dc=example,dc=com",
    "CreateHomeDirectory": true,
    "LDAPHostName": "127.0.0.1",
    "SearchChildDomains": false,
    "DomainName": "example",
    "SyncGlobalCatalogServer": null,
    "SyncDomainController": null,
    "SearchContext": "dc=example,dc=com"
}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">DirectoryAdminName</span></dt><dd><p>Account used to authenticate. This can be a
      <code class="literal"><em class="replaceable"><code>domainname</code></em>\<em class="replaceable"><code>user</code></em></code>
      combination, or simply the user name.</p></dd><dt><span class="term">DirectoryAdminPassword</span></dt><dd><p>Password used to authenticate</p></dd><dt><span class="term">ObjectClass</span></dt><dd><p>Object class for user objects</p></dd><dt><span class="term">Container</span></dt><dd><p>Base context for all searches</p></dd><dt><span class="term">CreateHomeDirectory</span></dt><dd><p>When <code class="literal">true</code>, create a home directory for new
      users.</p></dd><dt><span class="term">LDAPHostName</span></dt><dd><p>Use to enforce connection to a particular Active Directory
      server.</p></dd><dt><span class="term">SearchChildDomains</span></dt><dd><p>When set to <code class="literal">true</code> or <code class="literal">false</code>,
      apply <code class="literal">SyncGlobalCatalogServer</code> and
      <code class="literal">SyncDomainController</code> settings</p></dd><dt><span class="term">DomainName</span></dt><dd><p>Windows domain name</p></dd><dt><span class="term">SyncGlobalCatalogServer</span></dt><dd><p>Global catalog server to use when searching child domains</p></dd><dt><span class="term">SyncDomainController</span></dt><dd><p>Domain controller to use during synchronization when not searching
      child domains</p></dd><dt><span class="term">SearchContext</span></dt><dd><p>Reserved for future use</p></dd></dl></div></div><div class="section" id="ad-powershell"><div class="titlepage"><div><div><h4 class="title">9.4.3.5.&nbsp;Using PowerShell Scripts With the Active Directory Connector</h4></div></div></div><p>The Active Directory connector supports PowerShell scripting. The 
    following example shows a simple PowerShell script that is referenced in 
    the connector configuration and can be called over the REST interface.
    </p><p>This PowerShell script creates a new MS SQL user with a username 
    that is specified when the script is called. The script sets the user's 
    password to <code class="literal">Passw0rd</code> and, optionally, gives the user a 
    role. Save this script as <code class="filename">openidm/script/createUser.ps1</code>.
    </p><pre class="codelisting prettyprint">
    if ($loginName -ne $NULL) {
	[System.Reflection.Assembly]::LoadWithPartialName('Microsoft.SqlServer.SMO') | Out-Null
	$sqlSrv = New-Object ('Microsoft.SqlServer.Management.Smo.Server') ('WIN-C2MSQ8G1TCA')
 
	$login = New-Object -TypeName ('Microsoft.SqlServer.Management.Smo.Login') ($sqlSrv, $loginName)
	$login.LoginType = 'SqlLogin'
	$login.PasswordExpirationEnabled = $false
	$login.Create('Passw0rd')
	#  The next two lines are optional, and to give the new login a server role, optional
	$login.AddToRole('sysadmin')
	$login.Alter()
} else {
	$Error_Message = [string]"Required variables 'loginName' is missing!"
    Write-Error $Error_Message
    throw $Error_Message
}
    </pre><p>Now edit the Active Directory connector configuration to reference 
    the script. Add the following section to the connector configuration file 
    (<code class="filename">opendim/conf/provisioner.openicf-ad.json</code>).</p><pre class="codelisting prettyprint linenums lang-js">
"systemActions" : [   
    {
        "_scriptId" : "ConnectorScriptName",
        "actions" : [
            {
                "systemType" : ".*ActiveDirectoryConnector",
                "actionType" : "Shell",
                "actionSource" : "@echo off \r\n echo %loginName%\r\n"
            },
            {
                "systemType" : ".*ActiveDirectoryConnector",
                "actionType" : "PowerShell",
                "actionFile" : "script/createUser.ps1"
            }
        ]
    }
]   
    </pre><p>To call the PowerShell script over the REST interface, use the 
    following request, specifying the userName as input:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/system/ActiveDirectory/account?_action=script&amp;_scriptId=ConnectorScriptName&amp;loginName=myUser"</pre></div></div><div class="section" id="csv-file-connector"><div class="titlepage"><div><div><h3 class="title">9.4.4.&nbsp;CSV File Connector</h3></div></div></div><p>The CSV file connector often serves when importing users, either
    for initial provisioning or for ongoing updates. When used continuously in
    production, a CSV file serves as a change log, often containing only user
    records that changed.</p><p>The following example shows an excerpt of the provisioner configuration.
   The default connector-jar location is <code class="filename">openidm/connectors</code>.
   Therefore the <code class="literal">connectorHostRef</code> must point to
   <code class="literal">"#LOCAL"</code>.</p><pre class="codelisting prettyprint linenums lang-js">
{
  "connectorRef": {
    "connectorHostRef": "#LOCAL",
    "connectorName": "org.forgerock.openicf.csvfile.CSVFileConnector",
    "bundleName":
      "org.forgerock.openicf.connectors.csvfile-connector",
    "bundleVersion": ""
  }
}</pre><p>The following excerpt shows required configuration properties.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "configurationProperties": {
        "filePath": "data/hr.csv",
        "uniqueAttribute": "uid"
    }
}</pre><div class="variablelist"><p>The CSV file connector also supports a number of optional
    configuration properties, in addition to the required properties.</p><dl class="variablelist"><dt><span class="term">encoding (optional)</span></dt><dd><p>Default: <code class="literal">"utf-8"</code></p></dd><dt><span class="term">fieldDelimiter (optional)</span></dt><dd><p>Default: <code class="literal">","</code></p></dd><dt><span class="term">filePath (required)</span></dt><dd><p>References the CSV file containing account entries</p></dd><dt><span class="term">multivalueDelimiter (optional)</span></dt><dd><p>Used with multi-valued attributes. Default:
      <code class="literal">";"</code></p></dd><dt><span class="term">passwordAttribute (optional)</span></dt><dd><p>Attribute containing the password. Use when password-based
      authentication is required.</p></dd><dt><span class="term">uniqueAttribute (required)</span></dt><dd><p>Primary key used for the CSV file</p></dd><dt><span class="term">usingMultivalue (optional)</span></dt><dd><p>Whether attributes can have multiple values. Default:
      <code class="literal">false</code></p></dd></dl></div></div><div class="section" id="scripted-sql-connector"><div class="titlepage"><div><div><h3 class="title">9.4.5.&nbsp;Scripted SQL Connector</h3></div></div></div><p>The Scripted SQL Connector uses customizable Groovy scripts to
   interact with the database.</p><div class="itemizedlist"><p>The connector uses one script for each of the following actions
    on the external database.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Create</p></li><li class="listitem"><p>Delete</p></li><li class="listitem"><p>Search</p></li><li class="listitem"><p>Sync</p></li><li class="listitem"><p>Test</p></li><li class="listitem"><p>Update</p></li></ul></div><p>See the <code class="filename">openidm/samples/sample3/tools/</code> directory
   for example scripts.</p><p>The scripted SQL connector runs with autocommit mode enabled by default. 
   As soon as a statement is executed that modifies a table, the update is stored 
   on disk and the change cannot be rolled back. This setting applies to all 
   database actions (search, create, delete, test, synch, and update). 
   You can disable autocommit in the connector configuration file 
   (<code class="literal">conf/provisioner.openicf-scriptedsql.json</code>) by adding the 
   <code class="literal">autocommit</code> property and setting it to 
   <code class="literal">false</code>, for example:</p><pre class="codelisting prettyprint linenums lang-js">
  "configurationProperties" : {
        "host" : "localhost",
        "port" : "3306",
        ...
        "database" : "HRDB",
        "autoCommit" : false,
        "reloadScriptOnExecution" : true,
        "createScriptFileName" : "/path/to/openidm/tools/CreateScript.groovy",
   </pre><p>If you require a traditional transaction with a manual commit for 
   a specific script, you can disable autocommit mode in the script or scripts 
   for each action that requires a manual commit.</p></div></div><div class="section" id="connector-wiz"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.5.&nbsp;Creating Default Connector Configurations</h2></div></div></div><a class="indexterm" name="d0e5511"></a><p>Rather than creating provisioner files by hand, use the service that
  OpenIDM exposes through the REST interface to create basic connector
  configuration files named <code class="filename">provisioner-openicf-<em class="replaceable"><code>Connector
  Name</code></em>.json</code> file.</p><div class="orderedlist"><p>You create a new connector configuration file in three stages.</p><ol class="orderedlist" type="1"><li class="listitem"><p>List available connectors.</p></li><li class="listitem"><p>Generate the core configuration.</p></li><li class="listitem"><p>Connect to the target system and generate the final
   configuration.</p></li></ol></div><p>List available connectors using the following command.</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST "http://localhost:8080/openidm/system?_action=CREATECONFIGURATION"</pre><div class="itemizedlist"><p>Available connectors are installed in
   <code class="filename">openidm/connectors</code>. OpenIDM bundles the following
   connectors.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>csvfile</p></li><li class="listitem"><p>ldap</p></li><li class="listitem"><p>scriptedsql</p></li><li class="listitem"><p>xml</p></li></ul></div><p>The command above therefore should return the following output
  (formatted here with lines folded to make it easier to read.)</p><pre class="codelisting prettyprint linenums lang-js">
{
  "connectorRef": [
    {
      "connectorName": "org.identityconnectors.ldap.LdapConnector",
      "bundleName":
        "org.forgerock.openicf.connectors.ldap-connector",
      "bundleVersion": ""
    },
    {
      "connectorName": "com.forgerock.openicf.xml.XMLConnector",
      "bundleName":
        "org.forgerock.openicf.connectors.file.openicf-xml-connector",
      "bundleVersion": ""
    },
    {
      "connectorHostRef":
       "osgi:service/org.forgerock.openicf.framework.api.osgi.ConnectorManager",
      "connectorName": "org.forgerock.openicf.connectors.scriptedsql.ScriptedSQLConnector",
      "bundleName":
       "org.forgerock.openicf.connectors.scriptedsql-connector",
      "bundleVersion": ""
    },
    {
      "connectorHostRef":
       "osgi:service/org.forgerock.openicf.framework.api.osgi.ConnectorManager",
      "connectorName": "org.forgerock.openicf.csvfile.CSVFileConnector",
      "bundleName":
       "org.forgerock.openicf.connectors.csvfile-connector",
      "bundleVersion": ""
    }
  ]
}</pre><p>To generate the core configuration, choose one of the available
  connectors by copying JSON objects from the list into the body of the REST
  command, as shown below for the XML connector.</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 -d '{"connectorRef":
 {"connectorName":"com.forgerock.openicf.xml.XMLConnector",
 "bundleName":"org.forgerock.openicf.connectors.file.openicf-xml-connector",
 "bundleVersion":""}}' 
 --request POST "http://localhost:8080/openidm/system?_action=CREATECONFIGURATION"</pre><p>The command returns a core connector configuration. The core connector
  configuration returned is not yet functional. It does not contain
  system specific "configurationProperties" such as the host name and port for
  web based connectors, or the "xmlFilePath" for the XML file based connectors
  as can be seen below. In addition, the configuration returned does not
  include complete "objectTypes" and "operationOptions" parts.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "connectorRef": {
        "connectorName": "com.forgerock.openicf.xml.XMLConnector",
        "bundleName":
            "org.forgerock.openicf.connectors.file.openicf-xml-connector",
        "bundleVersion": ""
    },
    "poolConfigOption": {
        "maxObjects": 10,
        "maxIdle": 10,
        "maxWait": 150000,
        "minEvictableIdleTimeMillis": 120000,
        "minIdle": 1
    },
    "resultsHandlerConfig": {
        "enableNormalizingResultsHandler": true,
        "enableFilteredResultsHandler": true,
        "enableCaseInsensitiveFilter": false,
        "enableAttributesToGetSearchResultsHandler": true
    },
    "operationTimeout": {
        "CREATE": -1,
        "UPDATE": -1,
        "DELETE": -1,
        "TEST": -1,
        "SCRIPT_ON_CONNECTOR": -1,
        "SCRIPT_ON_RESOURCE": -1,
        "GET": -1,
        "RESOLVEUSERNAME": -1,
        "AUTHENTICATE": -1,
        "SEARCH": -1,
        "VALIDATE": -1,
        "SYNC": -1,
        "SCHEMA": -1
    },
    "configurationProperties": {
        "xmlFilePath": null,
        "xsdFilePath": null,
        "xsdIcfFilePath": null
    }
}</pre><p>To generate the final configuration, add the missing
  "configurationProperties" to the core configuration, and use the updated
  core configuration as the body for the next command.</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --data '{
   "connectorRef" :
      {
         "connectorName" : "com.forgerock.openicf.xml.XMLConnector",
         "bundleName" :
             "org.forgerock.openicf.connectors.file.openicf-xml-connector",
         "bundleVersion" : ""
      },
   "poolConfigOption" :
      {
         "maxObjects" : 10,
         "maxIdle" : 10,
         "maxWait" : 150000,
         "minEvictableIdleTimeMillis" : 120000,
         "minIdle" : 1
      },
   "resultsHandlerConfig" :
      {
         "enableNormalizingResultsHandler" : true,
         "enableFilteredResultsHandler" : true,
         "enableCaseInsensitiveFilter" : false,
         "enableAttributesToGetSearchResultsHandler" : true
      },
   "operationTimeout" :
      {
         "CREATE" : -1,
         "UPDATE" : -1,
         "DELETE" : -1,
         "TEST" : -1,
         "SCRIPT_ON_CONNECTOR" : -1,
         "SCRIPT_ON_RESOURCE" : -1,
         "GET" : -1,
         "RESOLVEUSERNAME" : -1,
         "AUTHENTICATE" : -1,
         "SEARCH" : -1,
         "VALIDATE" : -1,
         "SYNC" : -1,
         "SCHEMA" : -1
      },
   "configurationProperties" :
      {
         "xsdIcfFilePath" : "samples/sample1/data/resource-schema-1.xsd",
         "xsdFilePath" : "samples/sample1/data/resource-schema-extension.xsd",
         "xmlFilePath" : "samples/sample1/data/xmlConnectorData.xml"
      }
 }'
 --request POST "http://localhost:8080/openidm/system?_action=CREATECONFIGURATION"</pre><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>Notice the single quotes around the argument to the
   <code class="option">--data</code> option in the command above. For most UNIX shells,
   single quotes around a string prevent the shell from executing the command
   when encountering a newline in the content. You can therefore pass the
   <code class="option">--data '...'</code> option on a single line or including line feeds.</p></div></div><p>OpenIDM attempts to read the schema, if available, from the external
  resource in order to generate output. OpenIDM then iterates through schema
  objects and attributes, creating JSON representations for "objectTypes" and
  "operationOptions" for supported objects and operations.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "connectorRef": {
        "connectorHostRef": "#LOCAL",
        "connectorName": "com.forgerock.openicf.xml.XMLConnector",
        "bundleName":
            "org.forgerock.openicf.connectors.file.openicf-xml-connector",
        "bundleVersion": "-EA"
    },
    "poolConfigOption": {
        "maxObjects": 10,
        "maxIdle": 10,
        "maxWait": 150000,
        "minEvictableIdleTimeMillis": 120000,
        "minIdle": 1
    },
    "resultsHandlerConfig": {
        "enableNormalizingResultsHandler": true,
        "enableFilteredResultsHandler": true,
        "enableCaseInsensitiveFilter": false,
        "enableAttributesToGetSearchResultsHandler": true
    },
    "operationTimeout": {
        "CREATE": -1,
        "UPDATE": -1,
        "DELETE": -1,
        "TEST": -1,
        "SCRIPT_ON_CONNECTOR": -1,
        "SCRIPT_ON_RESOURCE": -1,
        "GET": -1,
        "RESOLVEUSERNAME": -1,
        "AUTHENTICATE": -1,
        "SEARCH": -1,
        "VALIDATE": -1,
        "SYNC": -1,
        "SCHEMA": -1
    },
    "configurationProperties": {
        "xmlFilePath": "samples/sample1/data/xmlConnectorData.xml",
        "xsdFilePath": "samples/sample1/data/resource-schema-extension.xsd",
        "xsdIcfFilePath": "samples/sample1/data/resource-schema-1.xsd"
    },
    "objectTypes": {
        "OrganizationUnit": {
            "...": "..."
        },
        "__GROUP__": {
            "$schema": "http://json-schema.org/draft-03/schema",
            "id": "__GROUP__",
            "type": "object",
            "nativeType": "__GROUP__",
            "properties": {
                "__DESCRIPTION__": {
                    "type": "string",
                    "required": true,
                    "nativeName": "__DESCRIPTION__",
                    "nativeType": "string"
                },
                "__NAME__": {
                    "type": "string",
                    "required": true,
                    "nativeName": "__NAME__",
                    "nativeType": "string"
                }
            }
        },
        "__ACCOUNT__": {
            "$schema": "http://json-schema.org/draft-03/schema",
            "id": "__ACCOUNT__",
            "type": "object",
            "nativeType": "__ACCOUNT__",
            "properties": {
                "firstname": {
                    "type": "string",
                    "nativeName": "firstname",
                    "nativeType": "string"
                },
                "__DESCRIPTION__": {
                    "type": "string",
                    "nativeName": "__DESCRIPTION__",
                    "nativeType": "string"
                },
                "__UID__": {
                    "type": "string",
                    "nativeName": "__UID__",
                    "nativeType": "string"
                },
                "__NAME__": {
                    "type": "string",
                    "required": true,
                    "nativeName": "__NAME__",
                    "nativeType": "string"
                }
            }
        }
    },
    "operationOptions": {
        "CREATE": {
            "objectFeatures": {
                "OrganizationUnit": {
                    "...": "..."
                },
                "__GROUP__": {
                    "...": "..."
                },
                "__ACCOUNT__": {
                    "denied": false,
                    "onDeny": "DO_NOTHING",
                    "operationOptionInfo": {
                        "$schema": "http://json-schema.org/draft-03/schema",
                        "id": "FIX_ME",
                        "type": "object",
                        "properties": {
                            "...": "..."
                        }
                    }
                }
            }
        },
        "UPDATE": {
            "objectFeatures": {
                "__ACCOUNT__": {
                    "denied": false,
                    "onDeny": "DO_NOTHING",
                    "operationOptionInfo": {
                        "$schema": "http://json-schema.org/draft-03/schema",
                        "id": "FIX_ME",
                        "type": "object",
                        "properties": {
                            "...": "..."
                        }
                    }
                }
            }
        }
    }
}</pre><p>As OpenIDM produces a full property set for all attributes and all
  object types in the schema from the external resource, the resulting
  configuration can be large. For an LDAP server, OpenIDM can generate a
  configuration containing several tens of thousands of lines, for example.
  You might therefore want to reduce the schema to a minimum on the external
  resource before you run the final command.</p></div></div><div lang="en" class="chapter" id="chap-synchronization"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;10.&nbsp;Configuring Synchronization</h1></div></div></div><a class="indexterm" name="d0e5596"></a><p>One of the core services of OpenIDM is synchronizing identity data from
 different resources. This chapter explains what you must know to get started
 configuring OpenIDM's flexible synchronization mechanism, and illustrates the
 concepts with examples.</p><div class="section" id="sync-types"><div class="titlepage"><div><div><h2 class="title" style="clear: both">10.1.&nbsp;Types of Synchronization</h2></div></div></div><a class="indexterm" name="d0e5604"></a><p>Synchronization happens either when OpenIDM receives a change directly,
  or when OpenIDM discovers a change on an external resource.</p><p>For direct changes to OpenIDM, OpenIDM immediately pushes updates to
  all external resources configured to receive the updates. A direct change
  can originate not only as a write request through the REST interface, but
  also as an update resulting from reconciliation with another resource.</p><div class="variablelist"><p>OpenIDM discovers changes on external resources through reconciliation
   and through LiveSync.</p><dl class="variablelist"><dt><span class="term">Reconciliation</span></dt><dd><a class="indexterm" name="d0e5620"></a><p>In identity management, <em class="firstterm">reconciliation</em> is the
     process of bidirectional synchronization of objects between different data
     stores. Reconciliation applies mainly to user objects, although OpenIDM
     can reconcile any objects, including groups and roles.</p><p>To perform reconciliation, OpenIDM analyzes both source and target
     systems to uncover the differences that it must reconcile. Reconciliation
     can therefore be a heavyweight process. When working with large data sets,
     finding all changes can be more work than processing the changes.</p><p>Reconciliation is, however, thorough. It recognizes system error
     conditions and catches changes that might be missed by the more
     lightweight LiveSync mechanism. Reconciliation therefore serves as the
     basis for compliance and reporting functionality.</p></dd><dt><span class="term">LiveSync</span></dt><dd><a class="indexterm" name="d0e5636"></a><p><em class="firstterm">LiveSync</em> performs the same job as
     reconciliation. LiveSync relies on a change log on the external resource
     to determine which objects have changed.</p><p>LiveSync is intended to react quickly to changes as they happen.
     LiveSync is however a best effort mechanism that, in some cases, can miss
     changes.</p><p>Furthermore, not all resources provide the change log mechanism
     that LiveSync requires. The change log provides OpenIDM with a list of
     objects that have changed since the last request, so that OpenIDM does not
     need to scan all objects for changes. OpenDJ and Active Directory both
     provide the change log required for LiveSync.</p></dd></dl></div><p>To determine what to synchronize, and how to carry out synchronization,
  OpenIDM relies on mappings that you configure. LiveSync relies on the set of
  mappings that you configure once per OpenIDM server. Reconciliation allows
  you to configure specific mappings for a particular reconciliation job.</p><p>You must trigger OpenIDM to poll for changes on external resources,
  usually by scheduling reconciliation or LiveSync, as described in
  <a href="../integrators-guide/index.html#chap-scheduler-conf" class="link"><em class="citetitle">Scheduling
  Tasks and Events</em></a>. Alternatively, you can manage
  reconciliation and LiveSync over the REST interface, as described in the
  following sections.</p></div><div class="section" id="recon-over-rest"><div class="titlepage"><div><div><h2 class="title" style="clear: both">10.2.&nbsp;Managing Reconciliation Over REST</h2></div></div></div><p>You can trigger, cancel, and monitor reconciliation operations over
   REST, using the REST endpoint
   <code class="literal">http://localhost:8080/openidm/recon</code>.</p><div class="section" id="triggering-recons"><div class="titlepage"><div><div><h3 class="title">10.2.1.&nbsp;Triggering a Reconciliation Run</h3></div></div></div><p>The following example triggers a reconciliation operation based on
    the <code class="literal">systemLdapAccounts_managedUser</code> mapping. The mapping
    is defined in the file <code class="filename">conf/sync.json</code>.</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/recon?_action=recon&amp;mapping=systemLdapAccounts_managedUser"
    </pre><p>By default, an assigned reconciliation run ID is returned immediately
    when the reconciliation operation is initiated. Clients can make subsequent
    calls to the reconciliation service, using this reconciliation run ID to
    query its state and to call operations on it.</p><p>For example, the reconciliation run initiated previously would return
    something similar to the following:</p><pre class="cmdline prettyprint">{"_id":"0890ad62-4738-4a3f-8b8e-f3c83bbf212e"}</pre><p>To have the entire reconciliation run complete before the
    reconciliation run ID is returned, set the
    <code class="literal">waitForCompletion</code> property to <code class="literal">true</code>
    when the reconciliation is initiated. For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/recon?_action=recon&amp;
 mapping=systemLdapAccounts_managedUser&amp;waitForCompletion=true"
    </pre></div><div class="section" id="canceling-recons"><div class="titlepage"><div><div><h3 class="title">10.2.2.&nbsp;Canceling a Reconciliation Run</h3></div></div></div><p>You can cancel a reconciliation run by sending a REST call with
    the <code class="literal">cancel</code> action, specifying the reconciliation run
    ID. For example, the following call cancels the reconciliation run
    initiated in the previous section:</p><pre class="cmdline prettyprint">$curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/recon/0890ad62-4738-4a3f-8b8e-f3c83bbf212e?_action=cancel"
    </pre><p>The output for a reconciliation cancelation request is similar to the
    following:</p><pre class="cmdline prettyprint">
    {"_id":"0890ad62-4738-4a3f-8b8e-f3c83bbf212e",
     "action":"cancel",
     "status":"SUCCESS"}
    </pre><p>If you specified that the call should wait for completion before
    the ID is returned, you can obtain the reconciliation run ID from the list
    of active reconciliations, as described in the following section.</p></div><div class="section" id="listing-recons"><div class="titlepage"><div><div><h3 class="title">10.2.3.&nbsp;Listing Reconciliation Runs</h3></div></div></div><p>You can display a list of reconciliation processes that have
    completed, and those that are in progress, by running a RESTful GET on
    <code class="literal">"http://localhost:8080/openidm/recon"</code>. The following
    example displays all reconciliation runs.</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET
 "http://localhost:8080/openidm/recon"
    </pre><p>The output of such a request is similar to the following, with one
    item for each reconciliation run.</p><pre class="cmdline prettyprint">{"reconciliations":[
 {"_id":"d3040cc9-ec2e-41b8-86c4-72393087a626",
 "mapping":"systemLdapAccounts_managedUser",
 "state":"SUCCESS",
 "stage":"COMPLETED_SUCCESS",
 "stageDescription":"reconciliation completed.",
 "progress":{
   "source":{
      "existing":{
         "processed":1001,
         "total":"1001"
      }
   },
   "target":{
      "existing":{
         "processed":1001,
         "total":"1001"
      },
      "created":0
   },
   "links":{
      "existing":{
         "processed":1001,
         "total":"1001"
      },
      "created":0
   }
 },
 "started":"2012-11-18T08:48:00.031Z",
 "ended":"2012-11-18T08:48:00.160Z"},
    </pre><div class="variablelist"><p>Each reconciliation run has the following properties:</p><dl class="variablelist"><dt><span class="term"><code class="literal">_id</code></span></dt><dd><p>The ID of the reconciliation run.</p></dd><dt><span class="term"><code class="literal">mapping</code></span></dt><dd><p>The name of the mapping, defined in the <code class="filename">conf/sync.json
       </code> file.</p></dd><dt><span class="term"><code class="literal">state</code></span></dt><dd><p>The high level state of the reconciliation run. Values can be as
       follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">ACTIVE</code></p><p>The reconciliation run is in progress.</p></li><li class="listitem"><p><code class="literal">CANCELED</code></p><p>The reconciliation run was successfully canceled.</p></li><li class="listitem"><p><code class="literal">FAILED</code></p><p>The reconciliation run was terminated because of failure.</p></li><li class="listitem"><p><code class="literal">SUCCESS</code></p><p>The reconciliation run completed successfully.</p></li></ul></div></dd><dt><span class="term"><code class="literal">stage</code></span></dt><dd><p>The current stage of the reconciliation run's progress. Values can
       be as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">ACTIVE_INITIALIZED</code></p><p>The initial stage, when a reconciliation run is first created.
         </p></li><li class="listitem"><p><code class="literal">ACTIVE_QUERY_ENTRIES</code></p><p>Querying the source, target and possibly link sets to reconcile.
         </p></li><li class="listitem"><p><code class="literal">ACTIVE_RECONCILING_SOURCE</code></p><p>Reconciling the set of IDs retrieved from the mapping source.
         </p></li><li class="listitem"><p><code class="literal">ACTIVE_RECONCILING_TARGET</code></p><p>Reconciling any remaining entries from the set of IDs retrieved
         from the mapping target, that were not matched or processed during
         the source phase.</p></li><li class="listitem"><p><code class="literal">ACTIVE_LINK_CLEANUP</code></p><p>Checking whether any links are now unused and should be cleaned
         up.</p></li><li class="listitem"><p><code class="literal">ACTIVE_PROCESSING_RESULTS</code></p><p>Post-processing of reconciliation results.</p></li><li class="listitem"><p><code class="literal">ACTIVE_CANCELING</code></p><p>Attempting to abort a reconciliation run in progress.</p></li><li class="listitem"><p><code class="literal">COMPLETED_SUCCESS</code></p><p>Successfully completed processing the reconciliation run.</p></li><li class="listitem"><p><code class="literal">COMPLETED_CANCELED</code></p><p>Completed processing because the reconciliation run was aborted.
         </p></li><li class="listitem"><p><code class="literal">COMPLETED_FAILED</code></p><p>Completed processing because of a failure.</p></li></ul></div></dd><dt><span class="term"><code class="literal">stageDescription</code></span></dt><dd><p>A description of the stages described previously.</p></dd><dt><span class="term"><code class="literal">progress</code></span></dt><dd><p>The progress object has the following structure (annotated here
       with comments):</p><pre class="cmdline prettyprint">
"progress":{
      "source":{             // Progress on the set of existing entries in the mapping source
         "existing":{
            "processed":1001,
            "total":"1001"   // Total number of entries in source set, if known, &#8220;?&#8221; otherwise
         }
      },
      "target":{             // Progress on the set of existing entries in the mapping target
         "existing":{
            "processed":1001,
            "total":"1001"   // Total number of entries in target set, if known, &#8220;?&#8221; otherwise
         },
         "created":0         // New entries that were created
      },
      "links":{              // Progress on the set of existing links between source and target
         "existing":{
            "processed":1001,
            "total":"1001"   // Total number of existing links, if known, &#8220;?&#8221; otherwise
         },
         "created":0         // Denotes new links that were created
      }
},
       </pre></dd></dl></div></div><div class="section" id="querying-recon-logs"><div class="titlepage"><div><div><h3 class="title">10.2.4.&nbsp;Querying the Reconciliation Audit Log</h3></div></div></div><p>Reconciliation operations are logged in the file
       <code class="filename">/path/to/openidm/audit/recon.csv</code> and in the
       repository. You can read and query the reconciliation audit logs over
       the REST interface as outlined in the following examples.</p><p>By default all <code class="literal">audit/recon</code> query responses are
       formatted based on the <code class="literal">entryType</code> of the entry. Fields
       that are not required for the specific entry type are stripped away from
       the response. For example, a <code class="literal">summary</code> entry would not
       need to include a null <code class="literal">targetObjectId</code> field, as this
       field would not make sense in the context of a summary. You can specify
       that this auto-formatting be disabled and return the full entry for all
       entry types. To disable entry formatting, include
       <code class="literal">formatted=false</code> as a query parameter in the request.</p><p>To return all reconciliation operations logged in the audit log,
       run a RESTful GET on the <code class="literal">audit/recon</code> endpoint. For
       example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET
 "http://localhost:8080/openidm/audit/recon"</pre><p>The following code sample shows an extract of the audit log
       after the first reconciliation operation in Sample 1.</p><pre class="codelisting prettyprint linenums lang-js">{
  "entries": [
    {
      "rootActionId": "d0578abf-f38e-4ede-a7dc-5ee9eaa8ce53",
      "messageDetail": null,
      "message": "Reconciliation initiated by openidm-admin",
      "timestamp": "2013-05-08T07:58:33.296Z",
      "reconId": "5cf09dfa-e85c-4d52-ab6c-8ba7c2e3d34f",
      "entryType": "start",
      "_id": "11381e20-3679-469d-a71c-c557c2bd091e",
      "status": "SUCCESS",
      "exception": "",
      "mapping": "systemXmlfileAccounts_managedUser"
    },
    {
      "messageDetail": null,
      "rootActionId": "d0578abf-f38e-4ede-a7dc-5ee9eaa8ce53",
      "situation": "ABSENT",
      "actionId": "86995423-8a43-4fc7-9c3c-9e450e0234cb",
      "targetObjectId": "managed/user/scarter",
      "action": "CREATE",
      "entryType": "",
      "_id": "9f59bb8a-31c6-41af-8f27-02094391ba0c",
      "reconId": "5cf09dfa-e85c-4d52-ab6c-8ba7c2e3d34f",
      "status": "SUCCESS",
      "exception": "",
      "reconciling": "source",
      "ambiguousTargetObjectIds": "",
      "timestamp": "2013-05-08T07:58:33.791Z",
      "message": null,
      "sourceObjectId": "system/xmlfile/account/scarter"
    },
    {
      "messageDetail": null,
      "rootActionId": "d0578abf-f38e-4ede-a7dc-5ee9eaa8ce53",
      "situation": "ABSENT",
      "actionId": "dea9b5c5-7a75-4cab-b8e4-176bea0a94a6",
      "targetObjectId": "managed/user/bjensen",
      "action": "CREATE",
      "entryType": "",
      "_id": "4fd285ef-a409-4875-abd0-5d70965fe172",
      "reconId": "5cf09dfa-e85c-4d52-ab6c-8ba7c2e3d34f",
      "status": "SUCCESS",
      "exception": "",
      "reconciling": "source",
      "ambiguousTargetObjectIds": "",
      "timestamp": "2013-05-08T07:58:33.793Z",
      "message": null,
      "sourceObjectId": "system/xmlfile/account/bjensen"
      },
      {
        "rootActionId": "d0578abf-f38e-4ede-a7dc-5ee9eaa8ce53",
        "messageDetail": {
          "ended": "2013-05-08T07:58:33.813Z",
          "started": "2013-05-08T07:58:33.294Z",
          "situationSummary": {
            "SOURCE_MISSING": 0,
            "FOUND": 0,
            "SOURCE_IGNORED": 0,
            "UNQUALIFIED": 0,
            "UNASSIGNED": 0,
            "TARGET_IGNORED": 0,
            "CONFIRMED": 0,
            "AMBIGUOUS": 0,
            "ABSENT": 2,
            "MISSING": 0
          },
          "progress": {
            "links": {
              "created": 2,
              "existing": {
                "total": "0",
                "processed": 0
              }
            },
            "target": {
              "created": 2,
              "existing": {
                "total": "0",
                "processed": 0
              }
            },
            "source": {
              "existing": {
                "total": "2",
                "processed": 2
              }
            }
          },
          "stageDescription": "reconciling target entries",
          "stage": "ACTIVE_RECONCILING_TARGET",
          "state": "ACTIVE",
          "mapping": "systemXmlfileAccounts_managedUser"
        },
        "message": "SOURCE_IGNORED: 0 MISSING: 0 FOUND: 0 AMBIGUOUS: 0 UNQUALIFIED: 0
           CONFIRMED: 0 SOURCE_MISSING: 0 ABSENT: 2 TARGET_IGNORED: 0 UNASSIGNED: 0 ",
        "timestamp": "2013-05-08T07:58:33.813Z",
        "reconId": "5cf09dfa-e85c-4d52-ab6c-8ba7c2e3d34f",
        "entryType": "summary",
        "_id": "a8a81f9f-fa8f-49f4-a0d6-c88b5fc4be2a",
        "status": "SUCCESS",
        "exception": "",
        "mapping": "systemXmlfileAccounts_managedUser"
      }
    ]
}</pre><p>Most of the fields in this audit log are self-explanatory. Each
       distinct reconciliation operation is identified by its
       <code class="literal">reconId</code>. Each entry in the log is identified by a
       unique <code class="literal">_id</code>. The first log entry indicates the status
       for the complete reconciliation operation. Successive entries indicate
       the status for each record affected by the reconciliation.</p><p>To obtain information on a specific audit log entry, include its
       entry <code class="literal">_id</code> in the endpoint. For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET
 "http://localhost:8080/openidm/audit/recon/9f59bb8a-31c6-41af-8f27-02094391ba0c"</pre><p>The following sample output shows the results of a read operation
       on a specific reconciliation audit entry.</p><pre class="codelisting prettyprint linenums lang-js">{
 "messageDetail": null,
 "rootActionId": "d0578abf-f38e-4ede-a7dc-5ee9eaa8ce53",
 "situation": "ABSENT",
 "actionId": "86995423-8a43-4fc7-9c3c-9e450e0234cb",
 "targetObjectId": "managed/user/scarter",
 "action": "CREATE",
 "entryType": "",
 "_id": "9f59bb8a-31c6-41af-8f27-02094391ba0c",
 "reconId": "5cf09dfa-e85c-4d52-ab6c-8ba7c2e3d34f",
 "status": "SUCCESS",
 "exception": "",
 "reconciling": "source",
 "ambiguousTargetObjectIds": "",
 "timestamp": "2013-05-08T07:58:33.791Z",
 "message": null,
 "sourceObjectId": "system/xmlfile/account/scarter"
}</pre><p>To query the audit log for a particular reconciliation operation,
       use the <code class="literal">audit-by-recon-id</code> keyword, specifying the
       reconciliation ID, as follows:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET
 "http://localhost:8080/openidm/audit/recon/?_queryId=audit-by-recon-id&amp;reconId=&lt;reconID&gt;"</pre><p>Output similar to the following is returned, for the specified
       reconciliation operation:</p><pre class="codelisting prettyprint linenums lang-js">{
  "start": {
    "rootActionId": "3c098d6f-a5e5-483c-a8ce-82911a10b0a9",
    "messageDetail": null,
    "message": "Reconciliation initiated by openidm-admin",
    "timestamp": "2013-05-14T08:20:41.343Z",
    "reconId": "1ef8e7b6-33dc-4f92-810a-b51913508a68",
    "entryType": "start",
    "_id": "ce58ef39-425d-4711-94b9-a9c77df23001",
    "status": "SUCCESS",
    "exception": "",
    "mapping": "systemXmlfileAccounts_managedUser"
  },
  "result": [
    {
      "messageDetail": null,
      "rootActionId": "3c098d6f-a5e5-483c-a8ce-82911a10b0a9",
      "situation": "ABSENT",
      "actionId": "1a391fe8-201b-4f59-ad05-92ee804488a8",
      "targetObjectId": "managed/user/scarter",
      "action": "CREATE",
      "entryType": "",
      "_id": "6dc0a18a-826d-487d-a29f-5cd8d2f55465",
      "reconId": "1ef8e7b6-33dc-4f92-810a-b51913508a68",
      "status": "SUCCESS",
      "exception": "",
      "reconciling": "source",
      "ambiguousTargetObjectIds": "",
      "timestamp": "2013-05-14T08:20:41.763Z",
      "message": null,
      "sourceObjectId": "system/xmlfile/account/scarter"
    },
    {
      "messageDetail": null,
      "rootActionId": "3c098d6f-a5e5-483c-a8ce-82911a10b0a9",
      "situation": "ABSENT",
      "actionId": "0aaba292-1dd3-4e98-a0e2-04bec9ae5209",
      "targetObjectId": "managed/user/bjensen",
      "action": "CREATE",
      "entryType": "",
      "_id": "1cda457e-54e2-451b-8a40-ef93dec7e60c",
      "reconId": "1ef8e7b6-33dc-4f92-810a-b51913508a68",
      "status": "SUCCESS",
      "exception": "",
      "reconciling": "source",
      "ambiguousTargetObjectIds": "",
      "timestamp": "2013-05-14T08:20:41.760Z",
      "message": null,
      "sourceObjectId": "system/xmlfile/account/bjensen"
    }
  ],
  "summary": {
    "rootActionId": "3c098d6f-a5e5-483c-a8ce-82911a10b0a9",
    "messageDetail": {
      "ended": "2013-05-14T08:20:41.783Z",
      "started": "2013-05-14T08:20:41.342Z",
      "situationSummary": {
        "SOURCE_MISSING": 0,
        "FOUND": 0,
        "SOURCE_IGNORED": 0,
        "UNQUALIFIED": 0,
        "UNASSIGNED": 0,
        "TARGET_IGNORED": 0,
        "CONFIRMED": 0,
        "AMBIGUOUS": 0,
        "ABSENT": 2,
        "MISSING": 0
      },
      "progress": {
        "links": {
          "created": 2,
          "existing": {
            "total": "0",
            "processed": 0
          }
        },
        "target": {
          "created": 2,
          "existing": {
            "total": "0",
            "processed": 0
          }
        },
        "source": {
          "existing": {
            "total": "2",
            "processed": 2
          }
        }
      },
      "stageDescription": "reconciling target entries",
      "stage": "ACTIVE_RECONCILING_TARGET",
      "state": "ACTIVE",
      "mapping": "systemXmlfileAccounts_managedUser"
    },
    "message": "SOURCE_IGNORED: 0 MISSING: 0 FOUND: 0 AMBIGUOUS: 0 UNQUALIFIED: 0
       CONFIRMED: 0 SOURCE_MISSING: 0 ABSENT: 2 TARGET_IGNORED: 0 UNASSIGNED: 0 ",
    "timestamp": "2013-05-14T08:20:41.783Z",
    "reconId": "1ef8e7b6-33dc-4f92-810a-b51913508a68",
    "entryType": "summary",
    "_id": "94c5893c-4ea8-4464-aff2-5533d6369722",
    "status": "SUCCESS",
    "exception": "",
    "mapping": "systemXmlfileAccounts_managedUser"
  }
}</pre><p>Note that the response structure of a read request on <code class="literal">audit/recon</code>
       differs from the response structure of a query by <code class="literal">recon-id</code>.
       The read response contains a flat list of entries. The query response
       separates the <code class="literal">summary</code> and <code class="literal">start</code>
       event type entries. Other entries are listed under the <code class="literal">result</code>
       entry.</p><p>To query the audit log for a specific reconciliation situation,
       use the <code class="literal">audit-by-recon-id-situation</code> keyword, specifying
       the reconciliation ID and the situation that you want to query. For
       example, the following query returns all ABSENT records found during
       the specified reconciliation operation:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET
 "http://localhost:8080/openidm/audit/recon?_queryId=audit-by-recon-id-situation&amp;situation=
 ABSENT&amp;reconId=fd2a59df-1fcd-444d-97ca-2c8a7ec6dc6c"</pre><p>Output similar to the following is returned, with one entry for
       each record that matches the situation queried:</p><pre class="codelisting prettyprint linenums lang-js">{
  "result": [
    {
      "messageDetail": null,
      "rootActionId": "3c098d6f-a5e5-483c-a8ce-82911a10b0a9",
      "situation": "ABSENT",
      "actionId": "1a391fe8-201b-4f59-ad05-92ee804488a8",
      "targetObjectId": "managed/user/scarter",
      "action": "CREATE",
      "entryType": "",
      "_id": "6dc0a18a-826d-487d-a29f-5cd8d2f55465",
      "reconId": "1ef8e7b6-33dc-4f92-810a-b51913508a68",
      "status": "SUCCESS",
      "exception": "",
      "reconciling": "source",
      "ambiguousTargetObjectIds": "",
      "timestamp": "2013-05-14T08:20:41.763Z",
      "message": null,
      "sourceObjectId": "system/xmlfile/account/scarter"
    },
    {
      "messageDetail": null,
      "rootActionId": "3c098d6f-a5e5-483c-a8ce-82911a10b0a9",
      "situation": "ABSENT",
      "actionId": "0aaba292-1dd3-4e98-a0e2-04bec9ae5209",
      "targetObjectId": "managed/user/bjensen",
      "action": "CREATE",
      "entryType": "",
      "_id": "1cda457e-54e2-451b-8a40-ef93dec7e60c",
      "reconId": "1ef8e7b6-33dc-4f92-810a-b51913508a68",
      "status": "SUCCESS",
      "exception": "",
      "reconciling": "source",
      "ambiguousTargetObjectIds": "",
      "timestamp": "2013-05-14T08:20:41.760Z",
      "message": null,
      "sourceObjectId": "system/xmlfile/account/bjensen"
    }
  ]
}</pre><p>The activity logs track all operations on internal (managed) and
       external (system) objects. Entries in the activity log contain
       identifiers for the reconciliation or synchronization action that
       triggered the activity, and for the original caller and the
       relationships between related actions.</p><p>You can access the activity logs over REST with the following call:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET
 "http://localhost:8080/openidm/audit/activity"</pre><p>The following extract of the activity log shows the last entry in
       the log, which was a password change for user bjensen.</p><pre class="cmdline prettyprint">{
  "entries": [
    {
      "rootActionId": "3c098d6f-a5e5-483c-a8ce-82911a10b0a9",
      "action": "create",
      "objectId": "managed/user/bjensen",
      "_rev": "0",
      "_id": "22ef6d20-bd84-4267-9db8-745825a46ad1",
      "timestamp": "2013-05-14T08:20:41.712Z",
      "message": null,
      "activityId": "aa964020-b343-4d23-8e00-745ed4b79f50",
      "parentActionId": "0aaba292-1dd3-4e98-a0e2-04bec9ae5209",
      "requester": "openidm-admin",
      "rev": "0",
      "passwordChanged": true,
      "status": "SUCCESS",
      "before": null,
      "changedFields": [
        "/password"
      ],
      "after": {
        "securityAnswer": {
          "$crypto": {
            "type": "x-simple-encryption",
            "value": {
              "key": "openidm-sym-default",
              "iv": "c6gZKz4sSL2YNTBwwFXIzw==",
              "cipher": "AES/CBC/PKCS5Padding",
              "data": "7FATEBtuLlLfMXGokfLrtJ2rXPEsE1YTIXSoGQCum4w="
            }
          }
        },
       ...</pre><p>To return activity information for a specific action, include the
       <code class="literal">_id</code> of the action in the endpoint, for example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET
 "http://localhost:8080/openidm/audit/activity/22ef6d20-bd84-4267-9db8-745825a46ad1"</pre><p>Results similar to the following are returned:</p><pre class="codelisting prettyprint linenums lang-js">{
  "rootActionId": "3c098d6f-a5e5-483c-a8ce-82911a10b0a9",
  "action": "create",
  "objectId": "managed/user/bjensen",
  "timestamp": "2013-05-14T08:20:41.712Z",
  "message": null,
  "activityId": "aa964020-b343-4d23-8e00-745ed4b79f50",
  "after": {
    "securityAnswer": {
      "$crypto": {
        "type": "x-simple-encryption",
        "value": {
          "key": "openidm-sym-default",
          "iv": "c6gZKz4sSL2YNTBwwFXIzw==",
          "cipher": "AES/CBC/PKCS5Padding",
          "data": "7FATEBtuLlLfMXGokfLrtJ2rXPEsE1YTIXSoGQCum4w="
        }
      }
    },
    "stateProvince": "",
    "userName": "bjensen@example.com",
    "roles": "openidm-authorized",
    "description": "Created By XML1",
    "accountStatus": "active",
    "password": {
      "$crypto": {
        "type": "x-simple-encryption",
        "value": {
          "key": "openidm-sym-default",
          "iv": "bqhRyLW1lI+KZROcpgyukg==",
          "cipher": "AES/CBC/PKCS5Padding",
          "data": "qO8A76GqNqftVVwOlasyPw=="
        }
      }
    },
    "securityQuestion": "1",
    "givenName": "Barbara",
    "address2": "",
    "lastPasswordAttempt": "Tue May 14 2013 10:20:41 GMT+0200 (SAST)",
    "address1": "",
    "familyName": "Jensen",
    "passwordAttempts": "0",
    "country": "",
    "city": "",
    "_rev": "0",
    "lastPasswordSet": "",
    "postalCode": "",
    "phoneNumber": "1234567",
    "_id": "bjensen",
    "email": "bjensen@example.com"
  },
  "changedFields": [
    "/password"
  ],
  "_id": "22ef6d20-bd84-4267-9db8-745825a46ad1",
  "_rev": "0",
  "parentActionId": "0aaba292-1dd3-4e98-a0e2-04bec9ae5209",
  "requester": "openidm-admin",
  "rev": "0",
  "passwordChanged": true,
  "status": "SUCCESS",
  "before": null
}</pre><p>Each action in the activity log has a <code class="literal">rootActionId</code>
       and a <code class="literal">parentActionId</code>. The <code class="literal">rootActionId</code>
       is the ID that was assigned to the incoming or initiating request. The
       <code class="literal">parentActionId</code> is the ID that is associated with the
       overall action. So, for example, if an HTTP request invokes a script that
       changes a user's password, the HTTP request is assigned the
       <code class="literal">rootActionId</code> and the action taken by the script is
       assigned the <code class="literal">parentActionId</code>. You can query the activity
       log for the details of a specific action by including the
       <code class="literal">parentActionId</code> in the query. For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET
 "http://localhost:8080/openidm/audit/activity?_queryId=audit-by-activity-parent-action&amp;
           parentActionId=90ce7473-98c7-4747-bfbb-32bfa3ce5d92"</pre><p>The following sample output shows the result of a query that requests
       details of the password change for bjensen.</p><pre class="codelisting prettyprint linenums lang-js">{
  "result": [
    {
      "rootActionId": "3c098d6f-a5e5-483c-a8ce-82911a10b0a9",
      "action": "create",
      "objectId": "managed/user/bjensen",
      "_rev": "0",
      "_id": "22ef6d20-bd84-4267-9db8-745825a46ad1",
      "timestamp": "2013-05-14T08:20:41.712Z",
      "message": null,
      "activityId": "aa964020-b343-4d23-8e00-745ed4b79f50",
      "parentActionId": "0aaba292-1dd3-4e98-a0e2-04bec9ae5209",
      "requester": "openidm-admin",
      "rev": "0",
      "passwordChanged": true,
      "status": "SUCCESS",
      "before": null,
      "changedFields": [
        "/password"
      ],
      "after": {
        "securityAnswer": {
          "$crypto": {
            "type": "x-simple-encryption",
            "value": {
              "key": "openidm-sym-default",
              "iv": "c6gZKz4sSL2YNTBwwFXIzw==",
              "cipher": "AES/CBC/PKCS5Padding",
              "data": "7FATEBtuLlLfMXGokfLrtJ2rXPEsE1YTIXSoGQCum4w="
            }
          }
        },
        "stateProvince": "",
        "userName": "bjensen@example.com",
        "roles": "openidm-authorized",
        "description": "Created By XML1",
        "accountStatus": "active",
        "password": {
          "$crypto": {
            "type": "x-simple-encryption",
            "value": {
              "key": "openidm-sym-default",
              "iv": "bqhRyLW1lI+KZROcpgyukg==",
              "cipher": "AES/CBC/PKCS5Padding",
              "data": "qO8A76GqNqftVVwOlasyPw=="
            }
          }
        },
        "securityQuestion": "1",
        "givenName": "Barbara",
        "address2": "",
        "lastPasswordAttempt": "Tue May 14 2013 10:20:41 GMT+0200 (SAST)",
        "address1": "",
        "familyName": "Jensen",
        "passwordAttempts": "0",
        "country": "",
        "city": "",
        "_rev": "0",
        "lastPasswordSet": "",
        "postalCode": "",
        "phoneNumber": "1234567",
        "_id": "bjensen",
        "email": "bjensen@example.com"
      }
    }
  ]
}</pre><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>For audit logs in the repository, you can define custom queries
         using the parameterized query mechanism. For more information, see
         the section on <a href="../integrators-guide/index.html#parameterized-queries" class="link"><em class="citetitle">Parameterized Queries</em></a>
         </p></div></div><p>For more information about the entries in these logs, see
       the chapter that covers <a href="../integrators-guide/index.html#chap-auditing" class="link"><em class="citetitle">Using Audit
       Logs</em></a>.</p></div></div><div class="section" id="livesync-over-rest"><div class="titlepage"><div><div><h2 class="title" style="clear: both">10.3.&nbsp;Triggering LiveSync Over REST</h2></div></div></div><p>The ability to trigger LiveSync operations over REST, or by using
      the resource API, enables you to use an external scheduler to trigger a
      LiveSync operation, rather than using the OpenIDM scheduling mechanism.
      </p><div class="itemizedlist"><p>There are two ways in which to trigger a LiveSync operation
              over REST.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Use the <code class="literal">_action=liveSync</code> parameter
                  directly on the resource. This is the recommended method.
                  The following example calls a LiveSync operation on the user
                  accounts in an external LDAP system.
              </p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/system/ldap/account?_action=liveSync"
              </pre></li><li class="listitem"><p>Target the <code class="literal">system</code> endpoint and supply
                    a <code class="literal">source</code> parameter to identify the object
                    that should be synchronized. This method matches the scheduler
                    configuration and can therefore be used to test schedules
                    before they are implemented.</p><p>The following example calls the same LiveSync operation
                    as the previous example.</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/system?_action=liveSync&amp;source=system/ldap/account"
                </pre></li></ul></div><p>A successful LiveSync operation returns the following response:</p><pre class="cmdline prettyprint">{
    "_id": "SYSTEMLDAPACCOUNT",
    "_rev": "0",
    "connectorData": {
        "syncToken": 1,
        "nativeType": "integer"
    }
}
        </pre><p>You should not run two identical LiveSync operations simultaneously -
          you must ensure that the first operation has completed before a second
          similar operation is launched.</p><p>To troubleshoot a LiveSync operation that has not succeeded, you
            can include an optional parameter (<code class="literal">detailedFailure</code>)
            to return additional information. For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/system/ldap/account?_action=liveSync&amp;detailedFailure=true"
        </pre><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>The first time that a LiveSync operation is called, no
            synchronization token exists in the database to establish which
            changes have already been processed. The default LiveSync behavior
            is to locate the last existing entry in the change log, and to
            store that entry in the database as the current starting position
            from which changes should be applied. This behavior prevents
            LiveSync from processing changes that might already have been
            processed during an initial data load. Subsequent LiveSync operations
            will pick up and process any new changes.</p><p>Typically, in setting up LiveSync on a new system, you would
            load the data initially (by using reconciliation, for example) and
            then enable LiveSync, starting from that base point.</p></div></div></div><div class="section" id="sync-flexible-data"><div class="titlepage"><div><div><h2 class="title" style="clear: both">10.4.&nbsp;Flexible Data Model</h2></div></div></div><a class="indexterm" name="d0e6068"></a><p>Identity management software tends to favor either a meta-directory
  data model, where all data are mirrored in a central repository, or a
  virtual data model, where only a minimum set of attributes are stored
  centrally, and most are loaded on demand from the external resources
  in which they are stored. The meta-directory model offers fast access at
  the risk of getting out-of-date data. The virtual model guarantees fresh
  data, but pays for that guarantee in terms of performance.</p><p>OpenIDM leaves the data model choice up to you. You determine the right
  trade offs for a particular deployment. OpenIDM does not hard code any
  particular schema or set of attributes stored in the repository. Instead,
  you define how external system objects map onto managed objects, and OpenIDM
  dynamically updates the repository to store the managed object attributes
  that you configure.</p><p>You can, for example, choose to follow the data model defined in the
  Simple Cloud Identity Management (<a class="link" href="http://www.simplecloud.info/specs/draft-scim-core-schema-00.html" target="_blank">SCIM</a>) specification. The following object represents a SCIM
  user.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "userName": "james1",
    "familyName": "Berg",
    "givenName": "James",
    "email": [
        "james1@example.com"
    ],
    "description": "Created by OpenIDM REST.",
    "password": "asdfkj23",
    "displayName": "James Berg",
    "phoneNumber": "12345",
    "employeeNumber": "12345",
    "userType": "Contractor",
    "title": "Vice President",
    "active": true
}</pre><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>Avoid using the dash character ( <code class="literal">-</code> ) in property
   names, like <code class="literal">last-name</code>, as dashes in names make
   JavaScript syntax more complex. If you cannot avoid the dash, then write
   <code class="literal">source['last-name']</code> instead of
   <code class="literal">source.last-name</code> in java script.</p></div></div></div><div class="section" id="basic-flow"><div class="titlepage"><div><div><h2 class="title" style="clear: both">10.5.&nbsp;Basic Data Flow Configuration</h2></div></div></div><p>Data flow for synchronization involves the following elements:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Connector configuration files
  (<code class="filename">conf/provisioner-*.json</code>), with one file per external
  resource.</p></li><li class="listitem"><p>Synchronization mappings file
  (<code class="filename">conf/sync.json</code>), with one file per OpenIDM instance.
  </p></li><li class="listitem"><p>A links table that OpenIDM maintains in its repository.</p></li><li class="listitem"><p>The scripts required to check objects and manipulate attributes.</p></li></ul></div><div class="section" id="connector-config-files"><div class="titlepage"><div><div><h3 class="title">10.5.1.&nbsp;Connector Configuration Files</h3></div></div></div><a class="indexterm" name="d0e6126"></a><p>Connector configuration files map external resource objects to OpenIDM
     objects, and are described in detail in the chapter on <a href="../integrators-guide/index.html#chap-resource-conf" class="link"><em class="citetitle">Connecting to
     External Resources</em></a>. Connector configuration files are
     named <code class="filename">openidm/conf/provisioner.<em class="replaceable"><code>resource-name</code></em>.json</code>,
     where <em class="replaceable"><code>resource-name</code></em> reflects the connector
     technology and external resource, such as
     <code class="literal">openicf-xml</code>.</p><p>An excerpt from an example connector configuration follows. The
     example shows the name for the connector and two attributes of an account
     object type. In the attribute mapping definitions, the attribute name is
     mapped from the <code class="literal">nativeName</code>, the attribute name used on
     the external resource, to the attribute name used in OpenIDM. Thus the
     example shows that the <code class="literal">sn</code> attribute in LDAP is mapped to
     <code class="literal">lastName</code> in OpenIDM. The <code class="literal">homePhone</code>
     attribute can have multiple values.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "name": "MyLDAP",
    "objectTypes": {
        "account": {
            "lastName": {
                "type": "string",
                "required": true,
                "nativeName": "sn",
                "nativeType": "string"
            },
            "homePhone": {
                "type": "array",
                "items": {
                    "type": "string",
                    "nativeType": "string"
                },
                "nativeName": "homePhone",
                "nativeType": "string"
            }
        }
    }
}</pre><p>In order for OpenIDM to access external resource objects and
    attributes, the object and its attributes must match the connector
    configuration. Note that the connector file only maps external resource
    objects to OpenIDM objects. To construct attributes and to manipulate
    their values, you use the synchronization mappings file.</p></div><div class="section" id="synchronization-mappings-file"><div class="titlepage"><div><div><h3 class="title">10.5.2.&nbsp;Synchronization Mappings File</h3></div></div></div><a class="indexterm" name="d0e6170"></a><a class="indexterm" name="d0e6175"></a><p>The synchronization mappings file (<code class="filename">openidm/conf/sync.json</code>)
         represents the core configuration for OpenIDM synchronization.
     </p><p>The <code class="filename">sync.json</code> file describes a set of mappings.
     Each mapping specifies how attributes from source objects correspond to
     attributes on target objects. The source and target indicate the direction
     for the data flow, so you must define a separate mapping for each data
     flow. For example, if you want data flows from an LDAP server to the
     repository and also from the repository to the LDAP server, you must
     define two separate mappings.</p><p>You identify external resource sources and targets as
     <code class="literal">system/<em class="replaceable"><code>name</code></em>/<em class="replaceable"><code>object-type</code></em></code>, where
     <em class="replaceable"><code>name</code></em> is the name used in the connector
     configuration file, and <em class="replaceable"><code>object-type</code></em> is the
     object defined in the connector configuration file list of object types.
     For objects in OpenIDM's internal repository, you use
     <code class="literal">managed/<em class="replaceable"><code>object-type</code></em></code>, where
     <em class="replaceable"><code>object-type</code></em> is defined in
     <code class="filename">openidm/conf/managed.json</code>. The name for the mapping
     by convention is set to a string of the form
     <code class="literal"><em class="replaceable"><code>source</code></em>_<em class="replaceable"><code>target</code></em></code>, as shown in the following example.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "mappings": [
        {
            "name": "systemLdapAccounts_managedUser",
            "source": "system/MyLDAP/account",
            "target": "managed/user",
            "properties": [
                {
                    "target": "familyName",
                    "source": "lastName"
                },
                {
                    "target": "homePhone",
                    "source": "homePhone"
                },
                {
                    "target": "phoneExtension",
                    "default": "0047"
                },
                {
                    "target": "mail",
                    "comment": "Set mail if non-empty.",
                    "source": "email",
                    "condition": {
                        "type": "text/javascript",
                        "source": "(object.email != null)"
                    }
                },
                {
                    "target": "displayName",
                    "source": "",
                    "transform": {
                        "type": "text/javascript",
                        "source": "source.lastName +', ' + source.firstName;"
                    }
                }
            ]
        }
    ]
}</pre><p>In this example, the source is the external resource,
     <code class="literal">MyLDAP</code>, and the target is OpenIDM's repository,
     specifically the managed user objects. The <code class="literal">properties</code>
     reflect OpenIDM attribute names. For example, the mapping has the
     attribute <code class="literal">lastName</code> defined in the
     <code class="literal">MyLDAP</code> connector configuration file mapped to
     <code class="literal">familyName</code> in the OpenIDM managed user object. Notice
     that the attribute names come from the connector configuration, rather
     than the external resource itself.</p><a class="indexterm" name="d0e6241"></a><p>You can create attributes on the target as part of the mapping. In
     the preceding example, a <code class="literal">phoneExtension</code> attribute with
     a default value of <code class="literal">0047</code> is created on the target. The
     <code class="literal">"default"</code> property can also be used to specify the
     value to assign to the target property if the <code class="literal">"source"</code>
     property and the <code class="literal">"transform"</code> script yield a null value.
     If no value is specified, the default value is null.
     </p><a class="indexterm" name="d0e6263"></a><p>You can also set up conditions under which OpenIDM maps attributes
     as shown for the email attribute in the example. By default, OpenIDM
     synchronizes all attributes. In the example, the mail attribute is set
     only if the script for the condition returns <code class="literal">true</code>.
     </p><a class="indexterm" name="d0e6273"></a><p>OpenIDM also enables you to transform attributes. In the example,
     the value of the <code class="literal">displayName</code> attribute is set using a
     combination of the <code class="literal">lastName</code> and
     <code class="literal">firstName</code> attribute values from the source. For
     transformations, the <code class="literal">source</code> property is optional.
     However, the source object is only available when you specify the
     <code class="literal">source</code> property. Therefore, in order to use
     <code class="literal">source.lastName</code> and <code class="literal">source.firstName</code>
     to calculate the <code class="literal">displayName</code>, the example specifies
     <code class="literal">"source" : ""</code>.</p><p>To add a flow from the repository to <code class="literal">MyLDAP</code>,
     you would define a mapping with source <code class="literal">managed/user</code>
     and target <code class="literal">system/MyLDAP/account</code>, named for example
     <code class="literal">managedUser_systemLdapAccounts</code>.</p><p>The following image shows the paths to objects in the OpenIDM
     namespace.</p><div class="mediaobject" align="center" id="figure-service-tree"><a class="fancybox" href="images/ServiceTree.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_ServiceTree.png" align="middle" alt="OpenIDM namespace and object paths" title="The image shows paths to objects in the OpenIDM namespace."></a><div class="caption"><p>OpenIDM stores managed objects in the repository, and exposes
       them under <code class="literal">/openidm/managed</code>. System objects on
       external resources are exposed under
       <code class="literal">/openidm/system</code>.</p></div></div><div class="variablelist"><a class="indexterm" name="d0e6342"></a><p>By default, OpenIDM synchronizes all objects that match those
      defined in the connector configuration for the resource. Many connectors
      allow you to limit the scope of objects that the connector accesses. For
      example, the LDAP connector allows you to specify base DNs and LDAP
      filters so that you do not need to access every entry in the directory.
      OpenIDM also allows you to filter what is considered a valid source or
      valid target for synchronization by using JavaScript code. To apply these
      filters, use the <code class="literal">validSource</code>, and
      <code class="literal">validTarget</code> properties in your mapping.</p><dl class="variablelist"><dt><span class="term">validSource</span></dt><dd><p>A script that determines if a source object is valid to be
         mapped. The script yields a boolean value: <code class="literal">true</code>
         indicates that the source object is valid; <code class="literal">false</code>
         can be used to defer mapping until some condition is met. In the root
         scope, the source object is provided in the <code class="literal">"source"</code>
         property. If the script is not specified, then all source objects are
         considered valid.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "validSource": {
        "type": "text/javascript",
        "source": "source.ldapPassword != null"
    }
}
</pre></dd><dt><span class="term">validTarget</span></dt><dd><p>A script, used during reconciliation's second phase, that
        determines if a target object is valid to be mapped. The script yields
        a boolean value: <code class="literal">true</code> indicates that the target
        object is valid; <code class="literal">false</code> indicates that the target
        object should not be included in reconciliation. In the root scope, the
        source object is provided in the <code class="literal">"target"</code> property.
        If the script is not specified, then all target objects are considered
        valid for mapping.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "validTarget": {
        "type": "text/javascript",
        "source": "target.employeeType == 'internal'"
    }
}
</pre></dd></dl></div><p>During synchronization, your scripts always have access to a
     <code class="literal">source</code> object and a <code class="literal">target</code> object.
     Examples already shown in this section use <code class="literal">source.<em class="replaceable"><code>attributeName</code></em></code> to retrieve attributes from the
     source objects. Your scripts can also write to target attributes using
     <code class="literal">target.<em class="replaceable"><code>attributeName</code></em></code>
     syntax.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "onUpdate": {
        "type": "text/javascript",
        "source": "if (source.email != null) {target.mail = source.email;}"
    }
}</pre><p>See the <a href="../integrators-guide/index.html#appendix-scripting" class="link"><em class="citetitle">Scripting
     Reference</em></a> appendix for more on scripting.</p><p>By default, all mappings participate in automatic synchronization
   operations. You can prevent a specific mapping from participating in
   automatic synchronization by setting the <code class="literal">"enableSync"</code>
   property of that mapping to false. In the following example, automatic
   synchronization is disabled. This means that changes to objects in the internal
   repository are not automatically propagated to the LDAP directory. To
   propagate changes to the LDAP directory, reconciliation must be launched
   manually.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "mappings" : [
        {
            "name" : "managedUser_systemLdapAccounts",
            "source" : "managed/user",
            "target" : "system/ldap/account",
            "enableSync" : false,
             ....
}
   </pre></div><div class="section" id="sync-encrypted-values"><div class="titlepage"><div><div><h3 class="title">10.5.3.&nbsp;Using Encrypted Values</h3></div></div></div><a class="indexterm" name="d0e6425"></a><p>OpenIDM supports reversible encryption of attribute values for
   managed objects. Attribute values to encrypt include passwords,
   authentication questions, credit card numbers, and social security numbers.
   If passwords are already encrypted on the external resource, they are
   generally excluded from the synchronization process. For more information,
   see <a href="../integrators-guide/index.html#chap-passwords" class="link">
           <em class="citetitle">Managing Passwords</em></a>.</p><p>You configure encryption in the managed object configuration (in the
   <code class="filename">openidm/conf/managed.json</code> file). The following
   example shows a managed object configuration that encrypts and decrypts
   <code class="literal">securityAnswer</code>, <code class="literal">ssn</code>, and
   <code class="literal">password</code> attributes using the default symmetric
   key, and additional scripts for extra passwords.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "objects": [
        {
            "name": "user",
            "properties": [
                {
                    "name": "securityAnswer",
                    "encryption": {
                        "key": "openidm-sym-default"
                    }
                },
                {
                    "name": "ssn",
                    "encryption": {
                        "key": "openidm-sym-default"
                    }
                },
                {
                    "name": "password",
                    "encryption": {
                        "key": "openidm-sym-default"
                    }
                }
            ],
            "onStore": {
                "type": "text/javascript",
                "file": "script/encryptExtraPassword.js"
            },
            "onRetrieve": {
                "type": "text/javascript",
                "file": "script/decryptExtraPassword.js"
            }
        }
    ]
}</pre><p>Do not use the default symmetric key,
   <code class="literal">openidm-sym-default</code>, in production. See the chapter on
   <a href="../integrators-guide/index.html#chap-security" class="link"><em class="citetitle">Securing
   and Hardening OpenIDM</em></a> for instructions on adding your
   own symmetric key.</p></div><div class="section" id="restricting-http-access"><div class="titlepage"><div><div><h3 class="title">10.5.4.&nbsp;Restricting HTTP Access to Sensitive Data</h3></div></div></div><p>You can protect specific sensitive data stored in the repository by
   marking the corresponding properties as "private". Private data, whether it
   is encrypted or not, is not accessible over the REST interface. Properties
   that are marked as private are removed from an object when that object is
   retrieved over REST.</p><p>To mark a property as private, set its <code class="literal">"scope"</code> to
   <code class="literal">"private"</code> in the <code class="filename">conf/managed.json</code>
   file.</p><p>The following extract of the <code class="filename">managed.json</code> file
   shows how HTTP access is prevented on the <code class="literal">password</code> and
   <code class="literal">securityAnswer</code> properties.</p><pre class="codelisting prettyprint linenums lang-js">
       "properties" : [
           {
               "name" : "securityAnswer",
               "encryption" : {
                   "key" : "openidm-sym-default"
               },
               "scope" : "private"
           },
           {
               "name" : "password",
               "encryption" : {
                   "key" : "openidm-sym-default"
               },
               "scope" : "private"
   </pre><p>A potential caveat with using private properties is that such
   properties are <span class="emphasis"><em>removed</em></span> if an object is updated by
   using an HTTP <code class="literal">PUT</code> request. A <code class="literal">PUT</code>
   request replaces the entire object in the repository. Because properties
   that are marked as private are ignored in HTTP requests, these properties
   are effectively removed from the object when the update is done. To work
   around this limitation, do not use <code class="literal">PUT</code> requests if you
   have configured private properties. Instead, use a <code class="literal">PATCH</code>
   request to update only those properties that need to be changed.
   </p><p>For example, to update the familyName of user joe, replace only the
   familyName and not the entire user object, as follows:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --header "Content-Type: application/json"
 --request POST
 --data '[{"replace":"familyName","value": "Brown"}]'
 "http://localhost:8080/openidm/managed/user?_action=patch&amp;_queryId=for-userName&amp;uid=joe"
   </pre><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>The filtering of private data applies only to direct HTTP read
    and query calls on managed objects. No automatic filtering is done for
    internal callers, and the data that these callers choose to expose.</p></div></div></div><div class="section" id="constructing-attributes"><div class="titlepage"><div><div><h3 class="title">10.5.5.&nbsp;Constructing and Manipulating Attributes</h3></div></div></div><a class="indexterm" name="d0e6518"></a><p>OpenIDM enables you to construct and manipulate attributes using
       scripts that are triggered when an object is created (onCreate), updated
       (onUpdate), or deleted (onDelete), or when a link is created (onLink),
       or removed (onUnlink).</p><p>The following example derives a DN for an LDAP entry when the entry
   is created in the internal repository.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "onCreate": {
        "type": "text/javascript",
        "source":
            "target.dn = 'uid=' + source.uid + ',ou=people,dc=example,dc=com'"
    }
}</pre></div><div class="section" id="reusing-links"><div class="titlepage"><div><div><h3 class="title">10.5.6.&nbsp;Reusing Links</h3></div></div></div><a class="indexterm" name="d0e6532"></a><p>When two mappings exist to synchronize the same objects bidirectionally,
   you can use the <code class="literal">links</code> property in one mapping to have
   OpenIDM use the same internally managed link for both mappings. Otherwise,
   if no <code class="literal">links</code> property is specified, OpenIDM maintains a
   link for each mapping.</p><p>The following excerpt shows two mappings, one from MyLDAP accounts
   to managed users, and another from managed users to MyLDAP accounts. In
   the second mapping, the <code class="literal">link</code> property tells OpenIDM
   to reuse the links created in the first mapping, rather than create new
   links.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "mappings": [
        {
            "name": "systemMyLDAPAccounts_managedUser",
            "source": "system/MyLDAP/account",
            "target": "managed/user"
        },
        {
            "name": "managedUser_systemMyLDAPAccounts",
            "source": "managed/user",
            "target": "system/MyLDAP/account",
            "links": "systemMyLDAPAccounts_managedUser"
        }
    ]
}</pre></div></div><div class="section" id="handling-sync"><div class="titlepage"><div><div><h2 class="title" style="clear: both">10.6.&nbsp;Synchronization Situations and Actions</h2></div></div></div><a class="indexterm" name="d0e6555"></a><a class="indexterm" name="d0e6560"></a><p>During synchronization, OpenIDM categorizes objects by situation.
  Situations are characterized by whether an object exists on a source or
  target system, whether OpenIDM has registered a link between the source
  object and the target object, and whether the object is considered valid.
  OpenIDM takes action depending on the situation.</p><p>You can define actions for particular situations in the
  <code class="literal">policies</code> section of a synchronization mapping, as
  shown in the following excerpt.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "policies": [
        {
            "situation": "CONFIRMED",
            "action": "UPDATE"
        },
        {
            "situation": "FOUND",
            "action": "IGNORE"
        },
        {
            "situation": "ABSENT",
            "action": "CREATE"
        },
        {
            "situation": "AMBIGUOUS",
            "action": "IGNORE"
        },
        {
            "situation": "MISSING",
            "action": "IGNORE"
        },
        {
            "situation": "UNQUALIFIED",
            "action": "IGNORE"
        },
        {
            "situation": "UNASSIGNED",
            "action": "IGNORE"
        }
    ]
}</pre><p>If you do not define a policy for a particular situation, OpenIDM
  takes the default action for the situation.</p><p>The situations and their corresponding actions are described in the
  following sections.</p><div class="section" id="sync-situations"><div class="titlepage"><div><div><h3 class="title">10.6.1.&nbsp;Synchronization Situations</h3></div></div></div><div class="orderedlist"><p>OpenIDM performs a reconciliation action in two phases:</p><ol class="orderedlist" type="1"><li class="listitem"><p>Source reconciliation, where OpenIDM accounts for source
           objects and associated links based on the configured mapping.</p></li><li class="listitem"><p>Target reconciliation, where OpenIDM iterates over the target
           objects that were not processed in the first phase.</p></li></ol></div><div class="orderedlist"><p>During reconciliation OpenIDM builds three lists, assigning values
    to the objects to reconcile.</p><ol class="orderedlist" type="1"><li class="listitem"><p>All valid objects from the source</p><p>OpenIDM assigns valid source objects <code class="literal">qualifies=1</code>.
     Invalid objects, including those not found in the source system, and
     those filtered out by the script specified <code class="literal">validSource</code>
     property, are assigned <code class="literal">qualifies=0</code>.</p></li><li class="listitem"><p>All records from the appropriate link table</p><p>Objects with corresponding links in the link table of the repository
     are assigned <code class="literal">link=1</code>. Objects without corresponding links
     are assigned <code class="literal">link=0</code>.</p></li><li class="listitem"><p>All valid objects on the target system</p><p>Objects found in the target system are assigned <code class="literal">target=1</code>.
     Objects that are not found in the target system are assigned
     <code class="literal">target=0</code>.</p></li></ol></div><div class="variablelist"><p>Based on the values assigned to objects during source reconciliation,
    OpenIDM assigns situations, listed here with their default actions.</p><dl class="variablelist"><dt><span class="term">"CONFIRMED" (qualifies=1, link=1, target=1)</span></dt><dd><p>The mapping qualifies for a target object, and a link to an
      existing target object was found. Detected during change events and
      reconciliation. Default action: "UPDATE".</p></dd><dt><span class="term">"FOUND" (qualifies=1, link=0, target=1)</span></dt><dd><p>The mapping qualifies for a target object, there is no link to a
      target object, and there is a single target object, correlated by the
      logic found in the correlationQuery. Detected during change events and
      reconciliation. Default action: "UPDATE".</p></dd><dt><span class="term">"ABSENT" (qualifies=1, link=0, target=0)</span></dt><dd><p>The mapping qualifies for a target object, there is no link to a
      target object, and there is no correlated target object found.
      Detected during change events and reconciliation. Default action:
      "CREATE".</p></dd><dt><span class="term">"AMBIGUOUS" (qualifies=1, link=0, target&gt;1)</span></dt><dd><p>The mapping qualifies for a target object, there is no link to a
      target object, but there is more than one correlated target object.
      Detected during source object changes and reconciliation. Default
      action: "EXCEPTION".</p></dd><dt><span class="term">"MISSING" (qualifies=1, link=1, target=0)</span></dt><dd><p>The mapping qualifies for a target object, and there is a
      qualified link to a target object, but the target object is missing.
      Only detected during reconciliation and source object changes in
      synchronous mappings. Default action: "EXCEPTION".</p></dd><dt><span class="term">"UNQUALIFIED" (qualifies=0, link=0 or 1, target=1 or &gt;1)</span></dt><dd><p>The mapping is not qualified for a source object. One or more
      targets are found through the correlation logic. Detected during change
      events and reconciliation. Default action: "DELETE".</p></dd><dt><span class="term">"TARGET_IGNORED" (qualifies=0, link=0 or 1, target=1)</span></dt><dd><p>The mapping is not qualified for a source object. One or more
                targets are found through the correlation logic. Detected only
                during source object changes. Default action: "IGNORE".</p></dd><dt><span class="term">"SOURCE_IGNORED" (qualifies=0, link=0, target=0)</span></dt><dd><p>The source object is unqualified (by validSource), no link, no
               target is found. Detected during source object changes and
               reconciliation. Default action: "IGNORE".</p></dd><dt><span class="term">"LINK_ONLY" (qualifies=n/a, link=1, target=0)</span></dt><dd><p>The source may or may not be qualified, a link is found, but
           no target object is found. Detected only during source object
           changes. Default action: "EXCEPTION".</p></dd><dt><span class="term">"ALL_GONE" (qualifies=n/a, link=0, no previous object available)</span></dt><dd><p>The source may or may not be qualified, no link is found, and
               the server is unable to correlate, as the source cannot
               supply the deleted object. Detected only during source object
               changes. Default action: "IGNORE".</p></dd></dl></div><p>Based on the values assigned to objects during target reconciliation,
    OpenIDM assigns situations, listed here with their default actions.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">"TARGET_IGNORED" (qualifies=0)</span></dt><dd><p>During target reconciliation the target becomes unqualified by the
      "validTarget" script. Only detected during reconciliation. Default
      action: "IGNORE"</p></dd><dt><span class="term">"UNASSIGNED" (qualifies=1, link=0)</span></dt><dd><p>A target object exists for which there is no link. Only detected
      during reconciliation. Default action: "EXCEPTION".</p></dd><dt><span class="term">"CONFIRMED" (qualifies=1, link=1, source=1)</span></dt><dd><p>The mapping qualifies for a target object, and a link to a
      source object exists. Detected only during reconciliation. Default
      action: "UPDATE".</p></dd><dt><span class="term">"UNQUALIFIED" (qualifies=0, link=1, source=1, but source does not
     qualify)</span></dt><dd><p>The mapping is not qualified (by validTarget) for a target object,
      and there is a link from an existing source object where the source
      exists. Detected during change events and reconciliation. Default
      action: "DELETE".</p></dd><dt><span class="term">SOURCE_MISSING (qualifies=1, link=1, source=0)</span></dt><dd><p>The target qualifies and a link is found. But the source object is
      missing. Detected during change events and reconciliation. Default action:
      "DELETE".</p></dd></dl></div><p>The following sections reiterate in detail how OpenIDM assigns
   situations during each of the two synchronization phases.</p></div><div class="section" id="source-reconciliation"><div class="titlepage"><div><div><h3 class="title">10.6.2.&nbsp;Source Reconciliation</h3></div></div></div><p>OpenIDM starts reconciliation and LiveSync by reading a list of
   objects from the resource. For reconciliation, the list includes all
   objects available through the connector. For LiveSync, the list contains
   only changed objects. The connector can filter objects out of the list, too.
   You can filter objects out of the list by using the
   <code class="literal">validSource</code> property.</p><p>OpenIDM then iterates over the list, checking each entry against the
   <code class="literal">validSource</code> filter, classifying objects according to
   their situations as described in <a class="xref" href="#sync-situations" title="10.6.1.&nbsp;Synchronization Situations">Section&nbsp;10.6.1, &#8220;Synchronization Situations&#8221;</a>. OpenIDM
   uses the list of links for the current mapping to classify objects. Finally,
   OpenIDM executes the action configured for the situation.</p><p>The following table shows how OpenIDM assigns the appropriate
   situation during source reconciliation, depending on whether a valid
   source exists (Source Qualifies), whether a link with the appropriate type
   exists in the repository (Link Exists), and how many target objects are
   found, either based on links or correlation results.</p><div class="table" id="d0e6744"><div class="table-title">Table&nbsp;10.1.&nbsp;Resolving Source Reconciliation Situations</div><div class="table-contents"><table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Resolving Source Reconciliation Situations" width="100%" border="0"><colgroup><col width="11%" class="c1"><col width="11%" class="c2"><col width="11%" class="c3"><col width="11%" class="c4"><col width="11%" class="c5"><col width="11%" class="c6"><col width="11%" class="c7"><col width="23%" class="c8"></colgroup><thead><tr><th colspan="2" align="left">Source Qualifies?</th><th colspan="2" align="left">Link Exists?</th><th colspan="3" align="left">Target Objects
       Found<a href="#ftn.d0e6764" class="footnote"><sup class="footnote" id="d0e6764">[a]</sup></a></th><th rowspan="2" align="left" valign="top">Situation</th></tr><tr><th>Yes</th><th>No</th><th>Yes</th><th>No</th><th>0</th><th>1</th><th>&gt; 1</th></tr></thead><tbody><tr><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>TARGET_IGNORED</td></tr><tr><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>SOURCE_MISSING</td></tr><tr><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>UNQUALIFIED</td></tr><tr><td>&nbsp;</td><td>X</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>UNQUALIFIED</td></tr><tr><td>&nbsp;</td><td>X</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>TARGET_IGNORED</td></tr><tr><td>&nbsp;</td><td>X</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>UNQUALIFIED</td></tr><tr><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>ABSENT</td></tr><tr><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>FOUND</td></tr><tr><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>AMBIGUOUS</td></tr><tr><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>MISSING</td></tr><tr><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>CONFIRMED</td></tr></tbody><tbody class="footnotes"><tr><td colspan="8"><div id="ftn.d0e6764" class="footnote"><p><a href="#d0e6764" class="para"><sup class="para">[a] </sup></a>If no link exists for the source object, then
       OpenIDM executes a correlation query. If no previous object is available,
       OpenIDM cannot correlate.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" id="target-reconciliation"><div class="titlepage"><div><div><h3 class="title">10.6.3.&nbsp;Target Reconciliation</h3></div></div></div><p>During source reconciliation, OpenIDM cannot detect situations where
   no source object exists, such as the UNASSIGNED situation. When no source
   object exists, OpenIDM detects the situation during the second
   reconciliation phase, target reconciliation. During target reconciliation,
   OpenIDM iterates over all target objects that do not have a representation
   on the source, checking each object against the
   <code class="literal">validTarget</code> filter, determining the appropriate situation,
   and executing the action configured for the situation.</p><p>The following table shows how OpenIDM assigns the appropriate
   situation during target reconciliation, depending on whether a valid target
   exists (Target Qualifies), whether a link with an appropriate type exists
   in the repository (Link Exists), whether a source object exists
   (Source Exists), and whether the source object qualifies (Source Qualifies).
   Not all situations assigned during source reconciliation are assigned
   during target reconciliation.</p><div class="table" id="d0e6982"><div class="table-title">Table&nbsp;10.2.&nbsp;Resolving Target Reconciliation Situations</div><div class="table-contents"><table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Resolving Target Reconciliation Situations" width="100%" border="0"><colgroup><col width="10%" class="c1"><col width="10%" class="c2"><col width="10%" class="c3"><col width="10%" class="c4"><col width="10%" class="c5"><col width="10%" class="c6"><col width="10%" class="c7"><col width="10%" class="c8"><col width="20%" class="c9"></colgroup><thead><tr><th colspan="2" align="left">Target Qualifies?</th><th colspan="2" align="left">Link Exists?</th><th colspan="2" align="left">Source Exists?</th><th colspan="2" align="left">Source Qualifies?</th><th rowspan="2" align="left" valign="top">Situation</th></tr><tr><th>Yes</th><th>No</th><th>Yes</th><th>No</th><th>Yes</th><th>No</th><th>Yes</th><th>No</th></tr></thead><tbody><tr><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>TARGET_IGNORED</td></tr><tr><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>UNASSIGNED</td></tr><tr><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>CONFIRMED</td></tr><tr><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>UNQUALIFIED</td></tr><tr><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>SOURCE_MISSING</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" id="autosync-and-livesync"><div class="titlepage"><div><div><h3 class="title">10.6.4.&nbsp;Situations Specific to Automatic Synchronization and LiveSync</h3></div></div></div><p>Certain situations occur only during automatic synchronization
      (when OpenIDM pushes changes made in the repository out to external
      systems) and LiveSync (when OpenIDM polls external system change logs
      for changes and updates the repository).</p><p>The following table shows the situations that pertain only
      to automatic sync and LiveSync, when records are
      <span class="emphasis"><em>deleted</em></span> from the source or target resource.</p><div class="table" id="d0e7130"><div class="table-title">Table&nbsp;10.3.&nbsp;Resolving Automatic Sync and LiveSync Delete Situations</div><div class="table-contents"><table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Resolving Automatic Sync and LiveSync Delete Situations" width="100%" border="0"><colgroup><col width="11%" class="c1"><col width="11%" class="c2"><col width="11%" class="c3"><col width="11%" class="c4"><col width="11%" class="c5"><col width="11%" class="c6"><col width="11%" class="c7"><col width="23%" class="c8"></colgroup><thead><tr><th colspan="2" align="left">Source Qualifies?</th><th colspan="2" align="left">Link Exists?</th><th colspan="3" align="left">Target Objects
                          Found<a href="#ftn.d0e7150" class="footnote"><sup class="footnote" id="d0e7150">[a]</sup></a></th><th rowspan="2" align="left" valign="top">Situation</th></tr><tr><th>Yes</th><th>No</th><th>Yes</th><th>No</th><th>0</th><th>1</th><th>&gt; 1</th></tr></thead><tbody><tr><td>N/A</td><td>N/A</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>LINK_ONLY</td></tr><tr><td>N/A</td><td>N/A</td><td>&nbsp;</td><td>X</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>ALL_GONE</td></tr><tr><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>AMBIGUOUS</td></tr><tr><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>UNQUALIFIED</td></tr></tbody><tbody class="footnotes"><tr><td colspan="8"><div id="ftn.d0e7150" class="footnote"><p><a href="#d0e7150" class="para"><sup class="para">[a] </sup></a>If no link exists for the source object, then
                              OpenIDM executes a correlation query. If no previous object is available,
                              OpenIDM cannot correlate.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" id="sync-actions"><div class="titlepage"><div><div><h3 class="title">10.6.5.&nbsp;Synchronization Actions</h3></div></div></div><div class="variablelist"><p>Once OpenIDM has assigned a situation to an object, OpenIDM takes
    the actions configured in the mapping. If no action is configured, then
    OpenIDM takes the default action for the situation. OpenIDM supports the
    following actions.</p><dl class="variablelist"><dt><span class="term">"CREATE"</span></dt><dd><p>Create and link a target object.</p></dd><dt><span class="term">"UPDATE"</span></dt><dd><p>Link and update a target object.</p></dd><dt><span class="term">"DELETE"</span></dt><dd><p>Delete and unlink the target object.</p></dd><dt><span class="term">"LINK"</span></dt><dd><p>Link the correlated target object.</p></dd><dt><span class="term">"UNLINK"</span></dt><dd><p>Unlink the linked target object.</p></dd><dt><span class="term">"EXCEPTION"</span></dt><dd><p>Flag the link situation as an exception.</p><p>Do <span class="emphasis"><em>not</em></span> use this action for LiveSync mappings.</p></dd><dt><span class="term">"IGNORE"</span></dt><dd><p>Do not change the link or target object state.</p></dd></dl></div></div><div class="section" id="script-actions"><div class="titlepage"><div><div><h3 class="title">10.6.6.&nbsp;Providing a Script as an Action</h3></div></div></div><p>In addition to the static synchronization actions described in the
      previous section, you can provide a script that is run in specific
      synchronization situations. The following extract of a sample
      <code class="filename">sync.json</code> file specifies that when a synchronization
      operation assesses an entry as <code class="literal">ABSENT</code>, the workflow
      named <code class="literal">managedUserApproval</code> is invoked. The parameters
      for the workflow are passed in as properties of the <code class="literal">action</code>
      parameter.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "situation" : "ABSENT",
    "action" : {
        "workflowName" : "managedUserApproval",
        "type" : "text/javascript",
        "file" : "bin/defaults/script/workflow/workflow.js"
    }
}
      </pre><p>The variables available to these scripts are described in
      <a href="../integrators-guide/index.html#appendix-scripting" class="link">
      <em class="citetitle">Variables Available in Scripts</em></a> in the
      <em class="citetitle">Scripting Appendix</em>.</p></div></div><div class="section" id="asynchronous-reconciliation"><div class="titlepage"><div><div><h2 class="title" style="clear: both">10.7.&nbsp;Asynchronous Reconciliation</h2></div></div></div><p>Reconciliation can work in tandem with workflows to provide
   additional business logic to the reconciliation process. You can define
   scripts to determine the action that should be taken for a particular
   reconciliation situation. A reconciliation process can launch a workflow
   after it has assessed a situation, and then perform the reconciliation, or
   some other action.</p><p>For example, you might want a reconciliation process to assess new user
   accounts that need to be created on a target resource. However, new user
   account creation might require some kind of approval from a manager before
   the accounts are actually created. The initial reconciliation process can
   assess the accounts that need to be created, launch a workflow to request
   management approval for those accounts, and then relaunch the reconciliation
   process to create the accounts, once the management approval has been
   received.</p><p>In this scenario, the defined script returns <code class="literal">IGNORE</code>
   for new accounts and the reconciliation engine does not continue processing
   the given object. The script then initiates an asynchronous process which
   calls back and completes the reconciliation process at a later stage.</p><p>A sample configuration for this scenario is available in
   <code class="filename">openidm/samples/sample9</code>, and described in <a href="../install-guide/index.html#more-sample9" class="link"><em class="citetitle">Sample 9 -
   Asynchronous Reconciliation Using Workflows</em></a> in the
   <em class="citetitle">Installation Guide</em>.</p><div class="orderedlist"><p>Configuring asynchronous reconciliation involves the following
     steps:</p><ol class="orderedlist" type="1"><li class="listitem"><p>Create the workflow definition file (<code class="literal">.bar</code> file)
       and place it in the <code class="filename">openidm/workflow</code> directory.
       For more information about creating workflows, see <a href="../integrators-guide/index.html#chap-workflow" class="link">
       <em class="citetitle">Integrating Business Processes and Workflows</em></a>.
       </p></li><li class="listitem"><p>Modify the <code class="filename">conf/sync.json</code> file for the
       situation or situations that should call the workflow. Reference the
       workflow name in the configuration for that situation.</p><p>For example, the following <code class="filename">sync.json</code> extract
       calls the <code class="literal">managedUserApproval</code> workflow if the
       situation is assessed as <code class="literal">ABSENT</code>:</p><pre class="codelisting prettyprint linenums lang-js">
                {
                    "situation" : "ABSENT",
                    "action" : {
                        "workflowName" : "managedUserApproval",
                        "type" : "text/javascript",
                        "file" : "bin/defaults/script/workflow/workflow.js"
                    }
                },
       </pre></li><li class="listitem"><p>In the sample configuration, the workflow calls a second,
     asynchronous reconciliation process as a final step.</p></li></ol></div></div><div class="section" id="case-sensitivity"><div class="titlepage"><div><div><h2 class="title" style="clear: both">10.8.&nbsp;Configuring Case Sensitivity for Data Stores</h2></div></div></div><p>By default, OpenIDM is case-sensitive, which means that case is taken
   into account when comparing IDs during reconciliation. For data stores that
   are case-insensitive, such as OpenDJ, IDs and links that are created by a
   reconciliation process may be stored with a different case to the way in
   which they are stored in the OpenIDM repository. Such a situation can cause
   problems during a reconciliation operation, as the links for these IDs may
   not match.</p><p>For such data stores, you can configure OpenIDM to ignore case during
   reconciliation operations. With case sensitivity turned off in OpenIDM, for
   those specific mappings, comparisons are done without regard to case.</p><p>To specify that data stores are not case-sensitive, set the
   <code class="literal">"sourceIdsCaseSensitive"</code> or <code class="literal">"targetIdsCaseSensitive"</code>
   property to <code class="literal">false</code> in the mapping for those links. For
   example, if the LDAP data store is case-insensitive, set the mapping from
   the LDAP store to the managed user repository as follows:</p><pre class="codelisting prettyprint linenums lang-js">
"mappings" : [
{
"name" : "systemLdapAccounts_managedUser",
"source" : "system/ldap/account",
"sourceIdsCaseSensitive" : false,
"target" : "managed/user",
"properties" : [
...
   </pre><p>If a mapping inherits links by using the <code class="literal">"links"</code>
   property, it is not necessary to set case sensitivity, because the mapping
   uses the setting of the referred links.</p><p>Note that configuring OpenIDM to be case-insensitive when comparing
   links does not make the OpenICF provisioner case-insensitive when it requests
   data. For example, if a user entry is stored with the ID <code class="literal">testuser</code>
   and you make a request for <code class="literal">http://localhost:8080/openidm/managed/TESTuser</code>,
   most provisioners will filter out the match because of the difference in case,
   and will indicate that the record is not found. To prevent the provisioner from
   performing this secondary filtering, set the <code class="literal">enableFilteredResultsHandler</code>
   property to <code class="literal">false</code> in the provisioner configuration. For example:</p><pre class="cmdline prettyprint">"resultsHandlerConfig" :
{
    "enableFilteredResultsHandler":false,
},
   </pre><div class="panel panel-danger"><div class="panel-heading"><h3 class="panel-title">Caution</h3></div><div class="panel-body"><p>Do not disable the filtered results handler for the CSV file
     connector. The CSV file connector does not perform filtering so if you
     disable the filtered results handler for this connector, the full CSV
     file will be returned for every request.</p></div></div></div><div class="section" id="reconciliation-optimization"><div class="titlepage"><div><div><h2 class="title" style="clear: both">10.9.&nbsp;Reconciliation Optimization</h2></div></div></div><p>By default, reconciliation is configured to function in an optimized
  way. Some of these optimizations might, however, be unsuitable for your
  environment. The following sections describe the optimizations and how they
  can be configured.</p><div class="section" id="correlate-target-set"><div class="titlepage"><div><div><h3 class="title">10.9.1.&nbsp;Correlating Empty Target Sets</h3></div></div></div><p>To optimize a reconciliation operation, the reconciliation process does
  not attempt to correlate source objects to target objects if the set of
  target objects is empty when the correlation is started. This considerably
  speeds up the process the first time the reconciliation is run. You can change
  this behavior for a specific mapping by adding the
  <code class="literal">correlateEmptyTargetSet</code> property to the mapping definition
  and setting it to <code class="literal">true</code>. For example:</p><pre class="codelisting prettyprint linenums lang-js">
{
    "mappings": [
        {
            "name"                     : "systemMyLDAPAccounts_managedUser",
            "source"                   : "system/MyLDAP/account",
            "target"                   : "managed/user",
            "correlateEmptyTargetSet"  : true
        },
    ]
}</pre><p>Be aware that this setting will have a performance impact on the
   reconciliation process.</p></div><div class="section" id="prefetching-links"><div class="titlepage"><div><div><h3 class="title">10.9.2.&nbsp;Prefetching Links</h3></div></div></div><p>All links are queried at the start of a correlation and the results of
   that query are used. You can disable the prefetching of links, so that the
   correlation process looks up each link in the database as it processes each
   source or target object. You can disable the prefetching of links by adding
   the <code class="literal">prefetchLinks</code> property to the mapping, and setting it
   to <code class="literal">false</code>, for example:</p><pre class="codelisting prettyprint linenums lang-js">
{
    "mappings": [
        {
            "name": "systemMyLDAPAccounts_managedUser",
            "source": "system/MyLDAP/account",
            "target": "managed/user"
            "prefetchLinks" : false
        }
    ]
}</pre><p>Be aware that this setting will have a performance impact on the
   reconciliation process.</p></div><div class="section" id="parallel-recon-tasks"><div class="titlepage"><div><div><h3 class="title">10.9.3.&nbsp;Parallel Reconciliation Threads</h3></div></div></div><p>By default, reconciliation is executed in a multi-threaded manner,
    that is, numerous threads are dedicated to the same reconciliation run.
    Multithreading generally improves reconciliation run performance. The
    default number of threads for a single reconciliation run is ten (plus the
    main reconciliation thread). Under normal circumstances, you should not
    need to change this number, however the default might not be appropriate
    in the following situations:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The hardware has many cores and supports more concurrent threads.
        As a rule of thumb for performance tuning, start with setting the
        thread number to two times the number of cores.</p></li><li class="listitem"><p>The source or target is an external system with high latency or
       slow response times. Threads may then spend considerable time waiting
       for a response from the external system. Increasing the available
       threads enables the system to prepare or continue with additional
       objects.</p></li></ul></div><p>To change the number of threads, set the <code class="literal">taskThreads</code>
    property in the <code class="filename">conf/sync.json</code> file, for example:</p><pre class="codelisting prettyprint linenums lang-js">
    "mappings" : [
        {
            "name" : "systemXmlfileAccounts_managedUser",
            "source" : "system/xmlfile/account",
            "target" : "managed/user",
            "taskThreads" : 20
            ...
         }
    ]
}</pre><p>A value of <code class="literal">0</code> specifies that reconciliation is run
    on the main reconciliation thread, that is, in a serial manner.</p></div></div><div class="section" id="correlation"><div class="titlepage"><div><div><h2 class="title" style="clear: both">10.10.&nbsp;Correlation Queries</h2></div></div></div><a class="indexterm" name="d0e7493"></a><a class="indexterm" name="d0e7498"></a><p>Every time OpenIDM creates an object through synchronization, it
  creates a link between the source and target objects. OpenIDM then uses the
  link to determine the object's situation during later synchronization
  operations.</p><p>Initial, bulk synchronization operations can involve correlating
  many objects that exist both on source and target systems. In this case,
  OpenIDM uses correlation queries to find target objects that already exist,
  and that correspond to source objects. For the target objects that match
  a correlation query, OpenIDM needs only to create a link, rather than a
  new target object.</p><p>Correlation queries run against target resources. The query syntax
  therefore depends on the target system, and is either specific to the data
  store underlying the OpenIDM repository, or to OpenICF query capabilities.
  </p><div class="section" id="correlation-query-managed-object"><div class="titlepage"><div><div><h3 class="title">10.10.1.&nbsp;Managed Object as Correlation Query Target</h3></div></div></div><p>Queries on managed objects in the repository must be defined in the
   configuration file for the repository, which is either
   <code class="filename">openidm/conf/repo.orientdb.json</code>, or
   <code class="filename">openidm/conf/repo.jdbc.json</code>.</p><p>The following example shows a correlation query defined in
   <code class="filename">openidm/conf/repo.orientdb.json</code>.</p><pre class="codelisting prettyprint linenums lang-js">
"for-userName" : "SELECT * FROM ${unquoted:_resource} WHERE userName = ${uid}"
</pre><p>By default, a <code class="literal">${value}</code> token replacement is
   assumed to be a quoted string. If the value is not a quoted string, use the
   <code class="literal">unquoted:</code> prefix, as shown above.</p><p>The following correlation query example shows the JavaScript to call
   the query defined for OrientDB. The <code class="literal">_queryId</code> property
   value matches the name of the query specified in
   <code class="filename">openidm/conf/repo.orientdb.json</code>,
   <code class="literal">for-userName</code>. The <code class="literal">source.name</code> value
   replaces <code class="literal">${uid}</code> in the query. OpenIDM replaces
   <code class="literal">${unquoted:_resource}</code> in the query with the name of the
   table that holds managed objects.</p><pre class="codelisting prettyprint linenums lang-js">
{
  "correlationQuery": {
    "type": "text/javascript",
    "source":
      "var query = {'_queryId' : 'for-userName', 'uid' : source.name}; query;"
  }
}</pre><p>The query can return zero or more objects, so the situation OpenIDM
   assigns to the source object depends on the number of target objects
   returned.</p><p>With a JDBC-based repository, the query defined in
   <code class="filename">openidm/conf/repo.jdbc.json</code> is more complex due
   to how the tables are indexed. The correlation query you define in
   <code class="filename">openidm/conf/sync.json</code> is the same, however.</p></div><div class="section" id="correlation-query-system-object"><div class="titlepage"><div><div><h3 class="title">10.10.2.&nbsp;System Object as Correlation Query Target</h3></div></div></div><p>Correlation queries on system objects access the connector. The
   connector then executes the query on the external resource.</p><p>Your correlation query JavaScript must return a map holding a generic
   query with the following elements.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A condition such as "Equals"</p></li><li class="listitem"><p>The naming attribute to compare on the system object. In the example
     that follows, the naming attribute is <code class="literal">uid</code>.</p></li><li class="listitem"><p>The value from the source object to use in the search filter. You
     set this as the value of the <code class="literal">value</code> property, which
     takes an array. In the example that follows, the value to use in the
     search filter is <code class="literal">source.userName</code>.</p></li></ul></div><pre class="codelisting prettyprint linenums lang-js">
varmap={"query": {"Equals": {"field": "uid", "values": [ source.userName ]}}};
map;</pre></div></div><div class="section" id="advanced-dataflow"><div class="titlepage"><div><div><h2 class="title" style="clear: both">10.11.&nbsp;Advanced Data Flow Configuration</h2></div></div></div><a class="indexterm" name="d0e7596"></a><p><a class="xref" href="#basic-flow" title="10.5.&nbsp;Basic Data Flow Configuration">Section&nbsp;10.5, &#8220;Basic Data Flow Configuration&#8221;</a> shows how to trigger scripts when objects
  are created and updated. Other situations require you to trigger scripts
  in response to other synchronization actions. For example, you might not
  want OpenIDM to delete a managed user directly when an external account is
  deleted, but instead unlink the objects and deactivate the user in another
  resource. (Alternatively, you might delete the object in OpenIDM but
  nevertheless execute a script.) The following example shows a more advanced
  mapping configuration.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "mappings": [
        {
            "name": "systemLdapAccount_managedUser",
            "source": "system/ldap/account",
            "target": "managed/user",
            "validSource": {
                "type": "text/javascript",
                "file": "script/isValid.js"
            },
            "correlationQuery": {
                "type": "text/javascript",
                "file": "script/ldapCorrelationQuery.js"
            },
            "properties": [
                {
                    "source": "uid",
                    "transform": {
                        "type": "text/javascript",
                        "source": "source.toLowerCase()"
                    },
                    "target": "userName"
                },
                {
                    "source": "",
                    "transform": {
                        "type": "text/javascript",
                        "source": "if (source.myGivenName)
                            {source.myGivenName;} else {source.givenName;}"
                    },
                    "target": "givenName"
                },
                {
                    "source": "",
                    "transform": {
                        "type": "text/javascript",
                        "source": "if (source.mySn)
                            {source.mySn;} else {source.sn;}"
                    },
                    "target": "familyName"
                },
                {
                    "source": "cn",
                    "target": "fullname"
                },
                {
                    "comment": "Multi-valued in LDAP, single-valued in AD.
                        Retrieve first non-empty value.",
                    "source": "title",
                    "transform": {
                        "type": "text/javascript",
                        "file": "script/getFirstNonEmpty.js"
                    },
                    "target": "title"
                },
                {
                    "condition": {
                        "type": "text/javascript",
                        "source": "var clearObj = openidm.decrypt(object);
                            ((clearObj.password != null) &amp;&amp;
                            (clearObj.ldapPassword != clearObj.password))"
                    },
                    "transform": {
                        "type": "text/javascript",
                        "source": "source.password"
                    },
                    "target": "__PASSWORD__"
                }
            ],
            "onCreate": {
                "type": "text/javascript",
                "source": "target.ldapPassword = null;
                    target.adPassword = null;
                    target.password = null;
                    target.ldapStatus = 'New Account'"
            },
            "onUpdate": {
                "type": "text/javascript",
                "source": "target.ldapStatus = 'OLD'"
            },
            "onUnlink": {
                "type": "text/javascript",
                "file": "script/triggerAdDisable.js"
            },
            "policies": [
                {
                    "situation": "CONFIRMED",
                    "action": "UPDATE"
                },
                {
                    "situation": "FOUND",
                    "action": "UPDATE"
                },
                {
                    "situation": "ABSENT",
                    "action": "CREATE"
                },
                {
                    "situation": "AMBIGUOUS",
                    "action": "EXCEPTION"
                },
                {
                    "situation": "MISSING",
                    "action": "EXCEPTION"
                },
                {
                    "situation": "UNQUALIFIED",
                    "action": "UNLINK"
                },
                {
                    "situation": "UNASSIGNED",
                    "action": "EXCEPTION"
                }
            ]
        }
    ]
}</pre><div class="variablelist"><p>The following list shows all the properties that you can use as hooks
   in mapping configurations to call scripts.</p><dl class="variablelist"><dt><span class="term">Triggered by Situation</span></dt><dd><p>onCreate, onUpdate, onDelete, onLink, onUnlink</p></dd><dt><span class="term">Object Filter</span></dt><dd><p>vaildSource, validTarget</p></dd><dt><span class="term">Correlating Objects</span></dt><dd><p>correlationQuery</p></dd><dt><span class="term">Triggered on Reconciliation</span></dt><dd><p>result</p></dd><dt><span class="term">Scripts Inside Properties</span></dt><dd><p>condition, transform</p></dd></dl></div><p>Your scripts can get data from any connected system at any time by
  using the <code class="literal">openidm.read(id)</code> function, where
  <code class="literal">id</code> is the identifier of the object to read.</p><p>The following example reads a managed user object from the
  repository.</p><pre class="codelisting prettyprint linenums lang-js">
repoUser = openidm.read("managed/user/ddoe);</pre><p>The following example reads an account from an external LDAP
  resource.</p><pre class="codelisting prettyprint linenums lang-js">
externalAccount = openidm.read("system/ldap/account/uid=ddoe,ou=People,dc=example,dc=com");</pre><p>Note that the query targets a DN rather than a UID, as it did in the
  previous example. The attribute that is used for the <code class="literal">_id</code>
  is defined in the connector configuration file and, in this example, is set
  to <code class="literal">"uidAttribute" : "dn"</code>. Although it is possible to use
  a DN (or any unique attribute) for the <code class="literal">_id</code>, as a best
  practice, you should use an attribute that is both unique and immutable.
  </p></div><div class="section" id="scheduling-synchronization"><div class="titlepage"><div><div><h2 class="title" style="clear: both">10.12.&nbsp;Scheduling Synchronization</h2></div></div></div><a class="indexterm" name="d0e7669"></a><a class="indexterm" name="d0e7672"></a><a class="indexterm" name="d0e7677"></a><a class="indexterm" name="d0e7682"></a><p>You can schedule synchronization operations, such as LiveSync and
  reconciliation, using <span class="command"><strong>cron</strong></span>-like syntax.</p><p>This section describes scheduling for reconciliation and LiveSync,
  however, you can also use OpenIDM's scheduler service to schedule any other
  event by supplying a link to a script file, in which that event is defined.
  For information about scheduling other events, and for a deeper understanding
  of the OpenIDM scheduler service, see
  <a href="../integrators-guide/index.html#chap-scheduler-conf" class="link"><em class="citetitle">Scheduling Tasks
  and Events</em></a>.</p><div class="section" id="configuring-sync-schedule"><div class="titlepage"><div><div><h3 class="title">10.12.1.&nbsp;Configuring Scheduled Synchronization</h3></div></div></div><p>Each scheduled reconciliation and LiveSync task requires a schedule
  configuration file in <code class="filename">opendidm/conf</code>. By convention,
  files are named <code class="filename">openidm/conf/schedule-<em class="replaceable"><code>schedule-name
  </code></em>.json</code>, where <em class="replaceable"><code>schedule-name</code></em>
  is a logical name for the scheduled synchronization operation, such as
  <code class="literal">reconcile_systemXmlAccounts_managedUser</code>.</p><p>Schedule configuration files have the following format:</p><pre class="codelisting prettyprint linenums lang-js">
{
 "enabled"       : true,
 "persisted"     : false,
 "type"          : "cron",
 "startTime"     : "(optional) time",
 "endTime"       : "(optional) time",
 "schedule"      : "cron expression",
 "misfirePolicy" : "optional, string",
 "timeZone"      : "(optional) time zone",
 "invokeService" : "service identifier",
 "invokeContext" : "service specific context info"
}</pre><p>For an explanation of each of these properties, see
  <a href="../integrators-guide/index.html#chap-scheduler-conf" class="link"><em class="citetitle">Scheduling Tasks
  and Events</em></a>.</p><p>To schedule a reconciliation or LiveSync task, set the
  <code class="literal">invokeService</code> property to either <code class="literal">"sync"</code>
  (for reconciliation) or <code class="literal">"provisioner"</code> for LiveSync.</p><p>The value of the <code class="literal">invokeContext</code> property depends on
  the type of scheduled event. For reconciliation, the properties are set as
  follows:</p><pre class="codelisting prettyprint linenums lang-js">
{
    "invokeService": "sync",
    "invokeContext": {
        "action": "reconcile",
        "mapping": "systemLdapAccount_managedUser"
    }
}</pre><p>The <code class="literal">"mapping"</code> is either referenced by its name in
  the <code class="filename">openidm/conf/sync.json</code> file, or defined inline by
  using the <code class="literal">"mapping"</code> property, as shown in the example in
  <a href="../integrators-guide/index.html#alternative-mapping" class="link"><em class="citetitle">Alternative
  Mappings</em></a>.</p><p>For LiveSync, the properties are set as follows:</p><pre class="codelisting prettyprint linenums lang-js">
{
    "invokeService": "provisioner",
    "invokeContext": {
        "action": "liveSync",
        "source": "system/OpenDJ/__ACCOUNT__"
    }
}</pre><p>The <code class="literal">"source"</code> property follows OpenIDM's convention
  for a pointer to an external resource object and takes the form
  <code class="literal">system/<em class="replaceable"><code>resource-name</code></em>/<em class="replaceable"><code>
  object-type</code></em></code>.
    </p></div><div class="section" id="alternative-mapping"><div class="titlepage"><div><div><h3 class="title">10.12.2.&nbsp;Alternative Mappings</h3></div></div></div><a class="indexterm" name="d0e7802"></a><p>Mappings for synchronization are usually stored in
  <code class="filename">openidm/conf/sync.json</code> for reconciliation, LiveSync,
  and for pushing changes made to managed objects to external resources.
  You can, however, provide alternative mappings for scheduled reconciliation
  by adding the mapping to the schedule configuration instead of referencing
  a mapping in <code class="filename">sync.json</code>.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "enabled": true,
    "type": "cron",
    "schedule": "0 08 16 * * ?",
    "invokeService": "sync",
    "invokeContext": {
        "action": "reconcile",
        "mapping": {
            "name": "CSV_XML",
            "source": "system/Ldap/account",
            "target": "managed/user",
            "properties": [
                {
                    "source": "firstname",
                    "target": "firstname"
                },
                ...
            ],
            "policies": [...]
        }
    }
}</pre></div></div></div><div lang="en" class="chapter" id="chap-scheduler-conf"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;11.&nbsp;Scheduling Tasks and Events</h1></div></div></div><a class="indexterm" name="d0e7824"></a><a class="indexterm" name="d0e7827"></a><p>OpenIDM enables you to schedule reconciliation and synchronization 
  tasks. You can also use scheduling to trigger scripts, collect and run 
  reports, trigger workflows, perform custom logging, and so forth.</p><p>OpenIDM supports <span class="command"><strong>cron</strong></span>-like syntax to schedule events
 and tasks, based on expressions supported by the Quartz Scheduler (bundled 
 with OpenIDM).</p><p>If you use configuration files to schedule tasks and events, you must 
 place the schedule files in the <code class="filename">openidm/conf</code> directory.
 By convention, OpenIDM uses file names of the form
 <code class="filename">schedule-<em class="replaceable"><code>schedule-name</code></em>.json</code>, 
 where <em class="replaceable"><code>schedule-name</code></em> is a logical name for the 
 scheduled operation, for example, 
 <code class="filename">schedule-reconcile_systemXmlAccounts_managedUser.json</code>. 
 There are several example schedule configuration files in the 
 <code class="filename">openidm/samples/schedules</code> directory.</p><p>You can configure OpenIDM to pick up changes to scheduled tasks and 
 events dynamically, during initialization and also at runtime. For more 
 information, see <a href="../integrators-guide/index.html#changing-configuration" class="link"><em class="citetitle">Changing the 
 Configuration</em></a>.</p><p>In addition to the fine-grained scheduling facility, you can perform a 
 scheduled batch scan for a specified date in OpenIDM data, and then 
 automatically execute a task when this date is reached. For more information, 
 see <a class="xref" href="#task-scanner" title="11.5.&nbsp;Scanning Data to Trigger Tasks">Section&nbsp;11.5, &#8220;Scanning Data to Trigger Tasks&#8221;</a>.</p><div class="section" id="scheduler-configuration-file"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.1.&nbsp;Scheduler Configuration</h2></div></div></div><a class="indexterm" name="d0e7870"></a><div class="itemizedlist"><p>Schedules are configured through JSON objects. The schedule 
  configuration involves two types of files:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <code class="filename">openidm/conf/scheduler.json</code> file, that 
    configures the overall scheduler service</p></li><li class="listitem"><p>One <code class="filename">openidm/conf/schedule-<em class="replaceable"><code>schedule-name</code></em>.json</code> 
    file for each configured schedule</p></li></ul></div><p>The scheduler service configuration file 
  (<code class="filename">openidm/conf/scheduler.json</code>) governs the configuration
  for a specific scheduler instance, and has the following format:
  </p><pre class="codelisting prettyprint linenums lang-js">
{
 "threadPool" : {
     "threadCount" : "10"
 },
 "scheduler" : {
     "instanceId" : "scheduler-example",
     "executePersistentSchedules" : "true",
     "instanceTimeout" : "60000",
     "instanceRecoveryTimeout" : "60000",
     "instanceCheckInInterval" : "10000",
     "instanceCheckInOffset" : "0"
 },
 "advancedProperties" : {
     "org.quartz.scheduler.instanceName" : "OpenIDMScheduler"
 }
}
  </pre><p>Some of the optional properties are not in the default configuration
  file and are used specifically in the context of clustered OpenIDM instances.
  </p><div class="itemizedlist"><p>The properties in the <code class="filename">scheduler.json</code> file relate 
   to the configuration of the Quartz Scheduler.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">threadCount</code> specifies the maximum number of 
     threads that are available for the concurrent execution of scheduled 
     tasks.</p></li><li class="listitem"><p><code class="literal">instanceID</code> can be any string, but must be unique 
     for all schedulers working as if they are the same 'logical' Scheduler 
     within a cluster.</p></li><li class="listitem"><p><code class="literal">instanceTimeout</code> specifies the number of
     milliseconds that must elapse with no check-ins from a scheduler instance
     before it is considered to have timed out or failed. Default: 60000 (60
     seconds). When this timeout is reached, the instance is considered to be
     in a "recovery" state.</p></li><li class="listitem"><p><code class="literal">instanceRecoveryTimeout</code> specifies the number of
     milliseconds that must elapse while an instance is in the "recovery" state
     (meaning that it has failed and another instance is now attempting to
     recover its acquired triggers) before the scheduler instance recovery is
     considered to have failed. Default: 60000 (60 seconds).</p></li><li class="listitem"><p><code class="literal">instanceCheckInInterval</code> Specifies the period
     (in milliseconds) after which an instance checks in to indicate that it
     has not timed out or failed. Default: 10000 (10 seconds).</p></li><li class="listitem"><p><code class="literal">instanceCheckInOffset</code> An offset (in milliseconds)
     that can be used to shift the checkin events of instances to prevent all
     instances from accessing the repository simultaneously (if the instances
     are started simultaneously and have the same check-in intervals). This
     offset can help to minimize MVCC warnings from multiple instances
     simultaneously trying to recover the same failed instance. Default: 0.</p></li><li class="listitem"><p><code class="literal">executePersistentSchedules</code> allows you to disable 
     persistent schedule execution for a specific node. If this parameter is 
     set to <code class="literal">false</code>, the Scheduler Service will support the 
     management of persistent schedules (CRUD operations) but it will not 
     execute any persistent schedules. The value of this property can be a 
     string or boolean and is <code class="literal">true</code> by default.</p></li><li class="listitem"><p><code class="literal">advancedProperties</code> (optional) enables you to 
     configure additional properties for the Quartz Scheduler.</p></li></ul></div><p>For details of all the configurable properties for the Quartz Scheduler, 
  see the <a class="link" href="http://www.quartz-scheduler.org/documentation/quartz-2.1.x/configuration/ConfigMain" target="_blank"><em class="citetitle">Quartz Scheduler Configuration Reference</em></a>.</p><p>Each schedule configuration file, <code class="filename">openidm/conf/schedule-
  <em class="replaceable"><code>schedule-name</code></em>.json</code> has the following 
  format:</p><pre class="codelisting prettyprint linenums lang-js">
{
 "enabled"             : true,
 "persisted"           : false,
 "concurrentExecution" : false,
 "type"                : "cron",
 "startTime"           : "(optional) time",
 "endTime"             : "(optional) time",
 "schedule"            : "cron expression",
 "misfirePolicy"       : "optional, string",
 "timeZone"            : "(optional) time zone",
 "invokeService"       : "service identifier",
 "invokeContext"       : "service specific context info",
 "invokeLogLevel"      : "(optional) debug"
}</pre><div class="variablelist"><p>The schedule configuration properties are defined as follows:</p><dl class="variablelist"><dt><span class="term">enabled</span></dt><dd><p>Set to <code class="literal">true</code> to enable the schedule. When this 
    property is set to <code class="literal">false</code>, OpenIDM considers the 
    schedule configuration dormant, and does not allow it to be triggered or
    executed.</p><p>If you want to retain a schedule configuration, but do not want it 
    used, set <code class="literal">enabled</code> to <code class="literal">false</code> for task 
    and event schedulers, instead of changing the configuration or 
    <span class="command"><strong>cron</strong></span> expressions.</p></dd><dt><span class="term">persisted (optional)</span></dt><dd><p>Specifies whether the schedule state should be persisted or stored 
    in RAM. Boolean (<code class="literal">true</code> or <code class="literal">false</code>), 
    <code class="literal">false</code> by default. For more information, see 
    <a class="xref" href="#persistent-schedules" title="11.2.&nbsp;Configuring Persistent Schedules">Section&nbsp;11.2, &#8220;Configuring Persistent Schedules&#8221;</a>.</p></dd><dt><span class="term">concurrentExecution</span></dt><dd><p>Specifies whether multiple instances of the same schedule can run
      concurrently. Boolean (<code class="literal">true</code> or <code class="literal">false</code>),
      <code class="literal">false</code> by default. Multiple instances of the same
      schedule cannot run concurrently by default. This setting prevents a new
      scheduled task from being launched before the same previously launched
      task has completed. For example, under normal circumstances you would
      want a liveSync operation to complete its execution before the same
      operation was launched again. To enable concurrent execution of multiple
      schedules, set this parameter to <code class="literal">true</code>. The behavior of
      "missed" scheduled tasks is governed by the <a class="xref" href="#misfire-policy">misfirePolicy</a>.</p></dd><dt><span class="term">type</span></dt><dd><p>Currently OpenIDM supports only <code class="literal">cron</code>.</p></dd><dt><span class="term">startTime (optional)</span></dt><dd><p>Used to start the schedule at some time in the future. If this 
    parameter is omitted, empty, or set to a time in the past, the task or 
    event is scheduled to start immediately.</p><p>Use ISO 8601 format to specify times and dates (<code class="literal"><em class="replaceable"><code>
    YYYY</code></em>-<em class="replaceable"><code>MM</code></em>-<em class="replaceable"><code>DD
    </code></em>T<em class="replaceable"><code>hh</code></em>:<em class="replaceable"><code>mm
    </code></em>:<em class="replaceable"><code>ss</code></em></code>).</p></dd><dt><span class="term">endTime (optional)</span></dt><dd><p>Used to plan the end of scheduling.</p></dd><dt><span class="term">schedule</span></dt><dd><p>Takes <span class="command"><strong>cron</strong></span> expression syntax. For more information, 
    see the <a class="link" href="http://www.quartz-scheduler.org/docs/tutorials/crontrigger.html" target="_blank"><em class="citetitle">CronTrigger Tutorial</em></a> and <a class="link" href="http://www.quartz-scheduler.org/docs/tutorial/TutorialLesson06.html" target="_blank"><em class="citetitle">Lesson 6: CronTrigger</em></a>.</p></dd><dt><span class="term" id="misfire-policy">misfirePolicy</span></dt><dd><p>For persistent schedules, this optional parameter specifies the
    behavior if the scheduled task is missed, for some reason. Possible values
    are as follows:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">fireAndProceed</code>. The first execution 
     of a missed schedule is immediately executed when the server is back 
     online. Subsequent executions are discarded. After this, the normal 
     schedule is resumed.</p></li><li class="listitem"><p><code class="literal">doNothing</code>, all missed schedules are 
     discarded and the normal schedule is resumed when the server is back 
     online.</p></li></ul></div></dd><dt><span class="term">timeZone (optional)</span></dt><dd><p>If not set, OpenIDM uses the system time zone.</p></dd><dt><span class="term">invokeService</span></dt><dd><p>Defines the type of scheduled event or action. The value of this 
    parameter can be one of the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">"sync"</code> for reconciliation</p></li><li class="listitem"><p><code class="literal">"provisioner"</code> for LiveSync</p></li><li class="listitem"><p><code class="literal">"script"</code> to call some other scheduled 
       operation defined in a script</p></li></ul></div></dd><dt><span class="term">invokeContext</span></dt><dd><p>Specifies contextual information, depending on the type of scheduled 
    event (the value of the <code class="literal">invokeService</code> parameter).
    </p><p>The following example invokes reconciliation.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "invokeService": "sync",
    "invokeContext": {
        "action": "reconcile",
        "mapping": "systemLdapAccount_managedUser"
    }
}</pre><div class="itemizedlist"><p>For a scheduled reconciliation task, you can define the mapping 
   in one of two ways:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Reference a mapping by its name in <code class="filename">sync.json</code>,
    as shown in the previous example. The mapping must exist in the
    <code class="filename">openidm/conf/sync.json</code> file.</p></li><li class="listitem"><p>Add the mapping definition inline by using the
    <code class="literal">"mapping"</code> property, as shown in the example in
    <a href="../integrators-guide/index.html#alternative-mapping" class="link"><em class="citetitle">Alternative
    Mappings</em></a>.</p></li></ul></div><p>The following example invokes a LiveSync action.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "invokeService": "provisioner",
    "invokeContext": {
        "action": "liveSync",
        "source": "system/OpenDJ/__ACCOUNT__"
    }
}</pre><p>For scheduled LiveSync tasks, the <code class="literal">"source"</code> property 
  follows OpenIDM's convention for a pointer to an external resource object 
  and takes the form <code class="literal">system/<em class="replaceable"><code>resource-name</code></em>
  /<em class="replaceable"><code>object-type</code></em></code>.</p><p>The following example invokes a script, which prints the string 
  <code class="literal">Hello World</code> to the OpenIDM log 
  (<code class="filename">/openidm/logs/openidm0.log.X</code>) each minute.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "invokeService": "script",
    "invokeContext": {
        "script": {
            "type": "text/javascript",
            "source": "java.lang.System.out.println('Hello World&#8217;);"
        }
    }
}</pre><p>Note that these are sample configurations only. Your own schedule 
    configuration will differ according to your specific requirements.</p></dd><dt><span class="term">invokelogLevel (optional)</span></dt><dd><p>Specifies the level at which the invocation will be logged. 
    Particularly for schedules that run very frequently, such as LiveSync, the 
    scheduled task can generate significant output to the log file, and the log 
    level should be adjusted accordingly. The default schedule log level is 
    <code class="literal">info</code>. The value can be set to any one of the <a class="link" href="http://www.slf4j.org/apidocs/org/apache/commons/logging/Log.html" target="_top">SLF4J</a> 
    log levels:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">"trace"</code></p></li><li class="listitem"><p><code class="literal">"debug"</code></p></li><li class="listitem"><p><code class="literal">"info"</code></p></li><li class="listitem"><p><code class="literal">"warn"</code></p></li><li class="listitem"><p><code class="literal">"error"</code></p></li><li class="listitem"><p><code class="literal">"fatal"</code></p></li></ul></div></dd></dl></div></div><div class="section" id="persistent-schedules"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.2.&nbsp;Configuring Persistent Schedules</h2></div></div></div><p>By default, scheduling information, such as schedule state and details 
  of the schedule execution, is stored in RAM. This means that such 
  information is lost when OpenIDM is rebooted. The schedule configuration 
  itself (defined in the <code class="filename">openidm/conf/schedule-
  <em class="replaceable"><code>schedule-name</code></em>.json</code> file) is not lost 
  when OpenIDM is shut down, and normal scheduling continues when the server is 
  restarted. However, there are no details of missed schedule executions that 
  should have occurred during the period the server was unavailable.</p><p>You can configure schedules to be persistent, which means that the 
  scheduling information is stored in the internal repository rather than in 
  RAM. With persistent schedules, scheduling information is retained when OpenIDM 
  is shut down. Any previously scheduled jobs can be rescheduled automatically 
  when OpenIDM is restarted.</p><p>Persistent schedules also enable you to manage scheduling across a 
  cluster (multiple OpenIDM instances). When scheduling is persistent, a 
  particular schedule will be executed only once across the cluster, rather than 
  once on every OpenIDM instance. For example, if your deployment includes a 
  cluster of OpenIDM nodes for high availability, you can use persistent 
  scheduling to start a reconciliation action on only one node in the cluster, 
  instead of starting several competing reconciliation actions on each node.</p><p>You can use persistent schedules with the default OrientDB repository, 
  or with the MySQL repository (see <a href="../install-guide/index.html#chap-repository" class="link"><em class="citetitle">Installing a 
    Repository For Production</em></a>).
  </p><p>To configure persistent schedules, set the <code class="literal">"persisted"</code> 
  property to <code class="literal">true</code> in the schedule configuration file 
  (<code class="filename">schedule-<em class="replaceable"><code>schedule-name</code></em>.json)</code>.
  </p><p>If OpenIDM is down when a scheduled task was set to occur, one or more 
  executions of that schedule might be missed. To specify what action should be 
  taken if schedules are missed, set the <code class="literal">misfirePolicy</code> in the 
  schedule configuration file. The <code class="literal">misfirePolicy</code> determines 
  what OpenIDM should do if scheduled tasks are missed. Possible values are as 
  follows:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">fireAndProceed</code>. The first execution of 
     a missed schedule is immediately executed when the server is back online. 
     Subsequent executions are discarded. After this, the normal schedule is 
     resumed.</p></li><li class="listitem"><p><code class="literal">doNothing</code>. All missed schedules are 
     discarded and the normal schedule is resumed when the server is back 
     online.</p></li></ul></div></div><div class="section" id="scheduler-examples"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.3.&nbsp;Schedule Examples</h2></div></div></div><a class="indexterm" name="d0e8319"></a><p>The following example shows a schedule for reconciliation that
  is not enabled. When enabled (<code class="literal">"enabled" : true,</code>),
  reconciliation runs every 30 minutes, starting on the hour.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "enabled": false,
    "persisted": false,
    "type": "cron",
    "schedule": "0 0/30 * * * ?",
    "invokeService": "sync",
    "invokeContext": {
        "action": "reconcile",
        "mapping": "systemLdapAccounts_managedUser"
    }
}</pre><p>The following example shows a schedule for LiveSync enabled to run 
  every 15 seconds, starting at the beginning of the minute. The schedule is 
  persisted, that is, stored in the internal repository rather than in memory. 
  If one or more LiveSync executions are missed, as a result of OpenIDM being 
  unavailable, the first execution of the LiveSync action is executed when the 
  server is back online. Subsequent executions are discarded. After this, the 
  normal schedule is resumed.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "enabled": false,
    "persisted": true,
    "misfirePolicy" : "fireAndProceed",
    "type": "cron",
    "schedule": "0/15 * * * * ?",
    "invokeService": "provisioner",
    "invokeContext": {
        "action": "liveSync",
        "source": "system/ldap/account"
    }
}</pre></div><div class="section" id="scheduler-service-implementations"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.4.&nbsp;Service Implementer Notes</h2></div></div></div><p>Services that can be scheduled implement
  <code class="literal">ScheduledService</code>. The service PID is used as a basis for
  the service identifier in schedule definitions.</p></div><div class="section" id="task-scanner"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.5.&nbsp;Scanning Data to Trigger Tasks</h2></div></div></div><p>In addition to the fine-grained scheduling facility described 
  previously, OpenIDM provides a task scanning mechanism. The task scanner 
  enables you to perform a batch scan for a specified date in OpenIDM data, 
  on a scheduled interval, and then to execute a task when this date is 
  reached. When the task scanner identifies a condition that should trigger the
  task, it can invoke a script created specifically to handle the task.</p><p>For example, the task scanner can scan all <code class="literal">managed/user</code> 
  objects for a  "sunset date" and can invoke a script that executes a sunset 
  task on the user object when this date is reached.</p><div class="section" id="task-scanner-config"><div class="titlepage"><div><div><h3 class="title">11.5.1.&nbsp;Configuring the Task Scanner</h3></div></div></div><p>The task scanner is essentially a scheduled task that queries a span of 
  managed users. The task scanner is configured in the same way as a regular 
  scheduled task, in a schedule configuration file named 
  (<code class="filename">schedule-<em class="replaceable"><code>task-name</code></em>.json)</code>, 
  with the <code class="literal">"invokeService"</code> parameter set to 
  <code class="literal">"taskscanner</code>. The <code class="literal">"invokeContext"</code> 
  parameter defines the details of the scan, and the task that should be 
  executed when the specified condition is triggered.</p><p>The following example defines a scheduled scanning task that triggers 
  a sunset script. This sample configuration file is provided in the OpenIDM 
  delivery as 
  <code class="filename">openidm/samples/taskscanner/conf/schedule-taskscan_sunset.json</code>. 
  To use this sample file, you must copy it to the <code class="filename">openidm/conf</code> 
  directory.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "enabled" : true,
    "type" : "cron",
    "schedule" : "0 0 * * * ?",
    "invokeService" : "taskscanner",
    "invokeContext" : {
        "waitForCompletion" : false,
        "maxRecords" : 2000,
        "numberOfThreads" : 5,
        "scan" : {
            "object" : "managed/user",
            "_queryId" : "scan-tasks",
            "property" : "sunset/date",
            "condition" : {
                "before" : "${Time.now}"
            },
            "taskState" : {
                "started" : "sunset/task-started",
                "completed" : "sunset/task-completed"
            },
            "recovery" : {
                "timeout" : "10m"
            }
        },
        "task" : {
            "script" : {
                "type" : "text/javascript",
                "file" : "script/sunset.js"
            }
        }
    }
}</pre><div class="variablelist"><p>The <code class="literal">"invokeContext"</code> parameter takes the following 
  properties:
  </p><dl class="variablelist"><dt><span class="term"><code class="literal">"waitForCompletion"</code> (optional)</span></dt><dd><p>This property specifies whether the task should be performed 
    synchronously. Tasks are performed asynchronously by default (with 
    <code class="literal">waitForCompletion</code> set to false). A task ID (such as 
    <code class="literal">{"_id":"354ec41f-c781-4b61-85ac-93c28c180e46"}</code>) is 
    returned immediately. If this property is set to true, tasks are performed 
    synchronously and the ID is not returned until all tasks have completed.
    </p></dd><dt><span class="term"><code class="literal">"maxRecords"</code> (optional)</span></dt><dd><p>The maximum number of records that can be processed. This property 
    is not set by default so the number of records is unlimited. If a maximum 
    number of records is specified, that number will be spread evenly over the 
    number of threads.
    </p></dd><dt><span class="term"><code class="literal">"numberOfThreads"</code> (optional)</span></dt><dd><p>By default, the task scanner runs in a multi-threaded manner, that 
    is, numerous threads are dedicated to the same scanning task run. 
    Multithreading generally improves the performance of the task scanner. The 
    default number of threads for a single scanning task is ten. To change this 
    default, set the <code class="literal">"numberOfThreads"</code> property.
    </p></dd><dt><span class="term"><code class="literal">"scan"</code></span></dt><dd><p>Defines the details of the scan. The following properties are 
    defined:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">"object"</code></span></dt><dd><p>Defines the object type against which the query should be 
       performed.</p></dd><dt><span class="term"><code class="literal">"_queryId"</code></span></dt><dd><p>Specifies the query that is performed. The queries that can be 
       set here are defined in the database configuration file (either 
       <code class="filename">conf/repo.orientdb.json</code> or 
       <code class="filename">conf/repo.jdbc.json</code>).</p></dd><dt><span class="term"><code class="literal">"property"</code></span></dt><dd><p>Defines the object property against which the range query is 
       performed.</p></dd><dt><span class="term"><code class="literal">"condition"</code> (optional)</span></dt><dd><p>Indicates the conditions that must be matched for the defined 
       property.</p><p>In the previous example, the scanner scans for users for whom the 
       property <code class="literal">sunset/date</code> is set to a value prior to the 
       current timestamp at the time the script is executed.</p><p>You can use these fields to define any condition. For example, if 
       you wanted to limit the scanned objects to a specified location, say, 
       London, you could formulate a query to compare against object locations 
       and then set the condition to be:</p><pre class="codelisting prettyprint linenums lang-js">
            "condition" : {
                "location" : "London"
            },</pre><p>For time-based conditions, the <code class="literal">"condition"</code> 
        property supports macro syntax, based on the <code class="literal">Time.now</code> 
        object (which fetches the current time). You can specify any date/time 
        in relation to the current time, using the <code class="literal">+</code> or 
        <code class="literal">-</code> operator, and a duration modifier. For example: 
        <code class="literal">"before": "${Time.now + 1d}"</code> would return all user 
        objects whose <code class="literal">sunset/date</code> is before tomorrow 
        (current time plus one day). You must include space characters around the 
        operator (<code class="literal">+</code> or <code class="literal">-</code>). The duration 
        modifier supports the following unit specifiers:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">s</code> - second</td></tr><tr><td><code class="literal">m</code> - minute</td></tr><tr><td><code class="literal">h</code> - hour</td></tr><tr><td><code class="literal">d</code> - day</td></tr><tr><td><code class="literal">M</code> - month</td></tr><tr><td><code class="literal">y</code> - year</td></tr></table></dd><dt><span class="term"><code class="literal">"taskState"</code></span></dt><dd><p>Indicates the fields that are used to track the status of the 
       task.</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">"started"</code> specifies the field that stores 
        the timestamp for when the task begins.</td></tr><tr><td><code class="literal">"completed&#8221;</code> specifies the field that stores 
        the timestamp for when the task completes its operation.</td></tr></table></dd><dt><span class="term"><code class="literal">"recovery"</code> (optional)</span></dt><dd><p>Specifies a configurable timeout, after which the task scanner 
        process ends. In a scenario with clustered OpenIDM instances, there 
        might be more than one task scanner running at a time. A task 
        cannot be executed by two task scanners at the same time. When one 
        task scanner "claims" a task, it indicates that the task has been 
        started. That task is then unavailable to be claimed by another task 
        scanner and remains unavailable until the end of the task is indicated. 
        In the event that the first task scanner does not complete the task by 
        the specified timeout, for whatever reason, a second task scanner can 
        pick up the task.</p></dd></dl></div></dd><dt><span class="term"><code class="literal">"task"</code></span></dt><dd><p>Provides details of the task that is performed. Usually, 
   the task is invoked by a script, whose details are defined in the 
   <code class="literal">"script"</code> property:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">"type"</code> - the type of script. Currently, only 
     JavaScript is supported.</td></tr><tr><td><code class="literal">"file"</code> - the path to the script file. The script 
     file takes at least two objects (in addition to the default objects that 
     are provided to all OpenIDM scripts): <code class="literal">"input"</code> which is 
     the individual object that is retrieved from the query (in the example, 
     this is the individual user object) and <code class="literal">"objectID"</code> 
     which is a string that contains the full identifier of the object. The 
     objectID is useful for performing updates with the script as it allows you 
     to target the object directly, for example: 
     <code class="literal">openidm.update(objectID, input['_rev'], input);</code>. A sample 
     script file is provided in <code class="filename">openidm/samples/taskscanner/script/sunset.js</code>. 
     To use this sample file, you must copy it to the <code class="filename">openidm/script</code> 
     directory. The sample script marks all user objects that match the 
     specified conditions as "inactive". You can use this sample script to 
     trigger a specific workflow, or any other task associated with the sunset 
     process. For more information about using scripts in OpenIDM, see the 
     <a href="../integrators-guide/index.html#appendix-scripting" class="link">
     <em class="citetitle">Scripting Reference</em></a>.</td></tr></table></dd></dl></div></div><div class="section" id="task-scanner-rest"><div class="titlepage"><div><div><h3 class="title">11.5.2.&nbsp;Managing Scanning Tasks Over REST</h3></div></div></div><p>You can trigger, cancel, and monitor scanning tasks over the REST 
   interface, using the REST endpoint 
   <code class="literal">http://localhost:8080/openidm/taskscanner</code>.</p><div class="section" id="triggering-task-scanner"><div class="titlepage"><div><div><h4 class="title">11.5.2.1.&nbsp;Triggering a Scanning Task</h4></div></div></div><p>The following REST command executes a task named "taskscan_sunrise". 
    The task itself is defined in a file named 
    <code class="filename">openidm/conf/schedule-taskscan_sunset.json</code>.</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/taskscanner?_action=execute&amp;name=schedule/taskscan_sunset"
   </pre><p>By default, a scanning task ID is returned immediately when the task 
   is initiated. Clients can make subsequent calls to the task scanner service, 
   using this task ID to query its state and to call operations on it.</p><p>For example, the scanning task initiated previously would return
    something similar to the following, as soon as it was initiated:</p><pre class="cmdline prettyprint">{"_id":"edfaf59c-aad1-442a-adf6-3620b24f8385"}</pre><p>To have the scanning task complete before the ID is returned, set the 
    <code class="literal">waitForCompletion</code> property to <code class="literal">true</code> 
    in the task definition file (<code class="filename">schedule-taskscan_sunset.json</code>). 
    You can also set the property directly over the REST interface when the task is 
    initiated. For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/taskscanner?_action=execute&amp;name=schedule/taskscan_sunset&amp;waitForCompletion=true"
    </pre></div><div class="section" id="canceling-task-scanner"><div class="titlepage"><div><div><h4 class="title">11.5.2.2.&nbsp;Canceling a Scanning Task</h4></div></div></div><p>You can cancel a scanning task by sending a REST call with the 
    <code class="literal">cancel</code> action, specifying the task ID. For example, the 
    following call cancels the scanning task initiated in the previous section.
    </p><pre class="cmdline prettyprint">$curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/taskscanner/edfaf59c-aad1-442a-adf6-3620b24f8385?_action=cancel"
    </pre><p>The output for a scanning task cancelation request is similar to the
    following, but on a single line:</p><pre class="cmdline prettyprint">
    {"_id":"edfaf59c-aad1-442a-adf6-3620b24f8385",
     "action":"cancel",
     "status":"SUCCESS"}
    </pre></div><div class="section" id="listing-task-scanner"><div class="titlepage"><div><div><h4 class="title">11.5.2.3.&nbsp;Listing Scanning Tasks</h4></div></div></div><p>You can display a list of scanning tasks that have completed, and 
    those that are in progress, by running a RESTful GET on 
    <code class="literal">"http://localhost:8080/openidm/taskscanner"</code>. The following 
    example displays all scanning tasks.</p><pre class="cmdline prettyprint">$curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET
 "http://localhost:8080/openidm/taskscanner"
    </pre><p>The output of such a request is similar to the following, with one 
    item for each scanning task. The output appears on a single line, but
    has been indented here, for legibility.</p><pre class="cmdline prettyprint">{"tasks": [
    {
      "_id": "edfaf59c-aad1-442a-adf6-3620b24f8385",
      "progress": {
        "state": "COMPLETED",
        "processed": 2400,
        "total": 2400,
        "successes": 2400,
        "failures": 0
      },
      "started": 1352455546149,
      "ended": 1352455546182
    }
  ]
}
    </pre><div class="variablelist"><p>Each scanning task has the following properties:</p><dl class="variablelist"><dt><span class="term"><code class="literal">_id</code></span></dt><dd><p>The ID of the scanning task.</p></dd><dt><span class="term"><code class="literal">progress</code></span></dt><dd><p>The progress of the scanning task, summarised in the following 
       fields:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">state</code> - the overall state of the task, 
          <code class="literal">INITIALIZED</code>, <code class="literal">ACTIVE</code>, <code class="literal">
          COMPLETED</code>, <code class="literal">CANCELLED</code>, or <code class="literal">
          ERROR</code>
        </td></tr><tr><td><code class="literal">processed</code> - the number of processed records
        </td></tr><tr><td><code class="literal">total</code> - the total number of records</td></tr><tr><td><code class="literal">successes</code> - the number of records processed 
        successfully</td></tr><tr><td><code class="literal">failures</code> - the number of records not able 
        to be processed</td></tr></table></dd><dt><span class="term"><code class="literal">started</code></span></dt><dd><p>The time at which the scanning task started, .</p></dd><dt><span class="term"><code class="literal">ended</code></span></dt><dd><p>The time at which the scanning task ended.</p></dd></dl></div><p>The number of processed tasks whose details are retained is governed 
    by the <code class="literal">"openidm.taskscanner.maxcompletedruns"</code> property 
    in the <code class="filename">conf/boot.properties</code> file. By default, the 
    last one hundred completed tasks are retained.</p></div></div></div></div><div lang="en" class="chapter" id="chap-passwords"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;12.&nbsp;Managing Passwords</h1></div></div></div><a class="indexterm" name="d0e8735"></a><p>OpenIDM provides password management features that help you enforce
 password policies, limit the number of passwords users must remember, and
 let users reset and change their passwords.</p><div class="section" id="enforce-password-policy"><div class="titlepage"><div><div><h2 class="title" style="clear: both">12.1.&nbsp;Enforcing Password Policy</h2></div></div></div><p>A password policy is a set of rules defining what sequence of
  characters constitutes an acceptable password. Acceptable passwords generally
  are too complex for users or automated programs to generate or guess.</p><p>Password policies set requirements for password length, character sets
  that passwords must contain, dictionary words and other values that passwords
  must not contain. Password policies also require that users not reuse old
  passwords, and that users change their passwords on a regular basis.</p><a class="indexterm" name="d0e8747"></a><p>OpenIDM enforces password policy rules as part of the general policy 
  service. For more information about the policy service, see 
  <a href="../integrators-guide/index.html#chap-policies" class="link">
  <em class="citetitle">Using Policies to Validate Data</em></a>. The default 
  password policy applies the following rules to passwords as they are created 
  and updated:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A password property is required for any user object.</p></li><li class="listitem"><p>The value of a password cannot be empty.</p></li><li class="listitem"><p>The password must include at least one capital letter.
    </p></li><li class="listitem"><p>The password must include at least one number.</p></li><li class="listitem"><p>The minimum length of a password is 8 characters.</p></li><li class="listitem"><p>The password cannot contain the user name, given name, or 
    family name.</p></li></ul></div><p>You can remove these validation requirements, or include additional 
  requirements, by configuring the policy for passwords. For more information, 
  see <a href="../integrators-guide/index.html#configuring-default-policy" class="link">
  <em class="citetitle">Configuring the Default Policy</em></a>.</p><div class="variablelist"><p>The password validation mechanism can apply in many situations.</p><dl class="variablelist"><dt><span class="term">Password change and password reset</span></dt><dd><p>Password change involves changing a user or account password
     in accordance with password policy. Password reset involves setting a
     new user or account password on behalf of a user.</p><p>By default, OpenIDM controls password values as they are
     provisioned.</p><p>To change the default administrative user password,
     <code class="literal">openidm-admin</code>, see the procedure, <a href="../integrators-guide/index.html#security-replace-default-user-password" class="link"><em class="citetitle">To Replace the Default User and Password</em></a>,
     for instructions.</p></dd><dt><span class="term">Password recovery</span></dt><dd><p>Password recovery involves recovering a password or setting a new
     password when the password has been forgotten.</p><p>OpenIDM provides a self-service end user interface for password
     changes, password recovery, and password reset. For more information, see 
     <span class="olink">
     <em class="citetitle">Managing Passwords With the UI</em></span>.</p></dd><dt><span class="term">Password comparisons with dictionary words</span></dt><dd><p>You can add dictionary lookups to prevent use of password values
     that match dictionary words.</p></dd><dt><span class="term">Password history</span></dt><dd><p>You can add checks to prevent reuse of previous password
     values</p></dd><dt><span class="term">Password expiration</span></dt><dd><p>You can configure OpenIDM to call a workflow that ensures users
     are able to change expiring or to reset expired passwords.</p></dd></dl></div></div><div class="section" id="password-sync"><div class="titlepage"><div><div><h2 class="title" style="clear: both">12.2.&nbsp;Password Synchronization</h2></div></div></div><a class="indexterm" name="d0e8844"></a><p>Password synchronization intercepts user password changes, and ensures
  uniform password changes across resources that store the password. Following
  password synchronization, the user authenticates using the same password on
  each resource. No centralized directory or authentication server is required
  for performing authentication. Password synchronization reduces the number of
  passwords users need to remember, so they can use fewer, stronger
  passwords.</p><p>OpenIDM can propagate passwords to the resources storing a user's
  password. OpenIDM can intercept and synchronize passwords changed natively
  on OpenDJ and Active Directory. See the example in
  <code class="filename">samples/misc/managed.json</code> where you installed OpenIDM
  for a sample password synchronization configuration.</p><p>Before using the sample, you must set up OpenDJ and Active Directory,
  and adjust the password attributes, set in the sample as
  <code class="literal">ldapPassword</code> for OpenDJ, <code class="literal">adPassword</code>
  for Active Directory, and <code class="literal">password</code> for the internal
  OpenIDM password. Also, either set up password policy enforcement on OpenDJ
  or Active Directory rather than OpenIDM, or ensure that all password policies
  enforced are identical to prevent password updates on one resource from being
  rejected by OpenIDM or by another resource.</p><p>Also set up password synchronization plugins for OpenDJ and for Active
  Directory. The password synchronization plugins help by intercepting password
  changes on the resource before the passwords are stored in encrypted
  form. The plugins then send intercepted password values to OpenIDM over an
  encrypted channel.</p><div class="procedure" id="install-opendj-password-sync-plugin"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;12.1.&nbsp;To Install the OpenDJ Password Synchronization Plugin</div><a class="indexterm" name="d0e8872"></a><p>Before you start, make sure you configure OpenDJ to communicate over
   LDAPS as described in the <a class="link" href="http://opendj.forgerock.org/doc/admin-guide/#chap-listeners" target="_blank">OpenDJ documentation</a>.</p><p>The following steps install the plugin in OpenDJ directory server
   running on the same host as OpenIDM. If you run OpenDJ on a different host
   use the fully qualified domain name rather than <code class="literal">localhost</code>,
   and use your certificates rather than the example.</p><ol class="procedure" type="1"><li class="step"><p>Import the self-signed OpenIDM certificate into the trust store for
    OpenDJ.</p><pre class="cmdline prettyprint">$ cd /path/to/OpenDJ/config
$ keytool
 -import
 -alias openidm-localhost
 -keystore truststore
 -storepass `cat keystore.pin`
 -file /path/to/openidm/samples/security/openidm-localhost-cert.txt
Owner: CN=localhost, O=OpenIDM Self-Signed Certificate
Issuer: CN=localhost, O=OpenIDM Self-Signed Certificate
Serial number: 4e4bc38e
Valid from: Wed Aug 17 15:35:10 CEST 2011 until: Tue Aug 17 15:35:10 CEST 2021
Certificate fingerprints:
  MD5:  B8:B3:B4:4C:F3:22:89:19:C6:55:98:C5:DF:47:DF:06
  SHA1: DB:BB:F1:14:55:A0:53:80:9D:62:E7:39:FB:83:15:DA:60:63:79:D1
  Signature algorithm name: SHA1withRSA
  Version: 3
Trust this certificate? [no]:  yes
Certificate was added to keystore</pre></li><li class="step"><p>Download the OpenDJ password synchronization plugin, OPENIDM
    AGENTS-OPENDJ, from the OpenIDM download page under the ForgeRock
    <a class="link" href="http://forgerock.com/download-stack/" target="_blank">Open Stack download page</a>.</p></li><li class="step"><p>Unzip the module delivery.</p><pre class="cmdline prettyprint">$ unzip ~/Downloads/opendj-accountchange-handler-.zip
   creating: opendj/
   creating: opendj/config/
   creating: opendj/config/schema/
...</pre></li><li class="step"><p>Copy files to the directory where OpenDJ is installed.</p><pre class="cmdline prettyprint">$ cd opendj
$ cp -r * /path/to/OpenDJ/</pre></li><li class="step"><p>Restart OpenDJ to load the additional schema from the module.</p><pre class="cmdline prettyprint">$ cd /path/to/OpenDJ/bin
$ ./stop-ds --restart</pre></li><li class="step"><p>Add the configuration provided to OpenDJ's configuration.</p><pre class="cmdline prettyprint">$ ./ldapmodify
 --port 1389
 --hostname `hostname`
 --bindDN "cn=Directory Manager"
 --bindPassword "password"
 --defaultAdd
 --filename ../config/openidm-pwsync-plugin-config.ldif
Processing ADD request for cn=OpenIDM Notification Handler,
 cn=Account Status Notification Handlers,cn=config
ADD operation successful for DN cn=OpenIDM Notification Handler
 ,cn=Account Status Notification Handlers,cn=config</pre></li><li class="step"><p>Restart OpenDJ.</p><pre class="cmdline prettyprint">$ ./stop-ds --restart
...
[16/Jan/2012:15:55:47 +0100] category=EXTENSIONS severity=INFORMATION
 msgID=1049147 msg=Loaded extension from file '/path/to/OpenDJ/lib/extensions
 /opendj-accountchange-handler-.jar' (build &lt;unknown&gt;,
 revision &lt;unknown&gt;)
...
[16/Jan/2012:15:55:51 +0100] category=CORE severity=NOTICE msgID=458891 msg=The
 Directory Server has sent an alert notification generated by class
 org.opends.server.core.DirectoryServer (alert type
 org.opends.server.DirectoryServerStarted, alert ID 458887):
 The Directory Server has started successfully</pre></li><li class="step"><p>Enable the plugin for the appropriate password policy.</p><p>The following command enables the plugin for the default password
    policy.</p><pre class="cmdline prettyprint">$ ./dsconfig
 set-password-policy-prop
 --port 4444
 --hostname `hostname`
 --bindDN "cn=Directory Manager"
 --bindPassword password
 --policy-name "Default Password Policy"
 --set account-status-notification-handler:"OpenIDM Notification Handler"
 --trustStorePath ../config/admin-truststore
 --no-prompt</pre></li></ol></div></div><div class="procedure" id="install-ad-password-sync-plugin"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;12.2.&nbsp;To Install the Active Directory Password Synchronization Plugin</div><a class="indexterm" name="d0e8936"></a><p>Use the Active Directory password synchronization plugin to synchronize
   passwords between OpenIDM and Active Directory (on systems running at least
   Microsoft Windows 2008).</p><p>Install the plugin on Active Directory primary domain controllers
   (PDCs) to intercept password changes, and send the password values to OpenIDM
   over an encrypted channel. You must have Administrator privileges to install
   the plugin. In a clustered Active Directory environment, you must also
   install the plugin on all PDCs.</p><ol class="procedure" type="1"><li class="step"><p>Download the Active Directory password synchronization plugin,
    AD CONNECTOR, from the OpenIDM download page under the ForgeRock
    <a class="link" href="http://forgerock.com/download-stack/" target="_blank">Open Stack download page</a>.</p></li><li class="step"><p>Unzip the plugin, and double-click <code class="filename">setup.exe</code> to
    launch the installation wizard.</p></li><li class="step"><p>Complete the installation with the help of the following hints.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">CDDL license agreement</span></dt><dd><p>You must accept the agreement to proceed with the
       installation.</p></dd><dt><span class="term">OpenIDM URL</span></dt><dd><p>URL where OpenIDM is deployed such as
       <code class="literal">https://openidm.example.com:8444/openidm</code> for
       SSL mutual authentication</p></dd><dt><span class="term">Private Key alias</span></dt><dd><p>Alias used for the OpenIDM certificate also stored in the
       <code class="filename">keystore.jceks</code> file, such as
       <code class="literal">openidm-localhost</code> used for evaluation</p></dd><dt><span class="term">Private Key password</span></dt><dd><p>Password to access the PFX keystore file, such as
       <code class="literal">changeit</code> for evaluation. PFX files contain
       encrypted private keys, certificates used for authentication and
       encryption.</p></dd><dt><span class="term">Directory poll interval (seconds)</span></dt><dd><p>Number of seconds between calls to check that Active Directory
       is available, such as 60</p></dd><dt><span class="term">Query ID parameter</span></dt><dd><p>Query identifier configured in OpenIDM the
       <code class="filename">openidm/conf/repo.*.json</code> file. Use
       <code class="literal">for-userName</code> for evaluation.</p></dd><dt><span class="term">OpenIDM user password attribute </span></dt><dd><p>Password attribute for the <code class="literal">managed/user</code> object
       to which OpenIDM applies password changes</p></dd><dt><span class="term">OpenIDM user search attribute</span></dt><dd><p>The <code class="literal">sAMAccountName</code> value holder attribute name
       in the query definition. For example,
       <code class="literal">"SELECT * FROM ${unquoted:_resource} WHERE userName = ${uid}"</code>.
       Use <code class="literal">uid</code> for the evaluation.</p></dd><dt><span class="term">Select Certificate File</span></dt><dd><p>The PKCS 12 format PFX file containing the certificate used to
       encrypt communications with OpenIDM. Use
       <code class="filename">openidm/samples/security/openidm-localhost.p12</code> for
       evaluation.</p></dd><dt><span class="term">Select Output Directory</span></dt><dd><p>Select a secure directory where the password changes are queued.
       The queue contains the encrypted passwords. Yet, the server has to
       prevent access to this folder except access by the <code class="literal">Password
       Sync service</code>. The path name cannot include spaces.</p></dd><dt><span class="term">Select Log Directory</span></dt><dd><p>The plugin stores logs in the location you select. The path name
       cannot include spaces.</p></dd><dt><span class="term">Select Destination Location</span></dt><dd><p>Setup installs the plugin in the location you select, by default
       <code class="filename">C:\Program Files\OpenIDM Password Sync</code>.</p></dd></dl></div></li><li class="step"><p>After running the installation wizard, restart the computer.</p></li><li class="step"><p>If you must change any settings after installation, access settings
    using the Registry Editor under HKEY_LOCAL_MACHINE &gt; SOFTWARE &gt;
    ForgeRock &gt; OpenIDM &gt; PasswordSync.</p></li></ol></div></div><div class="procedure" id="setup-openidm-for-password-sync"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;12.3.&nbsp;To Set Up OpenIDM to Handle Password Changes</div><p>Follow these steps to configure OpenIDM to access password changes
   from the directory server.</p><ol class="procedure" type="1"><li class="step"><p>Add the directory server certificate to the OpenIDM trust store so
    that OpenIDM knows to trust the directory server during mutual
    authentication.</p><p>The following commands show how to do this with the default OpenDJ
    and OpenIDM settings.</p><pre class="cmdline prettyprint">$ cd /path/to/OpenDJ/config/
$ keytool
 -keystore keystore
 -storepass `cat keystore.pin`
 -export
 -alias server-cert
 &gt; /tmp/opendj.crt
$ cd /path/to/openidm/security/
$ keytool
 -import
 -alias opendj-server-cert
 -file /tmp/opendj.crt
 -keystore truststore
 -storepass changeit
 -trustcacerts
Owner: CN=localhost.localdomain, O=OpenDJ Self-Signed Certificate
Issuer: CN=localhost.localdomain, O=OpenDJ Self-Signed Certificate
Serial number: 4f143976
Valid from: Mon Jan 16 15:51:34 CET 2012 until: Wed Jan 15 15:51:34 CET 2014
Certificate fingerprints:
   MD5:  7B:7A:75:FC:5A:F0:65:E5:84:43:6D:10:B9:EA:CC:F0
   SHA1: D1:C6:C9:8A:EA:09:FD:1E:48:BB:B2:F5:95:41:50:2C:AB:4D:0F:C9
   Signature algorithm name: SHA1withRSA
   Version: 3
Trust this certificate? [no]:  yes
Certificate was added to keystore</pre></li><li class="step"><p>Add the configuration to managed objects to handle password
    synchronization.</p><p>You can find an example for synchronization with both OpenDJ and
    Active Directory in <code class="filename">samples/misc/managed.json</code>,
    JavaScript lines folded for readability:</p><pre class="codelisting prettyprint linenums lang-js">
{
    "objects": [
        {
            "name": "user",
            "properties": [
                {
                    "name": "ldapPassword",
                    "encryption": {
                        "key": "openidm-sym-default"
                    }
                },
                {
                    "name": "adPassword",
                    "encryption": {
                        "key": "openidm-sym-default"
                    }
                },
                {
                    "name": "password",
                    "encryption": {
                        "key": "openidm-sym-default"
                    }
                }
            ],
            "onUpdate": {
                "type": "text/javascript",
                "source":
                 "if (newObject.ldapPassword != oldObject.ldapPassword) {
                     newObject.password = newObject.ldapPassword
                  } else if (newObject.adPassword != oldObject.adPassword) {
                      newObject.password = newObject.adPassword
                  }"
            }
        }
    ]
}</pre><p>This sample assumes you define the password as
    <code class="literal">ldapPassword</code> for OpenDJ, and
    <code class="literal">adPassword</code> for Active Directory.</p></li><li class="step"><p>When you change a password in OpenDJ, you will notice that the value 
    changes in OpenIDM.</p><pre class="cmdline prettyprint">$ tail -f openidm/audit/activity.csv | grep bjensen
...userName=bjensen, ... password={$crypto={...data=tEsy7ZXo6nZtEqzW/uVE/A==...
...userName=bjensen, ... password={$crypto={...data=BReT79lnQEPcvfQG3ibLpg==...</pre><p>Be aware that the plugin is patching the password value of the 
    managed user in OpenIDM. The target <code class="literal">password</code> property 
    must exist for the patch to work. After the password has been updated in 
    OpenIDM, automatic synchronization is launched and the password is updated 
    in Active Directory.</p></li></ol></div></div></div></div><div lang="en" class="chapter" id="chap-auth"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;13.&nbsp;Managing Authentication, Authorization and RBAC</h1></div></div></div><a class="indexterm" name="d0e9125"></a><a class="indexterm" name="d0e9128"></a><p>OpenIDM provides a simple, yet flexible authentication and authorization 
 mechanism based on REST interface URLs and on roles stored in the repository.
 </p><div class="section" id="openidm-users"><div class="titlepage"><div><div><h2 class="title" style="clear: both">13.1.&nbsp;OpenIDM Users</h2></div></div></div><a class="indexterm" name="d0e9136"></a><a class="indexterm" name="d0e9141"></a><p>OpenIDM distinguishes between internal users and managed users.</p><div class="section" id="internal-users"><div class="titlepage"><div><div><h3 class="title">13.1.1.&nbsp;Internal Users</h3></div></div></div><p>Two internal users are created by default - <code class="literal">anonymous</code> 
   and <code class="literal">openidm-admin</code>. These accounts are separated from 
   other user accounts to protect them from any reconciliation or 
   synchronization processes.</p><p>OpenIDM stores internal users and their role membership in a table
   in the repository called <code class="literal">internaluser</code> when implemented
   in MySQL, and in the <code class="literal">internal_user</code> table for an OrientDB 
   repository. You can add or remove internal users over the REST interface 
   (at <code class="literal">http://localhost:8080/openidm/repo/internal/user</code>) or 
   directly in the repository.
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">anonymous</span></dt><dd><p>This user serves to access OpenIDM anonymously, for users
     who do not have their own accounts. The anonymous user is primarily
     intended to allow self-registration.</p><p>OpenIDM stores the anonymous user's password,
     <code class="literal">anonymous</code>, in clear text in the repository internal
     user table. The password is not considered to be secret.</p></dd><dt><span class="term">openidm-admin</span></dt><dd><p>This user serves as the super administrator. After
     installation, the <code class="literal">openidm-admin</code> user has full access,
     and provides a fallback mechanism in case other users are locked out. Do 
     not use <code class="literal">openidm-admin</code> for normal tasks. Under normal 
     circumstances, no real user is associated with the 
     <code class="literal">openidm-admin</code> user account, so audit log records that 
     pertain to <code class="literal">openidm-admin</code> do not reflect the actions of 
     any real person.</p><p>OpenIDM encrypts the password, <code class="literal">openidm-admin</code>, by
     default. Change the password immediately after installation. For
     instructions, see <a href="../integrators-guide/index.html#security-replace-default-user-password" class="link"><em class="citetitle">To Replace the Default User and Password</em></a>.</p></dd></dl></div></div><div class="section" id="managed-users"><div class="titlepage"><div><div><h3 class="title">13.1.2.&nbsp;Managed Users</h3></div></div></div><a class="indexterm" name="d0e9212"></a><p>External users that OpenIDM manages are referred to as managed users.
   When implemented in MySQL, OpenIDM stores managed users in the managed 
   objects table of the repository, named <code class="literal">managedobjects</code>. 
   A second MySQL table, <code class="literal">managedobjectproperties</code>, serves as 
   the index table. When implemented in OrientDB, managed objects are stored in 
   the table <code class="literal">managed_user</code>.</p><p>By default, the attribute names for managed user login and password
   are <code class="literal">userName</code> and <code class="literal">password</code>,
   respectively.</p></div></div><div class="section" id="openidm-authentication"><div class="titlepage"><div><div><h2 class="title" style="clear: both">13.2.&nbsp;Authentication</h2></div></div></div><p>OpenIDM does not allow access to the REST interface unless you
  authenticate. If a project requires anonymous access, to allow users to
  self-register for example, then allow access by user
  <code class="literal">anonymous</code>, password <code class="literal">anonymous</code>, as
  described in <a class="xref" href="#internal-users" title="13.1.1.&nbsp;Internal Users">Section&nbsp;13.1.1, &#8220;Internal Users&#8221;</a>. In production, only
  applications are expected to access the REST interface.</p><div class="variablelist"><p>OpenIDM supports an improved authentication mechanism on the REST 
   interface. Unlike basic authentication or form-based authentication, the 
   OpenIDM authentication mechanism is compatible with the AJAX framework.
   </p><dl class="variablelist"><dt><span class="term">OpenIDM authentication with standard header fields</span></dt><dd><pre class="cmdline prettyprint">$ curl --user userName:password</pre><p>This authentication is compatible with standard basic authentication, 
     except that it will not prompt for credentials if they are missing in the 
     request.</p></dd><dt><span class="term">OpenIDM  authentication with OpenIDM header fields</span></dt><dd><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"</pre></dd></dl></div><p>For more information about the OpenIDM authentication mechanism, see <a href="../integrators-guide/index.html#security-messages" class="link">
  <em class="citetitle">Use Message Level Security</em></a>.</p><p>You can change the attributes that OpenIDM uses to store user login 
  and password values. The attribute names are shown in a database query
  that is defined in 
  <code class="filename">openidm/conf/repo.<em class="replaceable"><code>repo-type</code></em>.json</code>.
  </p><div class="variablelist"><p>Two queries are defined by default.</p><dl class="variablelist"><dt><span class="term"><code class="literal">credential-internaluser-query</code></span></dt><dd><p>Uses the <code class="literal">_openidm_id</code> attribute for login</p></dd><dt><span class="term"><code class="literal">credential-query</code></span></dt><dd><p>Uses the <code class="literal">userName</code> attribute for login</p></dd></dl></div><p>The <code class="filename">openidm/conf/authentication.json</code> file defines
  the currently active query as the value of the <code class="literal">queryId</code>
  property. In the following example, <code class="literal">credential-query</code> is
  active.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "queryId" : "credential-query",
    "queryOnResource" : "managed/user",
    "defaultUserRoles" : [ ]
}</pre><p>You can explicitly define the properties that constitute passwords or 
 roles by setting the <code class="literal">propertyMapping</code> object in the 
 <code class="filename">conf/authentication.json</code> file. By default, the property 
 mapping is configured as follows:</p><pre class="codelisting prettyprint linenums lang-js">
 ...
    "propertyMapping" : {
        "userId" : "_id",
        "userCredential" : "password",
        "userRoles" : "roles"
    },
 ... 
 </pre></div><div class="section" id="openidm-roles"><div class="titlepage"><div><div><h2 class="title" style="clear: both">13.3.&nbsp;Roles</h2></div></div></div><a class="indexterm" name="d0e9330"></a><a class="indexterm" name="d0e9335"></a><div class="variablelist"><p>OpenIDM sets up the following roles by default:</p><dl class="variablelist"><dt><span class="term">openidm-reg</span></dt><dd><p>Role for users accessing OpenIDM with the default anonymous
     account</p></dd><dt><span class="term">openidm-admin</span></dt><dd><p>OpenIDM administrator role</p></dd><dt><span class="term">openidm-authorized</span></dt><dd><p>Default role for any user authenticated with a user name and
     password</p></dd><dt><span class="term">openidm-cert</span></dt><dd><p>Default role for any user authenticated with mutual SSL
     authentication</p></dd></dl></div><p>A user's roles are fetched <span class="emphasis"><em>after</em></span> authentication.
  If no roles are defined in the user profile, the
  <code class="literal">defaultUserRoles</code> are applied. You can configure
  the default roles that are assigned to successfully authenticated users by
  setting the <code class="literal">defaultUserRoles</code> property in
  <code class="filename">openidm/conf/authentication.json</code>, which
  takes a list. The default value is <code class="literal">openidm-authorized</code>.
  </p><pre class="codelisting prettyprint linenums lang-js">
{
    "queryId": "credential-query",
    "queryOnResource": "managed/user",
    "defaultUserRoles": [
        "openidm-authorized"
    ]
}</pre><p>A managed user who does not have a role of <code class="literal">openidm-authorized</code>
   can authenticate but is unable to access certain system resources,
   according to the access control configured in the <code class="filename">access.js</code>
   file. Requests on a resource for which access is denied return a 403 error.
   For more information, see the following section covering
   <a class="xref" href="#openidm-authorization" title="13.4.&nbsp;Authorization">Section&nbsp;13.4, &#8220;Authorization&#8221;</a>.</p></div><div class="section" id="openidm-authorization"><div class="titlepage"><div><div><h2 class="title" style="clear: both">13.4.&nbsp;Authorization</h2></div></div></div><a class="indexterm" name="d0e9400"></a><p>OpenIDM provides role-based authorization that restricts direct 
  HTTP access to REST interface URLs. The default authorization configuration 
  grants different access rights to users that are assigned the roles 
  <code class="literal">"openidm-admin"</code>, <code class="literal">"openidm-cert"</code>, 
  <code class="literal">"openidm-authorized"</code>, and <code class="literal">"openidm-reg"</code>.
  </p><p>Note that this access control applies to direct HTTP calls only. Access 
  for internal calls (for example, calls from scripts) is not affected by this 
  mechanism.</p><div class="itemizedlist"><p>Authorization is configured in two script files:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">openidm/bin/defaults/script/router-authz.js</code></p></li><li class="listitem"><p><code class="filename">openidm/script/access.js</code></p></li></ul></div><p>OpenIDM calls these scripts for each request, via the 
  <code class="literal">onRequest</code> hook that is defined in the default 
  <code class="filename">router.json</code> file. The scripts either throw the string 
  <code class="literal">Access denied</code>, or nothing. If 
  <code class="literal">Access denied</code> is thrown, OpenIDM denies the request.
  </p><div class="section" id="router-authz-js"><div class="titlepage"><div><div><h3 class="title">13.4.1.&nbsp;<code class="literal">router-authz.js</code></h3></div></div></div><p>This file provides the functions that enforce access rules. For 
    example, the following function controls whether users with a certain role 
    can start a specified process.</p><pre class="codelisting prettyprint linenums lang-js">
...
function isAllowedToStartProcess() {
var processDefinitionId = request.value._processDefinitionId;
return isProcessOnUsersList(processDefinitionId);
}
...
    </pre><p>There are certain functions in <code class="filename">router-authz.js</code> 
    that should <span class="emphasis"><em>not</em></span> be altered. These are indicated in the 
    file itself.</p></div><div class="section" id="access-js"><div class="titlepage"><div><div><h3 class="title">13.4.2.&nbsp;<code class="literal">access.js</code></h3></div></div></div><p>This file defines the access configuration for HTTP requests and 
    references the methods defined in <code class="filename">router-authz.js</code>. Each 
    entry in the configuration contains a pattern to match against the incoming 
    request ID, and the associated roles, methods, and actions that are allowed 
    for requests on that pattern.</p><p>The following sample configuration entry indicates the configurable 
    parameters and their purpose.</p><pre class="codelisting prettyprint linenums lang-js">
        {  
            "pattern"   : "*",
            "roles"     : "openidm-admin",
            "methods"   : "*", // default to all methods allowed
            "actions"   : "*", // default to all actions allowed
            "customAuthz" : "disallowQueryExpression()",
            "excludePatterns": "system/*"
        },    
    </pre><p>The overall intention of this entry is to allow users with the role 
    <code class="literal">openidm-admin</code> HTTP access to everything except the 
    <code class="literal">system</code> endpoints. The parameters are as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">"pattern"</code> - the REST endpoint to which access 
          is being controlled. <code class="literal">"*"</code> indicates access to all 
          endpoints. <code class="literal">"managed/user/*"</code> would indicate access 
          to all managed user objects.</p></li><li class="listitem"><p><code class="literal">"roles"</code> - a comma-separated list of the roles 
          to which this access configuration applies.</p></li><li class="listitem"><p><code class="literal">"methods"</code> - a comma separated list of the 
          methods to which access is being granted. The method can be one or 
          more of <code class="literal">create, read, update, delete, patch, action, query</code>. 
          A value of <code class="literal">"*"</code> indicates that all methods are 
          allowed. A value of <code class="literal">""</code> indicates that no methods 
          are allowed.</p></li><li class="listitem"><p><code class="literal">"actions"</code> - a comma separated list of the 
          allowed actions. The possible values depend on the service (URL) that 
          is being exposed. The following list indicates the possible actions 
          for each service.</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">openidm/managed</code> - 
              <code class="literal">patch</code></td></tr><tr><td><code class="literal">openidm/recon</code> - 
              <code class="literal">recon, cancel</code></td></tr><tr><td><code class="literal">openidm/sync</code> - 
              <code class="literal">onCreate, onUpdate, onDelete, recon, performAction</code>
            </td></tr><tr><td><code class="literal">openidm/external/email</code> - 
              <code class="literal">(no action parameter applies)</code></td></tr><tr><td><code class="literal">openidm/external/rest</code> - 
              <code class="literal">(no action parameter applies)</code></td></tr><tr><td><code class="literal">openidm/authentication</code> - 
              <code class="literal">reauthenticate</code></td></tr><tr><td><code class="literal">openidm/system</code> - 
              <code class="literal">createconfiguration</code></td></tr><tr><td><code class="literal">openidm/system/*</code> - 
              <code class="literal">script</code></td></tr><tr><td><code class="literal">openidm/taskscanner</code> - 
              <code class="literal">execute, cancel</code></td></tr><tr><td><code class="literal">openidm/workflow/processinstance</code> - 
              <code class="literal">(no action parameter applies)</code></td></tr><tr><td><code class="literal">openidm/workflow/taskinstance</code> - 
              <code class="literal">claim,complete</code></td></tr></table><p>A value of <code class="literal">"*"</code> indicates that all actions 
         exposed for that service are allowed. A value of <code class="literal">""</code> 
         indicates that no actions are allowed.</p></li><li class="listitem"><p><code class="literal">"customAuthz"</code> - an optional parameter that 
          enables you to specify a custom function for additional authorization 
          checks. These functions are defined in <code class="filename">router-authz.js</code>
          .</p><p>The <code class="literal">allowedPropertiesForManagedUser</code> variable,
          declared at the beginning of the file, enables you to create a white
          list of attributes that users may modify on their own accounts.</p></li><li class="listitem"><p><code class="literal">"excludePatterns"</code> - an optional parameter 
          that enables you to specify particular endpoints to which access 
          should not be given.</p></li></ul></div></div><div class="section" id="authorization-extending"><div class="titlepage"><div><div><h3 class="title">13.4.3.&nbsp;Extending the Authorization Mechanism</h3></div></div></div><p>You can extend the default authorization mechanism by defining 
    additional functions in <code class="filename">router-authz.js</code> and by 
    creating new access control configuration definitions in 
    <code class="filename">access.js</code>.</p></div></div></div><div lang="en" class="chapter" id="chap-security"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;14.&nbsp;Securing &amp; Hardening OpenIDM</h1></div></div></div><a class="indexterm" name="d0e9626"></a><a class="indexterm" name="d0e9629"></a><p>After following the guidance in this chapter, make sure that you test
 your installation to verify that it behaves as expected before putting it
 into production.</p><p>Out of the box, OpenIDM is set up for ease of development and
 deployment. When deploying OpenIDM in production, take the following
 precautions.</p><div class="section" id="security-ssl-https"><div class="titlepage"><div><div><h2 class="title" style="clear: both">14.1.&nbsp;Use SSL and HTTPS</h2></div></div></div><a class="indexterm" name="d0e9639"></a><p>Disable plain HTTP access, included for development convenience, as
  described in the section titled <a href="../integrators-guide/index.html#security-jetty" class="link"><em class="citetitle">Secure
  Jetty</em></a>.</p><p>Use TLS/SSL to access OpenIDM, ideally with mutual authentication so
  that only trusted systems can invoke each other. TLS/SSL protects data on
  the wire. Mutual authentication with certificates imported into the
  applications' trust and key stores provides some confidence for trusting
  application access.</p><p>Augment this protection with message level security where
  appropriate.</p></div><div class="section" id="rest-over-https"><div class="titlepage"><div><div><h2 class="title" style="clear: both">14.2.&nbsp;Restrict REST Access to the HTTPS Port</h2></div></div></div><p>Use certificates to secure REST access, over HTTPS. The following
     procedure shows how to generate a self-signed certificate to secure REST
     calls, over HTTPS. Note that in production systems, it is recommended that
     you use a key that has been signed by a certificate authority.</p><div class="procedure"><div class="procedure-inner"><ol class="procedure" type="1"><li class="step"><p>Extract the certificate that is installed with OpenIDM.</p><pre class="cmdline prettyprint">$ openssl s_client -showcerts -connect localhost:8443 &lt;/dev/null</pre><p>This command outputs the entire certificate to the terminal.</p></li><li class="step"><p>Using any text editor, create a file named <code class="filename">server.crt</code>.
             Copy the portion of the certificate from <code class="literal">&shy;&shy;&shy;&shy;&shy;BEGIN CERTIFICATE&shy;&shy;&shy;&shy;&shy;</code>
             to <code class="literal">&shy;&shy;&shy;&shy;&shy;END CERTIFICATE&shy;&shy;&shy;&shy;&shy;</code> and paste it into the
             <code class="filename">server.crt</code> file. Your <code class="filename">server.crt</code>
             file should now contain something like the following:</p><pre class="cmdline prettyprint">$ more server.crt
-----BEGIN CERTIFICATE-----
MIIB8zCCAVygAwIBAgIETkvDjjANBgkqhkiG9w0BAQUFADA+MSgwJgYDVQQKEx9P
cGVuSURNIFNlbGYtU2lnbmVkIENlcnRpZmljYXRlMRIwEAYDVQQDEwlsb2NhbGhv
c3QwHhcNMTEwODE3MTMzNTEwWhcNMjEwODE3MTMzNTEwWjA+MSgwJgYDVQQKEx9P
cGVuSURNIFNlbGYtU2lnbmVkIENlcnRpZmljYXRlMRIwEAYDVQQDEwlsb2NhbGhv
c3QwgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAKwMkyvHS5yHAnI7+tXUIbfI
nQfhcTChpWNPTHc/cli/+Ta1InTpN8vRScPoBG0BjCaIKnVVl2zZ5ya74UKgwAVe
oJQ0xDZvIyeC9PlvGoqsdtH/Ihi+T+zzZ14oVxn74qWoxZcvkG6rWEOd42QzpVhg
wMBzX98slxkOZhG9IdRxAgMBAAEwDQYJKoZIhvcNAQEFBQADgYEASo4qMI0axEKZ
m0jU4yJejLBHydWoZVZ8fKcHVlD/rTirtVgWsVgvdr3yUr0Idk1rH1nEF47Tzn+V
UCq7qJZ75HnIIeVrZqmfTx8169paAKAaNF/KRhTE6ZII8+awst02L86shSSWqWz3
s5xPB2YTaZHWWdzrPVv90gL8JL/N7/Q=
-----END CERTIFICATE-----
             </pre></li><li class="step"><p>Generate a private, self-signed key as follows:</p><ol type="a" class="substeps"><li class="step"><p>Generate an encrypted 1024-bit RSA key, and save it
                     to a file named <code class="filename">localhost.key</code>. Enter
                     a pass phrase for the key as requested.</p><pre class="cmdline prettyprint">$ openssl genrsa -des3 -out localhost.key 1024
Generating RSA private key, 1024 bit long modulus
.........++++++
.........................++++++
e is 65537 (0x10001)
Enter pass phrase for localhost.key:
Verifying - Enter pass phrase for localhost.key:</pre></li><li class="step"><p>Generate a certificate request using the key you
                     created in the previous step, and save it to a file named
                     <code class="filename">localhost.csr</code>. Enter any required
                     information to create the DN for the request.</p><pre class="cmdline prettyprint">$ openssl req -new -key localhost.key -out localhost.csr</pre><p>This step creates a file, <code class="filename">localhost.csr</code>,
                     that contains the details of the certificate request.</p></li><li class="step"><p>Sign the certificate with the key you created in the
                     previous step, and generate a certificate that is valid
                     for one year in a file named <code class="filename">localhost.crt</code>.
                     The <code class="literal">x509</code> subcommand enables you to
                     retrieve the information that is stored in the SSL certificate.
                     Output will depend on the details that you entered in the
                     certificate request.</p><pre class="cmdline prettyprint">
$ openssl x509 -req -days 365 -in localhost.csr -signkey localhost.key -out localhost.crt
Signature ok
subject=/C=FR/ST=Il-DE-FRANCE/L=Paris/O=example.com
Getting Private key
Enter pass phrase for localhost.key:
                     </pre><p>The contents of <code class="filename">localhost.crt</code> should
                     now be something like this:</p><pre class="cmdline prettyprint">$ more localhost.crt
-----BEGIN CERTIFICATE-----
MIIB/zCCAWgCCQD6VdiF6rX2czANBgkqhkiG9w0BAQUFADBEMQswCQYDVQQGEwJa
QTELMAkGA1UECBMCV0MxEjAQBgNVBAcTCUNhcGUgVG93bjEUMBIGA1UEChMLZXhh
bXBsZS5jb20wHhcNMTMwMTI1MTIzNzIyWhcNMTQwMTI1MTIzNzIyWjBEMQswCQYD
VQQGEwJaQTELMAkGA1UECBMCV0MxEjAQBgNVBAcTCUNhcGUgVG93bjEUMBIGA1UE
ChMLZXhhbXBsZS5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAONLO82s
wKA0tWkbR66DajwQKNO9QlYwZvcK4X7MFOcwex+8j2vvG5HCB0BW2Gm72mFTWei8
gVgQDP1oe/yTWDZRaiJ8rGWdvpgH1Cmxcd3N1AhhRya1I2j5wxrc9ZsyyTYCg2fd
pFfULrUXSd9QlB2qQZz7kb4ksT/mSwPiGqvFAgMBAAEwDQYJKoZIhvcNAQEFBQAD
gYEA3WrP8NKjXwQzE0vabYmdUhPHt3PF8EMMwVJ+h8G9Dwmtll0P/kLybXdHF1P/
SvN8ofdaEKi4DrLvBifkJvHdTm9DgZJo+bROM6LM9kac6CxNvwj9m/4g6mhnjxEV
63WQPzvAeriO51JC0ysMVe5vf+lO0t+J8W6SfPTKwoXDQhY=
-----END CERTIFICATE-----
                     </pre></li></ol></li><li class="step"><p>Combine the contents of <code class="filename">server.crt</code> and
             <code class="filename">localhost.crt</code> to create a Privacy Enhanced
             Mail Certificate (<code class="literal">.pem</code>) file named
             <code class="filename">CA.pem</code>.</p><pre class="cmdline prettyprint">$ cat server.crt localhost.crt &gt; CA.pem</pre><p>The contents of <code class="filename">CA.pem</code> should be
             something like the following (a concatenation of
             <code class="filename">server.crt</code> and <code class="filename">localhost.crt</code>).</p><pre class="cmdline prettyprint">$ more CA.pem
-----BEGIN CERTIFICATE-----
MIIB8zCCAVygAwIBAgIETkvDjjANBgkqhkiG9w0BAQUFADA+MSgwJgYDVQQKEx9P
cGVuSURNIFNlbGYtU2lnbmVkIENlcnRpZmljYXRlMRIwEAYDVQQDEwlsb2NhbGhv
c3QwHhcNMTEwODE3MTMzNTEwWhcNMjEwODE3MTMzNTEwWjA+MSgwJgYDVQQKEx9P
cGVuSURNIFNlbGYtU2lnbmVkIENlcnRpZmljYXRlMRIwEAYDVQQDEwlsb2NhbGhv
c3QwgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAKwMkyvHS5yHAnI7+tXUIbfI
nQfhcTChpWNPTHc/cli/+Ta1InTpN8vRScPoBG0BjCaIKnVVl2zZ5ya74UKgwAVe
oJQ0xDZvIyeC9PlvGoqsdtH/Ihi+T+zzZ14oVxn74qWoxZcvkG6rWEOd42QzpVhg
wMBzX98slxkOZhG9IdRxAgMBAAEwDQYJKoZIhvcNAQEFBQADgYEASo4qMI0axEKZ
m0jU4yJejLBHydWoZVZ8fKcHVlD/rTirtVgWsVgvdr3yUr0Idk1rH1nEF47Tzn+V
UCq7qJZ75HnIIeVrZqmfTx8169paAKAaNF/KRhTE6ZII8+awst02L86shSSWqWz3
s5xPB2YTaZHWWdzrPVv90gL8JL/N7/Q=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIB/zCCAWgCCQD6VdiF6rX2czANBgkqhkiG9w0BAQUFADBEMQswCQYDVQQGEwJa
QTELMAkGA1UECBMCV0MxEjAQBgNVBAcTCUNhcGUgVG93bjEUMBIGA1UEChMLZXhh
bXBsZS5jb20wHhcNMTMwMTI1MTIzNzIyWhcNMTQwMTI1MTIzNzIyWjBEMQswCQYD
VQQGEwJaQTELMAkGA1UECBMCV0MxEjAQBgNVBAcTCUNhcGUgVG93bjEUMBIGA1UE
ChMLZXhhbXBsZS5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAONLO82s
wKA0tWkbR66DajwQKNO9QlYwZvcK4X7MFOcwex+8j2vvG5HCB0BW2Gm72mFTWei8
gVgQDP1oe/yTWDZRaiJ8rGWdvpgH1Cmxcd3N1AhhRya1I2j5wxrc9ZsyyTYCg2fd
pFfULrUXSd9QlB2qQZz7kb4ksT/mSwPiGqvFAgMBAAEwDQYJKoZIhvcNAQEFBQAD
gYEA3WrP8NKjXwQzE0vabYmdUhPHt3PF8EMMwVJ+h8G9Dwmtll0P/kLybXdHF1P/
SvN8ofdaEKi4DrLvBifkJvHdTm9DgZJo+bROM6LM9kac6CxNvwj9m/4g6mhnjxEV
63WQPzvAeriO51JC0ysMVe5vf+lO0t+J8W6SfPTKwoXDQhY=
-----END CERTIFICATE-----
             </pre></li><li class="step"><p>Test REST access on the HTTPS port, using the certificate
             that you created in the previous step. For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username:openidm-admin"
 --header "X-OpenIDM-Password:openidm-admin"
 --cacert CA.pem
 --request GET
 "https://localhost:8443/openidm/managed/user/?_queryId=query-all-ids"
{
    "conversion-time-ms": 0,
    "result": [
        {
            "_rev": "0",
            "_id": "8afd44a7-13be-449e-9c47-7a310e675c00"
        }
    ],
    "query-time-ms": 1
}
             </pre><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>If you receive the response
                 <code class="literal">curl: (52) Empty reply from server</code>, check
                 that you have, in fact, used <code class="literal">https</code> and not
                 <code class="literal">http</code> in the URL.</p></div></div></li></ol></div></div></div><div class="section" id="security-encrypt-data"><div class="titlepage"><div><div><h2 class="title" style="clear: both">14.3.&nbsp;Encrypt Data Internally &amp; Externally</h2></div></div></div><a class="indexterm" name="d0e9780"></a><a class="indexterm" name="d0e9785"></a><p>Beyond relying on end-to-end availability of TLS/SSL to protect
  data, OpenIDM also supports explicit encryption of data that goes on the
  wire. This can be important if the TLS/SSL termination happens prior to
  the final end point.</p><p>OpenIDM also supports encryption of data stored in the repository,
  using a symmetric key. This protects against some attacks on the data
  store. Explicit table mapping is supported for encrypted string values.</p><p>OpenIDM automatically encrypts sensitive data in configuration files,
  such as passwords. OpenIDM replaces clear text values when the system first
  reads the configuration file. Take care with configuration files having
  clear text values that OpenIDM has not yet read and updated.</p></div><div class="section" id="security-messages"><div class="titlepage"><div><div><h2 class="title" style="clear: both">14.4.&nbsp;Use Message Level Security</h2></div></div></div><a class="indexterm" name="d0e9797"></a><p>OpenIDM supports message level security, forcing authentication before
  granting access. Authentication works by means of a filter-based mechanism
  that lets you use either an HTTP Basic like mechanism or OpenIDM-specific 
  headers, setting a cookie in the response that you can use for subsequent 
  authentication. If you attempt to access OpenIDM URLs without the appropriate 
  headers or session cookie, OpenIDM returns HTTP 401 Unauthorized, or HTTP 403
  Forbidden, depending on the situation. If you use a session cookie, you must
  include an additional header that indicates the origin of the request.</p><p>The following examples show successful authentications.</p><pre class="cmdline prettyprint">$ curl
 --dump-header /dev/stdout
 --user openidm-admin:openidm-admin
 "http://localhost:8080/openidm/managed/user/?_queryId=query-all-ids"

HTTP/1.1 200 OK
Set-Cookie: JSESSIONID=2l0zobpuk6st1b2m7gvhg5zas;Path=/
Expires: Thu, 01 Jan 1970 00:00:00 GMT
Content-Type: application/json; charset=UTF-8
Date: Wed, 18 Jan 2012 10:36:19 GMT
Accept-Ranges: bytes
Server: Restlet-Framework/2.0.9
Transfer-Encoding: chunked

{"query-time-ms":1,"result":[{"_id":"ajensen"},{"_id":"bjensen"}]}

$ curl
 --dump-header /dev/stdout
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 "http://localhost:8080/openidm/managed/user/?_queryId=query-all-ids"

HTTP/1.1 200 OK
Set-Cookie: JSESSIONID=ixnekr105coj11ji67xcluux8;Path=/
Expires: Thu, 01 Jan 1970 00:00:00 GMT
Content-Type: application/json; charset=UTF-8
Date: Wed, 18 Jan 2012 10:36:40 GMT
Accept-Ranges: bytes
Server: Restlet-Framework/2.0.9
Transfer-Encoding: chunked

{"query-time-ms":0,"result":[{"_id":"ajensen"},{"_id":"bjensen"}]}

$ curl
 --dump-header /dev/stdout
 --header "Cookie: JSESSIONID=ixnekr105coj11ji67xcluux8"
 --header "X-Requested-With: OpenIDM Plugin"
 "http://localhost:8080/openidm/managed/user/?_queryId=query-all-ids"

HTTP/1.1 200 OK
Content-Type: application/json; charset=UTF-8
Date: Wed, 18 Jan 2012 10:37:20 GMT
Accept-Ranges: bytes
Server: Restlet-Framework/2.0.9
Transfer-Encoding: chunked

{"query-time-ms":1,"result":[{"_id":"ajensen"},{"_id":"bjensen"}]}</pre><p>Notice that the last example uses the cookie OpenIDM set in the
  response to the previous request, and includes the
  <code class="literal">X-Requested-With</code> header to indicate the origin of the
  request. The value of the header can be any string, but should be informative
  for logging purposes. If you do not include the
  <code class="literal">X-Requested-With</code> header, OpenIDM returns HTTP 403
  Forbidden.</p><p>You can also request one-time authentication without a session.</p><pre class="cmdline prettyprint">$ curl
 --dump-header /dev/stdout
 --header "X-OpenIDM-NoSession: true"
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 "http://localhost:8080/openidm/managed/user/?_queryId=query-all-ids"

HTTP/1.1 200 OK
Content-Type: application/json; charset=UTF-8
Date: Wed, 18 Jan 2012 10:52:27 GMT
Accept-Ranges: bytes
Server: Restlet-Framework/2.0.9
Transfer-Encoding: chunked

{"query-time-ms":1,"result":[{"_id":"ajensen"},{"_id":"bjensen"}]}</pre><p>To log out and destroy the session, send the specific OpenIDM
  header.</p><pre class="cmdline prettyprint">$ curl
 --dump-header /dev/stdout
 --header "Cookie: JSESSIONID=ixnekr105coj11ji67xcluux8"
 --header "X-Requested-With: OpenIDM Plugin"
 --header "X-OpenIDM-Logout: true"
 "http://localhost:8080/openidm/"

HTTP/1.1 204 No Content</pre><p>OpenIDM creates the <code class="literal">openidm-admin</code> user with password
  <code class="literal">openidm-admin</code> by default. This internal user is stored in
  OpenIDM's repository.</p><pre class="cmdline prettyprint">mysql&gt; select objectid,roles from internaluser;
+---------------+----------------------------------+
| objectid      | roles                            |
+---------------+----------------------------------+
| anonymous     | openidm-reg                      |
| openidm-admin | openidm-admin,openidm-authorized |
+---------------+----------------------------------+
2 rows in set (0.00 sec)</pre><a class="indexterm" name="d0e9834"></a><p>OpenIDM uses the internal table for authentication, and also to set
  the roles for RBAC authorization of an authenticated user. The router
  service, described in the <a href="../integrators-guide/index.html#appendix-router" class="link"><em class="citetitle">Router
  Service Reference</em></a> appendix, enables you to apply filters
  as shown in <code class="filename">openidm/conf/router.json</code> and the associated
  script, <code class="filename">openidm/script/router-authz.js</code>. See the chapter
  on <a href="../integrators-guide/index.html#chap-auth" class="link"><em class="citetitle">Managing Authentication,
  Authorization &amp; RBAC</em></a> for details.</p></div><div class="section" id="security-replace-defaults"><div class="titlepage"><div><div><h2 class="title" style="clear: both">14.5.&nbsp;Replace Default Security Settings</h2></div></div></div><a class="indexterm" name="d0e9858"></a><p>The default security settings are adequate for evaluation purposes. For 
  production, change the default encryption key, and then replace the default user 
  password.</p><div class="procedure" id="security-change-encryption-keys"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;14.1.&nbsp;To Change Default Encryption Keys</div><a class="indexterm" name="d0e9866"></a><a class="indexterm" name="d0e9869"></a><p>By default, OpenIDM uses an symmetric encryption key with alias
   <code class="literal">openidm-sym-default</code>. Change this default key before
   deploying OpenIDM in production.</p><ol class="procedure" type="1"><li class="step"><p>Add the new key to the key store.</p><pre class="cmdline prettyprint">$ cd /path/to/openidm/
$ keytool
 -genseckey
 -alias new-sym-key
 -keyalg AES
 -keysize 128
 -keystore security/keystore.jceks
 -storetype JCEKS
Enter keystore password:
Enter key password for &lt;new-sym-key&gt;
  (RETURN if same as keystore password):
Re-enter new password:
$ </pre><p>Also see
    <code class="filename">openidm/samples/security/keystore_readme.txt</code>.</p></li><li class="step"><p>Change the alias used in
    <code class="filename">openidm/conf/boot/boot.properties</code>.</p></li></ol></div></div><div class="procedure" id="security-replace-default-user-password"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;14.2.&nbsp;To Replace the Default User &amp; Password</div><p>After changing the default encryption key, change at least the default
   user password.</p><ol class="procedure" type="1"><li class="step"><p>Use the <span class="command"><strong>encrypt</strong></span> command to obtain the encrypted 
    version of the new password.</p><pre class="cmdline prettyprint">$ cd /path/to/openidm/
$ cli.sh encrypt newpwd
...
-----BEGIN ENCRYPTED VALUE-----
{
  "$crypto" : {
    "value" : {
      "iv" : "TCoC/YrmiRmINw6jCPB5LQ==",
      "data" : "nCFvBIApIQ7C6k+UPzosaA==",
      "cipher" : "AES/CBC/PKCS5Padding",
      "key" : "openidm-sym-default"
    },
    "type" : "x-simple-encryption"
  }
}
------END ENCRYPTED VALUE------</pre></li><li class="step"><p>Replace the user object in the
    <code class="filename">openidm/db/scripts/mysql/openidm.sql</code> script before
    setting up MySQL as a repository for OpenIDM.</p><p>Alternatively, replace the user in the internal user table.</p></li></ol></div></div></div><div class="section" id="security-jetty"><div class="titlepage"><div><div><h2 class="title" style="clear: both">14.6.&nbsp;Secure Jetty</h2></div></div></div><a class="indexterm" name="d0e9919"></a><p>Before running OpenIDM in production, edit the
  <code class="filename">openidm/conf/jetty.xml</code> configuration to avoid
  clear text HTTP. Opt instead for HTTPS, either with or without mutual
  authentication. To disable plain HTTP access, comment out the section in
  <code class="filename">openidm/conf/jetty.xml</code> that enables HTTP on port
  8080.</p><pre class="codelisting prettyprint lang-xml">
&lt;!--
&lt;Item&gt;
    &lt;New class="org.eclipse.jetty.server.nio.SelectChannelConnector"&gt;
        &lt;Set name="host"&gt;&lt;Property name="jetty.host" /&gt;&lt;/Set&gt;
        &lt;Set name="port"&gt;8080&lt;/Set&gt;
        &lt;Set name="maxIdleTime"&gt;300000&lt;/Set&gt;
        &lt;Set name="Acceptors"&gt;2&lt;/Set&gt;
        &lt;Set name="statsOn"&gt;false&lt;/Set&gt;
        &lt;Set name="confidentialPort"&gt;8443&lt;/Set&gt;
        &lt;Set name="lowResourcesConnections"&gt;20000&lt;/Set&gt;
        &lt;Set name="lowResourcesMaxIdleTime"&gt;5000&lt;/Set&gt;
    &lt;/New&gt;
&lt;/Item&gt;
--&gt;</pre></div><div class="section" id="security-urls"><div class="titlepage"><div><div><h2 class="title" style="clear: both">14.7.&nbsp;Protect Sensitive REST Interface URLs</h2></div></div></div><p>Although the repository is accessible directly by default, since
  anything attached to the router is accessible with the default policy,
  avoid direct HTTP access in production. If you do not need such access,
  deny it in the authorization policy to reduce the attack surface.</p><p>Similarly deny direct HTTP access to system objects in production,
  particularly access to <code class="literal">action</code>. As a rule of thumb, do not 
  expose anything that is not used in production. The main public interfaces 
  over HTTP are <code class="literal">/openidm/managed/</code> and <code class="literal">/openidm/config/</code>.
  Other URIs are triggered indirectly, or are for internal consumption.</p><p>OpenIDM supports native query expressions on the JDBC repository and it 
  is possible to enable these over HTTP, for example:</p><pre class="cmdline prettyprint">$curl 
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 "http://localhost:8080/openidm/managed/user?_queryExpression=select+*+from+managedobjects"</pre><p>By default, direct HTTP access to native queries is disallowed, and 
  should remain so in production systems. To enable native queries on the JDBC 
  repository over HTTP, specifically for testing or development purposes, 
  remove the custom authorization call from the router authorization script 
  (<code class="filename">openidm/script/router-authz.js</code>).</p><pre class="cmdline prettyprint">"customAuthz" : "disallowQueryExpression()"</pre><p>Remember to remove the comma at the end of the preceding line as 
  well.</p><p>See the chapter on <a href="../integrators-guide/index.html#chap-auth" class="link"><em class="citetitle">Managing
  Authentication, Authorization &amp; RBAC</em></a> for an example
  showing how to protect sensitive URLs.</p></div><div class="section" id="security-files"><div class="titlepage"><div><div><h2 class="title" style="clear: both">14.8.&nbsp;Protect Sensitive Files &amp; Directories</h2></div></div></div><p>Protect OpenIDM files from access by unauthorized users.</p><p>In particular, prevent other users from reading files in at least the
  <code class="filename">openidm/conf/boot/</code> and
  <code class="filename">openidm/security/</code> directories.</p></div><div class="section" id="security-bootstrap"><div class="titlepage"><div><div><h2 class="title" style="clear: both">14.9.&nbsp;Obfuscate Bootstrap Information</h2></div></div></div><p>OpenIDM uses the information in
  <code class="filename">conf/boot/boot.properties</code>, including the key store
  password, to start up. You can set an obfuscated version in the file, or
  prompt for the password at start up time.</p><p>To use an obfuscated password, follow these steps:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Generate an obfuscated version of the password, by using the crypto
          bundle provided with OpenIDM:</p><pre class="cmdline prettyprint">$ java -jar /path/to/openidm/bundle/openidm-crypto-2.1.0-SNAPSHOT.jar
This utility helps obfuscate passwords to prevent casual observation.
It is not securely encrypted and needs further measures to prevent disclosure.
Please enter the password:
OBF:1vn21ugu1saj1v9i1v941sar1ugw1vo0
CRYPT:a8b5a01ba48a306f300b62a1541734c7</pre></li><li class="listitem"><p>Paste the obfuscated password into the
          <code class="filename">conf/boot/boot.properties</code> file. Comment out
          the regular keystore password and remove the comment tag from the
          line that contains the obfuscated password:</p><pre class="cmdline prettyprint">$ more conf/boot/boot.properties
...
   # Keystore password, adjust to match your keystore and protect this file
   # openidm.keystore.password=changeit
   openidm.truststore.password=changeit

   # optionally use the cli encrypt to obfuscate the password and set
     openidm.keystore.password=OBF:1vn21ugu1saj1v9i1v941sar1ugw1vo0
   #openidm.keystore.password=CRYPT:
...</pre></li><li class="listitem"><p>Restart OpenIDM.</p><pre class="cmdline prettyprint">$ ./startup.sh</pre></li></ol></div></div><div class="section" id="security-remove-dev-tools"><div class="titlepage"><div><div><h2 class="title" style="clear: both">14.10.&nbsp;Remove or Protect Development &amp; Debug Tools</h2></div></div></div><p>Before deploying OpenIDM in production, remove or protect development
  and debug tools, including the OSGi console exposed under
  <code class="literal">/system/console</code>. Authentication for this console is not
  integrated with authentication for OpenIDM.</p><p>To remove the OSGi console, remove the web console bundle,
  <code class="filename">org.apache.felix.webconsole-<em class="replaceable"><code>version</code></em>.jar</code>.</p><p>If you cannot remove the OSGi console, then protect it by overriding
  the default <code class="literal">admin:admin</code> credentials. Create a file called
  <code class="filename">openidm/conf/org.apache.felix.webconsole.internal.servlet.OsgiManager.cfg</code>
  containing the user name and password to access the console in Java
  properties file format.</p><pre class="codelisting prettyprint">
username=user-name
password=password</pre></div><div class="section" id="security-protect-repo"><div class="titlepage"><div><div><h2 class="title" style="clear: both">14.11.&nbsp;Protect the OpenIDM Repository</h2></div></div></div><p>Use the JDBC repository. OrientDB is not yet supported for production
  use.</p><p>Use a strong password for the JDBC connection. Do not rely on default
  passwords.</p><p>Use a case sensitive database, particularly if you work with systems
  with different identifiers that match except for case. Otherwise correlation
  queries can pick up identifiers that should not be considered the same.</p></div><div class="section" id="security-adjust-log-levels"><div class="titlepage"><div><div><h2 class="title" style="clear: both">14.12.&nbsp;Adjust Log Levels</h2></div></div></div><p>Leave log levels at <code class="literal">INFO</code> in production to ensure
  that you capture enough information to help diagnose issues. See the chapter
  on <a href="../integrators-guide/index.html#chap-logs" class="link"><em class="citetitle">Configuring Server
  Logs</em> for more information.</a>
  </p><p>At start up and shut down, <code class="literal">INFO</code> can produce many
  messages. Yet, during stable operation, <code class="literal">INFO</code> generally
  results in log messages only when coarse-grain operations such as
  scheduled reconciliation start or stop.</p></div><div class="section" id="security-run-as-service"><div class="titlepage"><div><div><h2 class="title" style="clear: both">14.13.&nbsp;Set Up Restart At System Boot</h2></div></div></div><p>You can run OpenIDM in the background as a service (daemon), and
  add startup and shutdown scripts to manage the service at system boot
  and shutdown. For more information, see <a href="../integrators-guide/index.html#chap-services" class="link"><em class="citetitle">Starting and 
  Stopping OpenIDM</em></a>.</p><p>See your operating system documentation for details on adding a
  service such as OpenIDM to be started at boot and shut down at system
  shutdown.</p></div></div><div lang="en" class="chapter" id="chap-workflow"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;15.&nbsp;Integrating Business Processes and Workflows</h1></div></div></div><a class="indexterm" name="d0e10087"></a><a class="indexterm" name="d0e10090"></a><p>Key to any identity management solution is the ability to provide
 workflow-driven provisioning activities, whether for self-service actions
 such as requests for entitlements, roles or resources, running sunrise or
 sunset processes, handling approvals with escalations, or performing
 maintenance.</p><p>OpenIDM provides an embedded workflow and business process engine
 based on Activiti and the Business Process Model and Notation (BPMN) 2.0
 standard.</p><p>More information about Activiti and the Activiti project can be found
 at <a class="link" href="http://www.activiti.org" target="_blank">http://www.activiti.org</a>.</p><div class="section" id="about-bmpm-2-activiti"><div class="titlepage"><div><div><h2 class="title" style="clear: both">15.1.&nbsp;BPMN 2.0 and the Activiti Tools</h2></div></div></div><p>Business Process Model and Notation 2.0 is the result of consensus
  among Business Process Management (BPM) system vendors. The <a class="link" href="http://omg.org/" target="_blank">Object Management Group</a>
  (OMG) has developed and maintained the <a class="link" href="http://www.omg.org/spec/BPMN/" target="_blank">BPMN</a> standard since
  2004.</p><p>The first version of the BPMN specification focused only on graphical
  notation, and quickly became popular with the business analyst audience.
  BPMN 1.x defines how constructs such as human tasks, executable scripts, and
  automated decisions are visualized in a vendor-neutral, standard way. The
  second version of BPMN extends that focus to include execution semantics,
  and a common exchange format. Thus, BPMN 2.0 process definition models
  can be exchanged not only between different graphical editors, but can also
  be executed as is on any BPMN 2.0-compliant engine, such as the engine
  embedded in OpenIDM.</p><p>Using BPMN 2.0, you can add artifacts describing workflow and business
  process behavior to OpenIDM for provisioning and other purposes. For example,
  you can craft the actual artifacts defining business processes and workflow
  in a text editor, or using a special Eclipse plugin. The Eclipse plugin 
  provides visual design capabilities, simplifying packaging and deployment of 
  the artifact to OpenIDM. See the <a class="link" href="http://docs.codehaus.org/display/ACT/Activiti+BPMN+2.0+Eclipse+Plugin" target="_blank">Activiti BPMN 2.0 Eclipse Plugin</a> documentation for
  instructions on installing Activiti Eclipse BPMN 2.0 Designer.</p><p>Also, read the Activiti <em class="citetitle">User Guide</em> section
  covering <a class="link" href="http://www.activiti.org/userguide/#bpmnConstructs" target="_blank"><em class="citetitle">BPMN 2.0 Constructs</em></a>, which
  describes in detail the graphical notations and XML representations for
  events, flows, gateways, tasks, and process constructs.</p></div><div class="section" id="setting-up-activiti"><div class="titlepage"><div><div><h2 class="title" style="clear: both">15.2.&nbsp;Setting Up Activiti Integration With OpenIDM</h2></div></div></div><div class="itemizedlist"><p>There are two modes of integrating Activiti with OpenIDM:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Local integration, where an embedded Activiti Process Engine 
     is started in the OpenIDM OSGi container.</p></li><li class="listitem"><p>Remote integration, where OpenIDM and Activiti run as 
    separate instances and the integration is done using a REST API.</p></li></ul></div><div class="section" id="setting-up-local-integration"><div class="titlepage"><div><div><h3 class="title">15.2.1.&nbsp;Setting Up Local Integration</h3></div></div></div><p>The embedded workflow and business process engine is provided as part 
  of the standard OpenIDM build.</p><p>Install the OpenIDM build, as described in the 
  <a href="../install-guide/index.html#chap-install" class="link"><em class="citetitle">Installation
  Guide</em></a>. Start OpenIDM, and run the 
  <span class="command"><strong>scr list</strong></span> command at the console to check that the 
  workflow bundle is active.</p><pre class="cmdline prettyprint">-&gt; scr list
...
[  14] [active       ] org.forgerock.openidm.workflow
...</pre><p>To verify the workflow integration you need at least one workflow 
  definition in the <code class="literal"><em class="replaceable"><code>/path/to/openidm</code></em>/workflow</code> directory. A sample workflow 
  (<code class="filename">example.bpmn20.xml</code>) is provided in the 
  <code class="literal"><em class="replaceable"><code>/path/to/openidm</code></em>/samples/misc</code> 
  directory. Copy this workflow to the 
  <code class="literal"><em class="replaceable"><code>/path/to/openidm</code></em>/workflow</code> 
  directory to test the workflow integration.</p><pre class="cmdline prettyprint">$ cd /path/to/openidm
$ cp samples/misc/example.bpmn20.xml workflow/</pre><p>You can verify the workflow integration by using the REST API. The 
  following REST call lists the defined workflows:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET
 "http://localhost:8080/openidm/workflow/processdefinition?_queryId=query-all-ids"
  </pre><p>The sample workflow definition that you copied in the previous step is 
  named <code class="literal">osgiProcess</code>. The result of the preceding REST call 
  is therefore something like:</p><pre class="cmdline prettyprint">
{"result":[
     {"_id":"osgiProcess:1:3",
      "name":"Osgi process"
     }
        ]
}
  </pre><p>The <code class="literal">osgiProcess</code> definition calls OpenIDM, queries 
  the available workflow definitions from Activiti, then prints the list of 
  workflow definitions to the OpenIDM logs. Invoke the <code class="literal">osgiProcess
  </code> workflow with the following REST call to OpenIDM:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/workflow/processinstance?_action=createProcessInstance"
 --data '{"_key":"osgiProcess"}'
  </pre><p>The workflow prints the list of workflow definitions to the OpenIDM 
  console. With the default sample, you should see something like this on the 
  console:</p><pre class="cmdline prettyprint">
script task using resolver: [
  result:[
    [_id:osgiProcess:1:3, name:Osgi process]
  ]
]
script task using expression resolver: [
  result:[
    [_id:osgiProcess:1:3, name:Osgi process]
  ]
]
  </pre></div><div class="section" id="setting-up-remote-integration"><div class="titlepage"><div><div><h3 class="title">15.2.2.&nbsp;Setting Up Remote Integration</h3></div></div></div><p>You can set up integration with a remote Activiti engine, as described 
  in the following steps.</p><div class="procedure"><div class="procedure-inner"><ol class="procedure" type="1"><li class="step"><p>Download and install OpenIDM, as described in the 
    <a href="../install-guide/index.html#chap-install" class="link"><em class="citetitle">Installation 
    Guide</em></a>.</p></li><li class="step"><p>Download and unzip the Activiti zip file 
    (<code class="filename">activiti-5.10.zip</code>) from <a class="link" href="http://activiti.org/download.html" target="_blank">
    Activiti Downloads</a> page.</p></li><li class="step"><p>Edit the Activiti configuration file to avoid a port conflict with 
    OpenIDM. OpenIDM runs on port 8080 by default. Edit the file so that 
    Activiti Explorer runs on port 9090 (by replacing each instance of 8080 
    with 9090). The following example uses <code class="literal">sed</code> on a UNIX 
    system to replace all instances of 8080 with 9090.
    </p><pre class="cmdline prettyprint">$ cd /path/to/activiti/setup/
$ sed -i.bak 's/8080/9090/g' build.xml
    </pre><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>There is currently a bug in the Activiti demo which might mean 
    that all port replacements are not made. If you cannot access Activiti 
    Explorer (in the next step) after making this change, <span class="emphasis"><em>also</em></span> 
    edit the following file to find and replace each instance of 8080 with 9090: 
    <code class="filename">/path/to/activiti/apps/apache-tomcat-6.0.32/conf/server.xml</code>.
    </p></div></div></li><li class="step"><p>Set up the default Activiti demo.</p><pre class="cmdline prettyprint">$ cd /path/to/activiti/setup/
$ ant demo.start
    </pre></li><li class="step"><p>In a browser, check that Activiti Explorer is running 
    (on localhost:9090/activiti-explorer). Log in with the default userid 
    <code class="literal">kermit</code> and password <code class="literal">kermit</code>. If all 
    is well, log out.</p></li><li class="step"><p>Configure Tomcat to operate with OpenIDM.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Stop Tomcat.</p><pre class="cmdline prettyprint">$ cd /path/to/activiti/setup/
$ ant tomcat.stop 
      </pre></li><li class="listitem"><p>Copy the OpenIDM remote workflow WAR file to the Tomcat webapps 
      folder.</p><pre class="cmdline prettyprint">$ cd /path/to/openidm/bin/workflow
$ cp openidm-workflow-remote-.war \
 /path/to/activiti/apps/apache-tomcat-6.0.32/webapps/
      </pre></li><li class="listitem"><p>Copy the OpenIDM workflow Activiti demo jar file to the Tomcat 
      Activiti Explorer library.</p><pre class="cmdline prettyprint">$ cd /path/to/openidm/bin/workflow/
$ cp openidm-workflow-activiti--jar-with-dependencies.jar \
 /path/to/activiti/apps/apache-tomcat-6.0.32/webapps/activiti-explorer/WEB-INF/lib/
      </pre></li><li class="listitem"><p>Edit the Activiti Explorer configuration file to be able to use the 
      OpenIDM extensions.</p><pre class="cmdline prettyprint">$ cd /path/to/activiti/
$ vi apps/apache-tomcat-6.0.32/webapps/activiti-explorer/WEB-INF/applicationContext.xml
      </pre><p>Replace the <code class="literal">processEngineConfiguration</code> with the 
      OpenIDM extended configuration. So remove this section:
      </p><pre class="codelisting prettyprint lang-xml">
       &lt;bean id="processEngineConfiguration" class="org.activiti.spring.SpringProcessEngineConfiguration"&gt;
        &lt;property name="dataSource" ref="dataSource" /&gt;
        &lt;property name="transactionManager" ref="transactionManager" /&gt;
        &lt;property name="databaseSchemaUpdate" value="true" /&gt;
        &lt;property name="jobExecutorActivate" value="true" /&gt;
        &lt;property name="customFormTypes"&gt;
         &lt;list&gt;
          &lt;ref bean="userFormType"/&gt;
         &lt;/list&gt;
        &lt;/property&gt;
       &lt;/bean&gt;
      </pre><p>and replace it with this section:</p><pre class="codelisting prettyprint lang-xml">
      &lt;bean id="processEngineConfiguration" class="org.activiti.spring.SpringProcessEngineConfiguration"&gt;
       &lt;property name="dataSource" ref="dataSource" /&gt;
       &lt;property name="transactionManager" ref="transactionManager" /&gt;
       &lt;property name="databaseSchemaUpdate" value="true" /&gt;
       &lt;property name="jobExecutorActivate" value="true" /&gt;
       &lt;property name="customFormTypes"&gt;
         &lt;list&gt;
          &lt;ref bean="userFormType"/&gt;
         &lt;/list&gt;
        &lt;/property&gt;
      &lt;property name="customSessionFactories"&gt;
        &lt;list&gt;
          &lt;bean class="org.forgerock.openidm.workflow.activiti.impl.session.OpenIDMSessionFactory"&gt;
            &lt;property name="url" value="http://localhost:8080/openidm/"/&gt;
            &lt;property name="user" value="openidm-admin"/&gt;
            &lt;property name="password" value="openidm-admin"/&gt;
          &lt;/bean&gt;
        &lt;/list&gt;
      &lt;/property&gt;
      &lt;property name="resolverFactories"&gt;
        &lt;list&gt;
          &lt;bean class="org.forgerock.openidm.workflow.activiti.impl.OpenIDMResolverFactory"&gt;&lt;/bean&gt;
          &lt;bean class="org.activiti.engine.impl.scripting.VariableScopeResolverFactory"&gt;&lt;/bean&gt;
          &lt;bean class="org.activiti.engine.impl.scripting.BeansResolverFactory"&gt;&lt;/bean&gt;
        &lt;/list&gt;
      &lt;/property&gt;
      &lt;property name="expressionManager"&gt;
        &lt;bean class="org.forgerock.openidm.workflow.activiti.impl.OpenIDMExpressionManager"&gt; &lt;/bean&gt;
      &lt;/property&gt;
     &lt;/bean&gt;
      </pre></li><li class="listitem"><p>Restart Tomcat.</p><pre class="cmdline prettyprint">$ cd /path/to/activiti/setup/
$ ant tomcat.start 
     </pre></li><li class="listitem"><p>Check that Activiti Explorer is running on 
      localhost:9090/activiti-explorer, as you did in the previous section.
      </p></li></ol></div></li><li class="step"><p>Configure OpenIDM to use the remote Activiti engine instead of the 
    local, bundled Activiti engine.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Copy the <code class="filename">workflow.json</code> configuration file to 
      the OpenIDM configuration directory.</p><pre class="cmdline prettyprint">$ cd /path/to/openidm/
$ cp samples/misc/workflow.json conf/
      </pre></li><li class="listitem"><p>Edit the workflow configuration file to specify the remote Activiti 
      engine.</p><pre class="cmdline prettyprint">$ vi conf/workflow.json
      </pre><p>Ensure that the url, username, and password fields contain the values 
      that correspond to your remote Activiti engine.</p><pre class="codelisting prettyprint linenums lang-js">
{
&nbsp; &nbsp;"enabled" : true,
&nbsp; &nbsp;"location" : "remote",
&nbsp; &nbsp;"engine" : {
&nbsp; &nbsp; &nbsp; &nbsp;"url" : "http://localhost:9090/openidm-workflow-remote-2.1.0/",
&nbsp; &nbsp; &nbsp; &nbsp;"username" : "youractivitiuser",
&nbsp; &nbsp; &nbsp; &nbsp;"password" : "youractivitipassword"
&nbsp; &nbsp;}
}
      </pre></li></ol></div></li><li class="step"><p>Start up OpenIDM.</p><pre class="cmdline prettyprint">$ cd /path/to/openidm/
$ ./startup.sh
   </pre></li><li class="step"><p>Test the integration by sending the following CURL request to list 
    the available workflows:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET 
 "http://localhost:8080/openidm/workflow/processdefinition?_queryId=query-all-ids"
    </pre></li><li class="step"><p>Log in to the Activiti Explorer of the remote Activiti engine (with 
    the default username (kermit) and password (kermit).
    </p></li><li class="step"><p>Install the sample workflow (<code class="filename">example.bpmn20.xml</code>).</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>In Activiti Explorer, click Manage.</p></li><li class="listitem"><p>From the Deployments menu, select Upload New.</p></li><li class="listitem"><p>Navigate to the sample workflow (<code class="filename">/path/to/openidm/samples
      /misc/example.bpmn20.xml)</code></p></li></ol></div></li><li class="step"><p>Verify the integration by sending the following CURL request:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/workflow/processinstance?_action=createProcessInstance"
 --data '{"_key":"osgiProcess"}'
    </pre><p>The request should return a process ID, similar to the following:</p><pre class="cmdline prettyprint">
{
  "_id":"614",
  "processInstanceId":"614",
  "status":"ended",
  "businessKey":null,
  "processDefinitionId":"osgiProcess:7:603"
}
    </pre><p>This request starts the osgiProcess and writes the list of installed 
    workflows to the Tomcat server log file (<code class="filename">/path/to/activiti/apps/
    apache-tomcat-6.0.32/logs/catalina.out</code>).
    </p></li><li class="step"><p>Test the integration with Activiti Explorer.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Click Processes and select Osgi Process from the list of process 
      definitions.</p></li><li class="listitem"><p>Click Start Process.</p></li><li class="listitem"><p>Check the output in the Tomcat server log file (
    <code class="filename">/path/to/activiti/apps/apache-tomcat-6.0.32/logs/catalina.out</code>. 
    The list of installed workflows is written to the log file.</p></li></ol></div></li></ol></div></div></div><div class="section" id="configuring-activiti-engine"><div class="titlepage"><div><div><h3 class="title">15.2.3.&nbsp;Configuring the Activiti Engine</h3></div></div></div><p>Whether you use the embedded Activiti engine, or a remote Activiti 
  engine, you configure the OpenIDM Activiti module in a file named 
  <code class="filename">/path/to/openidm/conf/workflow.json</code>. If this file is 
  absent from the configuration, the workflow module is unavailable for use. 
  In the default OpenIDM installation, the <code class="filename">workflow.json</code> 
  file assumes an embedded Activiti engine, and has the following 
  configuration:</p><pre class="codelisting prettyprint linenums lang-js">
{
   "enabled"  : "true"
}
  </pre><p>You can disable the workflow module by setting the "enabled" property 
  in this file to "false".</p><p>A sample <code class="filename">workflow.json</code> file, with all configurable 
  properties, is provided in <code class="literal">/path/to/openidm/samples/misc</code>. 
  To configure an Activiti engine beyond the default configuration that is 
  provided, edit this file as required and copy it to the 
  <code class="literal">/path/to/openidm/conf</code> directory.</p><p>The sample <code class="literal">workflow.json</code> file contains the following 
  configuration:</p><pre class="codelisting prettyprint linenums lang-js">
  {
    "enabled"  : "true",
    "location" : "remote",
    "engine" : {
        "url" : "http://localhost:9090/openidm-workflow-remote-",
        "username" : "youractivitiuser",
        "password" : "youractivitipassword"
    },
    "mail" : {
        "host" : "yourserver.smtp.com",
        "port" : 587,
        "username" : "yourusername",
        "password" : "yourpassword",
        "starttls" : true
    },
    "history" : "audit"
}
  </pre><div class="itemizedlist"><p>These fields have the following meaning:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">enabled</code>. Indicates whether the Activiti module is 
    enabled for use. Possible values are <code class="literal">true</code> or 
    <code class="literal">false</code>. The default value is <code class="literal">true</code>.</p></li><li class="listitem"><p><code class="literal">location</code>. Indicates whether the Activiti 
   engine is embedded with OpenIDM, or remote. Possible values are 
   <code class="literal">embedded</code> or <code class="literal">remote</code>. If 
   <code class="literal">remote</code>, you must provide details for the 
   <code class="literal">engine</code> property, below.</p></li><li class="listitem"><p><code class="literal">engine</code>. Specifies the details of the 
   remote Activiti engine. The following fields must be defined:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="literal">url</code>. The URL of the remote engine, 
     including the host name and port number.</p></li><li class="listitem"><p><code class="literal">username</code>. A user name for the remote 
     Activiti engine.</p></li><li class="listitem"><p><code class="literal">password</code>. The password for the user 
     specified above.</p></li></ul></div></li><li class="listitem"><p><code class="literal">mail</code>. Specifies the details of the 
   mail server that Activiti will use to send email notifications. By default, 
   Activiti uses the mail server <code class="literal">localhost:25</code>. To specify 
   a different mail server, enter the details of the mail server here.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="literal">host</code>. The host of the mail server.
     </p></li><li class="listitem"><p><code class="literal">port</code>. The port number of the mail 
     server.</p></li><li class="listitem"><p><code class="literal">username</code>. The user name of the account 
     that connects to the mail server.</p></li><li class="listitem"><p><code class="literal">password</code>. The password for the user 
     specified above.</p></li><li class="listitem"><p><code class="literal">startTLS</code>. Whether startTLS should be 
     used to secure the connection.</p></li></ul></div></li><li class="listitem"><p><code class="literal">history</code>. Determines the history level 
  that should be used for the Activiti engine. For more information, see 
  <a class="link" href="#activiti-history-level" title="15.2.3.1.&nbsp;Configuring the Activiti History Level">Configuring the Activiti History 
  Level</a>.</p></li></ul></div><div class="section" id="activiti-history-level"><div class="titlepage"><div><div><h4 class="title">15.2.3.1.&nbsp;Configuring the Activiti History Level</h4></div></div></div><p>The Activiti history level determines how much historical information 
    is retained when workflows are executed. You can configure the history 
    level by setting the <code class="literal">history</code> property in the 
    <code class="literal">workflow.json</code> file, for example:</p><pre class="cmdline prettyprint">"history" : "audit"</pre><div class="itemizedlist"><p>The following history levels can be configured:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">none</code>. No history archiving is done. This level 
     results in the best performance for workflow execution, but no historical 
     information is available.</p></li><li class="listitem"><p><code class="literal">activity</code>. Archives all process instances and 
     activity instances. No details are archived.</p></li><li class="listitem"><p><code class="literal">audit</code>. This is the default level. All process 
     instances, activity instances and submitted form properties are archived 
     so that all user interaction through forms is traceable and can be 
     audited.</p></li><li class="listitem"><p><code class="literal">full</code>. This is the highest level of history 
     archiving and has the greatest performance impact. This history level 
     stores all information as in the audit level as well as any process 
     variable updates.</p></li></ul></div></div></div><div class="section" id="defining-activiti-workflows"><div class="titlepage"><div><div><h3 class="title">15.2.4.&nbsp;Defining Activiti Workflows</h3></div></div></div><p>The following section outlines the process to follow when you create 
  an Activiti workflow for OpenIDM. Before you start creating workflows, you 
  must configure the Activiti engine, as described in <a class="link" href="#configuring-activiti-engine" title="15.2.3.&nbsp;Configuring the Activiti Engine">Configuring the Activiti Engine</a>.
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Define your workflow in a text file, either using an editor, 
    such as Activiti Eclipse BPMN 2.0 Designer, or a simple text editor.</p></li><li class="listitem"><p>Package the workflow definition file as a 
    <code class="literal">.bar</code> file (Business Archive File). If you are using 
    Eclipse to define the workflow, a <code class="literal">.bar</code> file is created 
    when you select "Create deployment artifacts". Essentially, a 
    <code class="literal">.bar</code> file is the same as a <code class="literal">.zip</code> file, 
    but with the <code class="literal">.bar</code> extension.</p></li><li class="listitem"><p>Copy the <code class="literal">.bar</code> file to the 
    <code class="literal">openidm/workflow</code> directory.</p></li><li class="listitem"><p>Invoke the workflow using a script (in 
    <code class="literal">openidm/script/</code>) or directly using the REST interface. 
    For more information, see <a class="link" href="#invoking-activiti-workflows" title="15.2.5.&nbsp;Invoking Activiti Workflows">
    Invoking Activiti Workflows</a>.</p></li><li class="listitem"><p>You can also schedule the workflow to be invoked repeatedly, 
    or at a future time. For more information, see the 
    <span class="olink"><em class="citetitle">Scheduler
 Reference</em></span></p></li></ol></div></div><div class="section" id="invoking-activiti-workflows"><div class="titlepage"><div><div><h3 class="title">15.2.5.&nbsp;Invoking Activiti Workflows</h3></div></div></div><p>You can invoke workflows and business processes from any trigger point 
  within OpenIDM, including reacting to situations discovered during
  reconciliation. Workflows can be invoked from script files, using the 
  <code class="literal">openidm.action()</code> function, or directly from the REST 
  interface.</p><p>The following sample script extract shows how to invoke a workflow from 
  a script file:</p><pre class="codelisting prettyprint linenums lang-js">
/*
 * Calling 'myWorkflow' workflow
 */

var params = {
 "foo" : "bar",
 "_key": "myWorkflow"
};

openidm.action('workflow/processinstance', {"_action" : "createProcessInstance"}, params);
</pre><p>You can invoke the same workflow from the REST interface by sending 
  the following REST call to OpenIDM:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/workflow/processinstance?_action=createProcessInstance"
 --data '{"_key":"myWorkflow", "foo":"bar"}'
  </pre><p>There are two ways in which you can specify the workflow definition 
  that is used when a new workflow instance is started.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">_key</code> specifies the <code class="literal">id</code> 
      attribute of the workflow process definition, for example:</p><pre class="codelisting prettyprint linenums lang-js">
&lt;process id="sendNotificationProcess" name="Send Notification Process"&gt;
      </pre><p>If there is more than more than one workflow definition with the 
      same <code class="literal">_key</code> parameter, the latest deployed version of 
      the workflow definition is invoked.
      </p></li><li class="listitem"><p><code class="literal">_processDefinitionId</code> specifies the ID that is 
      generated by the Activiti Process Engine when a workflow definition is 
      deployed, for example:</p><pre class="codelisting prettyprint linenums lang-js">
"sendNotificationProcess:1:104";
      </pre><p>You can obtain the <code class="literal">processDefinitionId</code> by 
      querying the available workflows, for example:</p><pre class="codelisting prettyprint linenums lang-js">      
 {
  "result": [
    {
      "name": "Process Start Auto Generated Task Auto Generated",
      "_id": "ProcessSAGTAG:1:728"
    },
    {
      "name": "Process Start Auto Generated Task Empty",
      "_id": "ProcessSAGTE:1:725"
    },
    ...     
      </pre><p>If you specify a <code class="literal">_key</code> and a 
      <code class="literal">_processDefinitionId</code>, the 
      <code class="literal">_processDefinitionId</code> is used because it is more 
      precise.</p></li></ul></div><p>You can use the optional <code class="literal">_businessKey</code> parameter to 
  add specific business logic information to the workflow when it is invoked.
  For example, the following workflow invocation assigns the workflow a 
  business key of <code class="literal">"newOrder"</code>. This business key can later 
  be used to query "newOrder" processes.</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/workflow/processinstance?_action=createProcessInstance"
 --data '{"_key":"myWorkflow", "_businessKey":"newOrder"}'
  </pre></div><div class="section" id="querying-activiti-workflows"><div class="titlepage"><div><div><h3 class="title">15.2.6.&nbsp;Querying Activiti Workflows</h3></div></div></div><p>The Activiti implementation supports filtered queries that enable you 
  to query the running process instances and tasks, based on specific query 
  parameters. For example, the following query returns all process instances 
  with the business key <code class="literal">"newOrder"</code>, as invoked in the previous 
  section.</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/workflow/processinstance?_queryId=filtered-query
 &amp;businessKey=newOrder"
  </pre><p>You can query process instances based on the value of any process 
  instance variable by prefixing the variable name with <code class="literal">_var-</code>.
  For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/workflow/processinstance?_queryId=filtered-query
 &amp;_var-processvariablename=processvariablevalue"
  </pre><p>The standard Activiti properties can be queried using the Activiti 
  notation, for example, 
  <code class="literal">processDefinitionId=managedUserApproval:1:6405</code>. The query 
  syntax applies to all queries with <code class="literal">_queryId=filtered-query</code>.
  </p></div></div><div class="section" id="workflows-REST"><div class="titlepage"><div><div><h2 class="title" style="clear: both">15.3.&nbsp;Managing Workflows Over the REST Interface</h2></div></div></div><p>In addition to the queries described previously, the following 
   examples show the endpoints that are exposed for managing workflows over 
   the REST interface. The example output is based on the sample workflow that 
   is provided in <code class="literal">openidm/samples/workflow</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">openidm/workflow/processdefinition</code></span></dt><dd><p>List the available workflow definitions, for example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET       
 "http://localhost:8080/openidm/workflow/processdefinition?_queryId=query-all-ids"
 
{
  "result": [
    {
      "name": "Managed User Approval Workflow",
      "_id": "managedUserApproval:1:3"
    }
  ]
}        
             </pre><p>List the workflows, based on certain filter criteria, for example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET       
 "http://localhost:8080/openidm/workflow/processdefinition?_queryId=
filtered-query&amp;category=Examples"
 
{
  "result": [
    {
      "name": "Managed User Approval Workflow",
      "_id": "managedUserApproval:1:3"
    }
  ]
}          
        </pre></dd><dt><span class="term"><code class="literal">openidm/workflow/processdefinition/{id}</code></span></dt><dd><p>Obtain detailed information for a process definition, based 
             on the ID. (The ID can be determined by querying all available 
             process definitions). For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET       
 "http://localhost:8080/openidm/workflow/processdefinition/contractorOnboarding:1:3"
 
{
  "key": "managedUserApproval",
  "_rev": "0",
  "formProperties": [],
  "category": "Examples",
  "_id": "managedUserApproval:1:3",
  "processDiagramResourceName": null,
  "description": null,
  "name": "Managed User Approval Workflow",
  "deploymentId": "1"
}        
             </pre></dd><dt><span class="term"><code class="literal">openidm/workflow/processinstance</code></span></dt><dd><p>Obtain the list of running workflows (process instances).
             The query returns a list of IDs. For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET
 "http://localhost:8080/openidm/workflow/processinstance?_queryId=query-all-ids"

{
  "result": [
    {
      "processDefinitionId": "contractorOnboarding:1:3",
      "_id": "4"
    }
  ]
}
             </pre><p>Obtain the list of running workflows based on specific
             filter criteria. For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET
 "http://localhost:8080/openidm/workflow/processinstance?_queryId=
filtered-query&amp;businessKey=myBusinessKey"
             </pre><p>Start a workflow process instance. For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --data {"_key":"contractorOnboarding"}
 --request POST
 "http://localhost:8080/openidm/workflow/processinstance?_action=createProcessInstance"
             </pre></dd><dt><span class="term"><code class="literal">openidm/workflow/processinstance/{id}</code></span></dt><dd><p>Obtain the details of the specified process instance. For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET
 "http://localhost:8080/openidm/workflow/processinstance/4"

{
  "deleteReason": null,
  "processDefinitionId": "contractorOnboarding:1:3",
  "_rev": "0",
  "startTime": "2012-12-18T22:04:50.549+02:00",
  "startUserId": "user1",
  "_id": "4",
  "businessKey": null,
  "durationInMillis": null,
  "endTime": null,
  "superProcessInstanceId": null
}
             </pre><p>Stop the specified process instance. For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request DELETE
 "http://localhost:8080/openidm/workflow/processinstance/4"
             </pre></dd><dt><span class="term"><code class="literal">openidm/workflow/taskdefinition</code></span></dt><dd><p>Query a task definition based on the process definition ID 
             and the task name (<code class="literal">taskDefinitionKey</code>). For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET       
 "http://localhost:8080/openidm/workflow/taskdefinition?_queryId=query-taskdefinition
&amp;processDefinitionId=contractorOnboarding:1:6&amp;taskDefinitionKey=decideApprovalTask"
{
  "dueDate": null,
  "taskCandidateGroup": [
    {
      "expressionText": "manager"
    }
  ],
  "formProperties": [
    {
      "type": {
        "values": {
          "accept": "Accept",
          "reject": "Reject"
...
             </pre></dd><dt><span class="term"><code class="literal">openidm/workflow/taskinstance</code></span></dt><dd><p>Query all running task instances. For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET       
 "http://localhost:8080/openidm/workflow/taskinstance?_queryId=query-all-ids"
 
{
  "result": [
    {
      "name": "Contractor Approval",
      "_id": "70"
    }
  ]
}
             </pre><p>Query task instances based on candidate users or candidate
             groups. For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET       
 "http://localhost:8080/openidm/workflow/taskinstance?_queryId=filtered-query&amp;taskCandidateUser=manager1"
             </pre><p>or</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET       
 "http://localhost:8080/openidm/workflow/taskinstance?_queryId=filtered-query&amp;taskCandidateGroup=management"
             </pre><p>Note that you can include both users and groups in the same 
             query.</p></dd><dt><span class="term"><code class="literal">openidm/workflow/taskinstance/{id}</code></span></dt><dd><p>Obtain detailed information for a running task, based on the 
             task ID. For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET       
 "http://localhost:8080/openidm/workflow/taskinstance/70"
 
{
  "dueDate": null,
  "processDefinitionId": "contractorOnboarding:1:3",
  "owner": null,
  "taskDefinitionKey": "decideApprovalTask",
  "name": "Contractor Approval",
...
             </pre><p>Update task-related data stored in the Activiti workflow
             engine. For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --header "If-Match : *"
 --request PUT       
 --data '{"description":"updated description"}'
 "http://localhost:8080/openidm/workflow/taskinstance/70"
             </pre><p>Complete the specified task. The variables required by the
             task are provided in the request body. For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST       
 --data '{"requestApproved":"true"}'
 "http://localhost:8080/openidm/workflow/taskinstance/70?_action=complete"
             </pre><p>Claim the specified task. The ID of the user who claims the
             task is provided in the request body. For example:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST       
 --data '{"userId":"manager1"}'
 "http://localhost:8080/openidm/workflow/taskinstance/70?_action=claim"
             </pre></dd></dl></div></div><div class="section" id="sample-activiti-workflows"><div class="titlepage"><div><div><h2 class="title" style="clear: both">15.4.&nbsp;Example Activiti Workflows With OpenIDM</h2></div></div></div><p>This section describes two example workflows - an email notification 
  workflow, and a workflow that demonstrates provisioning, using the 
  browser-based user interface.</p><div class="section" id="example-activiti-email-notification-flow"><div class="titlepage"><div><div><h3 class="title">15.4.1.&nbsp;Example Email Notification Workflow</h3></div></div></div><p>This example uses the Activiti Eclipse BPMN 2.0 Designer to set up an
   email notification business process. The example relies on an SMTP server
   listening on <code class="literal">localhost</code>, port 25.</p><div class="variablelist"><p>The example sets up a workflow that can accept parameters used to
    specify the sender and recipient of the mail.</p><dl class="variablelist"><dt><span class="term"><code class="literal">${fromSender}</code></span></dt><dd><p>Used to specify the sender</p></dd><dt><span class="term"><code class="literal">${toEmail}</code></span></dt><dd><p>Used to specify the recipient</p></dd></dl></div><p>Once you have defined the workflow, drag and drop components to create
   the workflow. This simple example uses only a <code class="literal">StartEvent</code>, 
   <code class="literal">MailTask</code>, and <code class="literal">EndEvent</code>.</p><div class="mediaobject" align="center" id="figure-bpmn-email-notification"><a class="fancybox" href="images/bpmn-email-notification.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_bpmn-email-notification.png" align="middle" alt="Email notification process" title="The email notification workflow has a start event, mail task, and&#xA;     end event."></a></div><p>After creating the workflow, adjust the generated XML source code to
   use the variables inside the <code class="literal">&lt;serviceTask&gt;</code>
   tag shown in the following listing.</p><pre class="codelisting prettyprint lang-xml">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions
 xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xmlns:activiti="http://activiti.org/bpmn"
 xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
 xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC"
 xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI"
 typeLanguage="http://www.w3.org/2001/XMLSchema"
 expressionLanguage="http://www.w3.org/1999/XPath"
 targetNamespace="http://www.activiti.org/test"&gt;
 &lt;process id="EmailNotification" name="emailNotification"&gt;
   &lt;documentation&gt;Simple Email Notification Task&lt;/documentation&gt;
   &lt;startEvent id="startevent1" name="Start"&gt;&lt;/startEvent&gt;
   &lt;sequenceFlow id="flow1" name="" sourceRef="startevent1"
     targetRef="mailtask1"&gt;&lt;/sequenceFlow&gt;
   &lt;endEvent id="endevent1" name="End"&gt;&lt;/endEvent&gt;
   &lt;sequenceFlow id="flow2" name="" sourceRef="mailtask1"
     targetRef="endevent1"&gt;&lt;/sequenceFlow&gt;
   &lt;serviceTask id="mailtask1" name="Email Notification"
     activiti:type="mail"&gt;
     &lt;extensionElements&gt;
       &lt;activiti:field name="to" expression="${toEmail}"
       &gt;&lt;/activiti:field&gt;
       &lt;activiti:field name="from" expression="${fromSender}"
       &gt;&lt;/activiti:field&gt;
       &lt;activiti:field name="subject" expression="Simple Email Notification"
       &gt;&lt;/activiti:field&gt;
       &lt;activiti:field name="text"&gt;
         &lt;activiti:expression&gt;&lt;![CDATA[Here is a simple Email Notification
         from ${fromSender}.]]&gt;&lt;/activiti:expression&gt;
       &lt;/activiti:field&gt;
     &lt;/extensionElements&gt;
   &lt;/serviceTask&gt;
 &lt;/process&gt;
 &lt;bpmndi:BPMNDiagram id="BPMNDiagram_EmailNotification"&gt;
   &lt;bpmndi:BPMNPlane bpmnElement="EmailNotification"
     id="BPMNPlane_EmailNotification"&gt;
     &lt;bpmndi:BPMNShape bpmnElement="startevent1" id="BPMNShape_startevent1"&gt;
       &lt;omgdc:Bounds height="35" width="35" x="170" y="250"&gt;&lt;/omgdc:Bounds&gt;
     &lt;/bpmndi:BPMNShape&gt;
     &lt;bpmndi:BPMNShape bpmnElement="endevent1" id="BPMNShape_endevent1"&gt;
       &lt;omgdc:Bounds height="35" width="35" x="410" y="250"&gt;&lt;/omgdc:Bounds&gt;
     &lt;/bpmndi:BPMNShape&gt;
     &lt;bpmndi:BPMNShape bpmnElement="mailtask1" id="BPMNShape_mailtask1"&gt;
       &lt;omgdc:Bounds height="55" width="105" x="250" y="240"&gt;&lt;/omgdc:Bounds&gt;
     &lt;/bpmndi:BPMNShape&gt;
     &lt;bpmndi:BPMNEdge bpmnElement="flow1" id="BPMNEdge_flow1"&gt;
       &lt;omgdi:waypoint x="205" y="267"&gt;&lt;/omgdi:waypoint&gt;
       &lt;omgdi:waypoint x="250" y="267"&gt;&lt;/omgdi:waypoint&gt;
     &lt;/bpmndi:BPMNEdge&gt;
     &lt;bpmndi:BPMNEdge bpmnElement="flow2" id="BPMNEdge_flow2"&gt;
       &lt;omgdi:waypoint x="355" y="267"&gt;&lt;/omgdi:waypoint&gt;
       &lt;omgdi:waypoint x="410" y="267"&gt;&lt;/omgdi:waypoint&gt;
     &lt;/bpmndi:BPMNEdge&gt;
   &lt;/bpmndi:BPMNPlane&gt;
 &lt;/bpmndi:BPMNDiagram&gt;
&lt;/definitions&gt;</pre><p>In Eclipse, select the project, then right click and select
   Create deployment artifacts to generate the components and package them
   in a .bar file for deployment in the <code class="filename">openidm/workflow</code>
   directory.</p><p>After you deploy the .bar, create a script named <code class="filename">
   openidm/script/triggerEmailNotification.js</code>. The script
   invokes the workflow.</p><pre class="codelisting prettyprint linenums lang-js">
/*
 * Calling 'EmailNotification' workflow
 */

var params = {
 "_key" : "EmailNotification",
 "fromSender" : "noreply@openidm",
 "toEmail" : "jdoe@example.com"
};

openidm.action('workflow/processinstance', {"_action" : "createProcessInstance"}, params);
</pre><p>You can also invoke the workflow over the REST interface with the 
   following REST command:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin" 
 --header "X-OpenIDM-Password: openidm-admin"
 --data '{"_key":"EmailNotification", "fromSender":"noreply@openidm", "toEmail":"jdoe@example.com"}'
 --request POST 
 "http://localhost:8080/openidm/workflow/processinstance?_action=createProcessInstance"
   </pre><p>To schedule the workflow to be invoked regularly, create a schedule 
   configuration object named 
   <code class="filename">openidm/conf/schedule-EmailNotification.json</code>. The
   following schedule invokes the workflow once per minute.</p><pre class="codelisting prettyprint linenums lang-js">
{
   "enabled" : true,
   "type" : "cron",
   "schedule" : "0 0/1 * * * ?",
   "invokeService" : "script",
   "invokeContext" : {
       "script" : {
           "type" : "text/javascript",
           "file" : "script/triggerEmailNotification.js"
       },
   }
}</pre></div><div class="section" id="example-provisioning-workflow"><div class="titlepage"><div><div><h3 class="title">15.4.2.&nbsp;Sample Workflow - Provisioning User Accounts</h3></div></div></div><p>This example, provided in <code class="filename">openidm/samples/workflow</code>, 
    uses workflows to provision user accounts. The example demonstrates the 
    use of the browser-based user interface to manage workflows.</p><div class="section" id="provisioning-sample-overview"><div class="titlepage"><div><div><h4 class="title">15.4.2.1.&nbsp;Overview of the Sample</h4></div></div></div><p>The sample starts with a reconciliation process that loads user 
    accounts from an XML file into the managed users repository. The 
    reconciliation creates two users, with UIDs <code class="literal">user1</code> and 
    <code class="literal">manager1</code>. Both users have the same password 
    (<code class="literal">Welcome1</code>).</p><p>The sample adds two new business roles to the configuration - 
    <code class="literal">employee</code> (assigned to <code class="literal">user1</code>) and 
    <code class="literal">manager</code> (assigned to <code class="literal">manager1</code>).</p><p>As part of the provisioning, employees are required to initiate 
    a "Contract Onboarding" process. This process is a request to add a 
    contractor to the managed users repository, with an option to include the 
    contractor in the original data source (the XML file).</p><p>When the employee has completed the required form, the request is 
    sent to the manager for approval. Any user with the role 
    <code class="literal">"manager"</code> can claim the approval task. If the request 
    is approved, the user is created in the managed users repository. If a 
    request was made to add the user to the original data source (the XML file) 
    this is done in a subsequent step.</p><p>The workflow uses embedded templates to build a more sophisticated 
    input form.  The form is validated with the server-side policy rules, 
    described in <a href="../integrators-guide/index.html#chap-policies" class="link"><em class="citetitle">Using 
    Policies to Validate Data</em></a>.</p></div><div class="section" id="provisioning-sample-running"><div class="titlepage"><div><div><h4 class="title">15.4.2.2.&nbsp;Running the Sample</h4></div></div></div><div class="procedure"><div class="procedure-inner"><ol class="procedure" type="1"><li class="step"><p>Start OpenIDM with the configuration for the workflow sample.</p><pre class="cmdline prettyprint">$ cd /path/to/openidm
$ ./startup.sh -p samples/workflow</pre></li><li class="step"><p>Run reconciliation over the REST interface.</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/recon?_action=recon&amp;mapping=systemXmlfileAccounts_managedUser"</pre><p>Successful reconciliation returns an "_id" object, such as the 
     following:</p><pre class="cmdline prettyprint">{"_id":"aea493f5-29ee-423d-b4b1-10449c60886c"}</pre><p>The two users are added to the repository. You can test this with 
     the following REST query, which shows the two users, 
     <code class="literal">manager1</code> and <code class="literal">user1</code>.</p><pre class="cmdline prettyprint">$ curl 
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET 
 "http://localhost:8080/openidm/managed/user/?_queryId=query-all-ids"

{
  "conversion-time-ms": 0,
  "result": [
    {
      "_rev": "0",
      "_id": "manager1"
    },
    {
      "_rev": "0",
      "_id": "user1"
    }
  ],
  "query-time-ms": 1
}
     </pre></li><li class="step"><p>Log in to the user interface as <code class="literal">user1</code>, with 
     password <code class="literal">Welcome1</code>. For information about logging in to 
     the user interface, see <a href="../integrators-guide/index.html#ui-overview" class="link">
     <em class="citetitle">Overview of the Default User Interface</em></a>.</p></li><li class="step"><p>Under "Processes" click "Contractor onboarding process".</p></li><li class="step"><p>Complete the details of the new user, then click Start.</p><div class="mediaobject" align="center"><a class="fancybox" href="images/ui-workflow.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_ui-workflow.png" align="middle" alt="Contractor onboarding process form"></a></div></li><li class="step"><p>Log out of the UI.</p></li><li class="step"><p>Log in to the UI as <code class="literal">manager1</code>, with password 
     <code class="literal">Welcome1</code>.</p></li><li class="step"><p>Under "Tasks that are in my group's queue" click 
     "Contractor Approval".</p></li><li class="step"><p>From the drop-down list, select "Assign to me".</p><p>Note that the "Contractor Approval" task has now moved under 
     "My tasks".</p></li><li class="step"><p>Under "My tasks" click "Contractor Approval".</p></li><li class="step"><p>Under Actions, click Details.</p><p>The form containing the details of the contractor is displayed.</p></li><li class="step"><p>At the bottom of the form, select a decision from the drop-down 
     list (either "Accept" or "Reject"), then click Complete.</p><p>If you Accept the new contractor details, the user account is 
     created in the repository. You can check the new account by running the 
     following REST command:</p><pre class="cmdline prettyprint">$ curl 
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET 
 "http://localhost:8080/openidm/managed/user/?_queryId=query-all-ids"

{
  "conversion-time-ms": 0,
  "result": [
    {
      "_rev": "0",
      "_id": "manager1"
    },
    {
      "_rev": "0",
      "_id": "user1"
    },
    {
      "_rev": "0",
      "_id": "51afe0f8-94c3-45c5-8c69-319e6ef5981f"
    }
  ],
  "query-time-ms": 1
}
     </pre><p>Display the details of the new user, by running a REST query on the 
     user ID, as follows:</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request GET     
 "http://localhost:8080/openidm/managed/user/51afe0f8-94c3-45c5-8c69-319e6ef5981f"

{
  "city": "",
  "country": "",
  "address2": "",
  "address1": "",
  "lastPasswordAttempt": "Fri Dec 14 2012 13:54:02 GMT+0200 (SAST)",
  "passwordAttempts": "0",
  "stateProvince": "",
  "postalCode": "",
  "lastPasswordSet": "",
  "jobTitle": "Accountant",
  "department": "Finance",
  "manager": "user1",
  "familyName": "Doe",
  "givenName": "John",
  "userName": "johnd",
  "_rev": "0",
  "_id": "51afe0f8-94c3-45c5-8c69-319e6ef5981f",
  "phoneNumber": "123456789",
  "email": "johnd@example.com",
  "startDate": "12/12/2012",
  "endDate": "12/12/2012",
  "description": "Contract accountant",
  "provisionToXML": "1",
  "accountStatus": "active",
  "roles": "openidm-authorized"
}     
     </pre><p>You can now log in to the UI as the new user (with the details that 
     you specified in Step 5). Under "Notifications" you will see a welcome 
     message indicating the working dates of the new user. If you log in as 
     <code class="literal">user1</code> you are notified of the result of the manager's 
     decision.</p><p>If you specified that the new user should be added to the original 
     data source, you will see that the account was added to the XML file:</p><pre class="cmdline prettyprint">$ cd /path/to/openidm
$ cat samples/workflow/data/xmlConnectorData.xml
...
   &gt;ri:__ACCOUNT__&lt;
      &gt;icf:__DESCRIPTION__&lt;Contract accountant&gt;/icf:__DESCRIPTION__&lt;
      &gt;ri:roles&lt;openidm-authorized&gt;/ri:roles&lt;
      &gt;ri:mobileTelephoneNumber&lt;123456789&gt;/ri:mobileTelephoneNumber&lt;
      &gt;ri:firstname&lt;John&gt;/ri:firstname&lt;
      &gt;ri:manager&lt;user1&gt;/ri:manager&lt;
      &gt;ri:startDate&lt;12/12/2012&gt;/ri:startDate&lt;
      &gt;ri:jobTitle&lt;Accountant&gt;/ri:jobTitle&lt;
      &gt;icf:__UID__&lt;201e0d50-3313-47b3-9bd1-30c1c7dd1cee&gt;/icf:__UID__&lt;
      &gt;icf:__NAME__&lt;johnd&gt;/icf:__NAME__&lt;
      &gt;ri:email&lt;johnd@example.com&gt;/ri:email&lt;
      &gt;icf:__PASSWORD__&lt;MyPassw0rd&gt;/icf:__PASSWORD__&lt;
      &gt;ri:department&lt;Finance&gt;/ri:department&lt;
      &gt;ri:endDate&lt;12/12/2012&gt;/ri:endDate&lt;
      &gt;ri:lastname&lt;Doe&gt;/ri:lastname&lt;
   &gt;/ri:__ACCOUNT__&lt;
...
     </pre><p>If you declined the approval request, the user will not be created 
     in either data source.</p></li></ol></div></div><p>You can see the details of the workflow definition in 
     <code class="filename">samples/workflow/workflow/contractorOnboarding.bpmn20.xml</code>.
     </p></div></div></div></div><div lang="en" class="chapter" id="chap-auditing"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;16.&nbsp;Using Audit Logs</h1></div></div></div><a class="indexterm" name="d0e11054"></a><p>OpenIDM auditing can publish and log all relevant system activity to
 the targets you specify. Auditing can include data from reconciliation as
 a basis for reporting, access details, and activity logs that capture
 operations on internal (managed) objects and external (system) objects.
 Auditing provides the data for all the relevant reports, including orphan
 account reports.</p><p>The auditing interface allows you to push auditing data to files and
 to the OpenIDM repository.</p><div class="section" id="audit-log-types"><div class="titlepage"><div><div><h2 class="title" style="clear: both">16.1.&nbsp;Audit Log Types</h2></div></div></div><div class="variablelist"><p>This section describes the types of audit log OpenIDM provides.</p><dl class="variablelist"><dt><span class="term">Access Log</span></dt><dd><p>OpenIDM writes messages concerning access to the REST API in this
     log.</p><p>Default file: <code class="filename">openidm/audit/access.csv</code></p></dd><dt><span class="term">Activity Log</span></dt><dd><p>OpenIDM logs operations on internal (managed) and external (system)
     objects to this log type.</p><p>Entries in the activity log contain identifiers both for the
     reconciliation or synchronization action that triggered the activity,
     and also for the original caller and the relationships between related
     actions.</p><p>Default file: <code class="filename">openidm/audit/activity.csv</code></p></dd><dt><span class="term">Reconciliation Log</span></dt><dd><p>OpenIDM logs the results of a reconciliation run, including
     situations and the resulting actions taken to this log type. The activity
     log contains details about the actions, where log entries display parent
     activity identifiers,
     <code class="literal">recon/<em class="replaceable"><code>reconID</code></em></code>.</p><p>Default file: <code class="filename">openidm/audit/recon.csv</code></p></dd></dl></div><p>Where an action happens in the context of a higher level business
  function, the log entry points to a parent activity for the context.
  The relationships are hierarchical. For example, a synchronization operation
  could result from scheduled reconciliation for an object type. OpenIDM also
  logs the top level root activity with each entry, making it possible to
  query related activities.</p></div><div class="section" id="audit-log-format"><div class="titlepage"><div><div><h2 class="title" style="clear: both">16.2.&nbsp;Audit Log File Formats</h2></div></div></div><p>This section describes the audit log file formats to help you map
  these to the reports you generate.</p><div class="variablelist" id="audit-access-fields"><div class="variablelist-title">Access Log Fields</div><p>Access messages are split into the following fields.</p><dl class="variablelist"><dt><span class="term"><code class="literal">"_id"</code></span></dt><dd><p>UUID for the message object, such as
     <code class="literal">"0419d364-1b3d-4e4f-b769-555c3ca098b0"</code></p></dd><dt><span class="term"><code class="literal">"action"</code></span></dt><dd><p>Action requested, such as <code class="literal">"authenticate"</code></p></dd><dt><span class="term"><code class="literal">"ip"</code></span></dt><dd><p>IP address of the client. For access from the local host, this
     can appear for example as <code class="literal">"0:0:0:0:0:0:0:1%0"</code>.</p></dd><dt><span class="term"><code class="literal">"principal"</code></span></dt><dd><p>Principal requesting the operation, such as
     <code class="literal">"openidm-admin"</code></p></dd><dt><span class="term"><code class="literal">"roles"</code></span></dt><dd><p>Roles associated with the principal, such as
     <code class="literal">"[openidm-admin, openidm-authorized]"</code></p></dd><dt><span class="term"><code class="literal">"status"</code></span></dt><dd><p>Result of the operation, such as <code class="literal">"SUCCESS"</code></p></dd><dt><span class="term"><code class="literal">"timestamp"</code></span></dt><dd><p>Time when OpenIDM logged the message, in UTC format, for example 
     <code class="literal">"2012-11-18T08:48:00.160Z"</code></p></dd></dl></div><div class="variablelist" id="audit-activity-fields"><div class="variablelist-title">Activity Log Fields</div><p>Activity messages are split into the following fields.</p><dl class="variablelist"><dt><span class="term"><code class="literal">"_id"</code></span></dt><dd><p>UUID for the message object, such as
     <code class="literal">"0419d364-1b3d-4e4f-b769-555c3ca098b0"</code></p></dd><dt><span class="term"><code class="literal">"action"</code></span></dt><dd><p>Action performed, such as <code class="literal">"create"</code>. See
     the section on <a href="../integrators-guide/index.html#audit-eventtypes" class="link"><em class="citetitle">Event
     Types</em></a> for a list.</p></dd><dt><span class="term"><code class="literal">"activityId"</code></span></dt><dd><p>UUID for the activity corresponding to the UUID of the resource
     context</p></dd><dt><span class="term"><code class="literal">"after"</code></span></dt><dd><p>JSON representation of the object resulting from the activity</p></dd><dt><span class="term"><code class="literal">"before"</code></span></dt><dd><p>JSON representation of the object prior to the activity</p></dd><dt><span class="term"><code class="literal">"message"</code></span></dt><dd><p>Human readable text about the activity</p></dd><dt><span class="term"><code class="literal">"objectId"</code></span></dt><dd><p>Object identifier such as
     <code class="literal">"managed/user/DDOE1"</code></p></dd><dt><span class="term"><code class="literal">"parentActionId"</code></span></dt><dd><p>UUID of the action leading to the activity</p></dd><dt><span class="term"><code class="literal">"requester"</code></span></dt><dd><p>Principal requesting the operation</p></dd><dt><span class="term"><code class="literal">"rev"</code></span></dt><dd><p>Object revision number</p></dd><dt><span class="term"><code class="literal">"rootActionId"</code></span></dt><dd><p>UUID of the root cause for the activity. This matches a
     corresponding <code class="literal">"rootActionId"</code> in a reconciliation
     message.</p></dd><dt><span class="term"><code class="literal">"status"</code></span></dt><dd><p>Result of the operation, such as <code class="literal">"SUCCESS"</code></p></dd><dt><span class="term"><code class="literal">"timestamp"</code></span></dt><dd><p>Time when OpenIDM logged the message, in UTC format, for example 
     <code class="literal">"2012-11-18T08:48:00.160Z"</code></p></dd></dl></div><div class="variablelist" id="audit-recon-fields"><div class="variablelist-title">Reconciliation Log Fields</div><p>Reconciliation messages are split into the following fields.</p><dl class="variablelist"><dt><span class="term"><code class="literal">"_id"</code></span></dt><dd><p>UUID for the message object, such as
     <code class="literal">"0419d364-1b3d-4e4f-b769-555c3ca098b0"</code></p></dd><dt><span class="term"><code class="literal">"action"</code></span></dt><dd><p>Synchronization action, such as <code class="literal">"CREATE"</code>. See
     the section on <a href="../integrators-guide/index.html#sync-actions" class="link"><em class="citetitle">Actions</em></a> for a list.</p></dd><dt><span class="term"><code class="literal">"ambiguousTargetObjectIds"</code></span></dt><dd><p>When the situation is AMBIGUOUS or UNQUALIFIED and OpenIDM cannot
     distinguish between more than one target object, OpenIDM logs the
     identifiers of the objects in this field in comma-separated format. This
     makes it possible to figure out what was ambiguous afterwards.</p></dd><dt><span class="term"><code class="literal">"entryType"</code></span></dt><dd><p>Kind of reconciliation log entry, such as <code class="literal">"start"</code>,
     or <code class="literal">"summary"</code>.</p></dd><dt><span class="term"><code class="literal">"message"</code></span></dt><dd><p>Human readable text about the reconciliation action</p></dd><dt><span class="term"><code class="literal">"reconciling"</code></span></dt><dd><p>What OpenIDM is reconciling, 
     <code class="literal">"source"</code> for the first phase, 
     <code class="literal">"target"</code> for the second phase</p></dd><dt><span class="term"><code class="literal">"reconId"</code></span></dt><dd><p>UUID for the reconciliation operation, which is the same for all
     entries pertaining to the reconciliation run.</p></dd><dt><span class="term"><code class="literal">"rootActionId"</code></span></dt><dd><p>UUID of the root cause for the activity. This matches a
     corresponding <code class="literal">"rootActionId"</code> in an activity
     message.</p></dd><dt><span class="term"><code class="literal">"situation"</code></span></dt><dd><p>The situation encountered. See
     the section describing <a href="../integrators-guide/index.html#sync-situations" class="link">synchronization
     situations</a> for a list.</p></dd><dt><span class="term"><code class="literal">"sourceObjectId"</code></span></dt><dd><p>UUID for the source object.</p></dd><dt><span class="term"><code class="literal">"status"</code></span></dt><dd><p>Result of the operation, such as <code class="literal">"SUCCESS"</code></p></dd><dt><span class="term"><code class="literal">"targetObjectId"</code></span></dt><dd><p>UUID for the target object</p></dd><dt><span class="term"><code class="literal">"timestamp"</code></span></dt><dd><p>Time when OpenIDM logged the message, in UTC format, for example 
    <code class="literal">"2012-11-18T08:48:00.160Z"</code></p></dd></dl></div></div><div class="section" id="audit-configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both">16.3.&nbsp;Audit Configuration</h2></div></div></div><p>OpenIDM exposes the audit logging configuration under
  <code class="literal">http://localhost:8080/openidm/config/audit</code>
  for the REST API, and in the file <code class="filename">conf/audit.json</code> where
  you installed OpenIDM. The default <code class="filename">conf/audit.json</code> file
  contains the following object.</p><pre class="codelisting prettyprint linenums lang-js">{
    "eventTypes" : {
        "activity" : {
            "filter" : {
                "actions" : [
                    "create",
                    "update",
                    "delete",
                    "patch",
                    "action"
                ]
            },
            "watchedFields" : [ ],
            "passwordFields" : [ "password" ]
        },
        "recon" : { }
    },
    "logTo" : [
        {
            "logType" : "csv",
            "location" : "audit",
            "recordDelimiter" : ";"
        },
        {
            "logType" : "repository",
            "useForQueries" : true
        }
    ],
    "exceptionFormatter" : {
        "type" : "text/javascript",
        "file" : "bin/defaults/script/audit/stacktraceFormatter.js"
    }
}</pre><div class="section" id="audit-eventtypes"><div class="titlepage"><div><div><h3 class="title">16.3.1.&nbsp;Event Types</h3></div></div></div><p>The <code class="literal">eventTypes</code> configuration specifies what events
   OpenIDM writes to audit logs. OpenIDM supports two
   <code class="literal">eventTypes</code>: <code class="literal">activity</code> for the activity
   log, and <code class="literal">recon</code> for the reconciliation log. The filter
   for actions under activity logging shows the actions on managed or system
   objects for which OpenIDM writes to the activity log.</p><div class="variablelist"><p>The <code class="literal">filter</code> <code class="literal">actions</code> list enables 
    you to configure the conditions that result in actions being written to the 
    activity log.</p><dl class="variablelist"><dt><span class="term"><code class="literal">read</code></span></dt><dd><p>When an object is read by using its identifier.</p></dd><dt><span class="term"><code class="literal">create</code></span></dt><dd><p>When an object is created.</p></dd><dt><span class="term"><code class="literal">update</code></span></dt><dd><p>When an object is updated.</p></dd><dt><span class="term"><code class="literal">delete</code></span></dt><dd><p>When an object is deleted.</p></dd><dt><span class="term"><code class="literal">patch</code></span></dt><dd><p>When an object is partially modified.</p></dd><dt><span class="term"><code class="literal">query</code></span></dt><dd><p>When a query is performed on an object.</p></dd><dt><span class="term"><code class="literal">action</code></span></dt><dd><p>When an action is performed on an object.</p></dd></dl></div><p>You can optionally add a <code class="literal">filter</code> 
   <code class="literal">triggers</code> list that specifies the actions that are logged 
   for a particular trigger. For example, the following addition to the 
   <code class="filename">audit.json</code> file specifies that only 
   <code class="literal">create</code> and <code class="literal">update</code> actions are logged 
   for an activity that was triggered by a <code class="literal">recon</code>.</p><pre class="codelisting prettyprint linenums lang-js">
   ...
            "filter" : {
                "actions" : [
                    "create",
                    "update",
                    "delete",
                    "patch",
                    "action"
                ],
                "triggers" : {
                    "recon" : [
                        "create",
                        "update"
                    ]
                }
            },
            "watchedFields" : [ ],   
   ...
   </pre><p>If a trigger is provided, but no actions are specified, nothing is 
   logged for that trigger. If a trigger is omitted, all actions are logged 
   for that trigger. In the current OpenIDM release, only the 
   <code class="literal">recon</code> trigger is implemented. For a list of reconciliation 
   actions that can be logged, see <a href="../integrators-guide/index.html#sync-actions" class="link"><em class="citetitle">Synchronization 
   Actions</em></a>.</p><p>The <code class="literal">watchedFields</code> parameter enables you to specify 
   a list of fields that should be "watched" for changes. When the value of one 
   of the fields in this list changes, the change is logged in the audit log, 
   under the column <code class="literal">"changedFields"</code>. Fields are listed in 
   comma-separated format, for example:</p><pre class="cmdline prettyprint">"watchedFields" : [ "email", "address" ]</pre><p>The <code class="literal">passwordFields</code> parameter enables you to specify 
   a list of fields that are considered passwords. This parameter functions much 
   like the <code class="literal">watchedFields</code> parameter in that changes to these 
   field values are logged in the audit log, under the column 
   <code class="literal">"changedFields"</code>. In addition, when a password field is 
   changed, the boolean <code class="literal">"passwordChanged"</code> flag is set to 
   <code class="literal">true</code> in the audit log. Fields are listed in 
   comma-separated format, for example:</p><pre class="cmdline prettyprint">"passwordFields" : [ "password", "username" ]</pre></div><div class="section" id="audit-logto"><div class="titlepage"><div><div><h3 class="title">16.3.2.&nbsp;Log To List</h3></div></div></div><div class="variablelist"><p>The <code class="literal">logTo</code> list enables you to specify the
    format of the log, where it is written, and various parameters for each
    log type.</p><dl class="variablelist"><dt><span class="term"><code class="literal">logType</code></span></dt><dd><p>The format of the audit log. The log type can be one
            of the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">csv</code> - write to a comma-separated
                    variable format file.</p><p>The <code class="literal">"location"</code> property indicates
                    the name of the directory in which the file should be written,
                    relative to the directory in which you installed OpenIDM.</p><p>Audit file names are fixed, <code class="filename">access.csv</code>,
                    <code class="filename">activity.csv</code>, and <code class="filename">recon.csv</code>.
                    </p><p>The <code class="literal">"recordDelimiter"</code> property
                    enables you to specify the separator between each record.
                    </p></li><li class="listitem"><p><code class="literal">repository</code> - write to the OpenIDM
                    database repository.</p><p>OpenIDM stores entries under the
                    <code class="literal">/openidm/repo/audit/</code> context. Such entries
                    appear as <code class="literal">audit/access/<em class="replaceable"><code>_id</code></em></code>,
                    <code class="literal">audit/activity/<em class="replaceable"><code>_id</code></em></code>, and
                    <code class="literal">audit/recon/<em class="replaceable"><code>_id</code></em></code>,
                    where the <em class="replaceable"><code>_id</code></em> is the UUID of the
                    entry, such as <code class="literal">0419d364-1b3d-4e4f-b769-555c3ca098b0</code>.
                    </p><p>In the OrientDB repository, OpenIDM stores log records in the
                    <code class="literal">audit_access</code>, <code class="literal">audit_activity</code>,
                    and <code class="literal">audit_recon</code> tables.</p><p>In a JDBC repository, OpenIDM stores records in the
                    <code class="literal">auditaccess</code>, <code class="literal">auditactivity</code>,
                    and <code class="literal">auditrecon</code> tables.</p><p>The <code class="literal">"useForQueries"</code> boolean property
                    indicates whether the repository logger should be used to service
                    reads and query requests. The value is <code class="literal">true</code>
                    by default. If <code class="literal">"useForQueries"</code> is set to
                    <code class="literal">false</code>, the CSV file is used to service read
                    and query requests.</p></li></ul></div></dd></dl></div></div><div class="section" id="audit-exception-formatter"><div class="titlepage"><div><div><h3 class="title">16.3.3.&nbsp;Exception Formatter</h3></div></div></div><p>The <code class="literal">exceptionFormatter</code> property specifies
      the name and type of file that handles the formatting and display of
      exceptions thrown by the audit logger. Currently,
      <code class="literal">"text/javascript"</code> is the only supported type.</p><p>The <code class="literal">"file"</code> property provides the path to the
      script file that performs the formatting. The default exception formatter
      is <code class="literal">"bin/defaults/script/audit/stacktraceFormatter.js"</code>.</p></div></div><div class="section" id="audit-reports"><div class="titlepage"><div><div><h2 class="title" style="clear: both">16.4.&nbsp;Generating Reports</h2></div></div></div><p>When generating reports from audit logs, you can correlate information
  from activity and reconciliation logs by matching the
  <code class="literal">"rootActionId"</code> on entries in both logs.</p><p>The following MySQL query shows a join of the audit activity and
  audit reconciliation tables using root action ID values.</p><pre class="cmdline prettyprint">
mysql&gt; select distinct auditrecon.activity,auditrecon.sourceobjectid,
 auditrecon.targetobjectid,auditactivity.activitydate,auditrecon.status
 from auditactivity inner join auditrecon
 auditactivity.rootactionid=auditrecon.rootactionid
 where auditrecon.activity is not null group by auditrecon.sourceobjectid;
+----------+--------------------------+----------------------+---------------------+---------+
| activity | sourceobjectid           | targetobjectid       | activitydate        | status  |
+----------+--------------------------+----------------------+---------------------+---------+
| CREATE   | system/xmlfile/account/1 | managed/user/juser   | 2012-01-17T07:59:12 | SUCCESS |
| CREATE   | system/xmlfile/account/2 | managed/user/ajensen | 2012-01-17T07:59:12 | SUCCESS |
| CREATE   | system/xmlfile/account/3 | managed/user/bjensen | 2012-01-17T07:59:12 | SUCCESS |
+----------+--------------------------+----------------------+---------------------+---------+
3 rows in set (0.00 sec)</pre></div></div><div lang="en" class="chapter" id="chap-mail"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;17.&nbsp;Sending Email</h1></div></div></div><a class="indexterm" name="d0e11724"></a><a class="indexterm" name="d0e11729"></a><p>This chapter shows you how to configure the outbound email service, so
 that you can send email through OpenIDM either by script or through the REST
 API.</p><div class="procedure" id="setup-outbound-email"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;17.1.&nbsp;To Set Up Outbound Email</div><p>The outbound email service relies on a configuration object to identify
  the email account used to send messages.</p><ol class="procedure" type="1"><li class="step"><p>Shut down OpenIDM.</p></li><li class="step"><p>Copy the sample configuration to
   <code class="filename">openidm/conf</code>.</p><pre class="cmdline prettyprint">$ cd /path/to/openidm/
$ cp samples/misc/external.email.json conf/</pre></li><li class="step"><p>Edit <code class="filename">external.email.json</code> to reflect the
   account used to send messages.</p><pre class="codelisting prettyprint linenums lang-js">
{
        "host" : "smtp.example.com",
        "port" : "25",
        "username" : "openidm",
        "password" : "secret12",
        "mail.smtp.auth" : "true",
        "mail.smtp.starttls.enable" : "true"
}</pre><p>OpenIDM encrypts the password you provide.</p><div class="variablelist"><p>Follow these hints when editing the configuration.</p><dl class="variablelist"><dt><span class="term"><code class="literal">"host"</code></span></dt><dd><p>SMTP server host name or IP address. This can be
      <code class="literal">"localhost"</code> if the server is on the same system as
      OpenIDM.</p></dd><dt><span class="term"><code class="literal">"port"</code></span></dt><dd><p>SMTP server port number such as 25, or 587</p></dd><dt><span class="term"><code class="literal">"username"</code></span></dt><dd><p>Mail account user name needed when <code class="literal">"mail.smtp.auth" :
      "true"</code></p></dd><dt><span class="term"><code class="literal">"password"</code></span></dt><dd><p>Mail account user password needed when <code class="literal">"mail.smtp.auth" :
      "true"</code></p></dd><dt><span class="term"><code class="literal">"mail.smtp.auth"</code></span></dt><dd><p>If <code class="literal">"true"</code>, use SMTP authentication</p></dd><dt><span class="term"><code class="literal">"mail.smtp.starttls.enable"</code></span></dt><dd><p>If <code class="literal">"true"</code>, use TLS</p></dd><dt><span class="term"><code class="literal">"from"</code></span></dt><dd><p>Optional default <code class="literal">From:</code> address</p></dd></dl></div></li><li class="step"><p>Start up OpenIDM.</p></li><li class="step"><p>Check that the email service is active.</p><pre class="cmdline prettyprint">-&gt; scr list
...
[   6] [active       ] org.forgerock.openidm.external.email
...</pre></li></ol></div></div><div class="section" id="send-mail-rest"><div class="titlepage"><div><div><h2 class="title" style="clear: both">17.1.&nbsp;Sending Mail Over REST</h2></div></div></div><p>Although you are more likely to send mail from a script in production,
  you can send email using the REST API by sending an HTTP POST to
  <code class="literal">/openidm/external/email</code> in order to test that your
  configuration works. You pass the message parameters as POST parameters,
  URL encoding the content as necessary.</p><p>The following example sends a test email using the REST API.</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/external/email?
 _from=openidm@example.com&amp;_to=admin@example.com&amp;
 _subject=Test&amp;_body=Test"</pre></div><div class="section" id="send-mail-script"><div class="titlepage"><div><div><h2 class="title" style="clear: both">17.2.&nbsp;Sending Mail From a Script</h2></div></div></div><p>You can send email from using the resource API <a href="../integrators-guide/index.html#function-ref" class="link">functions</a> with
  the <code class="literal">external/email</code> context, as in the following
  example, where <code class="literal">params</code> is an object containing the
  POST parameters.</p><pre class="codelisting prettyprint linenums lang-js">
var params =  new Object();
params._from = "openidm@example.com";
params._to = "admin@example.com";
params._cc = "wally@example.com,dilbert@example.com";
params._subject = "OpenIDM recon report";
params._type = "text/html";
params._body = "&lt;html&gt;&lt;body&gt;&lt;p&gt;Recon report follows...&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;";

openidm.action("external/email", params);</pre><div class="variablelist"><p>OpenIDM supports the following POST parameters.</p><dl class="variablelist"><dt><span class="term"><code class="literal">_from</code></span></dt><dd><p>Sender mail address</p></dd><dt><span class="term"><code class="literal">_to</code></span></dt><dd><p>Comma-separated list of recipient mail addresses</p></dd><dt><span class="term"><code class="literal">_cc</code></span></dt><dd><p>Optional comma-separated list of copy recipient mail addresses</p></dd><dt><span class="term"><code class="literal">_bcc</code></span></dt><dd><p>Optional comma-separated list of blind copy recipient mail
     addresses</p></dd><dt><span class="term"><code class="literal">_subject</code></span></dt><dd><p>Email subject</p></dd><dt><span class="term"><code class="literal">_body</code></span></dt><dd><p>Email body text</p></dd><dt><span class="term"><code class="literal">_type</code></span></dt><dd><p>Optional MIME type. One of <code class="literal">"text/plain"</code>,
     <code class="literal">"text/html"</code>, or <code class="literal">"text/xml"</code>.</p></dd></dl></div></div></div><div lang="en" class="chapter" id="chap-best-practices"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;18.&nbsp;OpenIDM Project Best Practices</h1></div></div></div><a class="indexterm" name="d0e11929"></a><p>This chapter lists points to check when implementing an identity
 management solution with OpenIDM.</p><div class="section" id="immplementation-phase"><div class="titlepage"><div><div><h2 class="title" style="clear: both">18.1.&nbsp;Implementation Phases</h2></div></div></div><p>Any identity management project should follow a set of well defined
  phases, where each phase defines discrete deliverables. The phases take
  the project from initiation to finally going live with a tested
  solution.</p><div class="section" id="d0e11939"><div class="titlepage"><div><div><h3 class="title">18.1.1.&nbsp;Initiation</h3></div></div></div><p>The project's initiation phase involves identifying and gathering
   project background, requirements, and goals at a high level. The deliverable
   for this phase is a statement of work or a mission statement.</p></div><div class="section" id="d0e11944"><div class="titlepage"><div><div><h3 class="title">18.1.2.&nbsp;Definition</h3></div></div></div><p>In the definition phase, you gather more detailed information on
   existing systems, determine how to integrate, describe account schemas,
   procedures, and other information relevant to the OpenIDM deployment.
   The deliverable for this phase is one or more documents that define
   detailed requirements for the project, and that cover project definition,
   the business case, use cases to solve, and functional specifications.</p><div class="variablelist"><p>The definition phase should capture at least the following.</p><dl class="variablelist"><dt><span class="term">User Administration and Management</span></dt><dd><p>Procedures for managing users and accounts, who manages users,
      what processes look like for joiners, movers and leavers, and what is
      required of OpenIDM to manage users</p></dd><dt><span class="term">Password Management and Password Synchronization</span></dt><dd><p>Procedures for managing account passwords, password policies,
      who manages passwords, and what is required of OpenIDM to manage
      passwords</p></dd><dt><span class="term">Security Policy</span></dt><dd><p>What security policies defines for users, accounts, passwords, and
      access control</p></dd><dt><span class="term">Target Systems</span></dt><dd><p>Target systems and resources with which OpenIDM must integrate.
      Information such as schema, attribute mappings and attribute
      transformation flow, credentials and other integration specific
      information.</p></dd><dt><span class="term">Entitlement Management</span></dt><dd><p>Procedures to manage user access to resources, individual
      entitlements, grouping provisioning activities into encapsulated
      concepts such as roles and groups</p></dd><dt><span class="term">Synchronization and Data Flow</span></dt><dd><p>Detailed outlines showing how identity information flows from
      authoritative sources to target systems, attribute transformations
      required</p></dd><dt><span class="term">Interfaces</span></dt><dd><p>How to secure the REST, user and file-based interfaces, and to
      secure the communication protocols involved</p></dd><dt><span class="term">Auditing and Reporting</span></dt><dd><p>Procedures for auditing and reporting, including who takes
      responsibility for auditing and reporting, and what information is
      aggregated and reported. Characteristics of reporting engines provided,
      or definition of the reporting engine to be integrated.</p></dd><dt><span class="term">Technical Requirements</span></dt><dd><p>Other technical requirements for the solution such as how to
      maintain the solution in terms of monitoring, patch management,
      availability, backup, restore and recovery process. This includes any
      other components leveraged such as a ConnectorServer and plug-ins for
      password synchronization on Active Directory, or OpenDJ.</p></dd></dl></div></div><div class="section" id="d0e12006"><div class="titlepage"><div><div><h3 class="title">18.1.3.&nbsp;Design</h3></div></div></div><p>This phase focuses on solution design including on OpenIDM and other
   components. The deliverables for this phase are the architecture and design
   documents, and also success criteria with detailed descriptions and test
   cases to verify when project goals have been met.</p></div><div class="section" id="d0e12011"><div class="titlepage"><div><div><h3 class="title">18.1.4.&nbsp;Build</h3></div></div></div><p>This phase builds and tests the solution prior to moving the solution
   into production.</p></div><div class="section" id="d0e12016"><div class="titlepage"><div><div><h3 class="title">18.1.5.&nbsp;Production</h3></div></div></div><p>This phase deploys the solution into production until an
   application steady state is reached and maintenance routines and procedures
   can be applied.</p></div></div></div><div lang="en" class="chapter" id="chap-troubleshooting"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;19.&nbsp;Troubleshooting</h1></div></div></div><a class="indexterm" name="d0e12025"></a><p>When things are not working check this chapter for tips and answers.</p><div class="section" id="stops-when-backgrounded"><div class="titlepage"><div><div><h2 class="title" style="clear: both">19.1.&nbsp;OpenIDM Stopped in Background</h2></div></div></div><p>When you start OpenIDM in the background without having disabled the
  text console, the job can stop immediately after startup.</p><pre class="cmdline prettyprint">$ ./startup.sh &amp;
[2] 346
$ ./startup.sh
Using OPENIDM_HOME:   /path/to/openidm
Using OPENIDM_OPTS:   -Xmx1024m
Using LOGGING_CONFIG:
 -Djava.util.logging.config.file=/path/to/openidm/conf/logging.properties
Using boot properties at /path/to/openidm/conf/boot/boot.properties
-&gt; 

[2]+  Stopped                 ./startup.sh</pre><p>To resolve this problem, make sure you remove
  <code class="filename">openidm/bundle/org.apache.felix.shell.tui-1.4.1.jar</code>
  before starting OpenIDM, and also remove Felix cache files in
  <code class="filename">openidm/felix-cache/</code>.</p></div><div class="section" id="internal-recon-sync-errors"><div class="titlepage"><div><div><h2 class="title" style="clear: both">19.2.&nbsp;Internal Server Error During Reconciliation or Synchronization</h2></div></div></div><p>You might see an error message such as the following returned from
  reconciliation or synchronization.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "error": "Conflict",
    "description": "Internal Server Error:
        org.forgerock.openidm.sync.SynchronizationException:
        Cowardly refusing to perform reconciliation with an
        empty source object set: Cowardly refusing to perform
        reconciliation with an empty source object set"
}</pre><p>This error can be misleading. This usually means the connector is
  not able to communicate with the target source.</p><p>Check the settings for your connector. For example, with the XML
  connector you get this error if the filename for the source is invalid. With
  the LDAP connector, you can get this error if your connector cannot contact
  the target LDAP server.</p></div><div class="section" id="sync-service-unsatisfied"><div class="titlepage"><div><div><h2 class="title" style="clear: both">19.3.&nbsp;The scr list Command Shows Sync Service As Unsatisfied</h2></div></div></div><p>You might encounter this message in the logs.</p><pre>
WARNING: Loading configuration file /path/to/openidm/conf/sync.json failed
org.forgerock.openidm.config.InvalidException:
 Configuration for org.forgerock.openidm.sync could not be parsed and may not
     be valid JSON : Unexpected character ('}' (code 125)): expected a value
     at [Source: java.io.StringReader@3951f910; line: 24, column: 6]
 at org.forgerock.openidm.config.crypto.ConfigCrypto.parse...
 at org.forgerock.openidm.config.crypto.ConfigCrypto.encrypt...
 at org.forgerock.openidm.config.installer.JSONConfigInstaller.setConfig...</pre><p>This indicates a syntax error in
  <code class="filename">openidm/conf/sync.json</code>. After fixing your configuration,
  change to the <code class="filename">/path/to/openidm/</code> directory, and use the
  <span class="command"><strong>cli.sh validate</strong></span> command to check that your configuration
  files are valid.</p><pre class="cmdline prettyprint">$ cd /path/to/openidm ; ./cli.sh validate
Using boot properties at /path/to/openidm/conf/boot/boot.properties
...................................................................
[Validating] Load JSON configuration files from:
[Validating]  /path/to/openidm/conf
[Validating] audit.json .................................. SUCCESS
[Validating] authentication.json ......................... SUCCESS
[Validating] managed.json ................................ SUCCESS
[Validating] provisioner.openicf-xml.json ................ SUCCESS
[Validating] repo.orientdb.json .......................... SUCCESS
[Validating] router.json ................................. SUCCESS
[Validating] scheduler-reconcile_systemXmlAccounts_managedUser.json  SUCCESS
[Validating] sync.json ................................... SUCCESS</pre></div><div class="section" id="json-parse-error"><div class="titlepage"><div><div><h2 class="title" style="clear: both">19.4.&nbsp;JSON Parsing Error</h2></div></div></div><p>You might encounter this error message in the logs.</p><pre>
"Configuration for org.forgerock.openidm.provisioner.openicf could not be
 parsed and may not be valid JSON : Unexpected character ('}' (code 125)): 
 was expecting double-quote to start field name"</pre><p>The error message usually points precisely to the point where the
  JSON file has the syntax problem. The error above was caused by a excess
  comma in the JSON file, <code class="literal">{"attributeName":{},{},}</code>. The
  second comma is too much.</p><p>The situation usually results in the service the JSON file configures
  being left in the <code class="literal">unsatisfied</code> state.</p><p>After fixing your configuration, change to the
  <code class="filename">/path/to/openidm/</code> directory, and use the <span class="command"><strong>cli.sh
  validate</strong></span> command to check that your configuration files are
  valid.</p></div><div class="section" id="system-not-available"><div class="titlepage"><div><div><h2 class="title" style="clear: both">19.5.&nbsp;System Not Available</h2></div></div></div><p>OpenIDM throws the following error as a result of a reconciliation
  where the source systems configuration can not be found.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "error": "Conflict",
    "description": "Internal Server Error:
        org.forgerock.openidm.sync.SynchronizationException:
        org.forgerock.openidm.objset.ObjectSetException:
        System: system/HR/account is not available.:
        org.forgerock.openidm.objset.ObjectSetException:
        System: system/HR/account is not available.:
        System: system/HR/account is not available."
}</pre><p>This error occurs when the <code class="literal">"name"</code> property value
  in <code class="filename">provisioner.<em class="replaceable"><code>resource</code></em>.json</code>
  is changed from <code class="literal">HR</code> to something else.</p><p> The same error also occurs when a provisioner configuration fails to
  load due to misconfiguration, or when the path to the data file for a
  CSV or XML connector is incorrectly set.</p></div><div class="section" id="bad-connector-host-reference"><div class="titlepage"><div><div><h2 class="title" style="clear: both">19.6.&nbsp;Bad Connector Host Reference in Provisioner Configuration</h2></div></div></div><p>You might see the following error when a provision configuration
  loads.</p><pre>
Wait for meta data for config org.forgerock.openidm.provisioner.openicf-scriptedsql</pre><p>In this case the configuration fails to load because some information
  is missing. One possible cause is a wrong value for
  <code class="literal">connectorHostRef</code> in the provisioner configuration
  file.</p><div class="itemizedlist"><p>For local Java connector servers, the following rules apply.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If the connector .jar is installed as a bundle under
    <code class="filename">openidm/bundle</code>, then the value must be
    <code class="literal">"connectorHostRef" :
    "osgi:service/org.forgerock.openicf.framework.api.osgi.ConnectorManager",</code>.</p></li><li class="listitem"><p>If the connector .jar is installed as a connector under
    <code class="filename">openidm/connectors</code>, then the value must be 
    <code class="literal">"connectorHostRef" : "#LOCAL",</code>.</p><pre class="literallayout"></pre></li></ul></div></div><div class="section" id="missing-name-attribute"><div class="titlepage"><div><div><h2 class="title" style="clear: both">19.7.&nbsp;Missing Name Attribute</h2></div></div></div><p>In this case, the situation in the audit recon log shows "NULL".</p><p>A missing name attribute error, followed by an
  <code class="literal">IllegalArgumentException</code>, points to misconfiguration of
  the correlation rule, with the correlation query pointing to the external
  system. Such queries usually reference the "name" field which, if empty,
  leads to the error below.</p><pre>
Jan 20, 2012 1:59:58 PM
 org.forgerock.openidm.provisioner.openicf.commons.AttributeInfoHelper build
SEVERE: Failed to build name attribute out of [null]
Jan 20, 2012 1:59:58 PM
 org.forgerock.openidm.provisioner.openicf.impl.OpenICFProvisionerService query
SEVERE: Operation [query, system/ad/account] failed with Exception on system
 object: java.lang.IllegalArgumentException: Attribute value must be an
 instance of String.
Jan 20, 2012 1:59:58 PM org.forgerock.openidm.router.JsonResourceRouterService
 handle
WARNING: JSON resource exception
org.forgerock.json.resource.JsonResourceException: IllegalArgumentException
 at org.forgerock.openidm.provisioner....OpenICFProvisionerService.query...
 at org.forgerock.openidm.provisioner.....OpenICFProvisionerService.handle...
 at org.forgerock.openidm.provisioner.impl.SystemObjectSetService.handle...
 at org.forgerock.json.resource.JsonResourceRouter.handle...</pre><p>Check your <code class="literal">correlationQuery</code>. Another symptom of a
  broken correlationQuery is that the audit recon log shows a situation
  of "NULL", and no onCreate, onUpdate or similar scripts are executed.</p></div></div><div lang="en" class="appendix" id="appendix-file-layout"><div class="titlepage"><div><div><h1 class="title">Appendix&nbsp;A.&nbsp;File Layout</h1></div></div></div><a class="indexterm" name="d0e12179"></a><a class="indexterm" name="d0e12182"></a><div class="variablelist"><p>When you unpack and start OpenIDM , you
  create the following files and directories. Note that the precise paths will 
  depend on the install, project, and working directories that you have selected 
  during startup. For more information, see <a href="../integrators-guide/index.html#startup-configuration" class="link">
  <em class="citetitle">Specifying the OpenIDM Startup Configuration</em></a>.</p><dl class="variablelist"><dt><span class="term"><code class="filename">openidm/audit/</code></span></dt><dd><p>OpenIDM audit log directory default location, created at run time, 
     as configured in <code class="filename">openidm/conf/audit.json</code></p></dd><dt><span class="term"><code class="filename">openidm/audit/access.csv</code></span></dt><dd><p>Default OpenIDM access audit log</p></dd><dt><span class="term"><code class="filename">openidm/audit/activity.csv</code></span></dt><dd><p>Default OpenIDM activity audit log</p></dd><dt><span class="term"><code class="filename">openidm/audit/recon.csv</code></span></dt><dd><p>Default OpenIDM reconciliation audit log</p></dd><dt><span class="term"><code class="filename">openidm/bin/</code></span></dt><dd><p>OpenIDM core libraries and scripts</p></dd><dt><span class="term"><code class="filename">openidm/bin/create-openidm-logrotate.sh</code></span></dt><dd><p>Script to create an <code class="filename">openidmlog</code> log 
    rotation scheduler for inclusion under 
    <code class="filename">/etc/logrotate.d/</code></p></dd><dt><span class="term"><code class="filename">openidm/bin/create-openidm-rc.sh</code></span></dt><dd><p>Script to create an <code class="filename">openidm</code> resource 
    definition file for inclusion under <code class="filename">/etc/init.d/</code></p></dd><dt><span class="term"><code class="filename">openidm/bin/defaults/script</code></span></dt><dd><p>Default scripts required to run specific services. In general, you 
    should not modify these scripts. Instead, add customized scripts to the 
    <code class="filename">openidm/script</code> folder.</p></dd><dt><span class="term"><code class="filename">openidm/bin/defaults/script/info/login.js</code></span></dt><dd><p>Provides information about the current OpenIDM session.
    </p></dd><dt><span class="term"><code class="filename">openidm/bin/defaults/script/info/ping.js</code></span></dt><dd><p>Provides basic information about the health of an OpenIDM 
    system</p></dd><dt><span class="term"><code class="filename">openidm/bin/defaults/script/policy.js</code></span></dt><dd><p>Defines each policy and specifies how policy validation is 
    performed</p></dd><dt><span class="term"><code class="filename">openidm/bin/defaults/script/policyFilter.js</code></span></dt><dd><p>Enforces policy validation</p></dd><dt><span class="term"><code class="filename">openidm/bin/defaults/script/router-authz.js</code></span></dt><dd><p>Provides the functions that enforce access rules</p></dd><dt><span class="term"><code class="filename">openidm/bin/defaults/script/ui/*</code></span></dt><dd><p>Scripts required by the UI</p></dd><dt><span class="term"><code class="filename">openidm/bin/defaults/script/workflow/*</code></span></dt><dd><p>Default workflow scripts</p></dd><dt><span class="term"><code class="filename">openidm/bin/felix.jar</code>, </span><span class="term"><code class="filename">openidm/bin/openidm.jar</code>, </span><span class="term"><code class="filename">openidm/bin/org.apache.felix.gogo.runtime-0.10.0.jar</code>, </span><span class="term"><code class="filename">openidm/bin/org.apache.felix.gogo.shell-0.10.0.jar</code></span></dt><dd><p>Files relating to the Apache Felix OSGi framework</p></dd><dt><span class="term"><code class="filename">openidm/bin/launcher.bat</code>, </span><span class="term"><code class="filename">openidm/bin/launcher.jar</code>, </span><span class="term"><code class="filename">openidm/bin/launcher.json</code></span></dt><dd><p>Files relating to the startup configuration</p></dd><dt><span class="term"><code class="filename">openidm/bin/LICENSE.TXT</code>, </span><span class="term"><code class="filename">openidm/bin/NOTICE.TXT</code></span></dt><dd><p>Files relating to the Apache Software License</p></dd><dt><span class="term"><code class="filename">openidm/bin/MonitorService.bat</code>, </span><span class="term"><code class="filename">openidm/bin/prunmgr.exe</code>, </span><span class="term"><code class="filename">openidm/bin/amd64/prunsrv.exe</code>, </span><span class="term"><code class="filename">openidm/bin/i386/prunsrv.exe</code>, </span><span class="term"><code class="filename">openidm/bin/ia64/prunsrv.exe</code></span></dt><dd><p>Files required by the user interface to monitor and 
    configure installed services</p></dd><dt><span class="term"><code class="filename">openidm/bin/startup/</code>, </span><span class="term"><code class="filename">openidm/bin/startup/OS X - Run OpenIDM In Background.command</code>, </span><span class="term"><code class="filename">openidm/bin/startup/OS X - Run OpenIDM In Terminal Window.command</code>, </span><span class="term"><code class="filename">openidm/bin/startup/OS X - Stop OpenIDM.command</code></span></dt><dd><p>Clickable commands for Mac OS X</p></dd><dt><span class="term"><code class="filename">openidm/bin/workflow/</code></span></dt><dd><p>Files related to the Activiti workflow engine</p></dd><dt><span class="term"><code class="filename">openidm/bundle/</code></span></dt><dd><p>OSGi bundles and modules required by OpenIDM. Upgrade can 
    install new and upgraded bundles here.</p></dd><dt><span class="term"><code class="filename">openidm/cli.bat</code>, </span><span class="term"><code class="filename">openidm/cli.sh</code></span></dt><dd><p>Management commands for operations such as validating 
    configuration files</p></dd><dt><span class="term"><code class="filename">openidm/conf/</code></span></dt><dd><p>OpenIDM configuration files, including .properties files and JSON
    files. You can also access JSON views through the REST interface.</p></dd><dt><span class="term"><code class="filename">openidm/conf/audit.json</code></span></dt><dd><p>Audit event publisher configuration file</p></dd><dt><span class="term"><code class="filename">openidm/conf/authentication.json</code></span></dt><dd><p>Authentication configuration file for access to the REST API</p></dd><dt><span class="term"><code class="filename">openidm/conf/boot/boot.properties</code></span></dt><dd><p>OpenIDM bootstrap properties</p></dd><dt><span class="term"><code class="filename">openidm/conf/config.properties</code></span></dt><dd><p>Felix and OSGi bundle configuration properties</p></dd><dt><span class="term"><code class="filename">openidm/conf/endpoint-*.json</code></span></dt><dd><p>Endpoint configuration files required by the UI for the default 
    workflows</p></dd><dt><span class="term"><code class="filename">openidm/conf/jetty.xml</code></span></dt><dd><p>Jetty configuration controlling access to the REST interface</p></dd><dt><span class="term"><code class="filename">openidm/conf/logging-config.xml</code></span></dt><dd><p>Experimental log configuration</p></dd><dt><span class="term"><code class="filename">openidm/conf/logging.properties</code></span></dt><dd><p>OpenIDM log configuration properties</p></dd><dt><span class="term"><code class="filename">openidm/conf/managed.json</code></span></dt><dd><p>Managed object configuration file</p></dd><dt><span class="term"><code class="filename">openidm/conf/policy.json</code></span></dt><dd><p>Default policy configuration</p></dd><dt><span class="term"><code class="filename">openidm/conf/process-access.json</code></span></dt><dd><p>Workflow access configuration</p></dd><dt><span class="term"><code class="filename">openidm/conf/repo.orientdb.json</code></span></dt><dd><p>OrientDB internal repository configuration file</p></dd><dt><span class="term"><code class="filename">openidm/conf/router.json</code></span></dt><dd><p>Router service configuration file</p></dd><dt><span class="term"><code class="filename">openidm/conf/scheduler.json</code></span></dt><dd><p>Scheduler service configuration</p></dd><dt><span class="term"><code class="filename">openidm/conf/system.properties</code></span></dt><dd><p>System configuration properties used when starting OpenIDM
    services</p></dd><dt><span class="term"><code class="filename">openidm/conf/ui-configuration.json</code></span></dt><dd><p>Main configuration file for the browser-based user interface</p></dd><dt><span class="term"><code class="filename">openidm/conf/ui-countries.json</code></span></dt><dd><p>Configurable list of countries available when registering users in 
    the user interface</p></dd><dt><span class="term"><code class="filename">openidm/conf/ui-secquestions.json</code></span></dt><dd><p>Configurable list of security questions available when registering 
    users in the user interface</p></dd><dt><span class="term"><code class="filename">openidm/conf/workflow.json</code></span></dt><dd><p>Configuration of the Activiti workflow engine</p></dd><dt><span class="term"><code class="filename">openidm/connectors/</code></span></dt><dd><p>OpenICF connector libraries. OSGi enabled connector libraries can
    also be stored in <code class="filename">openidm/bundle/</code>.</p></dd><dt><span class="term"><code class="filename">openidm/db/</code></span></dt><dd><p>Internal repository files, including both OrientDB files and data
    definition language scripts for JDBC based repositories such as MySQL</p></dd><dt><span class="term"><code class="filename">openidm/felix-cache/</code></span></dt><dd><p>Bundle cache directory created when the Felix framework is 
    started</p></dd><dt><span class="term"><code class="filename">openidm/logs/</code></span></dt><dd><p>OpenIDM service log directory</p></dd><dt><span class="term"><code class="filename">openidm/logs/openidm0.log.*</code></span></dt><dd><p>OpenIDM service log files as configured in
    <code class="filename">openidm/conf/logging.properties</code></p></dd><dt><span class="term"><code class="filename">openidm/samples/</code></span></dt><dd><p>OpenIDM sample configurations</p></dd><dt><span class="term"><code class="filename">openidm/samples/customendpoint</code></span></dt><dd><p>Sample custom endpoint configuration. For more information, see 
    <a href="../integrators-guide/index.html#adding-custom-endpoints" class="link"><em class="citetitle">Adding Custom Endpoints</em></a>.</p></dd><dt><span class="term"><code class="filename">openidm/samples/infoservice</code></span></dt><dd><p>Sample that shows how to use the configurable information service. 
    For more information, see <a href="../integrators-guide/index.html#info-service" class="link"><em class="citetitle">Obtaining Information About an OpenIDM Instance</em></a>.</p></dd><dt><span class="term"><code class="filename">openidm/samples/misc/</code></span></dt><dd><p>Sample configuration files</p></dd><dt><span class="term"><code class="filename">openidm/samples/openam/</code></span></dt><dd><p>Sample that shows how to protect OpenIDM with OpenAM</p></dd><dt><span class="term"><code class="filename">openidm/samples/provisioners/</code></span></dt><dd><p>Sample connector configuration files</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample1/</code></span></dt><dd><p>XML file connector sample</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample2/</code></span></dt><dd><p>OpenDJ connector sample with no back link</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample2b/</code></span></dt><dd><p>OpenDJ connector sample with back link</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample2c/</code></span></dt><dd><p>OpenDJ connector sample synchronizing users' LDAP group membership</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample2d/</code></span></dt><dd><p>OpenDJ connector sample synchronizing LDAP groups</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample3/</code></span></dt><dd><p>Scripted SQL connector sample for MySQL</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample4/</code></span></dt><dd><p>CSV connector sample</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample5/</code></span></dt><dd><p>LDAP to OpenIDM to Active Directory attribute flow sample using XML
    resources rather than actual directories</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample6/</code></span></dt><dd><p>LiveSync sample for use with one or two LDAP servers</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample7/</code></span></dt><dd><p>Sample exposing identities with a SCIM-line schema</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample8/</code></span></dt><dd><p>Sample demonstrating logging in scripts</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample9/</code></span></dt><dd><p>Sample showing asynchronous reconciliation with workflows</p></dd><dt><span class="term"><code class="filename">openidm/samples/schedules/</code></span></dt><dd><p>Sample schedule configuration files</p></dd><dt><span class="term"><code class="filename">openidm/samples/security/</code></span></dt><dd><p>Sample key store, trust store, and certificates</p></dd><dt><span class="term"><code class="filename">openidm/samples/taskscanner/</code></span></dt><dd><p>Sample sunset scanning task. For more information, see <a href="../integrators-guide/index.html#task-scanner" class="link"><em class="citetitle">Scanning Data to Trigger Tasks</em></a>.</p></dd><dt><span class="term"><code class="filename">openidm/samples/workflow/</code></span></dt><dd><p>Typical use case of a workflow for provisioning</p></dd><dt><span class="term"><code class="filename">openidm/script/</code></span></dt><dd><p>OpenIDM location for JavaScript files referenced in the
    configuration</p></dd><dt><span class="term"><code class="filename">openidm/script/access.js</code></span></dt><dd><p>Default authorization policy script</p></dd><dt><span class="term"><code class="filename">openidm/security/</code></span></dt><dd><p>OpenIDM security configuration, key store, and trust store</p></dd><dt><span class="term"><code class="filename">openidm/shutdown.sh</code></span></dt><dd><p>Script to shutdown OpenIDM services based on the process
    identifier</p></dd><dt><span class="term"><code class="filename">openidm/startup.bat</code></span></dt><dd><p>Script to start OpenIDM services on Windows</p></dd><dt><span class="term"><code class="filename">openidm/startup.sh</code></span></dt><dd><p>Script to start OpenIDM services on UNIX</p></dd><dt><span class="term"><code class="filename">openidm/ui/</code></span></dt><dd><p>OpenIDM graphical UI files</p></dd><dt><span class="term"><code class="filename">openidm/workflow/</code></span></dt><dd><p>OpenIDM location for BPMN 2.0 workflows and .bar files</p></dd></dl></div></div><div lang="en" class="appendix" id="appendix-ports-used"><div class="titlepage"><div><div><h1 class="title">Appendix&nbsp;B.&nbsp;Ports Used</h1></div></div></div><div class="variablelist"><p>By default, OpenIDM  listens on the following
  ports (specified in <code class="filename">/path/to/openidm/conf/boot/boot.properties</code>):</p><dl class="variablelist"><dt><span class="term"><code class="literal">8080</code></span></dt><dd><a class="indexterm" name="d0e12830"></a><p>HTTP access to the REST API, requiring OpenIDM authentication. This
    port is not secure, exposing clear text passwords and all data that is not
    encrypted. This port is therefore not suitable for production use.</p></dd><dt><span class="term"><code class="literal">8443</code></span></dt><dd><a class="indexterm" name="d0e12842"></a><p>HTTPS access to the REST API, requiring OpenIDM authentication</p></dd><dt><span class="term"><code class="literal">8444</code></span></dt><dd><a class="indexterm" name="d0e12854"></a><p>HTTPS access to the REST API, requiring SSL mutual authentication.
    Clients presenting certificates found in the trust store under
    <code class="filename">openidm/security/</code> are granted access to the
    system.</p></dd></dl></div><p>The Jetty configuration (in <code class="filename">openidm/conf/jetty.xml</code>)
    references the ports that are specified in the <code class="filename">boot.properties</code>
    file.</p></div><div lang="en" class="appendix" id="appendix-objects"><div class="titlepage"><div><div><h1 class="title">Appendix&nbsp;C.&nbsp;Data Models and Objects Reference</h1></div></div></div><p>OpenIDM allows you to customize a variety of objects that can be
 addressed via a URL or URI, and that have a common set of functions that
 OpenIDM can perform on them such as CRUD, query, and action.</p><p>Depending on how you intend to use them, different objects are
 appropriate.</p><div class="table" id="table-object-types"><div class="table-title">Table&nbsp;C.1.&nbsp;OpenIDM Objects</div><div class="table-contents"><a class="indexterm" name="d0e12883"></a><table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="OpenIDM Objects" width="100%" border="0"><colgroup><col width="28%"><col width="43%"><col width="29%"></colgroup><thead><tr><th>Object Type</th><th>Intended Use</th><th>Special Functionality</th></tr></thead><tbody><tr><td>Managed objects</td><td>Serve as targets and sources for synchronization, and to build
     virtual identities.</td><td>Provide appropriate auditing, script hooks, declarative mappings
     and so forth in addition to the REST interface.</td></tr><tr><td>Configuration objects</td><td>Ideal for look-up tables or other custom configuration, which
     can be configured externally like any other system configuration.</td><td>Adds file view, REST interface, and so forth</td></tr><tr><td>Repository objects</td><td>The equivalent of arbitrary database table access. Appropriate
     for managing data purely through the underlying data store or repository 
     API.</td><td>Persistence and API access</td></tr><tr><td>System objects</td><td>Representation of target resource objects, such as accounts,
     but also resource objects such as groups.</td><td>&nbsp;</td></tr><tr><td>Audit objects</td><td>Houses audit data in the OpenIDM internal repository.</td><td>&nbsp;</td></tr><tr><td>Links</td><td>Defines a relation between two objects.</td><td>&nbsp;</td></tr></tbody></table></div></div><br class="table-break"><div class="section" id="managed-objects"><div class="titlepage"><div><div><h2 class="title" style="clear: both">C.1.&nbsp;Managed Objects</h2></div></div></div><a class="indexterm" name="d0e12946"></a><p>A <em class="firstterm">managed object</em> in OpenIDM is an object which
  represents the identity-related data managed by OpenIDM. Managed objects
  are stored by OpenIDM in its data store. All managed objects are JSON-based
  data structures.</p><div class="section" id="managed-object-schema"><div class="titlepage"><div><div><h3 class="title">C.1.1.&nbsp;Managed Object Schema</h3></div></div></div><p>Managed objects have an associated schema to enforce a specific
   data structure. Schema is specified using the <a class="link" href="http://tools.ietf.org/html/draft-zyp-json-schema-03" target="_blank">JSON
   Schema</a> specification. This is currently an Internet-Draft, with
   implementations in multiple programming languages.</p><div class="section" id="managed-object-reserved-properties"><div class="titlepage"><div><div><h4 class="title">C.1.1.1.&nbsp;Managed Object Reserved Properties</h4></div></div></div><p>Top-level properties in a managed object that begin with an underscore
    ( <code class="literal">_</code> ) are reserved by OpenIDM for internal use, and are
    not explicitly part of its schema. Internal properties are read-only, and
    are ignored when provided by the REST API client.</p><div class="variablelist"><p>The following properties exist for all managed objects in
     OpenIDM.</p><dl class="variablelist"><dt><span class="term">_id</span></dt><dd><p>string</p><p>The unique identifier for the object. This value forms a part
       of the managed object's URI.</p></dd><dt><span class="term">_rev</span></dt><dd><p>string</p><p>The revision of the object. This is the same value that is
       exposed as the object's ETag through the REST API. The content of this
       attribute is not defined. No consumer should make any assumptions
       of its content beyond equivalence comparison. This attribute may
       be provided by the underlying data store.</p></dd><dt><span class="term">_schema_id</span></dt><dd><p>string</p><p>The a reference to the schema object that the managed object
       is associated with.</p></dd><dt><span class="term">_schema_rev</span></dt><dd><p>string</p><p>The revision of the schema that was used for validation when
       the object was last stored.</p></dd></dl></div></div><div class="section" id="managed-object-schema-validation"><div class="titlepage"><div><div><h4 class="title">C.1.1.2.&nbsp;Managed Object Schema Validation</h4></div></div></div><p>Schema validation is performed unequivocally whenever an object
    is stored, and conditionally whenever an object is retrieved from the
    data store and exhibits a <code class="literal">_schema_rev</code> value that
    differs from the <code class="literal">_rev</code> of the schema that the OpenIDM
    instance currently has for that managed object type. Whenever schema
    validation is performed, the <code class="literal">_schema_rev</code> of the object
    is updated to contain the <code class="literal">_rev</code> value of the current
    schema.</p></div><div class="section" id="managed-object-derived-properties"><div class="titlepage"><div><div><h4 class="title">C.1.1.3.&nbsp;Managed Object Derived Properties</h4></div></div></div><p>Properties can be defined to be strictly derived from other
    properties within the object. This allows computed and composite
    values to be created in the object. Whenever an object undergoes a
    change, all derived properties are recomputed. The values of derived
    properties are stored in the data store, and are not recomputed upon
    retrieval.</p></div></div><div class="section" id="managed-object-data-consistency"><div class="titlepage"><div><div><h3 class="title">C.1.2.&nbsp;Data Consistency</h3></div></div></div><p>Single-object operations shall be consistent within the scope of
   the operation performed, limited by capabilities of the underlying
   data store. Bulk operations shall not have any consistency
   guarantees. OpenIDM does not expose any transactional semantics
   in the managed object access API.</p><p>All access through the REST API uses the ETag and associated
   conditional headers: <code class="literal">If-Match</code>,
   <code class="literal">If-None-Match</code>. In operations that
   modify model objects, conditional headers are mandatory.</p></div><div class="section" id="managed-object-triggers"><div class="titlepage"><div><div><h3 class="title">C.1.3.&nbsp;Managed Object Triggers</h3></div></div></div><p><em class="firstterm">Triggers</em> are user-definable functions that
   validate or modify object or property state.</p><div class="section" id="managed-object-state-triggers"><div class="titlepage"><div><div><h4 class="title">C.1.3.1.&nbsp;State Triggers</h4></div></div></div><p>Managed objects are resource-oriented. A set of triggers is
    defined to intercept the supported request methods on managed
    objects. Such triggers are intended to perform authorization, redact,
    or modify objects before the action is performed. The object
    being operated on is in scope for each trigger, meaning that the
    object is retrieved by the data store before the trigger is fired.</p><p>If retrieval of the object fails, the failure occurs before any
    trigger is called. Triggers are executed before any optimistic
    concurrency mechanisms are invoked. The reason for this is to
    prevent a potential attacker from getting information about an
    object (including its presence in the data store) before
    authorization is applied.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">onCreate</span></dt><dd><p>Called upon a request to create a new object. Throwing an
       exception causes the create to fail.</p></dd><dt><span class="term">onRead</span></dt><dd><p>Called upon a request to retrieve a whole object or portion of
       an object. Throwing an exception causes the object to not be
       included in the result. This method is also called when lists of
       objects are retrieved via requests to its container object; in this
       case, only the requested properties are included in the object.
       Allows for uniform access control for retrieval of objects,
       regardless of the method in which they were requested.</p></dd><dt><span class="term">onUpdate</span></dt><dd><p>Called upon a request to store an object. The "old" and "new"
       objects are in-scope for the trigger. The "old" object represents a
       complete object as retrieved from the data store. The trigger can
       elect to change "new" object properties. If as a result of the
       trigger the object's "old" and "new" values are identical (that is,
       update is reverted), the update ends prematurely, though
       successfully. Throwing an exception causes the update to fail.</p></dd><dt><span class="term">onDelete</span></dt><dd><p>Called upon a request to delete an object. Throwing an
       exception causes the deletion to fail.</p></dd></dl></div></div><div class="section" id="managed-object-storage-triggers"><div class="titlepage"><div><div><h4 class="title">C.1.3.2.&nbsp;Object Storage Triggers</h4></div></div></div><div class="variablelist"><p>An object-scoped trigger applies to an entire object. Unless
    otherwise specified, the object itself is in scope for the trigger.</p><dl class="variablelist"><dt><span class="term">onValidate</span></dt><dd><p>Validates an object prior to its storage in the data store.
           Throws an exception in the event of a validation failure.</p></dd><dt><span class="term">onRetrieve</span></dt><dd><p>Called when an object is retrieved from the data store.
       Typically used to transform an object after it has been retrieved
       (for example decryption, JIT data conversion).</p></dd><dt><span class="term">onStore</span></dt><dd><p>Called just prior to when an object is stored in the data
        store. Typically used to transform an object just prior to its
        storage (for example, encryption).</p></dd></dl></div></div><div class="section" id="managed-object-property-storage-triggers"><div class="titlepage"><div><div><h4 class="title">C.1.3.3.&nbsp;Property Storage Triggers</h4></div></div></div><p>A property-scoped trigger applies to a specific property within
    an object. Only the property itself is in scope for the trigger. No
    other properties in the object should be accessed during execution
    of the trigger. Unless otherwise specified, the order of execution
    of property-scoped triggers is intentionally left undefined.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">onValidate</span></dt><dd><p>Validates a given property value after its retrieval from and
       prior to its storage in the data store. Throws an exception in the
       event of a validation failure.</p></dd><dt><span class="term">onRetrieve</span></dt><dd><p>Called after an object is retrieved from the data store.
       Typically used to transform a given property after its object's
       retrieval.</p></dd><dt><span class="term">onStore</span></dt><dd><p>Called prior to when an object is stored in the data store.
           Typically used to transform a given property prior to its
           object's storage.</p></dd></dl></div></div><div class="section" id="managed-object-storage-trigger-sequences"><div class="titlepage"><div><div><h4 class="title">C.1.3.4.&nbsp;Storage Trigger Sequences</h4></div></div></div><p>Triggers are executed in the following order:</p><div class="orderedlist" id="managed-object-retrieval-sequence"><div class="orderedlist-title">Object Retrieval Sequence</div><ol class="orderedlist" type="1"><li class="listitem"><p>Retrieve the raw object from the data store</p></li><li class="listitem"><p>Call object <code class="literal">onRetrieve</code> trigger</p></li><li class="listitem"><p>Per-property within the object:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Call property <code class="literal">onRetrieve</code> trigger</p></li><li class="listitem"><p>Perform schema validation if <code class="literal">_schema_rev</code>
        does not match (see the <a class="link" href="#managed-object-schema-validation" title="C.1.1.2.&nbsp;Managed Object Schema Validation"><em class="citetitle">Schema
        Validation</em></a> section)</p></li></ul></div></li></ol></div><div class="orderedlist" id="managed-object-storage-sequence"><div class="orderedlist-title">Object Storage Sequence</div><ol class="orderedlist" type="1"><li class="listitem"><p>Per-property within the object:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Call property <code class="literal">onValidate</code> trigger</p></li><li class="listitem"><p>Call object <code class="literal">onValidate</code> trigger</p></li></ul></div></li><li class="listitem"><p>Per-property trigger within the object:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Call property <code class="literal">onStore</code> trigger</p></li><li class="listitem"><p>Call object <code class="literal">onStore</code> trigger</p></li><li class="listitem"><p>Store the object with any resulting changes to the data
          store</p></li></ul></div></li></ol></div></div></div><div class="section" id="managed-object-encryption"><div class="titlepage"><div><div><h3 class="title">C.1.4.&nbsp;Managed Object Encryption</h3></div></div></div><p>Sensitive object properties can be encrypted prior to storage,
   typically through the property <code class="literal">onStore</code> trigger. The
   trigger has access to configuration data, which can include arbitrary
   attributes that you define, such as a symmetric encryption key. Such
   attributes can be decrypted during retrieval from the data store through
   the property <code class="literal">onRetrieve</code> trigger.</p></div><div class="section" id="managed-object-configuration"><div class="titlepage"><div><div><h3 class="title">C.1.5.&nbsp;Managed Object Configuration</h3></div></div></div><p>Configuration of managed objects is provided through an array of
   managed object configuration objects.</p><pre class="codelisting prettyprint linenums lang-js">
{
  "objects": [ managed-object-config object, ... ]
}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">objects</span></dt><dd><p>array of managed-object-config objects, required</p><p>Specifies the objects that the managed object service
       manages.</p></dd></dl></div><div class="variablelist" id="managed-object-config-object-properties"><div class="variablelist-title">Managed-Object-Config Object Properties</div><p>Specifies the configuration of each managed object.</p><pre class="codelisting prettyprint linenums lang-js">
{
  "name"      : string,
  "schema"    : json-schema object,
  "onCreate"  : script object,
  "onRead"    : script object,
  "onUpdate"  : script object,
  "onDelete"  : script object,
  "onValidate": script object,
  "onRetrieve": script object,
  "onStore"   : script object,
  "properties": [ property-configuration object, ... ]
}</pre><dl class="variablelist"><dt><span class="term">name</span></dt><dd><p>string, required</p><p>The name of the managed object. Used to identify the
      managed object in URIs and identifiers.</p></dd><dt><span class="term">schema</span></dt><dd><p>json-schema object, optional</p><p>The schema to use to validate the structure and content of
      the managed object. The schema-object format is specified by the
      JSON Schema specification.</p></dd><dt><span class="term">onCreate</span></dt><dd><p>script object, optional</p><p>A script object to trigger when the creation of an object
      is being requested. The object to be created is provided in the
      root scope as an object property. The script may change the
      object. If an exception is thrown, the create aborts with an
      exception.</p></dd><dt><span class="term">onRead</span></dt><dd><p>script object, optional</p><p>A script object to trigger when the read of an object is
      being requested. The object being read is provided in the root
      scope as an object property. The script may change the object.
      If an exception is thrown, the read aborts with an
      exception.</p></dd><dt><span class="term">onUpdate</span></dt><dd><p>script object, optional</p><p>A script object to trigger when an update to an object is
      requested. The old value of the object being updated is provided
      in the root scope as an <code class="literal">oldObject</code> property. The new
      value of the object being updated is provided in the root scope as a
      <code class="literal">newObject</code> property. The script may change the
      <code class="literal">newObject</code>. If an exception is thrown, the update
      aborts with an exception.</p></dd><dt><span class="term">onDelete</span></dt><dd><p>script object, optional</p><p>A script object to trigger when the deletion of an object
      is being requested. The object being deleted is provided in the
      root scope as an object property. If an exception is thrown, the
      deletion aborts with an exception.</p></dd><dt><span class="term">onValidate</span></dt><dd><p>script object, optional</p><p>A script object to trigger when the object requires
      validation. The object to be validated is provided in the root
      scope as an object property. If an exception is thrown, the
      validation fails.</p></dd><dt><span class="term">onRetrieve</span></dt><dd><p>script object, optional</p><p>A script object to trigger once an object is retrieved from
      the repository. The object that was retrieved is provided in the
      root scope as an object property. The script may change the
      object. If an exception is thrown, then object retrieval
      fails.</p></dd><dt><span class="term">onStore</span></dt><dd><p>script object, optional</p><p>A script object to trigger when an object is about to be
      stored in the repository. The object to be stored is provided in
      the root scope as an object property. The script may change the
      object. If an exception is thrown, then object storage
      fails.</p></dd><dt><span class="term">properties</span></dt><dd><p>array of property-config objects, optional</p><p>A list of property specifications.</p></dd></dl></div><div class="variablelist" id="managed-object-script-object-properties"><div class="variablelist-title">Script Object Properties</div><pre class="codelisting prettyprint linenums lang-js">
{
  "type"  : "text/javascript",
  "source": string
 }</pre><dl class="variablelist"><dt><span class="term">type</span></dt><dd><p>string, required</p><p>Specifies the type of script to be executed. Currently, only
      <code class="literal">"text/javascript"</code> is supported.</p></dd><dt><span class="term">source, file</span></dt><dd><p>string, required (only one, source or file is required)</p><p>Specifies the source code of the script to be executed (if the 
      keyword is "source"), or a pointer to the file that contains the script 
      (if the keyword is "file").</p></dd></dl></div><div class="variablelist" id="managed-object-property-config-properties"><div class="variablelist-title">Property Config Properties</div><pre class="codelisting prettyprint linenums lang-js">
{
  "name"      : string,
  "onValidate": script object,
  "onRetrieve": script object,
  "onStore"   : script object,
  "encryption": property-encryption object
}</pre><dl class="variablelist"><dt><span class="term">name</span></dt><dd><p>string, required</p><p>The name of the property being configured.</p></dd><dt><span class="term">onValidate</span></dt><dd><p>script object, optional</p><p>A script object to trigger when the property requires
      validation. The property to be validated is provided in the root
      scope as the <code class="literal">property</code> property. If an exception is
      thrown, the validation fails.</p></dd><dt><span class="term">onRetrieve</span></dt><dd><p>script object, optional</p><p>A script object to trigger once a property is retrieved
       from the repository. The property that was retrieved is provided
       in the root scope as the <code class="literal">property</code> property. The
       script may change the property value. If an exception is thrown, then
       object retrieval fails.</p></dd><dt><span class="term">onStore</span></dt><dd><p>script object, optional</p><p>A script object to trigger when a property is about to be
       stored in the repository. The property to be stored is provided
       in the root scope as the <code class="literal">property</code> property. The
       script may change the property value. If an exception is thrown, then
       object storage fails.</p></dd><dt><span class="term">encryption</span></dt><dd><p>property-encryption object, optional</p><p>Specifies the configuration for encryption of the property
       in the repository. If omitted or null, the property is not
       encrypted.</p></dd></dl></div><div class="variablelist" id="managed-object-property-encryption-properties"><div class="variablelist-title">Property Encryption Object</div><pre class="codelisting prettyprint linenums lang-js">
{
  "cipher": string,
  "key"   : string
}</pre><dl class="variablelist"><dt><span class="term">cipher</span></dt><dd><p>string, optional</p><p>The cipher transformation used to encrypt the property. If
      omitted or null, the default cipher of
      <code class="literal">"AES/CBC/PKCS5Padding"</code> is used.</p></dd><dt><span class="term">key</span></dt><dd><p>string, required</p><p>The alias of the key in the OpenIDM cryptography service
      keystore used to encrypt the property.</p></dd></dl></div></div><div class="section" id="custom-managed-objects"><div class="titlepage"><div><div><h3 class="title">C.1.6.&nbsp;Custom Managed Objects</h3></div></div></div><a class="indexterm" name="d0e13494"></a><p>Managed objects in OpenIDM are inherently fully user definable and
   customizable. Like all OpenIDM objects, managed objects can maintain
   relationships to each other in the form of links. Managed objects are
   intended for use as targets and sources for synchronization operations to
   represent domain objects, and to build up virtual identities. The name comes
   from the intention that OpenIDM stores and manages these objects, as opposed
   to system objects that are present in external systems.</p><p>OpenIDM can synchronize and map directly between external systems
   (system objects), without storing intermediate managed objects. Managed
   objects are appropriate, however, as a way to cache the data&#8212;for
   example, when mapping to multiple target systems, or when decoupling the
   availability of systems&#8212;to more fully report and audit on all object
   changes during reconciliation, and to build up views that are different from
   the original source, such transformed and combined or virtual views. Managed
   objects can also be allowed to act as an authoritative source if no other
   appropriate source is available.</p><p>Other object types exist for other settings that should be available
   to a script, such as configuration or look-up tables that do not need audit
   logging.</p><div class="section" id="managed-objects-setup"><div class="titlepage"><div><div><h4 class="title">C.1.6.1.&nbsp;Setting Up a Managed Object Type</h4></div></div></div><p>To set up a managed object, you declare the object in the
    <code class="filename">conf/managed.json</code> file where OpenIDM is installed.
    The following example adds a simple <code class="literal">foobar</code> object
    declaration after the user object type.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "objects": [
        {
            "name": "user"
        },
        {
            "name": "foobar"
        }
    ]
}</pre></div><div class="section" id="managed-objects-declarative"><div class="titlepage"><div><div><h4 class="title">C.1.6.2.&nbsp;Manipulating Managed Objects Declaratively</h4></div></div></div><p>By mapping an object to another object, either an external system
    object or another internal managed object, you automatically tie the object
    life cycle and property settings to the other object. See the chapter on
    <a href="../integrators-guide/index.html#chap-synchronization" class="link"><em class="citetitle">Configuring Synchronization</em></a> for
    details.</p></div><div class="section" id="managed-objects-programmatic"><div class="titlepage"><div><div><h4 class="title">C.1.6.3.&nbsp;Manipulating Managed Objects Programmatically</h4></div></div></div><p>You can address managed objects as resources using URLs or URIs with
    the <code class="literal">managed/</code> prefix. This works whether you address the
    managed object internally as a script running in OpenIDM or externally
    through the REST interface.</p><p>You can use all resource API functions in script objects for
    create, read, update, delete operations, and also for arbitrary queries on
    the object set, but not currently for arbitrary actions. See the
    <a href="../integrators-guide/index.html#appendix-scripting" class="link"><em class="citetitle">Scripting Reference</em></a> appendix for
    details.</p><p>OpenIDM supports concurrency through a multi version concurrency
    control (MVCC) mechanism. In other words, each time an object changes,
    OpenIDM assigns it a new revision.</p><p>Objects can be arbitrarily complex as long as they use supported
    types, such as maps, lists, numbers, strings, and booleans as defined in
    <a class="link" href="http://www.json.org" target="_blank">JSON</a>.</p><div class="section" id="managed-objects-programmatic-create"><div class="titlepage"><div><div><h5 class="title">Creating Objects</h5></div></div></div><p>The following script example creates an object type.</p><pre class="codelisting prettyprint linenums lang-js">
openidm.create("managed/foobar/myidentifier", mymap)</pre></div><div class="section" id="managed-objects-programmatic-update"><div class="titlepage"><div><div><h5 class="title">Updating Objects</h5></div></div></div><p>The following script example updates an object type.</p><pre class="codelisting prettyprint linenums lang-js">var expectedRev = origMap._rev
openidm.update("managed/foobar/myidentifier", expectedRev, mymap)</pre><p>The MVCC mechanism requires that <code class="literal">expectedRev</code>
     be set to the expected revision of the object to update. You obtain the
     revision from the object's <code class="literal">_rev</code> property. If something
     else changes the object concurrently, OpenIDM rejects the update, and you
     must either retry or inspect the concurrent modification.</p></div><div class="section" id="managed-objects-programmatic-patch"><div class="titlepage"><div><div><h5 class="title">Patching Objects</h5></div></div></div><p>You can partially update a managed object using the patch method, 
     which changes only the specified properties of the object. OpenIDM 
     implements the JSON patch media type version 02, described at 
     <a class="link" href="https://tools.ietf.org/html/draft-pbryan-json-patch-02" target="_top">
     https://tools.ietf.org/html/draft-pbryan-json-patch-02</a>.</p><p>The following script example updates an object type.</p><pre class="codelisting prettyprint linenums lang-js">
openidm.patch("managed/foobar/myidentifier", rev, value)</pre><p>The patch method supports a revision of <code class="literal">"null"</code>, 
     which effectively disables the MVCC mechanism, that is, changes are 
     applied, regardless of revision. In the REST interface, this matches the 
     <code class="literal">If-Match: "*"</code> condition supported by patch.</p><p>The API supports patch by query, so the caller does not need to 
     know the identifier of the object to change.</p><pre class="cmdline prettyprint">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST -d '[{"replace":"/password","value": "Passw0rd"}]' 
 "http://localhost:8080/openidm/managed/user?_action=patch&amp;_queryId=for-userName&amp;uid=DDOE"</pre><p>For the syntax on how to formulate the query
      <code class="literal">_queryId=for-userName&amp;uid=DDOE</code> see
      <a class="xref" href="#managed-objects-programmatic-query" title="Querying Object Sets">the section called &#8220;Querying Object Sets&#8221;</a>.</p></div><div class="section" id="managed-objects-programmatic-delete"><div class="titlepage"><div><div><h5 class="title">Deleting Objects</h5></div></div></div><p>The following script example deletes an object type.</p><pre class="codelisting prettyprint linenums lang-js">var expectedRev = origMap._rev
openidm.delete("managed/foobar/myidentifier", expectedRev)</pre><p>The MVCC mechanism requires that <code class="literal">expectedRev</code>
     be set to the expected revision of the object to update. You obtain the
     revision from the object's <code class="literal">_rev</code> property. If something
     else changes the object concurrently, OpenIDM rejects deletion, and you
     must either retry or inspect the concurrent modification.</p></div><div class="section" id="managed-objects-programmatic-read"><div class="titlepage"><div><div><h5 class="title">Reading Objects</h5></div></div></div><p>The following script example reads an object type.</p><pre class="codelisting prettyprint linenums lang-js">
val = openidm.read("managed/foobar/myidentifier")</pre></div><div class="section" id="managed-objects-programmatic-query"><div class="titlepage"><div><div><h5 class="title">Querying Object Sets</h5></div></div></div><p>The following script example queries object type instances.</p><pre class="codelisting prettyprint linenums lang-js">
var params = {
    "_queryId": "my-custom-query-id",
    "mycustomtoken": "samplevalue"
};
val = openidm.query("managed/foobar", params);</pre><p>The example sets up a query with ID
     <code class="literal">my-custom-query-id</code>. The query definition (not shown)
     is found in the repository configuration. The query definition includes
     the parameter <code class="literal">mycustomtoken</code> for token
     substitution.</p><p>An example for a query can be found in chapter <a href="../integrators-guide/index.html#correlation-query-managed-object" class="link">
  <em class="citetitle">Managed Object as Correlation Query Target</em>
</a>.</p></div></div></div><div class="section" id="managed-objects-access-rest"><div class="titlepage"><div><div><h3 class="title">C.1.7.&nbsp;Accessing Managed Objects Through the REST API</h3></div></div></div><p>OpenIDM exposes all managed object functionality through the REST API
   unless you configure a policy to prevent such access. In addition to the
   common REST functionality of create, read, update, delete, patch, and query,
   the REST API also supports patch by query. See the <a href="../integrators-guide/index.html#appendix-rest" class="link"><em class="citetitle">REST
   API Reference</em></a> appendix for details.</p><p>OpenIDM requires authentication to access the REST API. Authentication
   configuration is shown in
   <code class="filename">openidm/conf/authentication.json</code>. The default
   authorization filter script is
   <code class="filename">openidm/script/router-authz.js</code>.</p></div></div><div class="section" id="configuration-objects-reference"><div class="titlepage"><div><div><h2 class="title" style="clear: both">C.2.&nbsp;Configuration Objects</h2></div></div></div><p>OpenIDM provides an extensible configuration to allow you to leverage
  regular configuration mechanisms.</p><p>Unlike native OpenIDM configuration, which OpenIDM interprets
  automatically and can start new services, OpenIDM stores custom configuration
  objects and makes them available to your code through the API.</p><p>See the chapter on <a href="../integrators-guide/index.html#chap-configuration" class="link"><em class="citetitle">Configuration Options</em></a> for an introduction
  to standard configuration objects.</p><div class="section" id="configuration-objects-when-to-use"><div class="titlepage"><div><div><h3 class="title">C.2.1.&nbsp;When To Use Custom Configuration Objects</h3></div></div></div><p>Configuration objects are ideal for metadata and settings that need
   not be included in the data to reconcile. In other words, use configuration
   objects for data that does not require audit log, and does not serve
   directly as a target or source for mappings.</p><p>Although you can set and manipulate configuration objects both
   programmatically and also manually, configuration objects are expected to
   change slowly, perhaps through a mix of both manual file updates and also
   programmatic updates. To store temporary values that can change frequently
   and that you do not expect to be updated by configuration file changes,
   custom repository objects can be more appropriate.</p></div><div class="section" id="configuration-objects-naming"><div class="titlepage"><div><div><h3 class="title">C.2.2.&nbsp;Custom Configuration Object Naming Conventions</h3></div></div></div><p>By convention custom configuration objects are added under the
   reserved context, <code class="literal">config/custom</code>.</p><p>You can choose any name under
   <code class="literal">config/<em class="replaceable"><code>context</code></em></code>. Be sure,
   however, to choose a value for <em class="replaceable"><code>context</code></em> that
   does not clash with future OpenIDM configuration names.</p></div><div class="section" id="configuration-objects-file-mapping"><div class="titlepage"><div><div><h3 class="title">C.2.3.&nbsp;Mapping Configuration Objects To Configuration Files</h3></div></div></div><p>If you have not disabled the file based view for configuration, you
   can view and edit all configuration including custom configuration in
   <code class="filename">openidm/conf/*.json</code> files. The configuration maps to a
   file named
   <code class="filename"><em class="replaceable"><code>context</code></em>-<em class="replaceable"><code>config-name</code></em>.json</code>,
   where <em class="replaceable"><code>context</code></em> for custom configuration objects
   is <code class="literal">custom</code> by convention, and
   <em class="replaceable"><code>config-name</code></em> is the configuration object name.
   A configuration object named <code class="literal">escalation</code> thus maps to a
   file named <code class="filename">conf/custom-escalation.json</code>.</p><p>OpenIDM detects and automatically picks up changes to the file.</p><p>OpenIDM also applies changes made through APIs to the file.</p><p>By default, OpenIDM stores configuration objects in the repository.
   The file view is an added convenience aimed to help you in the development
   phase of your project.</p></div><div class="section" id="configuration-objects-formats"><div class="titlepage"><div><div><h3 class="title">C.2.4.&nbsp;Configuration Objects File &amp; REST Payload Formats</h3></div></div></div><p>By default, OpenIDM maps configuration objects to JSON
   representations.</p><p>OpenIDM represents objects internally in plain, native types like
   maps, lists, strings, numbers, booleans, null. OpenIDM constrains the
   object model to simple types so that mapping objects to external
   representations is trivial.</p><p>The following example shows a representation of a configuration
   object with a look-up map.</p><pre class="codelisting prettyprint linenums lang-js">{
    "CODE123" : "ALERT",
    "CODE889" : "IGNORE"
}</pre><p>In the JSON representation, maps are represented with braces
   (<code class="literal">{ }</code>), and lists are represented with brackets
   (<code class="literal">[ ]</code>). Objects can be arbitrarily complex, as in the
   following example.</p><pre class="codelisting prettyprint linenums lang-js">{
    "CODE123" : {
        "email" : ["sample@sample.com", "john.doe@somedomain.com"],
        "sms" : ["555666777"]
    }
    "CODE889" : "IGNORE"
}</pre></div><div class="section" id="configuration-objects-access-rest"><div class="titlepage"><div><div><h3 class="title">C.2.5.&nbsp;Accessing Configuration Objects Through the REST API</h3></div></div></div><p>You can list all available configuration objects, including system
   and custom configurations, using an HTTP GET on
   <code class="literal">/openidm/config</code>.</p><p>The <code class="literal">_id</code> property in the configuration object
   provides the link to the configuration details with an HTTP GET on
   <code class="literal">/openidm/config/<em class="replaceable"><code>id-value</code></em></code>.
   By convention, the <em class="replaceable"><code>id-value</code></em> for a custom
   configuration object called <code class="literal">escalation</code> is
   <code class="literal">custom/escalation</code>.</p><p>OpenIDM supports REST mappings for create, read, update, and delete
   of configuration objects. Currently OpenIDM does not support patch and
   custom query operations for configuration objects.</p></div><div class="section" id="configuration-objects-access-programmatic"><div class="titlepage"><div><div><h3 class="title">C.2.6.&nbsp;Accessing Configuration Objects Programmatically</h3></div></div></div><p>You can address configuration objects as resources using the URL or
   URI <code class="literal">config/</code> prefix both internally and also through
   the REST interface. The resource API provides script object functions for
   create, read, update, and delete operations.</p><p>OpenIDM supports concurrency through a multi version concurrency
   control mechanism. In other words, each time an object changes, OpenIDM
   assigns it a new revision.</p><p>Objects can be arbitrarily complex as long as they use supported
   types, such as maps, lists, numbers, strings, and booleans.</p></div><div class="section" id="configuration-objects-programmatic-create"><div class="titlepage"><div><div><h3 class="title">C.2.7.&nbsp;Creating Objects</h3></div></div></div><p>The following script example creates an object type.</p><pre class="codelisting prettyprint linenums lang-js">
openidm.create("config/custom/myconfig", mymap)</pre></div><div class="section" id="configuration-objects-programmatic-update"><div class="titlepage"><div><div><h3 class="title">C.2.8.&nbsp;Updating Objects</h3></div></div></div><p>The following script example updates a custom configuration object
    type.</p><pre class="codelisting prettyprint linenums lang-js">openidm.update("config/custom/myconfig", mymap)</pre></div><div class="section" id="configuration-objects-programmatic-delete"><div class="titlepage"><div><div><h3 class="title">C.2.9.&nbsp;Deleting Objects</h3></div></div></div><p>The following script example deletes a custom configuration object
    type.</p><pre class="codelisting prettyprint linenums lang-js">openidm.delete("config/custom/myconfig")</pre></div><div class="section" id="configuration-objects-programmatic-read"><div class="titlepage"><div><div><h3 class="title">C.2.10.&nbsp;Reading Objects</h3></div></div></div><p>The following script example reads an object type.</p><pre class="codelisting prettyprint linenums lang-js">
val = openidm.read("config/custom/myconfig")</pre></div></div><div class="section" id="system-objects"><div class="titlepage"><div><div><h2 class="title" style="clear: both">C.3.&nbsp;System Objects</h2></div></div></div><a class="indexterm" name="d0e13836"></a><p><em class="firstterm">System objects</em> are pluggable representations of
 objects on external systems. They follow the same RESTful resource based
 design principles as managed objects. There is a default implementation for
 the OpenICF framework, which allows any connector object to be represented
 as a system object.</p></div><div class="section" id="audit-objects"><div class="titlepage"><div><div><h2 class="title" style="clear: both">C.4.&nbsp;Audit Objects</h2></div></div></div><a class="indexterm" name="d0e13848"></a><p>Audit objects house audit data selected for local storage in the
 OpenIDM repository. For details, see the chapter on <a href="../integrators-guide/index.html#chap-auditing" class="link"><em class="citetitle">Using Audit
 Logs</em></a>.</p></div><div class="section" id="links"><div class="titlepage"><div><div><h2 class="title" style="clear: both">C.5.&nbsp;Links</h2></div></div></div><a class="indexterm" name="d0e13862"></a><p>Link objects define relations between source objects and target
 objects, usually relations between managed objects and system objects.
 The link relationship is established by provisioning activity that either
 results in a new account on a target system, or a reconciliation or
 synchronization scenario that takes a <code class="literal">LINK</code> action.</p></div></div><div lang="en" class="appendix" id="appendix-synchronization"><div class="titlepage"><div><div><h1 class="title">Appendix&nbsp;D.&nbsp;Synchronization Reference</h1></div></div></div><a class="indexterm" name="d0e13876"></a><p>The synchronization engine is one of the core services of OpenIDM. You 
 configure the synchronization service through a <code class="literal">mappings</code> 
 property that specifies mappings between objects that are managed by the 
 synchronization engine.</p><pre class="codelisting prettyprint linenums lang-js">{
  "mappings": [ object-mapping object, ... ]
}</pre><div class="section" id="sync-object-mapping"><div class="titlepage"><div><div><h2 class="title" style="clear: both">D.1.&nbsp;Object-Mapping Objects</h2></div></div></div><p>An object-mapping object specifies the configuration for a mapping of
  source objects to target objects.</p><pre class="codelisting prettyprint linenums lang-js"> {
  "name"            : string,
  "source"          : string,
  "target"          : string,
  "links"           : string,
  "validSource"     : script object,
  "validTarget"     : script object,
  "correlationQuery": script object,
  "properties"      : [ property object, ... ],
  "policies"        : [ policy object, ... ],
  "onCreate"        : script object,
  "onUpdate"        : script object,
  "onLink"          : script object,
  "onUnlink"        : script object
}</pre><div class="variablelist" id="mapping-object-properties"><div class="variablelist-title">Mapping Object Properties</div><dl class="variablelist"><dt><span class="term">name</span></dt><dd><p>string, required</p><p>Uniquely names the object mapping. Used in the link object
      identifier.</p></dd><dt><span class="term">source</span></dt><dd><p>string, required</p><p>Specifies the path of the source object set. Example:
      <code class="literal">"managed/user"</code>.</p></dd><dt><span class="term">target</span></dt><dd><p>string, required</p><p>Specifies the path of the target object set. Example:
      <code class="literal">"system/ldap/account"</code>.</p></dd><dt><span class="term">links</span></dt><dd><p>string, optional</p><p>Enables reuse of the links created in another mapping. 
      Example: <code class="literal">"systemLdapAccounts_managedUser"</code> reuses the 
      links created by a previous mapping whose <code class="literal">name</code> is 
      <code class="literal">"systemLdapAccounts_managedUser"</code>.</p></dd><dt><span class="term">validSource</span></dt><dd><p>script object, optional</p><p>A script that determines if a source object is valid to be
      mapped. The script yields a boolean value: <code class="literal">true</code>
      indicates the source object is valid; <code class="literal">false</code> can be
      used to defer mapping until some condition is met. In the root scope,
      the source object is provided in the <code class="literal">"source"</code>
      property. If the script is not specified, then all source objects are
      considered valid.</p></dd><dt><span class="term">validTarget</span></dt><dd><p>script object, optional</p><p>A script used during the target phase of reconciliation that 
     determines if a target object is valid to be mapped. The script yields 
     a boolean value: <code class="literal">true</code> indicates that the target object 
     is valid; <code class="literal">false</code> indicates that the target object should 
     not be included in reconciliation. In the root scope, the target object is
      provided in the <code class="literal">"target"</code> property. If the script is
      not specified, then all target objects are considered valid for
      mapping.</p></dd><dt><span class="term">correlationQuery</span></dt><dd><p>script object, optional</p><p>A script that yields a query object to query the target object
      set when a source object has no linked target. The syntax for writing 
      the query depends on the target system of the correlation. See the 
      section on <a href="../integrators-guide/index.html#correlation" class="link"> 
      <em class="citetitle">Correlation Queries</em></a> for examples of some 
      common targets. The source object is provided in the 
      <code class="literal">"source"</code> property in the script scope.</p></dd><dt><span class="term">properties</span></dt><dd><p>array of property-mapping objects, optional</p><p>Specifies mappings between source object properties and target
      object properties, with optional transformation scripts.</p></dd><dt><span class="term">policies</span></dt><dd><p>array of policy objects, optional</p><p>Specifies a set of link conditions and associated actions to
      take in response.</p></dd><dt><span class="term">onCreate</span></dt><dd><p>script object, optional</p><p>A script to execute when a target object is to be created,
      after property mappings have been applied. In the root scope, the
      source object is provided in the <code class="literal">"source"</code> property,
      projected target object in the <code class="literal">"target"</code> property and
      the link situation that led to the create operation in
      <code class="literal">"situation"</code>. The <code class="literal">_id</code> property in
      the target object can be modified, allowing the mapping to select an
      identifier; if not set then the identifier is expected to be set by
      the target object set. If the script throws an exception, then
      target object creation is aborted.</p></dd><dt><span class="term">onUpdate</span></dt><dd><p>script object, optional</p><p>A script to execute when a target object is to be updated,
      after property mappings have been applied. In the root scope, the
      source object is provided in the <code class="literal">"source"</code> property,
      projected target object in the <code class="literal">"target"</code> property,
      link situation that led to the update operation in
      <code class="literal">"situation"</code>. If the script throws an exception,
      then target object update is aborted.</p></dd><dt><span class="term">onLink</span></dt><dd><p>script object, optional</p><p>A script to execute when a source object is to be linked to a target object,
      after property mappings have been applied. In the root scope, the
      source object is provided in the <code class="literal">"source"</code> property,
      projected target object in the <code class="literal">"target"</code> property. If the script throws an exception,
      then target object linking is aborted.</p></dd><dt><span class="term">onUnlink</span></dt><dd><p>script object, optional</p><p>A script to execute when a source and a target object are to be 
     unlinked, after property mappings have been applied. In the root scope, 
     the source object is provided in the <code class="literal">"source"</code> property,
      projected target object in the <code class="literal">"target"</code> property. If 
      the script throws an exception, then target object unlinking is aborted.
      </p></dd><dt><span class="term">result</span></dt><dd><p>script object, optional</p><p>A script to execute on each mapping event, independent of the nature
      of the operation. In the root scope, the source object is provided in the
      <code class="literal">"source"</code> property, projected target object in the
      <code class="literal">"target"</code> property. If the script throws an exception,
      then target object unlinking is aborted.</p><p>The "result" script is executed only during reconciliation 
      operations!</p></dd></dl></div><div class="section" id="sync-property-objects"><div class="titlepage"><div><div><h3 class="title">D.1.1.&nbsp;Property Objects</h3></div></div></div><p>A property object specifies how the value of a target property is
   determined.</p><pre class="codelisting prettyprint linenums lang-js"> {
  "target" : string,
  "source" : string,
  "transform" : script object,
  "condition" : script object,
  "default": value
}</pre><div class="variablelist" id="sync-property-object-properties"><div class="variablelist-title">Property Object Properties</div><dl class="variablelist"><dt><span class="term">target</span></dt><dd><p>string, required</p><p>Specifies the path of the property in the target object to map
       to.</p></dd><dt><span class="term">source</span></dt><dd><p>string, optional</p><p>Specifies the path of the property in the source object to map
        from. If not specified, then the target property value is derived
        from the script or default value.</p></dd><dt><span class="term">transform</span></dt><dd><p>script object, optional</p><p>A script to determine the target property value. The root
        scope contains the value of the source in the
        <code class="literal">"source"</code> property, if specified. If the 
        <code class="literal">"source"</code> property has a value of 
        <code class="literal">""</code>, then the entire source object of the mapping is 
        contained in the root scope. The resulting value yielded by the script 
        is stored in the target property.</p></dd><dt><span class="term">condition</span></dt><dd><p>script object, optional</p><p>A script to determine whether the mapping should be executed or 
       not. The condition has an <code class="literal">"object"</code> property available
       in root scope, which (if specified) contains the full source object. For
       example <code class="literal">"source": "(object.email != null)"</code>. The
       script is considered to return a boolean value.</p></dd><dt><span class="term">default</span></dt><dd><p>any value, optional</p><p>Specifies the value to assign to the target property if a
        non-null value is not established by <code class="literal">"source"</code> or
        <code class="literal">"transform"</code>. If not specified, the default value is
        <code class="literal">null</code>.</p></dd></dl></div></div><div class="section" id="sync-policy-objects"><div class="titlepage"><div><div><h3 class="title">D.1.2.&nbsp;Policy Objects</h3></div></div></div><p>A policy object specifies a link condition and the associated actions
   to take in response.</p><pre class="codelisting prettyprint linenums lang-js">{
  "situation"  : string,
  "action"     : string or script object
  "postAction" : optional, script object
}</pre><div class="variablelist" id="sync-policy-object-properties"><div class="variablelist-title">Policy Object Properties</div><dl class="variablelist"><dt><span class="term">situation</span></dt><dd><p>string, required</p><p>Specifies the situation for which an associated action is to be
      defined.</p></dd><dt><span class="term">action</span></dt><dd><p>string or script object, required</p><p>Specifies the action to perform. If a script is specified, the
       script is executed and is expected to yield a string containing the
       action to perform.</p></dd><dt><span class="term">postAction</span></dt><dd><p>script object, optional</p><p>Specifies the action to perform after the previously specified 
      action has completed.</p></dd></dl></div><div class="section" id="sync-script-objects"><div class="titlepage"><div><div><h4 class="title">D.1.2.1.&nbsp;Script Object</h4></div></div></div><p>Script objects take the following form.</p><pre class="codelisting prettyprint linenums lang-js">{
  "type"  : "text/javascript",
  "source": string
}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">type</span></dt><dd><p>string, required</p><p>Specifies the type of script to be executed. Currently, OpenIDM
        supports only <code class="literal">"text/javascript"</code>.</p></dd><dt><span class="term">source</span></dt><dd><p>string, required</p><p>Specifies the source code of the script to be executed.</p></dd></dl></div></div></div></div><div class="section" id="sync-links"><div class="titlepage"><div><div><h2 class="title" style="clear: both">D.2.&nbsp;Links</h2></div></div></div><p>To maintain links between source and target objects in mappings,
  OpenIDM stores an object set in the repository. The object set identifier
  follows this scheme.</p><pre class="literallayout">links/<em class="replaceable"><code>mapping</code></em></pre><p>Here, <em class="replaceable"><code>mapping</code></em> represents the name of the
  mapping for which links are managed.</p><p>Link entries have the following structure.</p><pre class="codelisting prettyprint linenums lang-js">{
   "_id":string,
   "_rev":string,
   "linkType":string,
   "firstId":string
   "secondId":string,
}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">_id</span></dt><dd><p>string</p><p>The identifier of the link object.</p></dd><dt><span class="term">_rev</span></dt><dd><p>string, required</p><p>The value of link object's revision.</p></dd><dt><span class="term">linkType</span></dt><dd><p>string, required</p><p>The type of the link. Usually then name of the mapping which 
     created the link.</p></dd><dt><span class="term">firstId</span></dt><dd><p>string, required</p><p>The identifier of the first of the two linked objects.</p></dd><dt><span class="term">secondId</span></dt><dd><p>string</p><p>The identifier of the second of the two linked objects.</p></dd></dl></div></div><div class="section" id="sync-queries"><div class="titlepage"><div><div><h2 class="title" style="clear: both">D.3.&nbsp;Queries</h2></div></div></div><div class="orderedlist"><p>OpenIDM performs the following queries on a link object set.</p><ol class="orderedlist" type="1"><li class="listitem"><p>Find link(s) for a given firstId object identifier.</p><pre class="literallayout">SELECT * FROM links WHERE linkType
     = <em class="replaceable"><code>value</code></em> AND firstId = <em class="replaceable"><code>value</code></em></pre><p>Although a single result makes sense, this query is intended to
    allow multiple results so that this scenario can be handled as an
    exception.</p></li><li class="listitem"><p>Select link(s) for a given second object identifier.</p><pre class="literallayout">SELECT * FROM links  WHERE linkType 
    = <em class="replaceable"><code>value</code></em> AND secondId = <em class="replaceable"><code>value</code></em></pre><p>Although a single result makes sense, this query is intended to
    allow multiple results so that this scenario can be handled as an
    exception.</p></li></ol></div></div><div class="section" id="sync-reconciliation"><div class="titlepage"><div><div><h2 class="title" style="clear: both">D.4.&nbsp;Reconciliation</h2></div></div></div><div class="orderedlist"><p>OpenIDM performs reconciliation on a per-mapping basis. The process of
  reconciliation for a given mapping includes these stages.</p><ol class="orderedlist" type="1"><li class="listitem"><p>Iterate through all objects for the object set specified as
    <code class="literal">"source"</code>. For each source object, carry out the
    following steps.</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Look for a link to a target object in the link object set, and
      perform a correlation query (if defined).</p></li><li class="listitem"><p>Determine the link condition, as well as whether a target object 
      can be found.</p></li><li class="listitem"><p>Determine the action to perform based on the policy defined for the
      condition.</p></li><li class="listitem"><p>Perform the action.</p></li><li class="listitem"><p>Keep track of the target objects for which a condition and action 
      has already been determined.</p></li><li class="listitem"><p>Write the results.</p></li></ol></div></li><li class="listitem"><p>Iterate through all object identifiers for the object set specified
    as <code class="literal">"target"</code>. For each identifier, carry out the
    following steps.</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Find the target in the link object set.</p><p>Determine if the target object was handled in the first phase.</p></li><li class="listitem"><p>Determine the action to perform based on the policy defined for the
      condition.</p></li><li class="listitem"><p>Perform the action.</p></li><li class="listitem"><p>Write the results.</p></li></ol></div></li><li class="listitem"><p>Iterate through all link objects, carrying out the following
    steps.</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>If the <code class="literal">reconId</code> is <code class="literal">"my"</code>, then
      skip the object.</p><p>If the <code class="literal">reconId</code> is not recognized, then the
      source or the target is missing.</p></li><li class="listitem"><p>Determine the action to perform based on the policy.</p></li><li class="listitem"><p>Perform the action.</p></li><li class="listitem"><p>Store the <code class="literal">reconId</code> identifer in the mapping to
      indicate that it was processed in this run.</p></li></ol></div></li></ol></div><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>To optimize a reconciliation operation, the reconciliation process 
   does not attempt to correlate source objects to target objects if the set 
   of target objects is empty when the correlation is started. For information 
   on changing this default behaviour, see 
   <a href="../integrators-guide/index.html#reconciliation-optimization" class="link"><em class="citetitle">Reconciliation 
   Optimization</em></a>.</p></div></div></div><div class="section" id="sync-rest-api"><div class="titlepage"><div><div><h2 class="title" style="clear: both">D.5.&nbsp;REST API</h2></div></div></div><div class="variablelist"><p>External synchronized objects expose an API to request immediate
   synchronization. This API includes the following requests and
   responses.</p><dl class="variablelist"><dt><span class="term">Request</span></dt><dd><p>Example:</p><pre class="codelisting prettyprint">
POST /openidm/system/xml/account/jsmith?action=sync HTTP/1.1</pre></dd><dt><span class="term">Response (success)</span></dt><dd><p>Example:</p><pre class="codelisting prettyprint">
HTTP/1.1 204 No Content
...</pre></dd><dt><span class="term">Response (synchronization failure)</span></dt><dd><p>Example:</p><pre class="codelisting prettyprint">
HTTP/1.1 409 Conflict
...
[JSON representation of error]</pre></dd></dl></div></div></div><div lang="en" class="appendix" id="appendix-rest"><div class="titlepage"><div><div><h1 class="title">Appendix&nbsp;E.&nbsp;REST API Reference</h1></div></div></div><a class="indexterm" name="d0e14526"></a><a class="indexterm" name="d0e14531"></a><p>OpenIDM provides a RESTful API for accessing managed objects.</p><div class="section" id="rest-uri-scheme"><div class="titlepage"><div><div><h2 class="title" style="clear: both">E.1.&nbsp;URI Scheme</h2></div></div></div><p>The URI scheme for accessing a managed object follows this
  convention, assuming the OpenIDM web application was deployed at
  <code class="literal">/openidm</code>.</p><pre class="literallayout">/openidm/managed/<em class="replaceable"><code>type</code></em>/<em class="replaceable"><code>id</code></em></pre></div><div class="section" id="rest-object-identifier"><div class="titlepage"><div><div><h2 class="title" style="clear: both">E.2.&nbsp;Object Identifiers</h2></div></div></div><a class="indexterm" name="d0e14554"></a><p>Each managed object has an identifier (expressed as
  <em class="replaceable"><code>id</code></em> in the URI scheme) which is used to
  address the object through the REST API. The REST API allows for the
  client-generated and server-generated identifiers, through PUT and POST
  methods. The default server-generated identifier type is a UUID. Object
  identifiers that begin with underscore ( <code class="literal">_</code> ) are reserved
  for future use.</p></div><div class="section" id="rest-content-negotiation"><div class="titlepage"><div><div><h2 class="title" style="clear: both">E.3.&nbsp;Content Negotiation</h2></div></div></div><p>The REST API fully supports negotiation of content representation
  through the <code class="literal">Accept</code> HTTP header. Currently, the supported
  content type is JSON; omitting content-negotiation is equivalent to including
  the following header:</p><pre class="literallayout">Accept: application/json</pre></div><div class="section" id="rest-conditional-operations"><div class="titlepage"><div><div><h2 class="title" style="clear: both">E.4.&nbsp;Conditional Operations</h2></div></div></div><p>The REST API fully supports conditional operations through the use of
  the <code class="literal">ETag</code>, <code class="literal">If-Match</code> and
  <code class="literal">If-None-Match</code> HTTP headers. The use of HTTP conditional
  operations is the basis of OpenIDM's optimistic concurrency control system.
  Clients should make requests conditional in order to prevent inadvertent
  modification of the wrong version of an object.</p></div><div class="section" id="rest-supported-methods"><div class="titlepage"><div><div><h2 class="title" style="clear: both">E.5.&nbsp;Supported Methods</h2></div></div></div><p>The managed object API uses standard HTTP methods to access managed
  objects.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">GET</span></dt><dd><p>Retrieves a managed object in OpenIDM.</p><p>Example Request</p><pre class="codelisting prettyprint">
GET /openidm/managed/user/bdd793f8 HTTP/1.1
...</pre><p>Example Response</p><pre class="codelisting prettyprint">
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 123
ETag: "0"
...

[JSON representation of the managed object]</pre></dd><dt><span class="term">HEAD</span></dt><dd><p>Returns metainformation about a managed object in OpenIDM.</p><p>Example Request</p><pre class="codelisting prettyprint">
HEAD /openidm/managed/user/bdd793f8 HTTP/1.1
...</pre><p>Example Response</p><pre class="codelisting prettyprint">
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 123
ETag: "0"</pre></dd><dt><span class="term">PUT</span></dt><dd><p>Creates or updates a managed object. PUT is the preferred method of
     creating managed objects.</p><p>Example Request: Creating a new object</p><pre class="codelisting prettyprint">
PUT /openidm/managed/user/5752c0fd9509 HTTP/1.1
Content-Type: application/json
Content-Length: 123
If-None-Match: *
...

[JSON representation of the managed object to create]</pre><p>Example Response: Creating a new object</p><pre class="codelisting prettyprint">
HTTP/1.1 201 Created
Content-Type: application/json
Content-Length: 45
ETag: "0"
...

[JSON representation containing metadata (underscore-prefixed) properties]</pre><p>Example Request: Updating an existing object</p><pre class="codelisting prettyprint">
PUT /openidm/managed/user/5752c0fd9509 HTTP/1.1
Content-Type: application/json
Content-Length: 123
If-Match: "0"
...

[JSON representation of managed object to update]</pre><p>Example Response: Updating an existing object (success)</p><pre class="codelisting prettyprint">
HTTP/1.1 201 Created
Content-Type: application/json
Content-Length: 45
ETag: "0"
....</pre><p>This return code may change in a future release.</p><p>Example Response: Updating an existing object when no version is
     supplied (version conflict)</p><pre class="codelisting prettyprint">
HTTP/1.1 409 Conflict
Content-Type: application/json
Content-Length: 89
...

[JSON representation of error]</pre><p>Example Response: Updating an existing object when an invalid
      version is supplied (version conflict)</p><pre class="codelisting prettyprint">
HTTP/1.1 412 Precondition Required
Content-Type: application/json
Content-Length: 89
...

[JSON representation of error]</pre></dd><dt><span class="term">POST</span></dt><dd><p>The POST method allows arbitrary actions to be performed on managed
     objects. The <code class="literal">_action</code> query parameter defines the action
     to be performed.</p><p>The <code class="literal">create</code> action is used to create a managed
     object. Because POST is neither safe nor idempotent, PUT is the preferred
     method of creating managed objects, and should be used if the client knows
     what identifier it wants to assign the object. The response contains
     the server-generated <code class="literal">_id</code> of the newly created managed
     object.</p><p>The POST method create optionally accepts an <code class="literal">_id</code>
     query parameter to specify the identifier to give the newly created
     object. If an <code class="literal">_id</code> is not provided, the server selects
     its own identifier.</p><p>The <code class="literal">patch</code> action is used to update one or more
     attributes of a managed object, without replacing the entire object.</p><p>Example Create Request</p><pre class="codelisting prettyprint">
POST /openidm/managed/user?_action=create HTTP/1.1
Content-Type: application/json
Content-Length: 123
...

[JSON representation of the managed object to create]</pre><p>Example Response</p><pre class="codelisting prettyprint">
HTTP/1.1 201 Created
Content-Type: application/json
Content-Length: 45
ETag: "0"
...

[JSON representation containing metadata (underscore-prefixed) properties]</pre><p>Example Patch Request</p><pre class="codelisting prettyprint">
POST /openidm/managed/user?_action=patch HTTP/1.1
Content-Type: application/json
Content-Length: 123
...

[JSON representation of the managed object to create]</pre><p>Example Response (success)</p><pre class="codelisting prettyprint">
HTTP/1.1 204 No Content
ETag: "1"
...</pre></dd><dt><span class="term">DELETE</span></dt><dd><p>Deletes a managed object.</p><p>Example Request</p><pre class="codelisting prettyprint">
DELETE /openidm/managed/user/c3471805b60f
If-Match: "0"
...</pre><p>Example Response (success)</p><pre class="codelisting prettyprint">
HTTP/1.1 204 No Content
...</pre><p>Deleting an existing object when no version is supplied (version
     conflict)</p><pre class="codelisting prettyprint">
HTTP/1.1 409 Conflict
Content-Type: application/json
Content-Length: 89
...

[JSON representation of error]</pre><p>Example Response: Deleting an existing object when an invalid
            version is supplied (version conflict)</p><pre class="codelisting prettyprint">
HTTP/1.1 412 Precondition Required
Content-Type: application/json
Content-Length: 89
...

[JSON representation of error]</pre></dd><dt><span class="term">PATCH</span></dt><dd><p>Performs a partial modification of a managed object.</p><p>See the <a class="link" href="http://tools.ietf.org/html/draft-pbryan-json-patch-04" target="_blank">JSON
     Patch Internet-Draft</a> for details.</p><p>Example Request</p><pre class="codelisting prettyprint">
PATCH /openidm/managed/user/5752c0fd9509 HTTP/1.1
Content-Type: application/patch+json
Content-Length: 456
If-Match: "0"
...

[JSON representation of patch document to apply]</pre><p>Example Response (success)</p><pre class="codelisting prettyprint">
HTTP/1.1 200 OK
Set-Cookie: JSESSIONID=1kke440cyv1vivbrid6ljso7b;Path=/
Expires: Thu, 01 Jan 1970 00:00:00 GMT
Content-Type: application/json; charset=UTF-8
ETag: "1"
...
{"_id":"5752c0fd9509","_rev":"2"}
     </pre><p>Updating an existing object when no version is supplied (version
     conflict)</p><pre class="codelisting prettyprint">
HTTP/1.1 409 Conflict
Content-Type: application/json
Content-Length: 89
...

[JSON representation of error]</pre><p>Example Response: Updating an existing object when an invalid
     version is supplied (version conflict)</p><pre class="codelisting prettyprint">
HTTP/1.1 412 Precondition Required
Content-Type: application/json
Content-Length: 89
...

[JSON representation of error]</pre></dd></dl></div></div></div><div lang="en" class="appendix" id="appendix-scripting"><div class="titlepage"><div><div><h1 class="title">Appendix&nbsp;F.&nbsp;Scripting Reference</h1></div></div></div><a class="indexterm" name="d0e14800"></a><p>Scripting allows you to customize various aspects of OpenIDM
        functionality, for example, by providing custom logic between source
        and target mappings, defining correlation rules, filters, and triggers,
        and so on.
    </p><div class="section" id="scripting-configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.1.&nbsp;Scripting Configuration</h2></div></div></div><p>You define scripts using script objects, which can either include the
            code directly in the configuration, or call an external file that contains
            the script.
        </p><p>
            Custom scripts should be placed in the <code class="literal">script/</code> folder
            for your project, for example <code class="literal">path/to/openidm/script/</code>.
            Do not modify or remove the script files located in
            <code class="literal">path/to/openidm/bin/defaults/script/</code>. This folder
            contains the default scripts that are required to run specific services.
            Scripts in this folder are not guaranteed to remain constant between
            product releases.
        </p><pre class="codelisting prettyprint linenums lang-js">
{
  "type" : "text/javascript",
  "source": string
}
        </pre><p>or</p><pre class="codelisting prettyprint linenums lang-js">
{
  "type" : "text/javascript",
  "file" : file location
}
        </pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">type</span></dt><dd><p>string, required</p><p>Specifies the type of script to be executed. Currently, OpenIDM
                        supports only<code class="literal">"text/javascript"</code>.
                    </p></dd><dt><span class="term">source</span></dt><dd><p>string, required if file is not specified</p><p>Specifies the source code of the script to be executed.</p></dd><dt><span class="term">file</span></dt><dd><p>string, required if source is not specified</p><p>Specifies the file containing the source code of the script to
                        execute.
                    </p></dd></dl></div></div><div class="section" id="scripting-example"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.2.&nbsp;Examples</h2></div></div></div><p>The following example (included in the <code class="filename">sync.json</code>
            file) returns <code class="literal">true</code> if the <code class="literal">employeeType</code>
            is equal to <code class="literal">external</code>, otherwise returns
            <code class="literal">false</code>. This script can be useful during reconciliation to
            establish whether the source object should be a part of the reconciliation,
            or ignored.
        </p><pre class="codelisting prettyprint linenums lang-js">
"validTarget": {
   "type" : "text/javascript",
   "source": "target.employeeType == 'external'"
}
        </pre><p>The following example (included in the <code class="filename">sync.json</code>
            file) sets the <code class="literal">__PASSWORD__</code> attribute to
            <code class="literal">defaultpwd</code> when OpenIDM creates a target object.
        </p><pre class="codelisting prettyprint linenums lang-js">
"onCreate" : {
  "type" : "text/javascript",
  "source": "target.__PASSWORD__ = 'defaultpwd'"
}
        </pre><p>The following example (included in the <code class="filename">router.json</code>
            file) shows a trigger to create Solaris home directories using a script.
            The script is located in a file,
            <code class="filename">/path/to/openidm/script/createUnixHomeDir.js</code>.
        </p><pre class="codelisting prettyprint linenums lang-js">
{
  "filters" : [ {
    "pattern" : "^system/solaris/account$",
    "methods" : [ "create" ],
    "onResponse" : {
      "type" : "text/javascript",
      "file" : "script/createUnixHomeDir.js"
    }
  } ]
}
        </pre></div><div class="section" id="function-ref"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.3.&nbsp;Function Reference</h2></div></div></div><a class="indexterm" name="d0e14909"></a><a class="indexterm" name="d0e14914"></a><p>Functions (access to managed objects, system objects, and
            configuration objects) within OpenIDM are accessible to scripts
            via the <code class="literal">openidm</code> object, which is included in
            the top-level scope provided to each script.
        </p><p>OpenIDM also provides a <code class="literal">logger</code> object to
            access SLF4J facilities. The following code shows an example:
        </p><pre class="codelisting prettyprint linenums lang-js">
logger.info("Parameters passed in: {} {} {}", param1, param2, param3);
        </pre><p>To set the log level, use
            <code class="literal">org.forgerock.openidm.script.javascript.JavaScript.level</code>
            in <code class="filename">openidm/conf/logging.properties</code>.
        </p><div class="section" id="function-create"><div class="titlepage"><div><div><h3 class="title">F.3.1.&nbsp;openidm.create(id, value)</h3></div></div></div><p>This function creates a new resource object.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object to be created.</p></dd><dt><span class="term">value</span></dt><dd><p>object</p><p>The value of the object to be created.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The created OpenIDM resource object.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the object could not be created.
                    </p></li></ul></div></div><div class="section" id="function-patch"><div class="titlepage"><div><div><h3 class="title">F.3.2.&nbsp;openidm.patch(id, rev, value)</h3></div></div></div><p>This function performs a partial modification of a managed
            object. Unlike the <code class="literal">update</code> function, only the
            modified attributes are provided, not the entire object.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object to be updated.</p></dd><dt><span class="term">rev</span></dt><dd><p>string</p><p>The revision of the object to be updated, or
                        <code class="literal">null</code> if the object is not subject
                        to revision control.
                        </p></dd><dt><span class="term">value</span></dt><dd><p>object</p><p>The value of the modifications to be applied to
                        the object.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The modified OpenIDM resource object.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the object could not be updated.
                    </p></li></ul></div></div><div class="section" id="function-read"><div class="titlepage"><div><div><h3 class="title">F.3.3.&nbsp;openidm.read(id)</h3></div></div></div><p>This function reads and returns an OpenIDM resource object.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object to be read.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The read OpenIDM resource object, or <code class="literal">null</code>
                        if not found.
                    </p></li></ul></div></div><div class="section" id="function-update"><div class="titlepage"><div><div><h3 class="title">F.3.4.&nbsp;openidm.update(id, rev, value)</h3></div></div></div><p>This function updates a resource object.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the resource object to be updated.</p></dd><dt><span class="term">rev</span></dt><dd><p>string</p><p>The revision of the object to be updated, or
                            <code class="literal">null</code> if the object is not subject to revision control.
                        </p></dd><dt><span class="term">value</span></dt><dd><p>object</p><p>The value of the object to be updated.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The modified OpenIDM resource object.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the object could not be updated.
                    </p></li></ul></div></div><div class="section" id="function-delete"><div class="titlepage"><div><div><h3 class="title">F.3.5.&nbsp;openidm.delete(id, rev)</h3></div></div></div><p>This function deletes a resource object.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object to be deleted.</p></dd><dt><span class="term">rev</span></dt><dd><p>string</p><p>The revision of the object to be deleted, or
                            <code class="literal">null</code> if the object is not subject to revision control.
                        </p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A <code class="literal">null</code> value if successful.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the object could not be deleted.
                    </p></li></ul></div><p>Note that <code class="literal">delete</code> is a reserved word in JavaScript
                and this function can therefore not be called in the usual manner. To call
                delete from a JavaScript, you must specify the call as shown in the
                following example:
            </p><pre class="codelisting prettyprint linenums lang-js">
openidm['delete']('managed/user/'+ user._id, user._rev)
            </pre><p>Calling <code class="literal">openidm.delete()</code> directly from a JavaScript
                results in an error similar to the following:
            </p><pre class="cmdline prettyprint">
                org.forgerock.openidm.script.ScriptException: missing name after . operator
            </pre></div><div class="section" id="function-query"><div class="titlepage"><div><div><h3 class="title">F.3.6.&nbsp;openidm.query(id, params)</h3></div></div></div><p>This function performs a query on the specified OpenIDM resource object.
            </p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object to perform the query on.</p></dd><dt><span class="term">params</span></dt><dd><p>object</p><p>An object containing the query ID and its parameters.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The result of the query. A query result includes the following
                        parameters:
                    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">"query-time-ms"</span></dt><dd><p>The time, in milliseconds, that OpenIDM took to process
                                    the query.
                                </p></dd><dt><span class="term">"conversion-time-ms"</span></dt><dd><p>(For an OrientDB repository only) the time, in
                                    milliseconds, taken to convert the data to a JSON object.
                                </p></dd><dt><span class="term">"result"</span></dt><dd><p>The list of entries retrieved by the query. The result
                                    includes the revision (<code class="literal">"_rev"</code>) of the
                                    entry and any other properties that were requested in the
                                    query.
                                </p></dd></dl></div><p>The following example shows the result of a custom query that
                        requests the ID, user name, and email address of managed users in the
                        repository. For an OrientDB repository, the query would be something like
                        <code class="literal">select _openidm_id, userName, email from managed_user,</code>.
                    </p><pre class="codelisting prettyprint linenums lang-js">
{
  "conversion-time-ms": 0,
  "result": [
    {
      "email": "bjensen@example.com",
      "userName": "bjensen",
      "_rev": "0",
      "_id": "36bbb745-517f-4695-93d0-998e1e7065cf"
    },
    {
      "email": "scarter@example.com",
      "userName": "scarter",
      "_rev": "0",
      "_id": "cc3bf6f0-949e-4699-9b8e-8c78ce04a287"
    }
  ],
  "query-time-ms": 1
}
                    </pre></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the given query could not be processed.
                    </p></li></ul></div></div><div class="section" id="function-action"><div class="titlepage"><div><div><h3 class="title">F.3.7.&nbsp;openidm.action(id, params, value)</h3></div></div></div><p>This function performs an action on the specified OpenIDM resource
                object.
            </p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object on which the action should be
                            performed.</p></dd><dt><span class="term">params</span></dt><dd><p>object</p><p>An object containing the parameters to pass to the action.</p></dd><dt><span class="term">value</span></dt><dd><p>object</p><p>A value that can be provided to the action for processing.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The result of the action. May be <code class="literal">null</code> if
                        no result is provided.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the given action could not be executed
                        for any reason.
                    </p></li></ul></div></div><div class="section" id="function-encrypt"><div class="titlepage"><div><div><h3 class="title">F.3.8.&nbsp;openidm.encrypt(value, cipher, alias)</h3></div></div></div><p>This function encrypts a value.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">value</span></dt><dd><p>any</p><p>The value to be encrypted.</p></dd><dt><span class="term">cipher</span></dt><dd><p>string</p><p>The cipher with which to encrypt the value, using the form
                            "algorithm/mode/padding" or just "algorithm". Example:
                            <code class="literal">AES/ECB/PKCS5Padding</code>.
                        </p></dd><dt><span class="term">alias</span></dt><dd><p>string</p><p>The key alias in the key store with which to encrypt the node.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The value, encrypted with the specified cipher and key.</p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the object could not be encrypted for any
                        reason.
                    </p></li></ul></div></div><div class="section" id="function-decrypt"><div class="titlepage"><div><div><h3 class="title">F.3.9.&nbsp;openidm.decrypt(value)</h3></div></div></div><p>This function decrypts a value.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">value</span></dt><dd><p>any</p><p>The value to be decrypted.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A deep copy of the value, with any encrypted value decrypted.</p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the object could not be decrypted for any
                        reason.
                    </p></li></ul></div></div><div class="section" id="function-logger-debug"><div class="titlepage"><div><div><h3 class="title">F.3.10.&nbsp;logger.debug(string message, object... params)</h3></div></div></div><p>Logs a message at DEBUG level.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">message</span></dt><dd><p>string</p><p>The message format to log. Params replace <code class="literal">{}</code>
                            in your message.
                        </p></dd><dt><span class="term">params</span></dt><dd><p>object</p><p>Arguments to include in the message.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A <code class="literal">null</code> value if successful.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the message could not be logged.</p></li></ul></div></div><div class="section" id="function-logger-error"><div class="titlepage"><div><div><h3 class="title">F.3.11.&nbsp;logger.error(string message, object... params)</h3></div></div></div><p>Logs a message at ERROR level.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">message</span></dt><dd><p>string</p><p>The message format to log. Params replace <code class="literal">{}</code>
                            in your message.
                        </p></dd><dt><span class="term">params</span></dt><dd><p>object</p><p>Arguments to include in the message.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A <code class="literal">null</code> value if successful.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the message could not be logged.</p></li></ul></div></div><div class="section" id="function-logger-info"><div class="titlepage"><div><div><h3 class="title">F.3.12.&nbsp;logger.info(string message, object... params)</h3></div></div></div><p>Logs a message at INFO level.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">message</span></dt><dd><p>string</p><p>The message format to log. Params replace
                            <code class="literal">{}</code>
                            in your message.
                        </p></dd><dt><span class="term">params</span></dt><dd><p>object</p><p>Arguments to include in the message.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A
                        <code class="literal">null</code>
                        value if successful.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the message could not be logged.</p></li></ul></div></div><div class="section" id="function-logger-trace"><div class="titlepage"><div><div><h3 class="title">F.3.13.&nbsp;logger.trace(string message, object... params)</h3></div></div></div><p>Logs a message at TRACE level.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">message</span></dt><dd><p>string</p><p>The message format to log. Params replace
                            <code class="literal">{}</code>
                            in your message.
                        </p></dd><dt><span class="term">params</span></dt><dd><p>object</p><p>Arguments to include in the message.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A
                        <code class="literal">null</code>
                        value if successful.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the message could not be logged.</p></li></ul></div></div><div class="section" id="function-logger-warn"><div class="titlepage"><div><div><h3 class="title">F.3.14.&nbsp;logger.warn(string message, object... params)</h3></div></div></div><p>Logs a message at WARN level.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">message</span></dt><dd><p>string</p><p>The message format to log. Params replace
                            <code class="literal">{}</code>
                            in your message.
                        </p></dd><dt><span class="term">params</span></dt><dd><p>object</p><p>Arguments to include in the message.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A <code class="literal">null</code> value if successful.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the message could not be logged.</p></li></ul></div></div></div><div class="section" id="script-places"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.4.&nbsp;Places to Trigger Scripts</h2></div></div></div><p>Scripts can be triggered at different places, by different events.
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">In <code class="filename">openidm/conf/sync.json</code>
                </span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">Triggered by situation</span></dt><dd><p>onCreate, onUpdate, onDelete, onLink, onUnlink</p></dd><dt><span class="term">Object filter</span></dt><dd><p>vaildSource, validTarget</p></dd><dt><span class="term">Correlating objects</span></dt><dd><p>correlationQuery</p></dd><dt><span class="term">Triggered on any reconciliation</span></dt><dd><p>result</p></dd><dt><span class="term">Scripts inside properties</span></dt><dd><p>condition, transform</p><p><code class="literal">sync.json</code> supports only one script
                                    per hook. If multiple scripts are defined for the same hook, only the last
                                    one is kept.
                                </p></dd></dl></div></dd><dt><span class="term">In <code class="filename">openidm/conf/managed.json</code>
                </span></dt><dd><p>onCreate, onRead, onUpdate, onDelete, onValidate,
                        onRetrieve and onStore
                    </p><p><code class="literal">managed.json</code> supports only one script
                        per hook. If multiple scripts are defined for the same hook, only the last
                        one is kept.
                    </p></dd><dt><span class="term">In <code class="filename">openidm/conf/router.json</code>
                </span></dt><dd><p>onRequest, onResponse, onFailure</p><p><code class="literal">router.json</code> supports multiple scripts per hook.
                    </p></dd></dl></div></div><div class="section" id="script-variables"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.5.&nbsp;Variables Available in Scripts</h2></div></div></div><p>The variables that are available to scripts depend on the triggers
            that launch the script. The following section outlines the available
            variables, per trigger.
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">condition</span></dt><dd><p>object</p></dd><dt><span class="term">correlationQuery</span></dt><dd><p>source</p></dd><dt><span class="term">Custom endpoint scripts</span></dt><dd><p>request</p></dd><dt><span class="term">onCreate</span></dt><dd><p>object, source, target</p></dd><dt><span class="term">onDelete</span></dt><dd><p>object</p></dd><dt><span class="term">onLink</span></dt><dd><p>source, target</p></dd><dt><span class="term">onRead</span></dt><dd><p>object</p></dd><dt><span class="term">onRetrieve</span></dt><dd><p>object, property</p></dd><dt><span class="term">onStore</span></dt><dd><p>object, property</p></dd><dt><span class="term">onUnlink</span></dt><dd><p>source, target</p></dd><dt><span class="term">onUpdate</span></dt><dd><p>oldObject, newObject</p></dd><dt><span class="term">onValidate</span></dt><dd><p>object, property</p></dd><dt><span class="term">result</span></dt><dd><p>source, target</p></dd><dt><span class="term">synchronization situation scripts</span></dt><dd><p><code class="literal">recon.actionParam</code> - the details of
                    the synchronization operation in progress. This variable can
                    be used for asynchronous callbacks to execute the action at
                    a later stage.</p><p><code class="literal">sourceAction</code> - a boolean that
                    indicates whether the situation was assessed during the source phase</p><p><code class="literal">source</code> (if found)</p><p><code class="literal">target</code> (if found)</p><p>The properties from the configured script object.</p></dd><dt><span class="term">taskScanner</span></dt><dd><p>input, objectID</p></dd><dt><span class="term">transform</span></dt><dd><p>source</p></dd><dt><span class="term">validSource</span></dt><dd><p>source</p></dd><dt><span class="term">validTarget</span></dt><dd><p>target</p></dd></dl></div></div><div class="section" id="debugging-scripts"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.6.&nbsp;Debugging OpenIDM Scripts</h2></div></div></div><p>OpenIDM includes Eclipse JSDT libraries so you can use Eclipse to debug
            your OpenIDM scripts during development.
        </p><div class="procedure" id="enable-debugging"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;F.1.&nbsp;To Enable Debugging</div><p>Follow these steps to enable debugging using Eclipse.</p><ol class="procedure" type="1"><li class="step"><p>Install the environment to support JavaScript development in either
                    of the following ways.
                </p><ul class="stepalternatives">
                    <li class="step"><p>Download and install Eclipse IDE for JavaScript Web Developers
                            from the <a class="link" href="http://www.eclipse.org/downloads/" target="_blank">Eclipse download page</a>.
                        </p></li>
                    <li class="step"><p>Add
                            <a class="link" href="http://wiki.eclipse.org/JSDT" target="_blank">JavaScript Development Tools
                            </a>
                            to your existing
                            Eclipse installation.
                        </p></li>
                </ul></li><li class="step"><p>Create an empty JavaScript project called <code class="literal">External JavaScript Source</code>
                    in Eclipse.
                </p><p>Eclipse then uses the <code class="filename">External JavaScript Source</code>
                    directory in the default workspace location to store sources that it
                    downloads from OpenIDM.
                </p></li><li class="step"><p>Stop OpenIDM.</p></li><li class="step"><p>Edit
                    <code class="filename">openidm/conf/boot/boot.properties</code>
                    to
                    enable debugging.
                </p><ol type="a" class="substeps"><li class="step"><p>Uncomment and edit the following line.</p><pre>
#openidm.script.javascript.debug=transport=socket,suspend=y,address=9888,trace=true
                        </pre><p>Here <code class="literal">suspend=y</code> prevents OpenIDM from starting
                            until the remote JavaScript debugger has connected. You might therefore
                            choose to set this to <code class="literal">suspend=n</code>.
                        </p></li><li class="step"><p>Uncomment and edit the following line.</p><pre>
#openidm.script.javascript.sources=/Eclipse/workspace/External JavaScript Source/
                        </pre><p>Adjust <code class="literal">/Eclipse/workspace/External JavaScript Source/</code>
                            to match the absolute path to this folder including the
                            trailing <code class="literal">/</code> character. On Windows, also use forward
                            slashes, such as<code class="literal">C:/Eclipse/workspace/External JavaScript Source/</code>.
                        </p><p>Each time OpenIDM loads a new script, it then creates or overwrites
                            the file in the <code class="filename">External JavaScript Source</code>
                            directory. Before toggling breakpoints, be sure to refresh the source manually in
                            Eclipse so you have the latest version.
                        </p></li></ol></li><li class="step"><p>Prepare the Eclipse debugger to allow you to set breakpoints.</p><p>In the Eclipse Debug perspective, select the Breakpoints tab, and
                    then click the Add Script Load Breakpoint icon to open the list of
                    scripts.
                </p><p>In the Add Script Load Breakpoint window, select your scripts, and
                    then click OK.
                </p></li><li class="step"><p>Start OpenIDM, and connect the debugger.</p><p>To create a new debug, configuration click Run &gt; Debug
                    Configurations... &gt; Remote JavaScript &gt; New button, and then set
                    the port to 9888 as shown above.
                </p></li></ol></div></div></div></div><div lang="en" class="appendix" id="appendix-router"><div class="titlepage"><div><div><h1 class="title">Appendix&nbsp;G.&nbsp;Router Service Reference</h1></div></div></div><a class="indexterm" name="d0e15855"></a><p>The OpenIDM router service provides the uniform interface to all
  objects in OpenIDM: managed objects, system objects, configuration
  objects, and so on.</p><div class="section" id="router-configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both">G.1.&nbsp;Configuration</h2></div></div></div><p>The router object as shown in <code class="filename">conf/router.json</code>
  defines an array of filter objects.</p><pre class="codelisting prettyprint linenums lang-js">
{
  "filters": [ filter object, ... ]
}</pre><p>The required filters array defines a list of filters to be processed
  on each router request. Filters are processed in the order in which they are
  specified in this array.</p><div class="section" id="filter-object"><div class="titlepage"><div><div><h3 class="title">G.1.1.&nbsp;Filter Objects</h3></div></div></div><p>Filter objects are defined as follows.</p><pre class="codelisting prettyprint linenums lang-js">
{
  "pattern": string,
  "methods": [ string, ... ],
  "condition": script object,
  "onRequest": script object,
  "onResponse": script object,
  "onFailure": script object
}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">"pattern"</span></dt><dd><p>string, optional</p><p>Specifies a regular expression pattern matching the JSON pointer of
      the object to trigger scripts. If not specified, all identifiers
      (including <code class="literal">null</code>) match.</p></dd><dt><span class="term">"methods"</span></dt><dd><p>array of strings, optional</p><p>One or more methods for which the script(s) should be triggered.
      Supported methods are: <code class="literal">"create"</code>,
      <code class="literal">"read"</code>, <code class="literal">"update"</code>,
      <code class="literal">"delete"</code>, <code class="literal">"patch"</code>,
      <code class="literal">"query"</code>, <code class="literal">"action"</code>. If not specified,
      all methods are matched.</p></dd><dt><span class="term">"condition"</span></dt><dd><p>script object, optional</p><p>Specifies a script that is called first to determine if the script
      should be triggered. If the condition yields <code class="literal">"true"</code>,
      the other script(s) are executed. If no condition is specified, the 
      script(s) are called unconditionally.</p></dd><dt><span class="term">"onRequest"</span></dt><dd><p>script object, optional</p><p>Specifies a script to execute before the request is dispatched to
      the resource. If the script throws an exception, the method is not
      performed, and a client error response is provided.</p></dd><dt><span class="term">"onResponse"</span></dt><dd><p>script object, optional</p><p>Specifies a script to execute after the request is successfully
      dispatched to the resource and a response is returned. Throwing an
      exception from this script does not undo the method already
      performed.</p></dd><dt><span class="term">"onFailure"</span></dt><dd><p>script object, optional</p><p>Specifies a script to execute if the request resulted in an
      exception being thrown. Throwing an exception from this script does not
      undo the method already performed.</p></dd></dl></div></div><div class="section" id="script-sequenze"><div class="titlepage"><div><div><h3 class="title">G.1.2.&nbsp;Script Execution Sequence</h3></div></div></div><p>All "onRequest" and "onResponse" scripts are executed in sequence. 
    First, the "onRequest" scripts are executed from the top down, then the 
    "onResponse" scripts are executed from the bottom up.</p><pre class="cmdline prettyprint">
client -&gt; filter 1 onRequest -&gt; filter 2 onRequest -&gt; resource
client &lt;- filter 1 onResponse &lt;- filter 2 onResponse &lt;- resource
    </pre><p>The following sample <code class="filename">router.json</code> file shows the 
    order in which the scripts would be executed:</p><pre class="codelisting prettyprint linenums lang-js">
{
    "filters" : [
        {
            "onRequest" : {
                "type" : "text/javascript",
                "file" : "script/router-authz.js"
            }
        },
        {
            "pattern" : "^managed/user/.*",
            "methods" : [
                "read"
            ],
            "onRequest" : {
                "type" : "text/javascript",
                "source" : "java.lang.System.out.println('requestFilter 1');"
            }
        },
        {
            "pattern" : "^managed/user/.*",
            "methods" : [
                "read"
            ],
            "onResponse" : {
                "type" : "text/javascript",
                "source" : "java.lang.System.out.println('responseFilter 1');"
            }
        },
        {
            "pattern" : "^managed/user/.*",
            "methods" : [
                "read"
            ],
            "onRequest" : {
                "type" : "text/javascript",
                "source" : "java.lang.System.out.println('requestFilter 2');"
            }
        },
        {
            "pattern" : "^managed/user/.*",
            "methods" : [
                "read"
            ],
            "onResponse" : {
                "type" : "text/javascript",
                "source" : "java.lang.System.out.println('responseFilter 2');"
            }
        }
    ]
}    
    </pre><p>Will produce a log like:</p><pre class="cmdline prettyprint">
requestFilter 1
requestFilter 2
responseFilter 2
responseFilter 1    
    </pre></div><div class="section" id="filter-script-scope"><div class="titlepage"><div><div><h3 class="title">G.1.3.&nbsp;Script Scope</h3></div></div></div><p>Scripts are provided with the following scope.</p><pre class="codelisting prettyprint linenums lang-js">
{
  "openidm": openidm-functions object,
  "request": resource-request object,
  "response": resource-response object,
  "exception": exception object
}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">"openidm"</span></dt><dd><p><a href="../integrators-guide/index.html#function-ref" class="link">openidm-functions</a>
      object</p><p>Provides access to OpenIDM resources.</p></dd><dt><span class="term">"request"</span></dt><dd><p><a class="link" href="https://wikis.forgerock.org/confluence/display/json/resource-request" target="_blank">resource-request</a> object</p><p>The resource-request context, which has one or more parent contexts.
      Provided in the scope of <code class="literal">"condition"</code>,
      <code class="literal">"onRequest"</code>, <code class="literal">"onResponse"</code> and
      <code class="literal">"onFailure"</code> scripts.</p></dd><dt><span class="term">"response"</span></dt><dd><p><a href="../integrators-guide/index.html#function-ref" class="link">openidm-functions</a>
      object</p><p>The response to the resource-request. Only provided in the scope of
      the <code class="literal">"onResponse"</code> script.</p></dd><dt><span class="term">"exception"</span></dt><dd><p>exception object</p><p>The exception value that was thrown as a result of processing the
      request. Only provided in the scope of the
      <code class="literal">"onFailure"</code> script.</p></dd></dl></div><p>An exception object is defined as follows.</p><pre class="codelisting prettyprint linenums lang-js">
{
  "error": integer,
  "reason": string,
  "message": string,
  "detail": string
}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">"error"</span></dt><dd><p>integer</p><p>The numeric code of the exception.</p></dd><dt><span class="term">"reason"</span></dt><dd><p>string</p><p>The short reason phrase of the exception.</p></dd><dt><span class="term">"message"</span></dt><dd><p>string</p><p>A brief message describing the exception.</p></dd><dt><span class="term">"detail"</span></dt><dd><p>(optional), string</p><p>A detailed description of the exception, in structured JSON format, 
      suitable for programmatic evaluation.</p></dd></dl></div></div></div><div class="section" id="router-example"><div class="titlepage"><div><div><h2 class="title" style="clear: both">G.2.&nbsp;Example</h2></div></div></div><p>The following example executes a script after a managed user object is
  created or updated.</p><pre class="codelisting prettyprint linenums lang-js">
{
    "filters": [
        {
            "pattern": "^managed/user/.*",
            "methods": [
                "create",
                "update"
            ],
            "onResponse": {
                "type": "text/javascript",
                "file": "scripts/afterUpdateUser.js"
            }
        }
    ]
}</pre></div></div><div lang="en" class="appendix" id="appendix-jetty"><div class="titlepage"><div><div><h1 class="title">Appendix&nbsp;H.&nbsp;Embedded Jetty Configuration</h1></div></div></div><p>OpenIDM  includes an embedded Jetty web
 server.</p><p>To configure the embedded Jetty server, edit
 <code class="filename">openidm/conf/jetty.xml</code>. OpenIDM delegates most of the
 connector configuration to <code class="filename">jetty.xml</code>. OSGi and PAX web specific
 settings for connector configuration therefore do not have an effect. This
 lets you take advantage of all Jetty capabilities, as the web server is not
 configured through an abstraction that might limit some of the options.</p><p>The Jetty configuration can reference configuration properties (such as
 port numbers and key store details) from OpenIDM's
 <code class="filename">boot.properties</code> configuration file.</p><div class="section" id="access-openidm-config-properties"><div class="titlepage"><div><div><h2 class="title" style="clear: both">H.1.&nbsp;Using OpenIDM Configuration Properties in the Jetty Configuration</h2></div></div></div><p>OpenIDM exposes a <code class="literal">Param</code> class that you can use in
  <code class="filename">jetty.xml</code> to include OpenIDM configuration. The
  <code class="literal">Param</code> class exposes Bean properties for common Jetty
  settings and generic property access for other, arbitrary settings.</p><div class="section" id="jetty-access-bean-properties"><div class="titlepage"><div><div><h3 class="title">H.1.1.&nbsp;Accessing Explicit Bean Properties</h3></div></div></div><p>To retrieve an explicit Bean property, use the following syntax in
   <code class="filename">jetty.xml</code>.</p><pre class="codelisting prettyprint lang-xml">
&lt;Get class="org.forgerock.openidm.jetty.Param" name="&lt;bean property name&gt;"/&gt;
   </pre><p>For example, to set a Jetty property for keystore password:</p><pre class="codelisting prettyprint lang-xml">
&lt;Set name="password"&gt;
    &lt;Get class="org.forgerock.openidm.jetty.Param" name="keystorePassword"/&gt;
&lt;/Set&gt;</pre><p>Also see the bundled <code class="filename">jetty.xml</code> for further
   examples.</p><div class="variablelist"><p>The following explicit Bean properties are available.</p><dl class="variablelist"><dt><span class="term">port</span></dt><dd><p>Maps to <code class="literal">openidm.port.http</code></p></dd><dt><span class="term">port</span></dt><dd><p>Maps to <code class="literal">openidm.port.https</code></p></dd><dt><span class="term">port</span></dt><dd><p>Maps to <code class="literal">openidm.port.mutualauth</code></p></dd><dt><span class="term">keystoreType</span></dt><dd><p>Maps to <code class="literal">openidm.keystore.type</code></p></dd><dt><span class="term">keystoreProvider</span></dt><dd><p>Maps to <code class="literal">openidm.keystore.provider</code></p></dd><dt><span class="term">keystoreLocation</span></dt><dd><p>Maps to <code class="literal">openidm.keystore.location</code></p></dd><dt><span class="term">keystorePassword</span></dt><dd><p>Maps to <code class="literal">openidm.keystore.password</code></p></dd><dt><span class="term">keystoreKeyPassword</span></dt><dd><p>Maps to <code class="literal">openidm.keystore.key.password</code>, or the
      key store password if not set</p></dd><dt><span class="term">truststoreLocation</span></dt><dd><p>Maps to <code class="literal">openidm.truststore.location</code>, or the
      key store location if not set</p></dd><dt><span class="term">truststorePassword</span></dt><dd><p>Maps to <code class="literal">openidm.truststore.password</code>, or the
      key store password if not set</p></dd></dl></div></div><div class="section" id="jetty-access-generic-properties"><div class="titlepage"><div><div><h3 class="title">H.1.2.&nbsp;Accessing Generic Properties</h3></div></div></div><pre class="codelisting prettyprint lang-xml">
&lt;Call class="org.forgerock.openidm.jetty.Param" name="getProperty"&gt;
  &lt;Arg&gt;org.forgerock.openidm.some.sample.property&lt;/Arg&gt;
&lt;/Call&gt;
    </pre></div></div><div class="section" id="default-jetty-settings"><div class="titlepage"><div><div><h2 class="title" style="clear: both">H.2.&nbsp;Jetty Default Settings</h2></div></div></div><div class="itemizedlist"><p>By default the embedded Jetty server uses the following
   settings.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The HTTP, SSL, and Mutual Authentication ports defined in OpenIDM</p></li><li class="listitem"><p>Same key store/trust store settings as OpenIDM</p></li><li class="listitem"><p>Trivial sample realm,
    <code class="filename">openidm/security/realm.properties</code> to add users</p></li></ul></div><p>The default settings are intended for evaluation only. Adjust them
  according to your production requirements.</p></div><div class="section" id="registering-servlet-filters"><div class="titlepage"><div><div><h2 class="title" style="clear: both">H.3.&nbsp;Registering Additional Servlet Filters</h2></div></div></div><p>You can register generic servlet filters in the embedded Jetty 
  server to perform additional filtering tasks on requests to or responses 
  from OpenIDM. For example, you might want to use a servlet filter to protect 
  access to OpenIDM with an access management product such, as OpenAM. Servlet 
  filters are configured in files named 
  <code class="filename">openidm/conf/servletfilter-<em class="replaceable"><code>name</code></em>.json</code>. 
  These servlet filter configuration files define the filter class, required 
  libraries, and other settings.</p><p>A sample servlet filter configuration is provided in 
  <code class="filename">openidm/samples/openam</code>. The sample configuration includes 
  the servlet filter configuration file (<code class="filename">conf/servletfilter-openam.json</code>) 
  and the extension script that implements the filter 
  (<code class="filename">script/security/populateContext.js</code>).
  </p><p>The sample servlet filter configuration file is shown below:</p><pre class="codelisting prettyprint linenums lang-js">
{
    "classPathURLs" : [
        "file:/jetty_v61_agent/lib/agent.jar",
        "file:/jetty_v61_agent/lib/openssoclientsdk.jar",
        "file:/jetty_v61_agent/lib/",
        "file:/jetty_v61_agent/locale/"
    ],
    "systemProperties" : {
        "openam.agents.bootstrap.dir" : "/jetty_v61_agent/Agent_001/config"
    },
    "requestAttributes" : {
        "openidm.authinvoked" : "servletfilter-openam"
    },
    "scriptExtensions" : {
        "augmentSecurityContext" : {
            "type" : "text/javascript",
            "file" : "script/security/populateContext.js"
        }
    },
    "filterClass" : "com.sun.identity.agents.filter.AmAgentFilter"
}  
  </pre><p>The sample configuration includes the following properties:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">"classPathURLs"</code></span></dt><dd><p>The URLs to any required classes or libraries that should be 
        added to the classpath used by the servlet filter class</p></dd><dt><span class="term"><code class="literal">"systemProperties"</code></span></dt><dd><p>Any additional Java system properties required by the filter</p></dd><dt><span class="term"><code class="literal">"requestAttributes"</code></span></dt><dd><p>The HTTP Servlet request attributes that will be set by OpenIDM 
        when the filter is invoked. OpenIDM expects certain request attributes 
        to be set by any module that protects access to it, so this helps in setting these expected settings.</p></dd><dt><span class="term"><code class="literal">"scriptExtensions"</code></span></dt><dd><p>Optional script extensions to OpenIDM. Currently only 
        <code class="literal">"augmentSecurityContext"</code> is supported. A script 
        that is defined in <code class="literal">augmentSecurityContext</code> is 
        executed by OpenIDM after a successful authentication request. The 
        script helps to populate the expected security context in OpenIDM. 
        For example, the login module (servlet filter) might select to supply 
        only the authenticated user name, while the associated roles and user 
        ID can be augmented by the script.</p><p>Only JavaScript is supported 
        (<code class="literal">"type":"text/javascript"</code>). The script can be 
        provided inline (<code class="literal">"source":<em class="replaceable"><code>script source</code></em></code>) 
        or in a file (<code class="literal">"file":<em class="replaceable"><code>filename</code></em></code>). 
        The sample filter extends the filter interface with the functionality in 
        the script <code class="filename">script/security/populateContext.js</code>.</p></dd><dt><span class="term"><code class="literal">"filterClass"</code></span></dt><dd><p>The servlet filter that is being registered</p></dd></dl></div><p>The following additional properties can be configured for the filter:
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">"httpContextId"</code></span></dt><dd><p>The HTTP context under which the filter should be registered. 
        The default is <code class="literal">"openidm"</code>.</p></dd><dt><span class="term"><code class="literal">"servletNames"</code></span></dt><dd><p>A list of servlet names to which the filter should apply. The 
        default is <code class="literal">"OpenIDM REST"</code>.</p></dd><dt><span class="term"><code class="literal">"urlPatterns"</code></span></dt><dd><p>A list of URL patterns to which the filter applies. The default 
        is <code class="literal">["/openidm/*", "/openidmui/*"]</code>.</p></dd><dt><span class="term"><code class="literal">"initParams"</code></span></dt><dd><p>Filter configuration initialization parameters that are passed 
        to the servlet filter <code class="literal">init</code> method. For more 
        information, see 
        <a class="link" href="http://docs.oracle.com/javaee/5/api/javax/servlet/FilterConfig.html" target="_top">http://docs.oracle.com/javaee/5/api/javax/servlet/FilterConfig.html</a>.
        </p></dd></dl></div><p>When a servlet filter is used to integrate an access management 
  product, the specific servlet filter that is used, and the configuration 
  that is associated with that filter, is product-specific. The sample 
  configuration in <code class="filename">openidm/samples/openam</code> is specific 
  to OpenAM. For a detailed description of the OpenAM implementation, 
  see <span class="olink">
  <em class="citetitle">Protecting OpenIDM With OpenAM</em></span>.</p></div></div><div lang="en" class="appendix" id="appendix-interface-stability"><div class="titlepage"><div><div><h1 class="title">Appendix&nbsp;I.&nbsp;Release Levels &amp; Interface Stability</h1></div></div></div><p>This appendix includes ForgeRock definitions for product release levels
 and interface stability.</p><div lang="en" class="section" id="release-levels"><div class="titlepage"><div><div><h2 class="title" style="clear: both">I.1.&nbsp;ForgeRock Product Release Levels</h2></div></div></div><p>
  ForgeRock defines Major, Minor, and Maintenance product release levels.

  The release level is reflected in the version number.

  The release level tells you what sort of compatibility changes to expect.
 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Major (version: x[.0.0], trailing 0s are optional)</span></dt><dd><p>
     Major releases bring big new features.

     Major releases can include changes even to Stable interfaces.

     Major releases can remove previously Deprecated functionality,
     and in rare cases remove Evolving functionality
     that has not been explicitly Deprecated.

     Major releases also include the changes present
     in previous Minor and Maintenance releases.
    </p></dd><dt><span class="term">Minor (version: x.y[.0], trailing 0s are optional)</span></dt><dd><p>
     Minor releases might include new features,
     backwards-compatible changes to Stable interfaces in the same Major release,
     and incompatible changes to Evolving interfaces.

     Minor releases can remove previously Deprecated functionality.

     Minor releases also include the changes present in Maintenance releases.
    </p></dd><dt><span class="term">Maintenance (version: x.y.z)</span></dt><dd><p>
     Maintenance releases can include bug fixes.

     Maintenance releases are intended
     to be fully compatible with previous versions from the same Minor release.
    </p></dd></dl></div></div><div lang="en" class="section" id="interface-stability"><div class="titlepage"><div><div><h2 class="title" style="clear: both">I.2.&nbsp;Open Identity Platform Product Interface Stability</h2></div></div></div><p>
  Open Identity Platform products support many protocols, APIs, GUIs,
  and command-line interfaces.

  Some of these interfaces are standard and very stable.

  Others offer new functionality that is continuing to evolve.
 </p><p>
  We realize that you invest in these interfaces,
  and therefore must know when and how ForgeRock expects them to change.

  For that reason, Open Identity Platform Community defines interface stability labels
  and uses these definitions in ForgeRock products.
 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Stable</span></dt><dd><p>
     This documented interface is expected to undergo only
     backwards-compatible changes between major releases.

     Changes are announced at least one minor release before they take effect.
    </p></dd><dt><span class="term">Evolving</span></dt><dd><p>
     This documented interface is continuing to evolve
     and so is expected to change,
     potentially in backwards-incompatible ways even in a minor release.

     Changes are documented at the time of product release.
    </p><p>
     While new protocols and APIs are still in the process of standardization,
     they are Evolving.

     This applies for example to recent Internet-Draft implementations,
     and also to newly developed functionality.
    </p></dd><dt><span class="term">Deprecated</span></dt><dd><p>
     This interface is deprecated
     and likely to be removed in a future release.

     For previously stable interfaces,
     the change was likely announced in a previous release.

     Deprecated interfaces will be removed from Open Identity Platform products.
    </p></dd><dt><span class="term">Removed</span></dt><dd><p>
     This interface was deprecated in a previous release
     and has now been removed from the product.
    </p></dd><dt><span class="term">Internal/Undocumented</span></dt><dd><p>
     Internal and undocumented interfaces can change without notice.

     If you depend on one of these interfaces,
     contact Open Identity Platform <a class="link" href="https://github.com/OpenIdentityPlatform" target="_top">support</a>
     to discuss your needs.
    </p></dd></dl></div></div></div><div lang="en" class="glossary" id="openidm-glossary"><div class="titlepage"><div><div><h1 class="title">OpenIDM Glossary</h1></div></div></div><dl><dt><span class="glossterm">JSON</span></dt><dd class="glossdef"><p>JavaScript Object Notation, a lightweight data interchange format 
  based on a subset of JavaScript syntax. For more information, see the 
  <a class="link" href="http://www.json.org" target="_blank">JSON</a> site.</p></dd><dt><span class="glossterm">managed object</span></dt><dd class="glossdef"><p>An object that represents the identity-related data managed by OpenIDM. 
  Managed objects are configurable, JSON-based data structures that OpenIDM 
  stores in its pluggable repository. The default configuration of a managed 
  object is that of a user, but you can define any kind of managed object, for 
  example, groups or roles.</p></dd><dt><span class="glossterm">mapping</span></dt><dd class="glossdef"><p>A policy that is defined between a source object and a target object 
  during reconciliation or synchronization. A mapping can also define a trigger 
  for validation, customization, filtering, and transformation of source and 
  target objects.</p></dd><dt><span class="glossterm">OSGi</span></dt><dd class="glossdef"><p>A module system and service platform for the Java programming language 
  that implements a complete and dynamic component model. For a good 
  introduction, see the <a class="link" href="http://www.osgi.org/About/WhyOSGi" target="_blank">OSGi</a> site. OpenIDM 
  services are designed to run in any OSGi container, but OpenIDM currently 
  runs in <a class="link" href="http://felix.apache.org/site/index.html" target="_blank">Apache Felix</a>.</p></dd><dt><span class="glossterm">reconciliation</span></dt><dd class="glossdef"><p>During reconciliation, comparisons are made between managed objects 
  and objects on source or target systems. Reconciliation can result in one 
  or more specified actions, including, but not limited to, synchronization.
  </p></dd><dt><span class="glossterm">resource</span></dt><dd class="glossdef"><p>An external system, database, directory server, or other source of 
  identity data to be managed and audited by the identity management system.
  </p></dd><dt id="gloss-rest"><span class="glossterm">REST</span></dt><dd class="glossdef"><p>Representational State Transfer. A software architecture style for 
  exposing resources, using the technologies and protocols of the World Wide Web. 
  REST describes how distributed data objects, or resources, can be defined and 
  addressed.
  </p></dd><dt><span class="glossterm">source object</span></dt><dd class="glossdef"><p>In the context of reconciliation, a source object is a data object on 
  the source system, that OpenIDM scans before attempting to find a 
  corresponding object on the target system. Depending on the defined mapping, 
  OpenIDM then adjusts the object on the target system (target object).</p></dd><dt><span class="glossterm">synchronization</span></dt><dd class="glossdef"><p>The synchronization process creates, updates, or deletes objects on a 
  target system, based on the defined mappings from the source system. 
  Synchronization can be scheduled or on demand.</p></dd><dt><span class="glossterm">system object</span></dt><dd class="glossdef"><p>A pluggable representation of an object on an external system. For 
  example, a user entry that is stored in an external LDAP directory is 
  represented as a system object in OpenIDM for the period during which 
  OpenIDM requires access to that entry.System objects follow the same 
  RESTful resource-based design principles as managed objects.</p></dd><dt><span class="glossterm">target object</span></dt><dd class="glossdef"><p>In the context of reconciliation, a target object is a data object on 
  the target system, that OpenIDM scans after locating its corresponding object 
  on the source system. Depending on the defined mapping, OpenIDM then adjusts 
  the target object to match the corresponding source object.</p></dd></dl></div><div class="index" id="d0e16563"><div class="titlepage"><div><div><h1 class="title">Index</h1></div></div></div><div xmlns:xlink="http://www.w3.org/1999/xlink" class="index"><div class="indexdiv"><h3>A</h3><dl><dt id="ientry-d0e252">Architecture, <a class="indexterm" href="#chap-overview">Architectural Overview</a></dt><dt id="ientry-d0e11054">Audit logs, <a class="indexterm" href="#chap-auditing">Using Audit Logs</a></dt><dt id="ientry-d0e9125">Authentication, <a class="indexterm" href="#chap-auth">Managing Authentication, Authorization and RBAC</a></dt><dd><dl><dt>Internal users, <a class="indexterm" href="#openidm-users">OpenIDM Users</a>, <a class="indexterm" href="#security-messages">Use Message Level Security</a></dt><dt>Managed users, <a class="indexterm" href="#openidm-users">OpenIDM Users</a></dt><dt>Roles, <a class="indexterm" href="#openidm-roles">Roles</a></dt></dl></dd><dt id="ientry-d0e9128">Authorization, <a class="indexterm" href="#chap-auth">Managing Authentication, Authorization and RBAC</a>, <a class="indexterm" href="#openidm-authorization">Authorization</a></dt></dl></div><div class="indexdiv"><h3>B</h3><dl><dt id="ientry-d0e9626">Best practices, <a class="indexterm" href="#chap-security">Securing &amp; Hardening OpenIDM</a>, <a class="indexterm" href="#chap-best-practices">OpenIDM Project Best Practices</a></dt><dt id="ientry-d0e10090">Business processes, <a class="indexterm" href="#chap-workflow">Integrating Business Processes and Workflows</a></dt></dl></div><div class="indexdiv"><h3>C</h3><dl><dt id="ientry-d0e1479">Configuration</dt><dd><dl><dt>Email, <a class="indexterm" href="#chap-mail">Sending Email</a></dt><dt>Files, <a class="indexterm" href="#appendix-file-layout">File Layout</a></dt><dt>Objects, <a class="indexterm" href="#configuration-objects">OpenIDM Configuration Objects</a></dt><dt>REST API, <a class="indexterm" href="#configuring-over-rest">Configuring OpenIDM Over REST</a></dt><dt>Validating, <a class="indexterm" href="#cli-validate">validate</a></dt></dl></dd><dt id="ientry-d0e3416">Connectors, <a class="indexterm" href="#chap-resource-conf">Connecting to External Resources</a></dt><dd><dl><dt>Examples, <a class="indexterm" href="#connector-examples">Connector Configuration Examples</a></dt><dt>Generating configurations, <a class="indexterm" href="#connector-wiz">Creating Default Connector Configurations</a></dt><dt>Object types, <a class="indexterm" href="#openicf-provisioner-conf">Configuring Connectors</a></dt><dt>Remote, <a class="indexterm" href="#connector-info-provider-conf">Accessing Remote Connectors</a></dt></dl></dd><dt id="ientry-d0e7498">Correlation queries, <a class="indexterm" href="#correlation">Correlation Queries</a></dt></dl></div><div class="indexdiv"><h3>D</h3><dl><dt id="ientry-d0e2679">Data</dt><dd><dl><dt>accessing, <a class="indexterm" href="#chap-data">Accessing Data Objects</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>E</h3><dl><dt id="ientry-d0e9785">Encryption, <a class="indexterm" href="#security-encrypt-data">Encrypt Data Internally &amp; Externally</a>, <a class="indexterm" href="#security-replace-defaults">Replace Default Security Settings</a></dt></dl></div><div class="indexdiv"><h3>F</h3><dl><dt id="ientry-d0e12179">File layout, <a class="indexterm" href="#appendix-file-layout">File Layout</a></dt></dl></div><div class="indexdiv"><h3>H</h3><dl><dt id="ientry-d0e1020">healthcheck, <a class="indexterm" href="#system-healthcheck">Verifying the Health of an OpenIDM System</a></dt></dl></div><div class="indexdiv"><h3>K</h3><dl><dt id="ientry-d0e1433">Keytool, <a class="indexterm" href="#cli-keytool">keytool</a></dt></dl></div><div class="indexdiv"><h3>L</h3><dl><dt id="ientry-d0e5636">LiveSync, <a class="indexterm" href="#sync-types">Types of Synchronization</a></dt><dd><dl><dt>Scheduling, <a class="indexterm" href="#scheduling-synchronization">Scheduling Synchronization</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>M</h3><dl><dt id="ientry-d0e447">Mappings, <a class="indexterm" href="#openidm-core-services">Core Services</a>, <a class="indexterm" href="#synchronization-mappings-file">Synchronization Mappings File</a></dt><dd><dl><dt>Hooks for scripting, <a class="indexterm" href="#advanced-dataflow">Advanced Data Flow Configuration</a></dt><dt>Scheduled reconciliation, <a class="indexterm" href="#alternative-mapping">Alternative Mappings</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>O</h3><dl><dt id="ientry-d0e410">Objects</dt><dd><dl><dt>Audit objects, <a class="indexterm" href="#audit-objects">Audit Objects</a></dt><dt>Configuration objects, <a class="indexterm" href="#configuration-objects">OpenIDM Configuration Objects</a></dt><dt>Links, <a class="indexterm" href="#links">Links</a></dt><dt>Managed objects, <a class="indexterm" href="#openidm-core-services">Core Services</a>, <a class="indexterm" href="#sync-flexible-data">Flexible Data Model</a>, <a class="indexterm" href="#managed-users">Managed Users</a>, <a class="indexterm" href="#managed-objects">Managed Objects</a>, <a class="indexterm" href="#appendix-rest">REST API Reference</a></dt><dd><dl><dt>Customizing, <a class="indexterm" href="#custom-managed-objects">Custom Managed Objects</a></dt><dt>Identifiers, <a class="indexterm" href="#rest-object-identifier">Object Identifiers</a></dt><dt>Passwords, <a class="indexterm" href="#enforce-password-policy">Enforcing Password Policy</a></dt></dl></dd><dt>Object types, <a class="indexterm" href="#appendix-objects">Data Models and Objects Reference</a></dt><dt>Script access, <a class="indexterm" href="#data-scripts">Accessing Data Objects by Using Scripts</a>, <a class="indexterm" href="#function-ref">Function Reference</a></dt><dt>System objects, <a class="indexterm" href="#openidm-core-services">Core Services</a>, <a class="indexterm" href="#system-objects">System Objects</a></dt></dl></dd><dt id="ientry-d0e3422">OpenICF, <a class="indexterm" href="#chap-resource-conf">Connecting to External Resources</a></dt></dl></div><div class="indexdiv"><h3>P</h3><dl><dt id="ientry-d0e8735">Passwords, <a class="indexterm" href="#chap-passwords">Managing Passwords</a>, <a class="indexterm" href="#security-replace-defaults">Replace Default Security Settings</a></dt><dt id="ientry-d0e3048">Policies, <a class="indexterm" href="#chap-policies">Using Policies to Validate Data</a></dt><dt id="ientry-d0e9919">Ports</dt><dd><dl><dt>8080, <a class="indexterm" href="#appendix-ports-used">Ports Used</a></dt><dt>8443, <a class="indexterm" href="#appendix-ports-used">Ports Used</a></dt><dt>8444, <a class="indexterm" href="#appendix-ports-used">Ports Used</a></dt><dt>Disabling, <a class="indexterm" href="#security-jetty">Secure Jetty</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>R</h3><dl><dt id="ientry-d0e467">Reconciliation, <a class="indexterm" href="#openidm-core-services">Core Services</a>, <a class="indexterm" href="#sync-types">Types of Synchronization</a></dt><dd><dl><dt>Scheduling, <a class="indexterm" href="#scheduling-synchronization">Scheduling Synchronization</a></dt></dl></dd><dt id="ientry-d0e3419">Resources, <a class="indexterm" href="#chap-resource-conf">Connecting to External Resources</a></dt><dt id="ientry-d0e2305">REST API, <a class="indexterm" href="#configuring-over-rest">Configuring OpenIDM Over REST</a>, <a class="indexterm" href="#appendix-rest">REST API Reference</a></dt><dd><dl><dt>Listing configuration objects, <a class="indexterm" href="#configuring-over-rest">Configuring OpenIDM Over REST</a></dt></dl></dd><dt id="ientry-d0e9335">Roles, <a class="indexterm" href="#openidm-roles">Roles</a></dt><dt id="ientry-d0e15855">Router service, <a class="indexterm" href="#appendix-router">Router Service Reference</a></dt></dl></div><div class="indexdiv"><h3>S</h3><dl><dt id="ientry-d0e8319">Schedule</dt><dd><dl><dt>Examples, <a class="indexterm" href="#scheduler-examples">Schedule Examples</a></dt></dl></dd><dt id="ientry-d0e7669">Scheduler, <a class="indexterm" href="#scheduling-synchronization">Scheduling Synchronization</a>, <a class="indexterm" href="#chap-scheduler-conf">Scheduling Tasks and Events</a></dt><dd><dl><dt>Configuration, <a class="indexterm" href="#scheduler-configuration-file">Scheduler Configuration</a></dt></dl></dd><dt id="ientry-d0e7827">Scheduling tasks, <a class="indexterm" href="#chap-scheduler-conf">Scheduling Tasks and Events</a></dt><dt id="ientry-d0e14800">Scripting, <a class="indexterm" href="#appendix-scripting">Scripting Reference</a></dt><dd><dl><dt>Functions, <a class="indexterm" href="#function-ref">Function Reference</a></dt></dl></dd><dt id="ientry-d0e9629">Security, <a class="indexterm" href="#chap-security">Securing &amp; Hardening OpenIDM</a></dt><dd><dl><dt>Authentication, <a class="indexterm" href="#security-messages">Use Message Level Security</a></dt><dt>Encryption, <a class="indexterm" href="#security-encrypt-data">Encrypt Data Internally &amp; Externally</a>, <a class="indexterm" href="#security-replace-defaults">Replace Default Security Settings</a></dt><dt>SSL, <a class="indexterm" href="#security-ssl-https">Use SSL and HTTPS</a></dt></dl></dd><dt id="ientry-d0e11729">Sending mail, <a class="indexterm" href="#chap-mail">Sending Email</a></dt><dt id="ientry-d0e3372">Server logs, <a class="indexterm" href="#chap-logs">Configuring Server Logs</a></dt><dt id="ientry-d0e518">Starting OpenIDM, <a class="indexterm" href="#starting-and-stopping">To Start and Stop OpenIDM</a></dt><dt id="ientry-d0e521">Stopping OpenIDM, <a class="indexterm" href="#starting-and-stopping">To Start and Stop OpenIDM</a></dt><dt id="ientry-d0e464">Synchronization, <a class="indexterm" href="#openidm-core-services">Core Services</a>, <a class="indexterm" href="#chap-synchronization">Configuring Synchronization</a>, <a class="indexterm" href="#appendix-synchronization">Synchronization Reference</a></dt><dd><dl><dt>Actions, <a class="indexterm" href="#handling-sync">Synchronization Situations and Actions</a></dt><dt>Conditions, <a class="indexterm" href="#synchronization-mappings-file">Synchronization Mappings File</a></dt><dt>Connectors, <a class="indexterm" href="#connector-config-files">Connector Configuration Files</a></dt><dt>Correlation queries, <a class="indexterm" href="#correlation">Correlation Queries</a></dt><dt>Creating attributes, <a class="indexterm" href="#synchronization-mappings-file">Synchronization Mappings File</a>, <a class="indexterm" href="#constructing-attributes">Constructing and Manipulating Attributes</a></dt><dt>Direct (push), <a class="indexterm" href="#sync-types">Types of Synchronization</a></dt><dt>Encryption, <a class="indexterm" href="#sync-encrypted-values">Using Encrypted Values</a></dt><dt>Filtering, <a class="indexterm" href="#synchronization-mappings-file">Synchronization Mappings File</a></dt><dt>Mappings, <a class="indexterm" href="#synchronization-mappings-file">Synchronization Mappings File</a></dt><dt>Passwords, <a class="indexterm" href="#password-sync">Password Synchronization</a></dt><dd><dl><dt>With Active Directory, <a class="indexterm" href="#password-sync">Password Synchronization</a></dt><dt>With OpenDJ, <a class="indexterm" href="#password-sync">Password Synchronization</a></dt></dl></dd><dt>Reusing links, <a class="indexterm" href="#reusing-links">Reusing Links</a></dt><dt>Scheduling, <a class="indexterm" href="#scheduling-synchronization">Scheduling Synchronization</a></dt><dt>Situations, <a class="indexterm" href="#handling-sync">Synchronization Situations and Actions</a></dt><dt>Transforming attributes, <a class="indexterm" href="#synchronization-mappings-file">Synchronization Mappings File</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>T</h3><dl><dt id="ientry-d0e12025">Troubleshooting, <a class="indexterm" href="#chap-troubleshooting">Troubleshooting</a></dt></dl></div><div class="indexdiv"><h3>W</h3><dl><dt id="ientry-d0e10087">Workflow, <a class="indexterm" href="#chap-workflow">Integrating Business Processes and Workflows</a></dt></dl></div></div></div></div><a href="#" class="back-to-top hidden-xs"><button type="button" class="btn btn-primary btn-default"><span class="glyphicon glyphicon-chevron-up"></span></button></a></div></div><div class="footer"><div class="container-fluid"><div class="footer-left"><span class="footer-item">Copyright &copy;
              2011-2013&nbsp;
              ForgeRock AS;&nbsp;
              &nbsp;
              &nbsp;
          </span></div><div class="footer-right"><a target="_blank" class="footer-item snap-left" href="legalnotice.html"><i class="glyphicon glyphicon-briefcase"></i> Legal Notice</a><a target="_blank" class="footer-item snap-left" href="https://github.com/OpenIdentityPlatform/OpenAM/issues"><i class="glyphicon glyphicon-ok-sign"></i> Feedback</a><a target="_blank" class="footer-item snap-left" href="#" data-toggle="modal" data-target="#myModal"><i class="glyphicon glyphicon-info-sign"></i> About</a></div></div></div></body></html>