<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <style type="text/css">
   /*
* The contents of this file are subject to the terms of the Common Development and
* Distribution License (the License). You may not use this file except in compliance with the
* License.
*
* You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the
* specific language governing permission and limitations under the License.
*
* When distributing Covered Software, include this CDDL Header Notice in each file and include
* the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL
* Header, with the fields enclosed by brackets [] replaced by your own identifying
* information: "Portions copyright [year] [name of copyright owner]".
*
* Copyright 2015 ForgeRock AS.
* Portions copyright 2024 3A Systems LLC.
*/

/***********************************/
/* Imported Styles
/***********************************/

@import url(https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,300,400,700);
@import url(https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css);
@import url(https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css);
/* @import url(https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css); */
@import url(https://cdnjs.cloudflare.com/ajax/libs/jquery.colorbox/1.4.33/example1/colorbox.css);

/***********************************/
/* General Styles
/***********************************/

html {
    height: 100%;
}

body {
    /* Dark Grey */

    color: #2a2f32;
    font-family: 'Open Sans', "proxima-nova", sans-serif;
}

a {
    /* Sea Green */
    color: #519387;
}

a.link[href^="http"] {
    background-image: url("includes/logos/Icon_External_Link.png");
    background-position: top right;
    background-repeat: no-repeat;
    padding-right: 15px;
    margin-right: 2px;
}

a.self-link, a.self-link:hover, a.self-link:active {
    color: inherit;
    text-decoration: none;
}

a[href].self-link:hover::after
{
    -moz-osx-font-smoothing: grayscale;
    content: "\e144";
    color: #519387;
    display: inline-block;
    font-family: "Glyphicons Halflings";
    font-size: 75%;
    font-style: normal;
    line-height: 1;
    padding-left: 5px;
    position: relative;
    top: 1px;
}


li.L0,
li.L1,
li.L2,
li.L3,
li.L5,
li.L6,
li.L7,
li.L8 {
    list-style-type: decimal !important
}

.section,
.chapter,
.preface,
.glossary,
.refentry,
.reference,
.appendix,
.index,
.titlepage h2,
.titlepage h3,
.titlepage h4,
.titlepage h5 {
    padding-top: 60px;
    margin-top: -50px;
}

.left-shape-content {
    background: url("includes/logos/left-shape-4.png") no-repeat scroll 0 0 rgba(0, 0, 0, 0);
    float: left;
    height: 566px;
    position: fixed;
    width: 57px;
    top: 60%;
    z-index: -1;
}

/***********************************/
/* Bootstrap Override Styles
/***********************************/

/* Button Styles */

.btn-primary {
    /* Sea Green */
    background-color: #519387;

    /* Dark Sea Green */
    border-color: #488378;
    color: #fff;
}

.btn-default {
    background-color: #A1A8AD;
    border-color: #8a9298;
    color: #ffffff;
}

.btn-default:hover,
.btn-default:focus,
.btn-default.focus,
.btn-default:active,
.btn-default.active,
.open > .dropdown-toggle.btn-default {
    background-color: #3f4b54;
    border-color: #1B2025;
    color: #ffffff;
}

/* Tooltip Styles */

.tooltip.in {
    opacity: 0.95;
}

.tooltip.bottom .tooltip-arrow {
    border-bottom-color: #519387;
}

.tooltip-inner {
    background-color: #519387;
}

/* List Styles */

.dl-horizontal dt {
    white-space: normal;
    padding: 0 3px 0 0;
    width: 200px;
}

.dl-horizontal dd {
    border-bottom: 1px dotted rgb(125, 179, 168);
    border-bottom: 1px dotted rgba(125, 179, 168, 0.8);
    margin-bottom: 18px;
    margin-left: 210px;
}

.dl-horizontal {
    border-top: 1px dotted rgb(125, 179, 168);
    border-top: 1px dotted rgba(125, 179, 168, 0.9);
    padding-top: 10px;
}

.variablelist dt {
    margin: 18px 0 5px 15px;
}

.variablelist dd {
    border-bottom: 1px dotted rgba(125, 179, 168, 0.8);
    margin: 5px 0 5px 30px;
}

.variablelist > dl {
    border-top: 1px dotted rgba(125, 179, 168, 0.8);
}


/***********************************/
/* Redirect Page Styles
/***********************************/

.index-redirect,
.index-redirect body {
    height: 100%;
    background-color: #333;
    font-family: 'Open Sans', "proxima-nova", sans-serif;
}
.index-redirect body {
    color: #fff;
    text-align: center;
}
.index-redirect .container {
    display: table;
    vertical-align: middle;
    height: 100%;
}
.index-redirect .btn-primary {
    /* Sea Green */
    background-color: #519387;

    /* Dark Sea Green */
    border-color: #488378;
    color: #fff;
}
.index-redirect .cover-heading {
    font-weight: 400 !important;
}
.index-redirect .vertical-center-row {
    display: table-cell;
    vertical-align: middle;
}

/***********************************/
/* Header Styles
/***********************************/

.navbar-brand {
    padding: 7px 15px;
    display: flex;
    align-items: center;
}
.navbar-brand > img {
    height: 100%;
}

.navbar.navbar-inverse.navbar-fixed-top {
    box-shadow: 0 0 10px 2px #111;
}
.nav > li > a {
    font-weight: 200;
}

/***********************************/
/* Banner Styles
/***********************************/

.jumbotron {
    /* Sea Green */
    background: url("includes/logos/hero-bg-01.png") no-repeat scroll left top #519387;
    color: white;
    box-shadow: 0 0 10px 2px grey;
    margin-top: 50px;
    padding: 0 0 10px;
}
.jumbotron small {
    color: white;
}
.jumbotron p {
    font-size: 12px;
    font-weight: 400;
    margin-bottom: 5px;
}
.jumbotron h1 {
    font-size: 23px !important;
    font-weight: 300 !important;
}

/***********************************/
/* Table of Contents Styles
/***********************************/

#sidebar .nav>li>a {
    /* Light Grey */

    color: #777;
    border-left: 4px solid transparent;
    padding: 4px 10px;
    font-size: 13px;
    font-weight: 400;
}
/* nested links */

#sidebar .nav .nav>li>a {
    padding-top: 2px;
    padding-bottom: 2px;
    padding-left: 30px;
    font-size: 12px;
}
/* nested nested links */

#sidebar .nav .nav .nav>li>a {
    font-size: 11px;
    padding-bottom: 2px;
    padding-left: 50px;
    padding-top: 4px;
}
/* nested nested nested links */

#sidebar .nav .nav .nav .nav>li>a {
    font-size: 11px;
    padding-bottom: 2px;
    padding-left: 70px;
    padding-top: 4px;
}
/* active and hover links */

#sidebar .nav>.active>a,
#sidebar .nav>.locked-active>a,
#sidebar .nav>li>a:hover,
#sidebar .nav>li>a:focus {
    text-decoration: none;
    /*
    background-color: rgb(125, 179, 168, 0.8);
    background-color: rgba(125, 179, 168, 0.8);
    border-color: rgb(45, 52, 55, 0.8);
    border-color: rgba(45, 52, 55, 0.8);
    color: white;
    */
    /* Bright Yellow */

    background-color: #eeea07;
    border-color: #eeea07;
    /* Grey */

    color: #2a2f32;
}
/* all active links */

#sidebar .nav>.active>a,
#sidebar .nav>.active:hover>a,
#sidebar .nav>.active:focus>a {
    font-weight: 600;
}
/* nested active links */

#sidebar .nav .nav>.active>a,
#sidebar .nav .nav>.active:hover>a,
#sidebar .nav .nav>.active:focus>a {
    font-weight: 400;
}
/* nested nested active links */

#sidebar .nav .nav .nav>.active>a,
#sidebar .nav .nav .nav>.active:hover>a,
#sidebar .nav .nav .nav>.active:focus>a {
    font-weight: 300;
}
/* nested nested active links */

#sidebar .nav .nav .nav>.active>a,
#sidebar .nav .nav .nav>.active:hover>a,
#sidebar .nav .nav .nav>.active:focus>a {
    font-weight: 300;
}
/* hide all (inactive) nested list */

#sidebar .nav ul.nav {
    display: none;
}
/* show active nested list */

#sidebar .nav>.active>ul.nav {
    display: block;
}
#sidebar.affix {
    top: 66px;
    position: fixed;
    bottom: 30px;
    height: auto;
    overflow-y: scroll;
}
#sidebar.affix-bottom {
    position: absolute;
}

/***********************************/
/* Content Styles
/***********************************/

/* Main Content Styles */

h1 {
    font-size: 40px !important;
    font-weight: 700 !important;
}

h1 span {
    margin-right: .3em;
}

#doc-content h1,
#doc-content .h1 {
    /* Sea Green */
    border-bottom: 2px solid #70ab9b;
    font-size: 36px;
    margin-top: 24px;
    padding-bottom: 5px;
}

h2 {
    font-size: 32px !important;
    font-weight: 700 !important;
}

h5, .h5 {
    border-bottom: 1px solid #d3d3d3;
    font-size: 16px;
    padding-bottom: 4px;
    font-style: italic;
}

.anchorjs-link .anchorjs-icon {
    color: #A1A8AD;
    text-decoration: none;
}
.anchorjs-link:hover .anchorjs-icon {
    color: #519387;
    text-decoration: none;
}

h1:hover > .anchorjs-link,
h2:hover > .anchorjs-link,
h3:hover > .anchorjs-link,
h4:hover > .anchorjs-link,
h5:hover > .anchorjs-link,
.anchorjs-link:focus {
    opacity: 1 !important;
    transition: color 0.16s linear 0s;
    text-decoration: none;
}

.chapter > p:first-of-type,
.preface > p:first-of-type {
    font-size: 21px;
    font-weight: 300;
    line-height: 1.4;
    margin-bottom: 20px;
}

#doc-content {
    padding: 0 20px 85px 10px;
}

div.procedure, div.table {
    margin-top:-50px;
    padding-top: 60px;
}

div.procedure-title, div.table-title {
    margin: 6px 0 8px;
}

div.procedure-inner {
    border-color: lightslategray;
    border-left: 6px solid lightslategray;
    border-style: dotted dotted dotted solid;
    border-width: 1px 1px 1px 6px;
    margin: 15px 0 10px;
    padding: 10px 15px 10px 10px;
}

.author {
    display: inline;
}

.table {
    font-size: 14px;
}

div.simplelist {
    margin-bottom: 10px;
    width: 100%;
    font-size: 15px;
}

/* Title Styles */

.procedure-title > a, .procedure-title > a:hover {
    color: lightslategray;
    font-size: 14pt;
    font-weight: 400;
}

.itemizedlist-title {
    font-size: 18px;
    font-weight: 600;
    margin: 12px 0 6px;
}

.figure-title {
    font-weight: bold;
    margin: 16px 0 4px;
    text-align: center;
}

.table-title {
    font-size: 12pt;
    font-weight: 700;
}

.variablelist-title {
    font-weight: bold;
    margin: 10px 0;
    text-decoration: underline;
}

/* Code Styles */

.btn-copy-cmdline,
.btn-copy-codelisting {
    /* White */

    background-color: #fff;
    /* Light Grey */

    border: 1px solid #e1e1e8;
    border-radius: 0 4px;
    color: #777;
    display: block;
    font-size: 12px;
    padding: 5px 8px;
    position: absolute;
    right: 5px;
    top: 5px;
    z-index: 10;
}

pre.prettyprint {
    border: 1px solid #ccc;
    padding: 9.5px;
    font-size: 12px;
}

.zero-clipboard {
    display: block;
    position: relative;
}
.zeroclipboard-is-hover {
    /* Light Sea Green */

    background-color: #6faa9b;
    border-color: #6faa9b;
    color: #fff;
    cursor: pointer;
}

.ui-effects-transfer {
    border: 1px dotted black;
    background-color: yellow;
    opacity: 0.4;
}

/* Modal Dialog Styles */

#doc-content .modal h1.title {
    font-size: 40px !important;
    font-weight: 500 !important;
    margin: 14px 0 5px;
}
#doc-content .modal h2.subtitle {
    font-size: 26px !important;
    font-weight: 400 !important;
    margin-bottom: 26px;
}
#doc-content .modal h3.author {
    font-size: 14px !important;
    font-style: italic;
    font-weight: 100 !important;
    margin: 4px 0 5px 18px;
}
#doc-content .modal .affiliation .orgname {
    display: block;
    font-size: 20px !important;
    font-weight: 400 !important;
    margin: 20px 0 0 0;
}
#doc-content .modal .affiliation .address p {
    font-size: 16px !important;
    font-weight: 100 !important;
    margin: 4px 0;
}
#doc-content .modal .copyright {
    display: none;
}
#doc-content .modal .copyright {
    display: none;
}
#doc-content .modal .abstract .abstract-title {
    font-size: 20px !important;
    font-weight: 400 !important;
}
#doc-content .modal .abstract > p {
    margin: 10px 0 5px 20px;
    font-size: 16px !important;
    font-weight: 100 !important;
}

/* Image Styles */

.fancybox > img {
    cursor: zoom-in;
}
a.fancybox {
    text-decoration: none;
}

#cboxTitle {
    color: #519387;
    font-size: 14px;
    font-weight: 700;
}

#cboxOverlay{
    background: none repeat scroll 0 0 rgba(66, 130, 116, 0.6);
}

img.img-responsive {
    margin-bottom: 20px;
}

/* Index Styles */

.indexdiv > h3 {
    border-bottom: 2px dotted lightgrey;
    padding-bottom: 5px;
}
.indexdiv > dl {
    margin-left: 30px;
}
.indexdiv dl {
    margin-bottom: 5px;
}
.indexdiv dt {
    margin: 5px 0 2px;
}
.indexdiv dd {
    margin-left: 35px;
}
.indexdiv .indexterm {
    font-weight: 200;
}

/* Reference Styles */

.refnamediv h2 {
    display: none;
}

.refsect1 h2,
.refsynopsisdiv h2 {
    font-size: 20px !important;
    font-weight: 400 !important;
}

.refnamediv p {
    font-size: 32px !important;
    font-weight: 700 !important;
}

/***********************************/
/* Footer Styles
/***********************************/

.back-to-top {
    position: fixed;
    bottom: 55px;
    right: 5px;
    display: none;
    z-index: 15;
}

#footer {
    display: none;
}

.footer {
    /* Light Grey */
    background-color: #f5f5f5;

    /* Medium Grey */
    border-top: 1px solid #ACB5BD;
    bottom: 0;
    font-size: 12px;
    height: 30px;
    padding-top: 4px;
    position: fixed;
    width: 100%;
    z-index: 100;
}

.footer h3 {
    margin: 0;
}

.footer a:hover {
    text-decoration: none;
}

.footer-item {
    line-height: 22px;
    margin-left: 10px;
}

.footer-item.highlighted {
    /* Orange */
    color: #f7a540;
}

.footer-item.highlighted:hover {
    /* Dark Orange */
    color: #c97208;
}

.footer span {
    /* Grey */
    color: #2a2f32;
    margin-bottom: 0;
}

.footer .footer-left {
    float: left;
}

.footer .footer-right {
    float: right;
}

/***********************************/

  </style><meta name="viewport" content="width=device-width, initial-scale=1"><title>OpenAM Installation Guide</title><script src="https://code.jquery.com/jquery-1.11.2.min.js" type="text/javascript"></script><script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js" type="text/javascript"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="description" content="Guide showing you how to install OpenAM. OpenAM provides open source Authentication, Authorization, Entitlement and Federation software."><script type="text/javascript">
     /*
 * The contents of this file are subject to the terms of the Common Development and
 * Distribution License (the License). You may not use this file except in compliance with the
 * License.
 *
 * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the
 * specific language governing permission and limitations under the License.
 *
 * When distributing Covered Software, include this CDDL Header Notice in each file and include
 * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL
 * Header, with the fields enclosed by brackets [] replaced by your own identifying
 * information: "Portions copyright [year] [name of copyright owner]".
 *
 * Copyright 2015 ForgeRock AS.
 */

//

var loadJavaScriptsFN = function () {
    $.ajaxSetup({ cache: true });
    $.getScript("http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js", function () { prettyPrint() });
    $.getScript("http://cdnjs.cloudflare.com/ajax/libs/zeroclipboard/2.2.0/ZeroClipboard.min.js", function () {enableZeroClipboardFN() });
    $.getScript("http://cdnjs.cloudflare.com/ajax/libs/jquery.colorbox/1.4.33/jquery.colorbox-min.js", function () { enableColorboxFN() });
};

var wrapConfigurablesFn = function () {
    $('*:contains("https://openam.example.com:8443")').each(function(){
        if($(this).children().length < 1)
            $(this).html(
                $(this).text().replace(new RegExp("https://openam.example.com:8443", 'g'),'<span class="exampleUrl">https://openam.example.com:8443</span>')
            )
    });
    $('*:contains("amadmin")').each(function(){
        if($(this).children().length < 1)
            $(this).html(
                $(this).text().replace(new RegExp("amadmin", 'g'),'<span class="exampleAdmin">amadmin</span>')
            )
    });
    $('*:contains("iPlanetDirectoryPro")').each(function(){
        if($(this).children().length < 1)
            $(this).html(
                $(this).text().replace(new RegExp("iPlanetDirectoryPro", 'g'),'<span class="exampleSsoCookieName">iPlanetDirectoryPro</span>')
            )
    });
};

var btnClickHandler = function () {
    $("button#applyDocUpdate").click(function(){

        $('span.exampleUrl').fadeOut("slow", function(){
            $('span.exampleUrl').text($("input#exampleUrl").val());
            $('span.exampleUrl').fadeIn("slow");
        });

        $('span.exampleAdmin').fadeOut("slow", function(){
            $('span.exampleAdmin').text($("input#exampleAdmin").val());
            $('span.exampleAdmin').fadeIn("slow");
        });

        $('span.exampleSsoCookieName').fadeOut("slow", function(){
            $('span.exampleSsoCookieName').text($("input#exampleSsoCookieName").val());
            $('span.exampleSsoCookieName').fadeIn("slow");
        });

        $('#docConfig').modal('hide');
    });
};


var addCopyButtonFN = function () {
    $( ".cmdline" ).each(function() {
        $(this).before('<div class="zero-clipboard hidden-xs"><span class="btn-copy-cmdline"><span class="glyphicon glyphicon-pencil"></span> Copy<span class="hidden-sm"> command to clipboard</span></span></div>');
    });

    $( ".codelisting" ).each(function() {
        $(this).before('<div class="zero-clipboard hidden-xs"><span class="btn-copy-codelisting"><span class="glyphicon glyphicon-pencil"></span> Copy<span class="hidden-sm"> code to clipboard</span></span></div>');
    });
};
var enableScrollSpyFN = function () {
    $('body').scrollspy({
        target: '#sidebar',
        offset: 16
    });
};

var enableToolTipFN = function () {
    $(function () {
        $("[data-toggle='tooltip']").tooltip({placement: 'bottom'});
    });
};

var enableBackToTopFadeInFN = function () {
    var offset = 220;
    var duration = 500;
    $(window).scroll(function() {
        if ($(this).scrollTop() > offset) {
            $('.back-to-top').fadeIn(duration);
        } else {
            $('.back-to-top').fadeOut(duration);
        }
    });

    $('.back-to-top').click(function(event) {
        event.preventDefault();
        $('html, body').animate({scrollTop: 0}, duration);
        return false;
    })
};

var enableClampedWidthsFN = function () {

    /*
     * Clamped-width.
     * Usage:
     *  <div data-clampedwidth=".myParent">This long content will force clamped width</div>
     *
     * Author: LV
     */
    $('[data-clampedwidth]').each(function () {
        var elem = $(this);
        var parentPanel = elem.data('clampedwidth');
        var resizeFn = function () {
            var sideBarNavWidth = $(parentPanel).width() - parseInt(elem.css('paddingLeft')) - parseInt(elem.css('paddingRight')) - parseInt(elem.css('marginLeft')) - parseInt(elem.css('marginRight')) - parseInt(elem.css('borderLeftWidth')) - parseInt(elem.css('borderRightWidth'));
            elem.css('width', sideBarNavWidth);
        };

        resizeFn();
        $(window).resize(resizeFn);
    });
};

var affixToCFN = function() {
    $('#sidebar').affix({
        offset: {
            top: function () {
                return (this.top = $('.jumbotron').outerHeight(true)-66)
            }
        }
    });
};

var attachAnchorsToHeadings = function() {
    //addAnchors('h1.title, h2.title, h3.title, h4.title, h5.title');


    $('h1.title, h2.title, h3.title, h4.title, h5.title, .procedure-title, .table-title').each(function () {

        var href = $(this).closest("div[id]").attr("id");

        if (href === undefined || href === "") { // Unable to locate ID of parent element.
            return;
        }

        $(this).wrapInner('<a class=\"self-link" href=\"#' + href + '\"></a>');

    });
};

var addZeroClipboardToCmdlineButtonsFN = function () {
    var copycmdline = new ZeroClipboard( $('.btn-copy-cmdline') );

    copycmdline.on( 'ready', function(event) {
        // console.log( 'movie is loaded' );

        copycmdline.on( 'copy', function(event) {
            var wrappedText = "";
            $(event.target).parent().next().find("strong").each(function(index) {
                wrappedText += $(this).text() + "\n";
            });
            event.clipboardData.setData('text/plain', wrappedText);
        });

        copycmdline.on( 'aftercopy', function(event) {
            // console.log('Copied to clipboard: ' + event.data['text/plain']);
            $(event.target).parent().next().find("strong").each(function(index) {
                $(this).effect("transfer", { to: $(event.target)}, 750);
            });
        });
    });

    copycmdline.on( 'error', function(event) {
        console.log( 'ZeroClipboard error of type "' + event.name + '": ' + event.message );
        ZeroClipboard.destroy();
    });
};

var addZeroClipboardToCodeButtonsFN = function () {
    var copycodelisting = new ZeroClipboard( $('.btn-copy-codelisting') );

    copycodelisting.on( 'ready', function(event) {
        //console.log( 'movie is loaded' );

        copycodelisting.on( 'copy', function(event) {
            var wrappedText = "";
            $(event.target).parent().next(".codelisting.linenums").children().contents().each(function(index) {
                wrappedText += $(this).text() + "\n";
            });
            if(wrappedText == "") {
                wrappedText = $(event.target).parent().next(".codelisting").contents().text();
            };
            event.clipboardData.setData('text/plain', wrappedText);
        });

        copycodelisting.on( 'aftercopy', function(event) {
            // console.log('Copied code to clipboard: ' + event.data['text/plain']);
            $(event.target).parent().next(".codelisting").first().effect("transfer", { to: $(event.target)}, 750);
        });
    });

    copycodelisting.on( 'error', function(event) {
        console.log( 'ZeroClipboard error of type "' + event.name + '": ' + event.message );
        ZeroClipboard.destroy();
    });
};

var enableColorboxFN = function () {
    $(".fancybox").colorbox({
        title: function() {
            return $(this).children('img').attr('alt');
        },
        opacity: 1,
        transition:"elastic",
        initialWidth: 0,
        initialHeight: 0,
        maxWidth:"95%",
        maxHeight: "95%",
        scalePhotos: true,
        fixed: true
    });
};

var trackPageViewsFN = function () {

    $("a").click(function() {
        var href = $(this).attr('href');
        if(href) {
            var titleText =  $(this).text();
            if(href.charAt(0) === '#') {
                ga('send', {
                    'hitType': 'pageview',
                    'page': location.pathname + location.search + href,
                    'title': titleText
                });
            };
            if(href.charAt(0) === '.') {
                var lastHashPos = href.lastIndexOf('#');
                var cleanHref = href.slice(3,lastHashPos);
                var cleanFrag = href.slice(lastHashPos);
                if(window.location.href.search(cleanHref) > -1)
                {
                    ga('send', {
                        'hitType': 'pageview',
                        'page': location.pathname + location.search + cleanFrag,
                        'title': titleText
                    });
                }
            };
        }
    });
};

var enableZeroClipboardFN = function () {
    ZeroClipboard.config({
            swfPath:  "includes/swf/ZeroClipboard.swf",
            trustedDomains: ["*"],
            forceEnhancedClipboard: false,
            forceHandCursor: true,
            debug: false}
    );
    addCopyButtonFN();
    addZeroClipboardToCmdlineButtonsFN();
    addZeroClipboardToCodeButtonsFN();
};

$(document).ready(function() {
    //wrapConfigurablesFn();
    btnClickHandler();
    enableToolTipFN();
    enableBackToTopFadeInFN();
    enableClampedWidthsFN();
    enableScrollSpyFN();
    affixToCFN();
    attachAnchorsToHeadings();
    trackPageViewsFN();
    loadJavaScriptsFN();
});

//

    </script></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navbar navbar-inverse navbar-fixed-top"><nav class="container-fluid"><div class="navbar-header"><a href="/" class="navbar-brand"><span>Open Identity Platform</span></a></div><ul id="pdf-link" class="nav navbar-nav navbar-right hidden-xs"><li><a href="https://github.com/OpenIdentityPlatform/OpenAM/wiki/docbkx/pdf/OpenAM-Install-Guide.pdf" target="_blank"><span class="glyphicon glyphicon-save"></span> Download PDF Version</a></li></ul></nav></div><div class="jumbotron"><div class="container-fluid"><h1>OpenAM  Installation Guide<span></span><small></small></h1><p>Guide showing you how to install OpenAM. OpenAM provides open source
   Authentication, Authorization, Entitlement and Federation software.</p></div></div><div class="left-shape-content"></div><div class="container-fluid"><div class="row"><div class="col-sm-3 hidden-xs"><div id="sidebar" data-clampedwidth=".col-sm-3"><h4 class="toc-title">OpenAM  Installation Guide<br><small class="toc-subtitle"></small></h4><ul class="nav nav-stacked"><li><a href="#preface">Preface</a><ul class="nav nav-stacked"><li><a href="#d4462e122">1. Who Should Use this Guide</a></li><li><a href="#formatting-conventions">2. Formatting Conventions</a></li><li><a href="#accessing-doc-online">3. Accessing Documentation Online</a></li><li><a href="#joining-the-community">4. Joining the Open Identity Platform Community</a></li></ul></li><li><a href="#chap-prepare-install">1. Preparing For Installation</a><ul class="nav nav-stacked"><li><a href="#prepare-networking">1.1. Preparing a Fully-Qualified Domain Name</a></li><li><a href="#prepare-java">1.2. Preparing a Java Environment</a><ul class="nav nav-stacked"><li><a href="#prepare-java-sun">1.2.1. Settings For Sun/Oracle Java Environments</a></li><li><a href="#prepare-java-ibm">1.2.2. Settings For IBM Java Environments</a></li></ul></li><li><a href="#prerequisites-file-descriptors">1.3. Setting Maximum File Descriptors</a></li><li><a href="#prepare-configuration-store">1.4. Preparing a Configuration Data Store</a></li><li><a href="#prepare-identity-repository">1.5. Preparing an Identity Repository</a></li><li><a href="#download-openam-software">1.6. Obtaining OpenAM Software</a></li><li><a href="#prepare-apache-tomcat">1.7. Preparing Apache Tomcat</a></li><li><a href="#prepare-glassfish">1.8. Preparing GlassFish</a><ul class="nav nav-stacked"><li><a href="#prepare-glassfish-v2">1.8.1. Preparing GlassFish v2</a></li><li><a href="#prepare-glassfish-v3">1.8.2. Preparing GlassFish v3</a></li></ul></li><li><a href="#prepare-jboss-5">1.9. Preparing OpenAM &amp; JBoss 4 or 5</a></li><li><a href="#prepare-jboss-7">1.10. Preparing OpenAM &amp; JBoss AS 7 / EAP 6</a></li><li><a href="#prepare-jetty">1.11. Preparing Jetty</a></li><li><a href="#prepare-oracle-weblogic">1.12. Preparing Oracle WebLogic</a></li><li><a href="#prepare-ibm-websphere">1.13. Preparing IBM WebSphere</a></li></ul></li><li><a href="#chap-install-core">2. Installing OpenAM Core Services</a></li><li><a href="#chap-install-tools">3. Installing OpenAM Tools</a></li><li><a href="#chap-install-das">4. Installing OpenAM Distributed Authentication</a></li><li><a href="#chap-custom-ui">5. Customizing the OpenAM End User Pages</a><ul class="nav nav-stacked"><li><a href="#update-classic-ui">5.1. Updating the Classic UI</a></li><li><a href="#lookup-for-ui-files">5.2. How OpenAM Looks Up UI Files</a></li><li><a href="#basic-xui-configuration">5.3. Configuring the XUI</a></li></ul></li><li><a href="#chap-cts">6. Configuring the Core Token Service (CTS)</a><ul class="nav nav-stacked"><li><a href="#cts-config">6.1. CTS Configuration Parameters</a></li><li><a href="#cts-schema">6.2. Preparing an OpenDJ Directory Service for CTS</a></li><li><a href="#cts-acis">6.3. CTS Access Control Instructions</a></li><li><a href="#cts-replication">6.4. CTS and OpenDJ Replication</a></li><li><a href="#cts-deployment">6.5. CTS Deployment Scenario</a></li><li><a href="#cts-token-size">6.6. Managing CTS Tokens</a></li><li><a href="#cts-general-recommend">6.7. General Recommendations for CTS Configuration</a></li></ul></li><li><a href="#chap-session-failover">7. Setting Up OpenAM Session Failover</a></li><li><a href="#chap-uninstall">8. Removing OpenAM Software</a></li><li><a href="#d4462e3990">Index</a></li></ul></div></div><div id="doc-content" class="col-sm-9"><div class="titlepage modal fade" id="myModal"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">X</span></button><h4 class="modal-title">About this document</h4></div><div class="modal-body"><div><div><h1 class="title">OpenAM  Installation Guide</h1></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Mark</span> <span class="surname">Craig</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Vanessa</span> <span class="surname">Richie</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Mike</span> <span class="surname">Jang</span></h3></div></div></div><div><p class="releaseinfo"></p></div><div><p class="copyright">Copyright &copy; 2011-2013 ForgeRock AS</p></div><div><a href="legalnotice.html">Legal Notice</a></div><div><p class="pubdate">Publication date: September&nbsp;09,&nbsp;2024</p></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>Guide showing you how to install OpenAM. OpenAM provides open source
   Authentication, Authorization, Entitlement and Federation software.</p></div></div></div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><div lang="en" class="preface" id="preface"><div class="titlepage"><div><div><h1 class="title">Preface</h1></div></div></div><p>This guide shows you how to install core OpenAM services for access
 and federation management. Unless you are planning a throwaway evaluation
 or test installation, read the <em class="citetitle">Release Notes</em> before
 you get started.</p><div class="section" id="d4462e122"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.&nbsp;Who Should Use this Guide</h2></div></div></div><p>This guide is written for anyone installing OpenAM to manage
  and to federate access to web applications and web based resources.</p><p>This guide covers the install, upgrade, and removal (a.k.a. uninstall)
  procedures that you theoretically perform only once per version. This
  guide aims to provide you with at least some idea of what happens
  behind the scenes when you perform the steps.</p><p>You do not need to be an OpenAM wizard to learn something from
  this guide, though a background in access management and maintaining
  web application software can help. You do need some background in
  managing services on your operating systems and in your application
  servers. You can nevertheless get started with this guide, and then
  learn more as you go along.</p></div><div lang="en" class="section" id="formatting-conventions"><div class="titlepage"><div><div><h2 class="title" style="clear: both">2.&nbsp;Formatting Conventions</h2></div></div></div><p>
  Most examples in the documentation are created in GNU/Linux or Mac OS X
  operating environments.

  If distinctions are necessary between operating environments,
  examples are labeled with the operating environment name in parentheses.

  To avoid repetition file system directory names are often given
  only in UNIX format as in <code class="filename">/path/to/server</code>,
  even if the text applies to <code class="filename">C:\path\to\server</code> as well.
 </p><p>
  Absolute path names usually begin with the placeholder
  <code class="filename">/path/to/</code>.

  This path might translate to <code class="filename">/opt/</code>,
  <code class="filename">C:\Program Files\</code>, or somewhere else on your system.
 </p><p>
  Command line, terminal sessions are formatted as follows:
 </p><pre class="cmdline prettyprint">$ <strong>echo $JAVA_HOME</strong>
<em>/path/to/jdk</em></pre><p>
  Command output is sometimes formatted for narrower, more readable output
  even though formatting parameters are not shown in the command.
  In the following example,
  the query string parameter <code class="literal">_prettyPrint=true</code> is omitted
  and some of the output is replaced with an ellipsis (<code class="literal">...</code>):
 </p><pre class="cmdline prettyprint">
$ <strong>curl https://bjensen:hifalutin@opendj.example.com:8443/users/newuser</strong>
<em>{
  "_rev" : "000000005b337348",
  "_id" : "newuser",
  ...
}</em>
 </pre><p>
  Program listings are formatted as follows:
 </p><pre class="codelisting prettyprint">
class Test {
    public static void main(String [] args)  {
        System.out.println("This is a program listing.");
    }
}
 </pre></div><div lang="en" class="section" id="accessing-doc-online"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.&nbsp;Accessing Documentation Online</h2></div></div></div><p>
  Open Identity Platform core documentation, such as this document, aims to be
  technically accurate and complete with respect to the software documented.
 </p><div class="itemizedlist"><p>
   Core documentation therefore follows a three-phase review process
   designed to eliminate errors:
  </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
    Product managers and software architects review project documentation design
    with respect to the readers' software lifecycle needs.
   </p></li><li class="listitem"><p>
    Subject matter experts review proposed documentation changes for
    technical accuracy and completeness
    with respect to the corresponding software.
   </p></li><li class="listitem"><p>
    Quality experts validate implemented documentation changes
    for technical accuracy, completeness in scope,
    and usability for the readership.
   </p></li></ul></div><p>
  The review process helps to ensure that documentation published for
  a Open Identity Platform release is technically accurate and complete.
 </p><p>
  Fully reviewed, published core documentation is available at
  <a class="link" href="https://doc.openidentityplatform.org/" target="_blank">https://doc.openidentityplatform.org/</a>.
  Use this documentation when working with a Open Identity Platform release.
 </p><p>
  You can find pre-release draft documentation at the online
  <a class="link" href="https://github.com/OpenIdentityPlatform" target="_blank">community resource center</a>.
  Use this documentation when trying a nightly build.
 </p></div><div lang="en" class="section" id="joining-the-community"><div class="titlepage"><div><div><h2 class="title" style="clear: both">4.&nbsp;Joining the Open Identity Platform Community</h2></div></div></div><p>
  Visit the
  <a class="link" href="https://github.com/OpenIdentityPlatform" target="_blank">community resource center</a>
  where you can find information about each project,
  download nightly builds, browse the resource catalog,
  ask and answer questions on the forums, find community events near you,
  and of course get the source code as well.
 </p></div></div><div lang="en" class="chapter" id="chap-prepare-install"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;1.&nbsp;Preparing For Installation</h1></div></div></div><a class="indexterm" name="d4462e228"></a><p>This chapter covers prerequisites for installing OpenAM software,
 including how to prepare your application server to run OpenAM, how to prepare
 directory services to store configuration data, and how to prepare an identity
 repository to handle OpenAM identities.</p><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>If a Java Security Manager is enabled for your application server,
  add permissions before installing OpenAM.</p></div></div><div class="section" id="prepare-networking"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.1.&nbsp;Preparing a Fully-Qualified Domain Name</h2></div></div></div><p>OpenAM requires that you provide the fully-qualified domain name (FQDN)
  when you configure it. Before you set up OpenAM, be sure that your system
  has an FQDN such as <code class="literal">openam.example.com</code>. For evaluation
  purposes, you can give your system an alias using the
  <code class="filename">/etc/hosts</code> file on UNIX systems or
  <code class="filename">%SystemRoot%\system32\drivers\etc\hosts</code> on Windows. For
  deployment, make sure the FQDN is properly assigned for example using
  DNS.</p><p>Do not use the <code class="literal">localhost</code> domain for OpenAM, not even
  for testing purposes. OpenAM relies on browser cookies, which are returned
  based on domain name. Furthermore, use a domain name that contains at least 2
  <code class="literal">.</code> (dot) characters, such
  <code class="literal">openam.example.com</code>.</p></div><div class="section" id="prepare-java"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.2.&nbsp;Preparing a Java Environment</h2></div></div></div><a class="indexterm" name="d4462e265"></a><p>OpenAM software depends on a Java runtime environment. Check the output
  of <span class="command"><strong>java -version</strong></span> to make sure your the version is supported
  according to the <em class="citetitle">Release Notes</em> section on <a href="../release-notes/index.html#java-requirements" class="link"><em class="citetitle">Java
  Requirements</em></a>.</p><div class="section" id="prepare-java-sun"><div class="titlepage"><div><div><h3 class="title">1.2.1.&nbsp;Settings For Sun/Oracle Java Environments</h3></div></div></div><div class="variablelist"><p>When using a Sun or Oracle Java environment set at least the
    following options.</p><dl class="variablelist"><dt><span class="term"><code class="literal">-server</code></span></dt><dd><p>Use <code class="literal">-server</code> rather than
      <code class="literal">-client</code>.</p></dd><dt><span class="term"><code class="literal">-XX:MaxPermSize=256m</code></span></dt><dd><p>Set the permanent generation size to 256 MB.</p></dd><dt><span class="term"><code class="literal">-Xmx1024m</code> (minimum)</span></dt><dd><p>OpenAM requires at least a 1 GB heap. If you are including the embedded
      OpenDJ directory, OpenAM requires at least a 2 GB heap, as 50% of that space
      is allocated to OpenDJ. Higher volume and higher performance
      deployments require additional heap space.</p></dd></dl></div><p>For additional JVM tuning recommendations, see <a href="../admin-guide/index.html#tuning-jvm-for-openam" class="link"><em class="citetitle">Java Virtual
   Machine Settings</em></a>.</p></div><div class="section" id="prepare-java-ibm"><div class="titlepage"><div><div><h3 class="title">1.2.2.&nbsp;Settings For IBM Java Environments</h3></div></div></div><div class="variablelist"><p>When using an IBM Java environment set at least the following
    options.</p><dl class="variablelist"><dt><span class="term"><code class="literal">-DamCryptoDescriptor.provider=IBMJCE</code>, </span><span class="term"><code class="literal">-DamKeyGenDescriptor.provider=IBMJCE</code></span></dt><dd><p>Use the IBM Java Cryptography Extensions.</p></dd><dt><span class="term"><code class="literal">-Xmx1024m</code> (minimum)</span></dt><dd><p>OpenAM requires at least a 1 GB heap. If you are including the embedded
      OpenDJ directory, OpenAM requires at least a 2 GB heap, as 50% of that space
      is allocated to OpenDJ. Higher volume and higher
      performance deployments require additional heap space.</p></dd></dl></div></div></div><div class="section" id="prerequisites-file-descriptors"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.3.&nbsp;Setting Maximum File Descriptors</h2></div></div></div><a class="indexterm" name="d4462e347"></a><p>
   If you use the embedded OpenDJ directory, make sure OpenDJ has enough
   file descriptors. OpenDJ needs to be able to open many files,
   especially when handling many client connections.

   Linux systems in particular often set a limit of 1024 per user,
   which is too low for OpenDJ.
  </p><p>
   OpenDJ should have access to use at least 64K (65536) file descriptors.
   The embedded OpenDJ directory runs inside the OpenAM process space.

   When running OpenAM as user <code class="literal">openam</code> on a Linux system
   that uses <code class="filename">/etc/security/limits.conf</code> to set user limits,
   you can set soft and hard limits by adding these lines to the file.
  </p><pre class="codelisting prettyprint">
openam soft nofile 65536
openam hard nofile 131072
  </pre><pre class="cmdline prettyprint">$ ulimit -n
65536</pre><p>
   The example above assumes the system has enough file descriptors overall.

   You can verify the new soft limit the next time you log in as user
   <code class="literal">openam</code> with the <span class="command"><strong>ulimit -n</strong></span> command.
  </p><p>
   You can check the Linux system overall maximum as follows.
  </p><pre class="cmdline prettyprint">$ cat /proc/sys/fs/file-max
204252</pre><div class="orderedlist"><p>
    If the overall maximum is too low, you can increase it as follows.
   </p><ol class="orderedlist" type="1"><li class="listitem"><p>
    As superuser, edit <code class="filename">/etc/sysctl.conf</code> to set
    the kernel parameter <code class="literal">fs.file-max</code> to a higher maximum.
   </p></li><li class="listitem"><p>
    Run the <span class="command"><strong>sysctl -p</strong></span> command to reload
    the settings in <code class="filename">/etc/sysctl.conf</code>.
   </p></li><li class="listitem"><p>
    Read <code class="filename">/proc/sys/fs/file-max</code> again to confirm
    that it now corresponds to the new maximum.
   </p></li></ol></div></div><div class="section" id="prepare-configuration-store"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.4.&nbsp;Preparing a Configuration Data Store</h2></div></div></div><a class="indexterm" name="d4462e409"></a><p>OpenAM stores configuration, session, and token data in an LDAP
  directory service. This data is private to OpenAM. In other words, OpenAM
  controls this data and other applications should access it, if necessary,
  only through OpenAM.</p><p>OpenAM ships with an embedded OpenDJ directory server that you can
  install as part of the OpenAM configuration process. You can use the
  embedded directory server to simplify evaluation. By default OpenAM installs
  the embedded directory alongside configuration settings under the $HOME of the
  user running OpenAM, and runs the embedded directory in the same memory space
  as OpenAM. Before deploying OpenAM in production, measure the impact of
  using the embedded directory not only for relatively static configuration
  data, but also for volatile session and token data. Your tests should subject
  OpenAM to the same load patterns you expect in production. If it looks like
  a better choice to use an external directory service, then use one of the
  supported external configuration stores listed in the <a href="../release-notes/index.html#chap-before-you-install" class="link"><em class="citetitle">Release
  Notes</em></a>, such as OpenDJ.</p><p>With the embedded OpenDJ directory and the default configuration
  settings, OpenAM connects as directory super user, bypassing access control
  evaluation because OpenAM manages the directory as its private store. Be aware
  that failover and replication can not be controlled when using the embedded store.</p><p>OpenAM now supports the use of the Core Token Service (CTS), with tokens
  that can be stored in the local or external directory store. For more information,
  see the chapter on <a href="../install-guide/index.html#chap-cts" class="link">
  <em class="citetitle">Configuring the Core Token Service</em></a>.</p><div class="itemizedlist"><p>With an external directory service, the directory administrator can
   require OpenAM to connect with normal application credentials. In that case,
   the directory administrator must grant OpenAM specific access.</p><div class="panel panel-success"><div class="panel-heading"><h3 class="panel-title">Tip</h3></div><div class="panel-body"><p>If you are the directory administrator, and do not yet know directory
    services very well, take some time to read the documentation for your
    directory server, especially the documentation covering directory schema
    and covering how to configure access to directory data.</p></div></div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>OpenAM requires specific directory schema definitions for the object
    classes and attribute types that describe its data. For the configuration
    store, the directory administrator should let OpenAM update the directory
    schema at configuration time.</p><p>These access rights are only required during configuration, and only
    if the directory administrator does not add the OpenAM directory schema
    definitions manually.</p><p>To grant the required access with OpenDJ for example, first add a
    global access control instruction (ACI) permitting the OpenAM user to modify
    schema definitions as in the following example where the OpenAM entry has DN
    <code class="literal">uid=openam,ou=admins,dc=example,dc=com</code>.</p><pre class="codelisting prettyprint">global-aci: (target = "ldap:///cn=schema")(targetattr = "attributeTypes ||
  objectClasses")(version 3.0;acl "Modify schema"; allow (write)(userdn = "
 ldap:///uid=openam,ou=admins,dc=example,dc=com");)</pre><p>Also give the OpenAM user privileges to modify the schema and write
    to subentries such as the schema entry. Set the following attributes on
    the OpenAM user entry.</p><pre class="codelisting prettyprint">ds-privilege-name: subentry-write
ds-privilege-name: update-schema</pre><p>See the OpenDJ documentation about <a class="link" href="http://docs.forgerock.org/en/opendj/2.6.0/admin-guide/index/chap-privileges-acis.html" target="_blank">Configuring Privileges &amp; Access Control</a> for a more in-depth
    explanation of how access is configured for OpenDJ.</p></li><li class="listitem"><p>When OpenAM connects to an external directory service to store its
    data, it requires both read and write access.</p><p>With OpenDJ for example, add following ACIs to the configuration
    base Distinguished Name (DN) entry. Adjust them as necessary if the OpenAM
    user DN differs from
    <code class="literal">uid=openam,ou=admins,dc=example,dc=com</code>.</p><pre class="codelisting prettyprint">aci: (targetattr="*")(version 3.0;acl "Allow entry search"; allow (
 search, read)(userdn = "ldap:///uid=openam,ou=admins,dc=example,dc=com");)
aci: (targetattr="*")(version 3.0;acl "Modify config entry"; allow (write)(
 userdn = "ldap:///uid=openam,ou=admins,dc=example,dc=com");)
aci: (targetcontrol="2.16.840.1.113730.3.4.3")(version 3.0;acl "Allow
  persistent search"; allow (search, read)(userdn = "ldap:///uid=openam
 ,ou=admins,dc=example,dc=com");)
aci: (version 3.0;acl "Add config entry"; allow (add)(userdn = "ldap:///
 uid=openam,ou=admins,dc=example,dc=com");)
aci: (version 3.0;acl "Delete config entry"; allow (delete)(userdn = "ldap:///
 uid=openam,ou=admins,dc=example,dc=com");)</pre></li></ul></div><p>In addition, the directory administrator should index the following
  attributes used by OpenAM.</p><div class="table" id="prepare-configuration-store-indexes"><div class="table-title">Table&nbsp;1.1.&nbsp;Configuration Data Store Indexes</div><div class="table-contents"><table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Configuration Data Store Indexes" border="0"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th>Attribute</th><th>Indexes Required</th></tr></thead><tbody><tr><td><code class="literal">coreTokenDate01</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenDate02</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenDate03</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenDate04</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenDate05</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenExpirationDate</code></td><td>ordering</td></tr><tr><td><code class="literal">coreTokenInteger01</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger02</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger03</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger04</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger05</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger06</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger07</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger08</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger09</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger10</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString01</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString02</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString03</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString04</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString05</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString06</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString07</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString08</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString09</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString10</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString11</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString12</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString13</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString14</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString15</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenUserId</code></td><td>equality</td></tr><tr><td><code class="literal">iplanet-am-user-federation-info-key</code></td><td>equality</td></tr><tr><td><code class="literal">sun-fm-saml2-nameid-infokey</code></td><td>equality</td></tr><tr><td><code class="literal">sunxmlkeyvalue</code></td><td>equality, substring</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" id="prepare-identity-repository"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.5.&nbsp;Preparing an Identity Repository</h2></div></div></div><a class="indexterm" name="d4462e699"></a><p>OpenAM stores user identity data in one or more identity repositories.
  In many deployments OpenAM connects to existing LDAP directory services
  for user identity data. OpenAM is designed therefore to share data in an
  identity repository with other applications.</p><p>OpenAM ships with an embedded OpenDJ directory server that you can
  install as part of the OpenAM configuration process. In deployments where you
  will only ever have a few users to manage and do not need to share identity
  data with other applications, you can use the embedded store as your identity
  repository and avoid the additional overhead of maintaining a separate
  directory service. If OpenAM will share identity data with other applications,
  or if you expect to have lots of users, then connect OpenAM to an external
  identity repository. See the <a href="../release-notes/index.html#chap-before-you-install" class="link"><em class="citetitle">Release
  Notes</em></a> for a list of supported external identity
  repositories.</p><p>When OpenAM connects to an external identity repository, the
  administrator must give OpenAM the following access rights.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>OpenAM requires specific directory schema definitions for the object
    classes and attribute types that describe its data. The directory
    administrator can find these definitions in the <code class="filename">ldif</code>
    directory found inside the full .zip delivery.</p><p>If the directory administrator chooses instead to have OpenAM update
    the directory schema at configuration time, then the directory administrator
    must grant OpenAM access.</p><p>To grant this access right with OpenDJ for example, first add a global
    ACI permitting the OpenAM user to modify schema definitions as in the
    following example where the OpenAM entry has DN
    <code class="literal">uid=openam,ou=admins,dc=example,dc=com</code>.</p><pre class="codelisting prettyprint">global-aci: (target = "ldap:///cn=schema")(targetattr = "attributeTypes ||
  objectClasses")(version 3.0;acl "Modify schema"; allow (write)(userdn = "
 ldap:///uid=openam,ou=admins,dc=example,dc=com");)</pre><p>Also give the OpenAM user privileges to modify the schema and write
    to subentries such as the schema entry. Set the following attributes on
    the OpenAM user entry.</p><pre class="codelisting prettyprint">ds-privilege-name: subentry-write
ds-privilege-name: update-schema</pre></li><li class="listitem"><p>Allow OpenAM to read directory schema.</p><p>With OpenDJ for example, keep the default "User-Visible Schema
    Operational Attributes" global ACI.</p></li><li class="listitem"><p>When OpenAM connects to an external identity repository, it requires
    access to read and potentially to update data.</p><p>To grant the access rights with OpenDJ for example, add following ACIs
    to the configuration base DN entry. Adjust them as necessary if the OpenAM
    user DN differs from
    <code class="literal">uid=openam,ou=admins,dc=example,dc=com</code>.</p><pre class="codelisting prettyprint">aci: (targetattr="* || aci")(version 3.0;acl "Allow identity modification";
  allow (write)(userdn = "ldap:///uid=openam,ou=admins,dc=example,dc=com");)
aci: (targetattr!="userPassword||authPassword")(version 3.0;
 acl "Allow identity search"; allow (search, read)(userdn = "ldap:///
 uid=openam,ou=admins,dc=example,dc=com");)
aci: (targetcontrol="2.16.840.1.113730.3.4.3")(version 3.0;acl "Allow
  persistent search"; allow (search, read)(userdn = "ldap:///
 uid=openam,ou=admins,dc=example,dc=com");)
aci: (version 3.0;acl "Add identity"; allow (add)(userdn = "ldap:///
 uid=openam,ou=admins,dc=example,dc=com");)
aci: (version 3.0;acl "Delete identity"; allow (delete)(userdn = "ldap:///
 uid=openam,ou=admins,dc=example,dc=com");)</pre></li><li class="listitem"><p>Allow the OpenAM user to reset other users' passwords.</p><p>To grant this privilege in OpenDJ for example, set the following
    attribute on the OpenAM user entry.</p><pre class="codelisting prettyprint">ds-privilege-name: password-reset</pre></li></ul></div><p>In addition for external directory services, the directory administrator
  should index the following attributes used by OpenAM.</p><div class="table" id="prepare-identity-repository-indexes"><div class="table-title">Table&nbsp;1.2.&nbsp;Identity Repository Indexes</div><div class="table-contents"><table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Identity Repository Indexes" border="0"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th>Attribute</th><th>Indexes Required</th></tr></thead><tbody><tr><td><code class="literal">iplanet-am-user-federation-info-key</code></td><td>equality</td></tr><tr><td><code class="literal">sun-fm-saml2-nameid-infokey</code></td><td>equality</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" id="download-openam-software"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.6.&nbsp;Obtaining OpenAM Software</h2></div></div></div><a class="indexterm" name="d4462e789"></a><p>Download OpenAM releases from one of the following locations:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://forgerock.com/download-stack/" target="_blank"><em class="citetitle">Enterprise Downloads</em></a> has the latest stable version of OpenAM, including
     a <code class="filename">.zip</code> file with all of the OpenAM components, the
     <code class="filename">.war</code> file, OpenAM tools, the configurator, policy
     agents, OpenIG, and documentation. Make sure you review the Software License and 
     Subscription Agreement presented before you download OpenAM files.</p></li><li class="listitem"><p><a class="link" href="http://forgerock.org/openam.html" target="_blank"><em class="citetitle">Builds</em></a> has the nightly build, including a <code class="filename">.zip</code> 
     file with all of the OpenAM components, the <code class="filename">.war</code> file, 
     OpenAM tools, the configurator, policy agents, and the .NET Fedlet. Be
     aware that this is the working version of the trunk and should not be 
     used in a production environment.</p></li><li class="listitem"><p><a class="link" href="http://forgerock.org/openam-archive.html" target="_blank"><em class="citetitle">Archives</em></a> has old versions of OpenAM and
     policy agents. It includes the full <code class="filename">.zip</code> file with all
     of the OpenAM components, the server <code class="filename">.war</code> file,
     OpenAM tools, the configurator, policy agents,  the WSS policy agents, and
     the .NET Fedlet for all previous releases.</p></li></ul></div><p>For each release of the OpenAM core services, you can download the
  entire package as a <code class="filename">.zip</code> file, only the OpenAM 
  <code class="filename">.war</code> file, or only the administrative tools as a 
  <code class="filename">.zip</code> archive. The Archives also have only the 
  OpenAM source code used to build the release.</p><p>After you download the <code class="filename">.zip</code> file, create a new 
  openam folder, and unzip the <code class="filename">.zip</code> file to access the content:</p><pre class="cmdline prettyprint">$ cd ~/Downloads
$ mkdir openam ; cd openam
$ unzip ~/Downloads/</pre><div class="variablelist"><p>When you unzip the archive of the entire package, you get ldif, license, and 
   legal directories in addition to the following files.</p><dl class="variablelist"><dt><span class="term"><code class="filename"></code></span></dt><dd><p>The OpenAM Java client SDK library</p></dd><dt><span class="term"><code class="filename"></code></span></dt><dd><p>The .zip file containing the Java client SDK command-line examples,
     and .jar files needed to run the examples</p></dd><dt><span class="term"><code class="filename"></code></span></dt><dd><p>The .war file containing Java client SDK examples in a web
     application</p></dd><dt><span class="term"><code class="filename"></code></span></dt><dd><p>The IDP discovery .war file, deployed as a service to service
     providers that must discover which identity provider corresponds to a
     SAML 2.0 request</p><p>For details, see <a href="../admin-guide/index.html#deploy-idp-discovery" class="link"><em class="citetitle">Deploying the Identity Provider Discovery Service</em></a>.</p></dd><dt><span class="term"><code class="filename"></code></span></dt><dd><p>The .zip that contains the lightweight service provider
    implementations that you can embed in your Java EE or ASP.NET applications
    to enable it to use federated access management</p></dd><dt><span class="term"><code class="filename"></code></span></dt><dd><p>The deployable .war file</p></dd><dt><span class="term"><code class="filename"></code></span></dt><dd><p>The deployable .war file for distributed authentication</p></dd><dt><span class="term"><code class="filename"></code></span></dt><dd><p>The deployable .war file when you want to deploy OpenAM
    server without the OpenAM console</p></dd><dt><span class="term"><code class="filename"></code></span></dt><dd><p>The .zip file that contains tools to manage OpenAM from 
    the command line</p></dd><dt><span class="term"><code class="filename"></code></span></dt><dd><p>The .zip file that contains tools to configure OpenAM from 
    the command line</p></dd></dl></div></div><div class="section" id="prepare-apache-tomcat"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.7.&nbsp;Preparing Apache Tomcat</h2></div></div></div><p>OpenAM examples often use Apache Tomcat as the deployment container.
  Tomcat is installed on <code class="literal">openam.example.com</code>, and listens
  on the default ports, with no Java Security Manager enabled. The script
  <code class="filename">/etc/init.d/tomcat</code> manages the service at system
  startup and shutdown. This script assumes you run OpenAM as the user
  <code class="literal">openam</code>.</p><p>OpenAM core services require a minimum JVM heap size of 1 GB, and a
  permanent generation size of 256 MB. If you are including the embedded
  OpenDJ directory, OpenAM requires at least a 2 GB heap, as 50% of that space
  is allocated to OpenDJ. See <a class="xref" href="#prepare-java" title="1.2.&nbsp;Preparing a Java Environment">Section&nbsp;1.2, &#8220;Preparing a Java Environment&#8221;</a> for
  details.</p><pre class="codelisting prettyprint">#!/bin/sh
#
# tomcat
#
# chkconfig: 345 95 5
# description: Manage Tomcat web application container
CATALINA_HOME="/path/to/tomcat"
export CATALINA_HOME
JAVA_HOME=/path/to/jdk
export JAVA_HOME
CATALINA_OPTS="-server -Xmx2048m -XX:MaxPermSize=256m"
export CATALINA_OPTS

case "${1}" in
start)
  /bin/su openam -c "${CATALINA_HOME}/bin/startup.sh"
  exit ${?}
  ;;
stop)
  /bin/su openam -c "${CATALINA_HOME}/bin/shutdown.sh"
  exit ${?}
  ;;
*)
  echo "Usage:  $0 { start | stop }"
  exit 1
  ;;
esac
</pre></div><div class="section" id="prepare-glassfish"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.8.&nbsp;Preparing GlassFish</h2></div></div></div><p>
   Before you deploy OpenAM, update the JVM options as described in
   <a class="xref" href="#prepare-java" title="1.2.&nbsp;Preparing a Java Environment">Section&nbsp;1.2, &#8220;Preparing a Java Environment&#8221;</a>.

   The settings are accessible in the administration console
   under Application Server &gt; JVM Settings &gt; JVM Options for v2, or
   under Configurations &gt; server-config &gt; JVM Settings &gt; JVM Options for v3.
  </p><div class="section" id="prepare-glassfish-v2"><div class="titlepage"><div><div><h3 class="title">1.8.1.&nbsp;Preparing GlassFish v2</h3></div></div></div><div class="orderedlist"><p>
     In addition to setting JVM options,
     after downloading the OpenAM server .war file,
     edit the application configuration to make sure that
     classes from OpenAM libraries are loaded before GlassFish bundled libraries.
    </p><ol class="orderedlist" type="1"><li class="listitem"><p>Extract the OpenAM server .war file content to a working
     directory.</p><pre class="cmdline prettyprint">$ mkdir /tmp/openam ; cd /tmp/openam
$ jar -xf ~/Downloads/openam.war</pre></li><li class="listitem"><p>Add a <code class="filename">WEB-INF/sun-web.xml</code> file to set
     class-loading delegation to false.</p><pre class="cmdline prettyprint">$ vi WEB-INF/sun-web.xml
$ cat WEB-INF/sun-web.xml
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE sun-web-app PUBLIC
 "-//Sun Microsystems, Inc.//DTD Application Server 9.0 Servlet 2.5//EN"
 "http://www.sun.com/software/appserver/dtds/sun-web-app_2_5-0.dtd"&gt;
&lt;sun-web-app error-url=""&gt;
  &lt;class-loader delegate="false"/&gt;
&lt;/sun-web-app&gt;</pre></li><li class="listitem"><p>Pack the updated .war file to deploy.</p><pre class="cmdline prettyprint">$ jar -cf ../openam.war *</pre></li><li class="listitem"><p>Deploy the updated .war file in place of the server .war file
     delivered with the release.</p></li></ol></div></div><div class="section" id="prepare-glassfish-v3"><div class="titlepage"><div><div><h3 class="title">1.8.2.&nbsp;Preparing GlassFish v3</h3></div></div></div><div class="orderedlist"><p>
     In addition to setting JVM options,
     remove the <code class="literal">glassfish-full-profile</code>
     and <code class="literal">metro</code> packages
     to resolve library conflicts before you deploy OpenAM.
    </p><ol class="orderedlist" type="1"><li class="listitem"><p>
      Stop GlassFish if it is running.
     </p><pre class="cmdline prettyprint">$ /path/to/glassfish3/bin/asadmin stop-domain domain1
Waiting for the domain to stop ....
Command stop-domain executed successfully.</pre></li><li class="listitem"><p>
      Remove the packages by using the <span class="command"><strong>pkg</strong></span> command.
     </p><pre class="cmdline prettyprint">$ cd /path/to/glassfish3/bin/
./pkg uninstall glassfish-full-profile metro
PHASE                                        ACTIONS
Removal Phase                                  56/56</pre></li><li class="listitem"><p>
      Start GlassFish.
     </p><pre class="cmdline prettyprint">$ /path/to/glassfish3/bin/asadmin start-domain domain1
Waiting for domain1 to start ...
Successfully started the domain : domain1
domain  Location: /path/to/glassfish3/glassfish/domains/domain1
Log File: /path/to/glassfish3/glassfish/domains/domain1/logs/server.log
Admin Port: 4848
Command start-domain executed successfully.</pre><p>
      If the domain fails to start the first time you run the command,
      then run the <span class="command"><strong>asadmin start-domain</strong></span> command again.
     </p></li></ol></div></div></div><div class="section" id="prepare-jboss-5"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.9.&nbsp;Preparing OpenAM &amp; JBoss 4 or 5</h2></div></div></div><p>OpenAM must be able to store its configuration between restarts. If
  you plan to deploy OpenAM as a single archive file, then unpack the .war,
  edit <code class="filename">WEB-INF/classes/bootstrap.properties</code> to set the
  <code class="literal">configuration.dir</code> property to the location where OpenAM
  has write access to store its configuration.</p><pre class="cmdline prettyprint">$ mkdir openam
$ cd openam
$ jar -xf ~/Downloads/openam/
$ vi WEB-INF/classes/bootstrap.properties
$ grep ^config WEB-INF/classes/bootstrap.properties
configuration.dir=/home/jboss-user/openam</pre><p>Also, OpenAM .jar libraries that conflict with JBoss libraries must
  be loaded first. Add a <code class="filename">WEB-INF/jboss-web.xml</code> to ensure
  this happens. (If you deploy the exploded .war, you also need to add this
  file.)</p><pre class="cmdline prettyprint">$ vi WEB-INF/jboss-web.xml
$ cat WEB-INF/jboss-web.xml</pre><pre class="codelisting prettyprint">&lt;!DOCTYPE jboss-web PUBLIC
  "-//JBoss//DTD Web Application 5.0//EN"
  "http://www.jboss.org/j2ee/dtd/jboss-web_5_0.dtd"&gt;
&lt;jboss-web&gt;
  &lt;class-loading java2ClassLoadingCompliance='true'&gt;
    &lt;loader-repository&gt;
    jbia.loader:loader=opensso
    &lt;loader-repository-config&gt;java2ParentDelegaton=true&lt;/loader-repository-config&gt;
    &lt;/loader-repository&gt;
  &lt;/class-loading&gt;
&lt;/jboss-web&gt;</pre><p>Repack the .war file that you can then deploy.</p><pre class="cmdline prettyprint">$ jar -cf ../openam.war *</pre><p>Before you deploy OpenAM, update the JVM options as described in
  <a class="xref" href="#prepare-java" title="1.2.&nbsp;Preparing a Java Environment">Section&nbsp;1.2, &#8220;Preparing a Java Environment&#8221;</a>.</p></div><div class="section" id="prepare-jboss-7"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.10.&nbsp;Preparing OpenAM &amp; JBoss AS 7 / EAP 6</h2></div></div></div><p>Some preparation is required to deploy OpenAM on JBoss AS 7 / EAP 6. </p><p>The following instructions provide guidance for both standalone and domain deployments.
    OpenAM must be able to store its configuration between restarts. The procedures listed here are
    workarounds for JBoss AS 7.1.2 / 7.1.3, and the corresponding versions of JBoss EAP (6.0.0, 6.0.1).
    Workarounds are also needed for JBoss EAP 6.1.0/6.1.1.
    To identify the versions of JBoss EAP that have been built from JBoss
    AS, see the following article on <a class="link" href="https://access.redhat.com/site/articles/112673" target="_blank"><em class="citetitle">JBoss Enterprise Application Platform Component Details</em></a>.</p><p>Once JBoss has been configured, you can then prepare OpenAM for deployment, by making a few changes
    to the contents of the OpenAM <code class="filename">.war</code> archive.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="#prep-jboss-710-711" title="Procedure&nbsp;1.1.&nbsp;To Prepare JBoss AS 7.1.0 / 7.1.1">Procedure&nbsp;1.1, &#8220;To Prepare JBoss AS 7.1.0 / 7.1.1&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#prep-jboss-600-601" title="Procedure&nbsp;1.2.&nbsp;Alternative Method: To Prepare JBoss EAP 6.0.0 and 6.0.1">Procedure&nbsp;1.2, &#8220;Alternative Method: To Prepare JBoss EAP 6.0.0 and 6.0.1&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#prep-jboss-61x" title="Procedure&nbsp;1.3.&nbsp;To Prepare JBoss EAP 6.1.0 and 6.1.1">Procedure&nbsp;1.3, &#8220;To Prepare JBoss EAP 6.1.0 and 6.1.1&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#prep-jboss-for-openam" title="Procedure&nbsp;1.4.&nbsp;To Prepare JBoss for OpenAM">Procedure&nbsp;1.4, &#8220;To Prepare JBoss for OpenAM&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#prep-openam-for-jboss" title="Procedure&nbsp;1.5.&nbsp;To Prepare OpenAM for JBoss">Procedure&nbsp;1.5, &#8220;To Prepare OpenAM for JBoss&#8221;</a></p></li></ul></div><div class="procedure" id="prep-jboss-710-711"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;1.1.&nbsp;To Prepare JBoss AS 7.1.0 / 7.1.1</div><p>For JBoss AS 7.1.0 / 7.1.1, you need to make changes to the <code class="filename">module.xml</code>
                file in the <code class="filename">/path/to/jboss/modules/sun/jdk/main</code> directory, as well as changes
                to a configuration file associated with JBoss standalone or domain modes.</p><ol class="procedure" type="1"><li class="step"><p>Stop JBoss</p></li><li class="step"><p>Update the <code class="filename">module.xml</code> file associated with the container. You can
                    find this file a directory such as <code class="filename">/path/to/jboss/modules/sun/jdk/main</code>.</p></li><li class="step"><p>In the same <code class="filename">module.xml</code> file, add the Sun x509 security module path
                    (<code class="literal">sun/security/x509</code>).</p><p>The following example shows an excerpt of the revised file for JBoss AS 7.1.0.</p><pre class="codelisting prettyprint">&lt;path name="com/sun/security/auth"/&gt;
&lt;path name="com/sun/security/auth/login"/&gt;
&lt;path name="com/sun/security/auth/module"/&gt;
&lt;path name ="sun/security/x509"/&gt; &lt;!-- path added here --&gt;
&lt;path name="sun/misc"/&gt;</pre></li><li class="step"><p>When using <span class="command"><strong>ssoadm</strong></span> or the distributed
                    authentication service (DAS), also add the following path to the aforementioned
                    <code class="filename">module.xml</code> file.</p><pre class="literallayout">&lt;path name="com/sun/org/apache/xerces/internal/dom" /&gt;</pre></li><li class="step" id="jboss711-disable-conflicts"><p>Disable modules that conflict with OpenAM REST libraries. All jaxrs
                    references need to be removed from the configuration. The file that you modify
                    depends on whether you are running JBoss in standalone or domain mode.</p><ul class="stepalternatives">
                    <li class="step"><p>The following example is based on JBoss 7.1.0 standalone mode. Remember to
                            remove all subsystems and extension tags associated with <code class="literal">urn:jboss:domain:jaxrs:1.0</code>.</p><pre class="cmdline prettyprint">$ vi /path/to/jboss/standalone/configuration/standalone.xml
&lt;extension module="org.jboss.as.ejb3"/&gt;
-  &lt;extension module="org.jboss.as.jaxrs"/&gt;
....
-  &lt;subsystem xmlns="urn:jboss:domain:jaxrs:1.0"/&gt;
&lt;subsystem xmlns="urn:jboss:domain:jca:1.1"&gt;</pre></li>
                    <li class="step"><p>The following example is based on JBoss 7.1.0 for a managed domain.</p><pre class="cmdline prettyprint">$ vi /path/to/jboss7/domain/configuration/domain.xml
&lt;extension module="org.jboss.as.ejb3"/&gt;
-  &lt;extension module="org.jboss.as.jaxrs"/&gt;
....
-  &lt;subsystem xmlns="urn:jboss:domain:jaxrs:1.0"/&gt;
&lt;subsystem xmlns="urn:jboss:domain:jca:1.1"&gt;</pre></li>
                </ul></li><li class="step" id="jboss711-delete-webservices"><p>In either the <code class="filename">standalone.xml</code> or <code class="filename">domain.xml</code>
                    files, you will also need to delete <code class="literal">org.jboss.as.webservices</code> references.
                    Depending on the file, this includes one or more groups of <code class="literal">subsystem</code> lines
                    such as:</p><pre class="cmdline prettyprint">&lt;subsystem xmlns="urn:jboss:domain:webservices:1.1"/&gt;
....
&lt;/subsystem&gt;</pre></li><li class="step"><p>You are now ready to prepare OpenAM as described in <a class="xref" href="#prep-openam-for-jboss" title="Procedure&nbsp;1.5.&nbsp;To Prepare OpenAM for JBoss">Procedure&nbsp;1.5, &#8220;To Prepare OpenAM for JBoss&#8221;</a>.</p></li></ol></div></div><div class="procedure" id="prep-jboss-600-601"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;1.2.&nbsp;Alternative Method: To Prepare JBoss EAP 6.0.0 and 6.0.1</div><p>JBoss EAP 6.0.0 and 6.0.1 are built from JBoss AS 7.1.2 and 7.1.3, respectively. The same techniques
                described in the <a class="xref" href="#prep-jboss-710-711" title="Procedure&nbsp;1.1.&nbsp;To Prepare JBoss AS 7.1.0 / 7.1.1">Procedure&nbsp;1.1, &#8220;To Prepare JBoss AS 7.1.0 / 7.1.1&#8221;</a> section work here as well. One alternative
                method is available, as described in this section.</p><ol class="procedure" type="1"><li class="step"><p>Stop JBoss.</p></li><li class="step"><p>Update the <code class="filename">openam.war</code> before deploying OpenAM.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Create a temporary directory and expand the <code class="filename">openam.war</code>.</p><pre class="cmdline prettyprint"> $ mkdir /tmp/openam ; cd /tmp/openam
                            $ jar xvf /path/to/</pre></li><li class="listitem"><p>Create a new <code class="filename">jboss-deployment-structure.xml</code> file in the
                            <code class="filename">WEB-INF</code> subdirectory so that it appears as follows, and save
                            the change.</p><pre class="cmdline prettyprint">$ vi WEB-INF/jboss-deployment-structure.xml</pre><pre class="codelisting prettyprint">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;jboss-deployment-structure xmlns="urn:jboss:deployment-structure:1.2"&gt;
  &lt;deployment&gt;
   &lt;exclusions&gt;
    &lt;module name="sun.jdk" /&gt;
   &lt;/exclusions&gt;
   &lt;exclude-subsystems&gt;
    &lt;subsystem name="jaxrs" /&gt;
    &lt;subsystem name="webservices" /&gt;
   &lt;/exclude-subsystems&gt;
  &lt;dependencies&gt;
   &lt;module name="sun.jdk" &gt;
    &lt;imports&gt;
     &lt;exclude-set&gt;
&lt;path name="com/sun/org/apache/xml/internal/security/transforms/implementations"/&gt;
     &lt;/exclude-set&gt;
    &lt;/imports&gt;
   &lt;/module&gt;
   &lt;system&gt;
    &lt;paths&gt;
     &lt;path name="sun/security/x509" /&gt;
     &lt;path name="com/sun/org/apache/xpath/internal" /&gt;
     &lt;path name="com/sun/org/apache/xerces/internal/dom" /&gt;
     &lt;path name="com/sun/org/apache/xml/internal/utils" /&gt;
    &lt;/paths&gt;
   &lt;/system&gt;
  &lt;/dependencies&gt;
 &lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre></li><li class="listitem"><p>Rebuild the <code class="filename">openam.war</code> file.</p><pre class="cmdline prettyprint">$ jar cvf ../openam.war *</pre></li></ol></div></li><li class="step"><p>You will want to make at least one more change to the <code class="filename">openam.war</code> file before
                    deployment, as described in <a class="xref" href="#prep-openam-for-jboss" title="Procedure&nbsp;1.5.&nbsp;To Prepare OpenAM for JBoss">Procedure&nbsp;1.5, &#8220;To Prepare OpenAM for JBoss&#8221;</a>.</p></li><li class="step"><p>You do not need to make any of the other changes to XML files described in this section.
                    As JBoss EAP 6.0.0 and 6.0.1 was built from JBoss AS 7.1.2 and AS 7.1.3, respectively, this
                    procedure may also work on those versions of JBoss.</p></li></ol></div></div><div class="procedure" id="prep-jboss-61x"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;1.3.&nbsp;To Prepare JBoss EAP 6.1.0 and 6.1.1</div><ol class="procedure" type="1"><li class="step"><p>For JBoss EAP 6.1.0 / 6.1.1, follow <a class="xref" href="#jboss711-disable-conflicts" title="Step 5">Step 5</a>
                and <a class="xref" href="#jboss711-delete-webservices" title="Step 6">Step 6</a> from
                    <a class="xref" href="#prep-jboss-710-711" title="Procedure&nbsp;1.1.&nbsp;To Prepare JBoss AS 7.1.0 / 7.1.1">Procedure&nbsp;1.1, &#8220;To Prepare JBoss AS 7.1.0 / 7.1.1&#8221;</a>.</p></li><li class="step"><p>However, you still need to review <a class="xref" href="#prep-jboss-for-openam" title="Procedure&nbsp;1.4.&nbsp;To Prepare JBoss for OpenAM">Procedure&nbsp;1.4, &#8220;To Prepare JBoss for OpenAM&#8221;</a> and
                    <a class="xref" href="#prep-openam-for-jboss" title="Procedure&nbsp;1.5.&nbsp;To Prepare OpenAM for JBoss">Procedure&nbsp;1.5, &#8220;To Prepare OpenAM for JBoss&#8221;</a> to make sure the JVM and directories are
                    configured appropriately.</p></li></ol></div></div><div class="procedure" id="prep-jboss-for-openam"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;1.4.&nbsp;To Prepare JBoss for OpenAM</div><p>The default JBoss settings for JVM do not give sufficient memory to OpenAM. This procedure
                documents one method that you can use to modify JBoss. Other methods described in <a class="link" href="http://www.jboss.org/jbossas/docs" target="_blank">
               <em class="citetitle">JBoss Main Documentation Page</em></a>.</p><ol class="procedure" type="1"><li class="step"><p>Stop JBoss.</p></li><li class="step"><p>Open an appropriate JBoss configuration file. This procedure describes the use of the
                    <code class="filename">standalone.conf</code> file in the <code class="filename">/path/to/jboss/bin</code>
                    directory for JBoss in standalone mode.</p></li><li class="step"><p>Check the JVM settings associated with <code class="literal">JAVA_OPTS</code>. For JBoss AS 7.1.0 and AS 7.1.1,
                    you should change the JVM heap size to <code class="literal">-Xmx1024m</code>. The default JVM heap size and permanent
                    generation settings for later versions of JBoss may already exceed recommended values (-Xmx1024m,
                    -XX:MaxPermSize=256m). If you are using the embedded version of OpenDJ, the minimum heap size may
                    be higher. For details on the JVM options to use, see <a class="xref" href="#prepare-java" title="1.2.&nbsp;Preparing a Java Environment">Section&nbsp;1.2, &#8220;Preparing a Java Environment&#8221;</a>.</p></li><li class="step"><p>Set the following JVM <code class="literal">JAVA_OPTS</code> setting in the same file.</p><pre class="codelisting prettyprint">-Dorg.apache.tomcat.util.http.ServerCookie.ALWAYS_ADD_EXPIRES=true</pre><p>Make sure that headers include the <code class="literal">Expires</code>
                    attribute rather than only <code class="literal">Max-Age</code>, as some versions
                    of Internet Explorer do not support <code class="literal">Max-Age</code>.</p></li><li class="step"><p>Now deploy the <code class="filename">openam.war</code> file into the appropriate JBoss deployment directory.
                    The directory varies depending on whether you are running in standalone or domain mode.</p></li><li class="step"><p>You do not need to make any of the other changes to XML files described in this section.
                    As JBoss EAP 6.0.0 and 6.0.1 was built from JBoss AS 7.1.2 and AS 7.1.3, respectively, this
                    procedure may also work on those versions of JBoss.</p></li></ol></div></div><div class="procedure" id="prep-openam-for-jboss"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;1.5.&nbsp;To Prepare OpenAM for JBoss</div><p>To take full advantage of JBoss with OpenAM, you should make a couple of changes to the
                OpenAM <code class="filename">war</code> file. One problem is that JBoss will deploy applications from
                different temporary directories every time you restart the container, which would require
                reconfiguring OpenAM. To avoid this issue, take the following steps:</p><ol class="procedure" type="1"><li class="step"><p>If you have not already done so, create a temporary directory and
                    expand the <code class="filename">openam.war</code>.</p><pre class="cmdline prettyprint"> $ cd /tmp
$ mkdir /tmp/openam ; cd /tmp/openam
$ jar xvf ~/Downloads/</pre></li><li class="step"><p>Update the <code class="literal"># configuration.dir=</code> line in the
                    <code class="filename">bootstrap.properties</code> file so that it appears as follows,
                    and save the change.</p><pre class="cmdline prettyprint">$ vi WEB-INF/classes/bootstrap.properties
# This property should also be used when the system user that
# is running the web/application server process does not have
# a home directory. i.e. System.getProperty("user.home") returns
# null.

configuration.dir=$HOME/openamJboss</pre></li><li class="step"><p>Rebuild the <code class="filename">openam.war</code> file.</p><pre class="cmdline prettyprint">$ jar cvf ../openam.war *</pre></li></ol></div></div></div><div class="section" id="prepare-jetty"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.11.&nbsp;Preparing Jetty</h2></div></div></div><p>When you deploy OpenAM, make sure you start Jetty with enough
  memory.</p><pre class="cmdline prettyprint">$ cd /path/to/jetty
$ java -server -Xmx1024m -XX:MaxPermSize=256m -jar start.jar</pre><p>If you are using the embedded version of OpenDJ, the required
  JVM memory may be higher. For details on the JVM options to use, see
  <a class="xref" href="#prepare-java" title="1.2.&nbsp;Preparing a Java Environment">Section&nbsp;1.2, &#8220;Preparing a Java Environment&#8221;</a>.</p></div><div class="section" id="prepare-oracle-weblogic"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.12.&nbsp;Preparing Oracle WebLogic</h2></div></div></div><p>Before you deploy OpenAM, update the JVM options as described in
  <a class="xref" href="#prepare-java" title="1.2.&nbsp;Preparing a Java Environment">Section&nbsp;1.2, &#8220;Preparing a Java Environment&#8221;</a>.</p><div class="orderedlist"><p>
    In addition, edit the WebLogic domain configuration
    to allow basic authentication credentials to be passed back to OpenAM.
   </p><p>
    By default WebLogic attempts to resolve authentication credentials itself.
    When you change the WebLogic domain configuration, you make sure that
    OpenAM OAuth 2.0 providers receive basic authentication credentials
    for OAuth 2.0 grants that rely on basic authentication.
   </p><ol class="orderedlist" type="1"><li class="listitem"><p>
     Stop WebLogic server.
    </p></li><li class="listitem"><p>
     Edit the WebLogic domain configuration,
     <code class="filename">/path/to/wlsdomain/config/config.xml</code>,
     setting <code class="literal">&lt;enforce-valid-basic-auth-credentials&gt;</code>
     to <code class="literal">false</code> in the
     <code class="literal">&lt;security-configuration</code> element.
    </p><div class="informalexample"><pre class="codelisting prettyprint">
  &lt;security-configuration&gt;
    &lt;enforce-valid-basic-auth-credentials&gt;false&lt;/enforce-valid-basic-auth-credentials&gt;
  &lt;/security-configuration&gt;
     </pre></div></li><li class="listitem"><p>
     Start WebLogic server.
    </p></li></ol></div><p>
    When deploying OpenAM on WebLogic 11g (version 10.3.x),
    use the SOAP with Attachments API for Java (SAAJ) implementation
    from the Java Runtime Environment, rather than the WebLogic implementation.

    The WebLogic implementation can cause OpenAM to throw exceptions with the
    message <code class="literal">java.lang.UnsupportedOperationException:
    This class does not support SAAJ 1.1</code>,
    and to fail to authenticate users in some cases.

    No change is necessary when deploying OpenAM on WebLogic 12c.
   </p><p>
    To use the Sun/Oracle Java SAAJ implementation,
    edit the WebLogic start up script for the domain where OpenAM runs, such as
    <code class="filename">/path/to/weblogic/user_projects/domains/wlsdomain/bin/startWebLogic.sh</code>.

    Change the following line:

    </p><pre class="codelisting prettyprint">${DOMAIN_HOME}/bin/startWebLogic.sh $*</pre><p>

    To set the <code class="literal">javax.xml.soap.MessageFactory</code> property:

    </p><pre class="codelisting prettyprint">${DOMAIN_HOME}/bin/startWebLogic.sh \
-Djavax.xml.soap.MessageFactory=\
com.sun.xml.internal.messaging.saaj.soap.ver1_1.SOAPMessageFactory1_1Impl $*</pre><p>
   </p><p>
    Restart WebLogic for the change to take effect.
   </p></div><div class="section" id="prepare-ibm-websphere"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.13.&nbsp;Preparing IBM WebSphere</h2></div></div></div><p>Before you deploy OpenAM, use the Administrator console to update
  JVM options as described in <a class="xref" href="#prepare-java" title="1.2.&nbsp;Preparing a Java Environment">Section&nbsp;1.2, &#8220;Preparing a Java Environment&#8221;</a>.</p><div class="orderedlist"><p>In addition, configure WebSphere to load classes from OpenAM bundled
   libraries before loading classes from libraries delivered with WebSphere.
   The following steps must be completed after you deploy OpenAM into
   WebSphere.</p><ol class="orderedlist" type="1"><li class="listitem"><p>In WebSphere administration console, browse to Application &gt;
    Application Type &gt; WebSphere enterprise applications &gt; <em class="replaceable"><code>OpenAM
    Name</code></em> &gt; Class loading and update detection.</p></li><li class="listitem"><p>Set Class loader order &gt; Classes loaded with local class loader first
    (parent last).</p></li><li class="listitem"><p>Set WAR class loader policy &gt; Single class loader for application.</p></li><li class="listitem"><p>Save your work.</p></li></ol></div><div class="orderedlist"><p>Furthermore when using IBM Java, add the JAXP Reference Implementation
   .jar into the OpenAM .war file before deploying the .war into WebSphere as
   this required library is missing otherwise.</p><ol class="orderedlist" type="1"><li class="listitem"><p>Unpack the OpenAM .war file.</p><pre class="cmdline prettyprint">$ mkdir /tmp/openam
$ cd /tmp/openam/
$ jar -xf ~/Downloads/openam/</pre></li><li class="listitem"><p>Add the JAXP Reference Implementation .jar in
    <code class="filename">WEB-INF/lib/</code>.</p><pre class="cmdline prettyprint">$ wget http://repo1.maven.org/maven2/com/sun/xml/parsers/jaxp-ri/1.4.5/jaxp-ri-1.4.5.jar
$ mv jaxp-ri-1.4.5.jar WEB-INF/lib/</pre></li><li class="listitem"><p>Pack up the OpenAM .war file to deploy in WebSphere.</p><pre class="cmdline prettyprint">$ jar -cf ../openam.war *</pre></li><li class="listitem"><p>Deploy the new .war file.</p><p>In this case the .war file to deploy is
    <code class="filename">/tmp/openam.war</code>.</p></li></ol></div></div></div><div lang="en" class="chapter" id="chap-install-core"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;2.&nbsp;Installing OpenAM Core Services</h1></div></div></div><a class="indexterm" name="d4462e1492"></a><a class="indexterm" name="d4462e1497"></a><p>This chapter covers tasks required for a full install of OpenAM server
 with or without OpenAM Console.</p><p>This chapter does not cover installation for enforcing policies on
 resource servers. To manage access to resources on other servers, you can use
 OpenIG or OpenAM policy agents.</p><p><a class="link" href="http://openig.forgerock.org/" target="_blank">OpenIG</a>
 is a high-performance reverse proxy server with specialized session management
 and credential replay functionality. It can function as a standards-based 
 policy enforcement point.</p><p>OpenAM policy agents provide policy enforcement on supported
 web servers and Java EE containers, and are tightly integrated with OpenAM. 
 See the <a href="../web-install-guide/index.html#web-install-guide" class="link"><em class="citetitle">OpenAM Web Policy
 Agent Installation Guide</em></a>, or <a href="../jee-install-guide/index.html#jee-install-guide" class="link"><em class="citetitle">OpenAM Java EE
 Policy Agent Installation Guide</em></a> for instructions on
 installing OpenAM policy agents in supported web servers and Java EE
 application containers.</p><div class="table" id="decide-how-to-install"><div class="table-title">Table&nbsp;2.1.&nbsp;Deciding How To Install OpenAM</div><div class="table-contents"><table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Deciding How To Install OpenAM" width="100%" border="0"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th>If you want to...</th><th>Then see...</th></tr></thead><tbody><tr><td>Install quickly for evaluation using default settings</td><td>
      <p><a class="xref" href="#deploy-openam" title="Procedure&nbsp;2.1.&nbsp;To Deploy OpenAM">Procedure&nbsp;2.1, &#8220;To Deploy OpenAM&#8221;</a> and <a class="xref" href="#configure-openam-defaults" title="Procedure&nbsp;2.2.&nbsp;To Configure OpenAM With Defaults">Procedure&nbsp;2.2, &#8220;To Configure OpenAM With Defaults&#8221;</a></p>

      <p>Alternatively, follow the full example in the <a href="../getting-started/index.html#getting-started" class="link"><em class="citetitle">Getting
      Started</em></a> guide.</p>
     </td></tr><tr><td>Install OpenAM server and console, choosing settings</td><td><a class="xref" href="#deploy-openam" title="Procedure&nbsp;2.1.&nbsp;To Deploy OpenAM">Procedure&nbsp;2.1, &#8220;To Deploy OpenAM&#8221;</a> and <a class="xref" href="#configure-openam-custom" title="Procedure&nbsp;2.4.&nbsp;To Configure OpenAM">Procedure&nbsp;2.4, &#8220;To Configure OpenAM&#8221;</a></td></tr><tr><td>Erase the configuration and start over</td><td><a class="xref" href="#delete-config-start-over" title="Procedure&nbsp;2.3.&nbsp;To Delete an OpenAM Configuration Before Redeploying">Procedure&nbsp;2.3, &#8220;To Delete an OpenAM Configuration Before Redeploying&#8221;</a></td></tr><tr><td>Add an OpenAM server to a site</td><td><a class="xref" href="#deploy-openam" title="Procedure&nbsp;2.1.&nbsp;To Deploy OpenAM">Procedure&nbsp;2.1, &#8220;To Deploy OpenAM&#8221;</a>, and
     <a class="xref" href="#add-servers-to-site" title="Procedure&nbsp;2.5.&nbsp;To Add a Server to a Site">Procedure&nbsp;2.5, &#8220;To Add a Server to a Site&#8221;</a></td></tr><tr><td>Install OpenAM server only (no console)</td><td><a class="xref" href="#which-war-to-deploy" title="Table&nbsp;2.2.&nbsp;Determine Which War File to Deploy">Table&nbsp;2.2, &#8220;Determine Which War File to Deploy&#8221;</a>,
     <a class="xref" href="#deploy-openam" title="Procedure&nbsp;2.1.&nbsp;To Deploy OpenAM">Procedure&nbsp;2.1, &#8220;To Deploy OpenAM&#8221;</a>, and
     <a class="xref" href="#deploy-coreonly" title="Procedure&nbsp;2.6.&nbsp;To Deploy OpenAM Core Server (No Console)">Procedure&nbsp;2.6, &#8220;To Deploy OpenAM Core Server (No Console)&#8221;</a></td></tr><tr><td>Install <span class="command"><strong>ssoadm</strong></span> for CLI configuration</td><td><a href="../install-guide/index.html#chap-install-tools" class="link"><em class="citetitle">Installing
     OpenAM Tools</em></a>, or <a href="../admin-guide/index.html#openam-ssoadm-jsp-overview" class="link">OpenAM ssoadm.jsp</a>
     in the <em class="citetitle">Administration Guide</em></td></tr><tr><td>Perform a command-line install</td><td><a href="../install-guide/index.html#install-openam-config-tools" class="link"><em class="citetitle">To Set Up
     Configuration Tools</em></a></td></tr><tr><td>Install OpenAM in your DMZ</td><td><a href="../install-guide/index.html#chap-install-das" class="link"><em class="citetitle">Installing
     OpenAM Distributed Authentication</em></a></td></tr><tr><td>Skin OpenAM for your organization</td><td><a href="../install-guide/index.html#chap-custom-ui" class="link"><em class="citetitle">Customizing
     the OpenAM End User Pages</em></a></td></tr><tr><td>Uninstall OpenAM</td><td><a href="../install-guide/index.html#chap-uninstall" class="link"><em class="citetitle">Removing
     OpenAM Software</em></a></td></tr></tbody></table></div></div><br class="table-break"><p>Select the <code class="filename">.war</code> file based on the type of
  deployment you need, as defined in the following table.</p><div class="table" id="which-war-to-deploy"><div class="table-title">Table&nbsp;2.2.&nbsp;Determine Which War File to Deploy</div><div class="table-contents"><table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Determine Which War File to Deploy" width="100%" border="0"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th>If you want to...</th><th>Use...</th></tr></thead><tbody><tr><td>Install an OpenAM server including OpenAM Console</td><td><code class="filename"></code></td></tr><tr><td>Install OpenAM server without OpenAM Console</td><td><code class="filename"></code></td></tr><tr><td>Install OpenAM distributed authentication UI</td><td><code class="filename"></code></td></tr></tbody></table></div></div><br class="table-break"><div class="procedure" id="deploy-openam"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;2.1.&nbsp;To Deploy OpenAM</div><p>The <code class="filename"></code> file contains OpenAM
  server with OpenAM Console. How you deploy the .war file depends on your web
  application container.</p><ol class="procedure" type="1"><li class="step"><p>Deploy the .war file on your container.</p><p>For example, copy the file to deploy on Apache Tomcat.</p><pre class="cmdline prettyprint">$ cp  /path/to/tomcat/webapps/openam.war</pre><p>You change the file name to <code class="filename">openam.war</code> when
   deploying in Tomcat so that the deployment URI is
   <code class="literal">/openam</code>.</p><p>It can take several seconds for OpenAM to be deployed in your
   container.</p></li><li class="step"><p>Browse to the initial configuration screen, for example at
   <code class="literal">http://openam.example.com:8080/openam</code>.</p><div class="mediaobject" align="center" id="figure-openam-start"><a class="fancybox" href="images/openam-start.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_openam-start.png" align="middle" alt="Initial OpenAM configuration screen" title="The initial configuration screen lets you choose a&#xA;    default or custom configuration path."></a></div></li></ol></div></div><div class="procedure" id="configure-openam-defaults"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;2.2.&nbsp;To Configure OpenAM With Defaults</div><p>The default configuration option configures the embedded OpenDJ server
  using default ports&#8212;if the ports are already in use, OpenAM uses
  free ports&#8212;as both configuration store and identity store.</p><p>The default configuration sets the cookie domain based on the fully
  qualified domain name of the system. For an FQDN
  <code class="literal">openam.example.com</code>, the cookie domain is set to
  <code class="literal">.example.com</code>.</p><p>Configuration settings are saved to the home directory of the user
  running the web application container in a directory named after the
  deployment URI. In other words if OpenAM is deployed under
  <code class="literal">/openam</code>, then the configuration is saved under
  <code class="filename">$HOME/openam/</code>.</p><ol class="procedure" type="1"><li class="step"><p>In the initial configuration screen, click
   Create Default Configuration under Default Configuration.</p></li><li class="step"><p>Provide different passwords for the default OpenAM administrator,
   <code class="literal">amadmin</code>, and default Policy Agent users.</p><div class="mediaobject" align="center" id="figure-openam-default-conf"><a class="fancybox" href="images/openam-default-conf.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_openam-default-conf.png" align="middle" alt="OpenAM default configuration" title="The default configuration asks only for two&#xA;    passwords."></a></div></li><li class="step"><p>When the configuration completes, click Proceed to Login, and then
   login as the OpenAM administrator with the first of the two passwords you
   provided.</p><div class="mediaobject" align="center" id="figure-openam-first-login"><a class="fancybox" href="images/openam-first-login.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_openam-first-login.png" align="middle" alt="OpenAM first login" title="To access OpenAM Console, log in as OpenAM Administrator,&#xA;    amadmin"></a></div><p>After successful login, OpenAM redirects you to OpenAM Console.</p><div class="mediaobject" align="center" id="figure-openam-console-first-time"><a class="fancybox" href="images/openam-console.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_openam-console.png" align="middle" alt="OpenAM Console home page" title="The home page for OpenAM when logged in as the OpenAM&#xA;    Administrator, amadmin"></a></div></li></ol></div></div><div class="procedure" id="delete-config-start-over"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;2.3.&nbsp;To Delete an OpenAM Configuration Before Redeploying</div><a class="indexterm" name="d4462e1756"></a><p>If you are unhappy with your configuration and want to start over from
  the beginning, follow these steps.</p><ol class="procedure" type="1"><li class="step"><p>Stop the OpenAM web application to clear the configuration held
   in memory.</p><p>The following example shuts down Tomcat for example.</p><pre class="cmdline prettyprint">$ /path/to/tomcat/bin/shutdown.sh
Password: 
Using CATALINA_BASE:   /path/to/tomcat
Using CATALINA_HOME:   /path/to/tomcat
Using CATALINA_TMPDIR: /path/to/tomcat/temp
Using JRE_HOME:        /path/to/jdk/jre
Using CLASSPATH:
       /path/to/tomcat/bin/bootstrap.jar:/path/to/tomcat/bin/tomcat-juli.jar</pre></li><li class="step"><p>Delete OpenAM configuration files, by default under the
   <code class="filename">$HOME</code> of the user running the web application
   container.</p><pre class="cmdline prettyprint">$ rm -rf $HOME/openam $HOME/.openamcfg</pre><p>When using the internal OpenAM configuration store, this step
   deletes the embedded directory server and all of its contents. This is why
   you stop the application server before removing the configuration.</p><p>If you use an external configuration store, also delete the entries
   under the configured OpenAM suffix (by default
   ).</p></li><li class="step"><p>Restart the OpenAM web application.</p><p>The following example starts the Tomcat container.</p><pre class="cmdline prettyprint">$ /path/to/tomcat/bin/startup.sh
Password: 
Using CATALINA_BASE:   /path/to/tomcat
Using CATALINA_HOME:   /path/to/tomcat
Using CATALINA_TMPDIR: /path/to/tomcat/temp
Using JRE_HOME:        /path/to/jdk/jre
Using CLASSPATH:
       /path/to/tomcat/bin/bootstrap.jar:/path/to/tomcat/bin/tomcat-juli.jar</pre></li></ol></div></div><div class="procedure" id="configure-openam-custom"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;2.4.&nbsp;To Configure OpenAM</div><a class="indexterm" name="d4462e1795"></a><ol class="procedure" type="1"><li class="step"><p>In the initial configuration screen, click
   Create New Configuration under Custom Configuration.</p></li><li class="step"><p>Provide a password having at least 8 characters for the OpenAM
   Administrator, <code class="literal">amadmin</code>.</p><div class="mediaobject" align="center" id="figure-openam-conf-amadmin"><a class="fancybox" href="images/openam-conf-amadmin.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_openam-conf-amadmin.png" align="middle" alt="OpenAM amadmin password" title="The OpenAM Administrator has username&#xA;    amadmin."></a></div></li><li class="step"><p>Make sure the server settings are valid for your configuration.</p><div class="mediaobject" align="center" id="figure-openam-conf-server-settings"><a class="fancybox" href="images/openam-conf-server-settings.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_openam-conf-server-settings.png" align="middle" alt="OpenAM server settings" title="See OpenAM server settings below"></a></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Server URL</span></dt><dd><p>Provide a valid URL to the base of your OpenAM web
      container, including a fully qualified domain name (FQDN).</p><p>In a test environment, you can fake the FQDN by adding it to
      your <code class="filename">/etc/hosts</code> as an alias. The following excerpt
      shows lines from the <code class="filename">/etc/hosts</code> file on a Linux
      system where OpenAM is installed.</p><pre class="codelisting prettyprint">127.0.0.1 localhost.localdomain localhost
::1 localhost6.localdomain6 localhost6
127.0.1.1 openam openam.example.com</pre></dd><dt><span class="term">Cookie Domain</span></dt><dd><p>Starts with a dot (<code class="literal">.</code>).</p></dd><dt><span class="term">Platform Locale</span></dt><dd><p>Supported locales include en_US (English), de (German),
      es (Spanish), fr (French), ja (Japanese), ko (Korean),
      zh_CN (Simplified Chinese), and zh_TW (Traditional Chinese).</p></dd><dt><span class="term">Configuration Directory</span></dt><dd><p>Location on server for OpenAM configuration files. OpenAM must
      be able to write to this directory.</p></dd></dl></div></li><li class="step"><p>In the Configuration Store screen, you can accept the defaults
   to allow OpenAM to store configuration data in an embedded directory.
   The embedded directory can be configured separately to replicate data
   for high availability if necessary.</p><div class="mediaobject" align="center" id="figure-openam-conf-store"><a class="fancybox" href="images/openam-conf-store.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_openam-conf-store.png" align="middle" alt="OpenAM configuration store" title="The configuration store can use the embedded OpenDJ&#xA;    directory, or an external OpenDJ or DSEE service."></a></div><p>You can also add this OpenAM installation to an existing deployment,
   providing the URL of the site. See <a class="xref" href="#add-servers-to-site" title="Procedure&nbsp;2.5.&nbsp;To Add a Server to a Site">Procedure&nbsp;2.5, &#8220;To Add a Server to a Site&#8221;</a>
   for details.</p><p>Alternatively, if you already manage an OpenDJ or DSEE deployment,
   you can choose to store OpenAM configuration data in your existing
   directory service. You must, however, create the suffix to store
   configuration data on the directory server before you configure
   OpenAM. OpenAM does not create the suffix when you use an external
   configuration store.</p><p>When you create a new OpenAM custom configuration that uses an
   external LDAP directory server for the configuration data store, you must
   use a root suffix DN with at least two domain components, such as
   <code class="literal">dc=example,dc=com</code>.</p></li><li class="step"><p>In the User Store screen, you configure where OpenAM looks for
   user identities.</p><p>OpenAM must have write access to the directory service you choose,
   as it adds to the directory schema needed to allow OpenAM to manage access
   for users in the user store.</p><div class="mediaobject" align="center" id="figure-openam-conf-user-store"><a class="fancybox" href="images/openam-conf-user-store.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_openam-conf-user-store.png" align="middle" alt="OpenAM user store settings" title="See OpenAM user store settings below"></a></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">User Data Store Type</span></dt><dd><p>If you have a directory service already provisioned with users in
      a supported user data store, then select that type of directory from the
      options available.</p></dd><dt><span class="term">SSL/TLS Enabled</span></dt><dd><p>To use a secure connection, check this box, then make sure
      the Port you define corresponds to the port on which the directory
      listens for StartTLS or SSL connections. When using this option you also
      need to make sure the trust store used by the JVM running OpenAM has the
      necessary certificates installed.</p></dd><dt><span class="term">Directory Name</span></dt><dd><p>FQDN for the host housing the directory service</p></dd><dt><span class="term">Port</span></dt><dd><p>LDAP directory port. The default for LDAP and LDAP with StartTLS
      to protect the connection is port 389. The default for LDAP over SSL
      is port 636. Your directory service might use a different port.</p></dd><dt><span class="term">Root Suffix</span></dt><dd><p>Base distinguished name (DN) where user data are stored</p></dd><dt><span class="term">Login ID</span></dt><dd><p>Directory administrator user DN. The administrator must be capable
      of updating schema and user data.</p></dd><dt><span class="term">Password</span></dt><dd><p>Password for the directory administrator user</p></dd></dl></div></li><li class="step"><p>In the Site Configuration screen, you can set up OpenAM as part of
   a site where the load is balanced across multiple OpenAM servers.</p><p>If you have a site configuration with a load balancer, you can enable
   session high availability persistence and failover. OpenAM then stores
   sessions across server restarts, so that users do not have to login
   again.</p><p>If you then add additional servers to this OpenAM site, OpenAM performs
   <em class="firstterm">session failover</em>, storing session data in a directory
   service that is shared by different OpenAM servers. The shared storage means
   that if an OpenAM server fails, other OpenAM servers in the site have access
   to the user's session data and can serve requests about that user. As a
   result the user does not have to log in again. If session failover is
   important for your deployment, also follow the instructions in <a href="../install-guide/index.html#chap-session-failover" class="link"><em class="citetitle">Setting Up
   OpenAM Session Failover</em></a>.</p><div class="mediaobject" align="center" id="figure-openam-conf-site"><a class="fancybox" href="images/openam-conf-site.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_openam-conf-site.png" align="middle" alt="OpenAM site configuration" title="Accept the defaults unless you load balance across&#xA;    multiple OpenAM servers."></a></div><p>It is possible to set up a site after initial installation and
   configuration. Doing so is described in the chapter on
   <em class="citetitle">Setting Up OpenAM Session Failover</em>.</p></li><li class="step"><p>In the Agent Information screen, provide a password having at least
   8 characters to be used by policy agents to connect to OpenAM.</p><div class="mediaobject" align="center" id="figure-openam-conf-pa"><a class="fancybox" href="images/openam-conf-pa.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_openam-conf-pa.png" align="middle" alt="OpenAM policy agent password" title="OpenAM policy agents use the password you provide&#xA;    to access centralized configuration information."></a></div></li><li class="step"><p>Check the summary screen, and if necessary click Previous to return to
   earlier screens if necessary to fix configuration errors.</p><div class="mediaobject" align="center" id="figure-openam-conf-summary"><a class="fancybox" href="images/openam-conf-summary.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_openam-conf-summary.png" align="middle" alt="OpenAM configuration summary" title="The configuration summary screen shows the choices you&#xA;    made."></a></div><p>After you click Create Configuration in the summary screen,
   configuration proceeds, logging progress that you can read in your browser
   and later in the installation log. The process ends, and OpenAM shows the
   Proceed to Login prompt.</p><div class="mediaobject" align="center" id="figure-openam-proceed-to-login"><a class="fancybox" href="images/openam-proceed-to-login.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_openam-proceed-to-login.png" align="middle" alt="OpenAM proceed to login prompt" title="After configuration, you can login to access OpenAM&#xA;    console."></a></div></li><li class="step"><p>When the configuration completes, click Proceed to Login, and then
   login as the OpenAM administrator, <code class="literal">amadmin</code>.</p><div class="mediaobject" align="center" id="figure-openam-first-login-admin"><a class="fancybox" href="images/openam-first-login.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_openam-first-login.png" align="middle" alt="OpenAM first login" title="To access OpenAM console, log in as the OpenAM&#xA;    Administrator, amadmin"></a></div><p>After login, OpenAM redirects you to the OpenAM Console page.</p><div class="mediaobject" align="center" id="figure-openam-console"><a class="fancybox" href="images/openam-console.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_openam-console.png" align="middle" alt="OpenAM Console home page" title="The home page for OpenAM when logged in as the OpenAM&#xA;    Administrator, amadmin"></a></div><p>You can also access OpenAM Console by browsing to the Console URL, such
   as <code class="literal">http://openam.example.com:8080/openam/console</code>.</p></li><li class="step"><p>Restrict permissions to the configuration directory (by default
   <code class="filename">$HOME/openam</code>, where
   $HOME corresponds to the user who runs the web container). Prevent other
   users from accessing files in the configuration directory.</p></li></ol></div></div><div class="procedure" id="add-servers-to-site"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;2.5.&nbsp;To Add a Server to a Site</div><p>High availability requires redundant servers in case of failure.
  With OpenAM, you configure an OpenAM site with multiple servers in a
  pool behind a load balancing service the exposes a single URL as an entry
  point to the site.</p><p>Follow these steps to configure a server to belong to an existing
  site.</p><ol class="procedure" type="1"><li class="step"><p>In the initial configuration screen, under Custom Configuration click
   Create New Configuration.</p></li><li class="step"><p>In the first screen, enter the same password entered for the OpenAM
   Administrator, <code class="literal">amadmin</code>, when you configured the first
   server in the site.</p></li><li class="step"><p>Configure server settings as required.</p><p>The cookie domain should be identical to that of the first server in
   the site.</p></li><li class="step"><p>In the configuration store screen, select Add to Existing Deployment,
   and enter as the Server URL the URL of the first OpenAM server in the
   site.</p><p>The directory used to store configuration data should belong to the
   same directory service used for this purpose by other OpenAM servers in
   the site. If you use the embedded OpenDJ directory server, for example,
   you can have the configurator set up data replication with embedded directory
   servers used by other servers in the site.</p><p>Settings for the user store are then shared with the existing server,
   so the corresponding wizard screen is skipped.</p></li><li class="step"><p>In the site configuration screen, select <code class="literal">Yes</code> and
    enter the same site configuration details as you did for the first server
    in the site.</p><p>Settings for agent information are also shared with the existing server,
   so the corresponding wizard screen is skipped.</p></li><li class="step"><p>In the summary screen, verify the settings you chose, and then click
   Create Configuration.</p></li><li class="step"><p>When the configuration process finishes, click Proceed to Login,
   and then login as the OpenAM administrator to access OpenAM Console.</p></li></ol></div></div><div class="procedure" id="deploy-coreonly"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;2.6.&nbsp;To Deploy OpenAM Core Server (No Console)</div><p>You can deploy OpenAM server without OpenAM console by performing the
  following steps.</p><ol class="procedure" type="1"><li class="step"><p>Deploy the <code class="filename"></code> file 
    in your container.</p><p>For example, copy the file to deploy on Apache Tomcat.</p><pre class="cmdline prettyprint">$ cp  /path/to/tomcat/webapps/coreonly.war</pre></li><li class="step"><p>Browse to the configuration application, such as
    <code class="literal">http://openam.example.com:8080/coreonly/</code>, and configure
    OpenAM core services as in <a class="xref" href="#configure-openam-custom" title="Procedure&nbsp;2.4.&nbsp;To Configure OpenAM">Procedure&nbsp;2.4, &#8220;To Configure OpenAM&#8221;</a>.</p></li><li class="step"><p>After configuration, restrict permissions to the configuration
   directory, such as <code class="filename">$HOME/coreonly/</code> where
   <code class="literal">$HOME</code> corresponds to the user who runs the web
   container. Prevent other users from accessing files in the configuration
   directory.</p></li></ol></div></div></div><div lang="en" class="chapter" id="chap-install-tools"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;3.&nbsp;Installing OpenAM Tools</h1></div></div></div><a class="indexterm" name="d4462e2124"></a><p>OpenAM tools are found in <code class="filename">.zip</code> files where you
 unpacked the archive of the entire package, such as
 <code class="filename">~/Downloads/openam</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename"></code></span></dt><dd><p>Administration tools: <span class="command"><strong>ampassword</strong></span>,
    <span class="command"><strong>ssoadm</strong></span> and <span class="command"><strong>amverifyarchive</strong></span></p><p>See <a class="xref" href="#install-openam-admin-tools" title="Procedure&nbsp;3.1.&nbsp;To Set Up Administration Tools">Procedure&nbsp;3.1, &#8220;To Set Up Administration Tools&#8221;</a>.</p></dd><dt><span class="term"><code class="filename"></code></span></dt><dd><p>Configuration and upgrade tools, alternatives to using
    the GUI configuration wizard</p><p>See <a class="xref" href="#install-openam-config-tools" title="Procedure&nbsp;3.2.&nbsp;To Set Up Configuration Tools">Procedure&nbsp;3.2, &#8220;To Set Up Configuration Tools&#8221;</a>.</p></dd></dl></div><div class="procedure" id="install-openam-admin-tools"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;3.1.&nbsp;To Set Up Administration Tools</div><ol class="procedure" type="1"><li class="step"><p>Make sure OpenAM is installed and running before proceeding.</p></li><li class="step"><p>Make sure the <code class="literal">JAVA_HOME</code> environment variable
   is properly set.</p><pre class="cmdline prettyprint">$ echo $JAVA_HOME
/path/to/jdk</pre></li><li class="step"><p>Create a file system directory to unpack the tools.</p><pre class="cmdline prettyprint">$ mkdir -p /path/to/openam-tools/admin</pre></li><li class="step"><p>Unpack the tools.</p><pre class="cmdline prettyprint">$ cd /path/to/openam-tools/admin
$ unzip ~/Downloads/openam/</pre></li><li class="step"><p>If you use IBM Java, add
   <code class="literal">-D"amCryptoDescriptor.provider=IBMJCE"</code> and
   <code class="literal">-D"amKeyGenDescriptor.provider=IBMJCE"</code> options to the
   <span class="command"><strong>setup</strong></span> or <span class="command"><strong>setup.bat</strong></span> script before
   you install the tools.</p><p>The options should be set for the <span class="command"><strong>java</strong></span> command
   at the end of the script.</p><pre class="cmdline prettyprint">$ tail setup
CLASSPATH="$CLASSPATH:resources"

$JAVA_HOME/bin/java -D"load.config=yes" -D"help.print=$help_print" \
                      -D"path.AMConfig=$path_AMConfig" \
                      -D"path.debug=$path_debug" \
                      -D"path.log=$path_log" \
                      -D"amCryptoDescriptor.provider=IBMJCE" \
                      -D"amKeyGenDescriptor.provider=IBMJCE" \
                      -cp "$CLASSPATH" \
                      com.sun.identity.tools.bundles.Main</pre></li><li class="step"><p>Run the <span class="command"><strong>setup</strong></span> utility (<span class="command"><strong>setup.bat</strong></span>
   on Windows), providing the path to the directory where OpenAM configuration
   files are located, and where you want debug and log information to be
   located.</p><pre class="cmdline prettyprint">$ ./setup
Path to config files of OpenAM server [/home/mark/openam]:
Debug Directory [/path/to/openam-tools/admin/debug]:
Log Directory [/path/to/openam-tools/admin/log]:
The scripts are properly setup under directory:
 /path/to/openam-tools/admin/openam
Debug directory is /path/to/openam-tools/admin/debug.
Log directory is /path/to/openam-tools/admin/log.
The version of this tools.zip is: <em><strong>version and date</strong></em>
The version of your server instance is: OpenAM <em><strong>version and date</strong></em></pre><p>After setup, the tools are located under a directory named after the
   instance of OpenAM.</p><pre class="cmdline prettyprint">$ ls openam/bin/
ampassword  amverifyarchive  ssoadm</pre><p>On Windows, these files are .bat scripts.</p></li><li class="step"><p>If you use IBM Java, add
   <code class="literal">-D"amCryptoDescriptor.provider=IBMJCE"</code> and
   <code class="literal">-D"amKeyGenDescriptor.provider=IBMJCE"</code> options to the
   <span class="command"><strong>ssoadm</strong></span> or <span class="command"><strong>ssoadm.bat</strong></span> script before
   using the script.</p><p>The options should be set before the call to
   <code class="literal">com.sun.identity.cli.CommandManager</code> at the end of the
   script.</p><pre class="cmdline prettyprint">$ tail -3 /path/to/openam-tools/admin/openam/bin/ssoadm
    -D"amCryptoDescriptor.provider=IBMJCE" \
    -D"amKeyGenDescriptor.provider=IBMJCE" \
    com.sun.identity.cli.CommandManager "$@"</pre></li><li class="step"><p>Check that <span class="command"><strong>ssoadm</strong></span> works properly.</p><pre class="cmdline prettyprint">$ echo password &gt; /tmp/pwd.txt
$ chmod 400 /tmp/pwd.txt
$ cd /path/to/openam-tools/admin/openam/bin/
$ ./ssoadm list-servers -u amadmin -f /tmp/pwd.txt

http://openam.example.com:8080/openam</pre><p>The <span class="command"><strong>ssoadm</strong></span> commands can also be run from
   <code class="filename">ssoadm.jsp</code> in OpenAM, for example at
   <code class="literal">http://openam.example.com:8080/openam/ssoadm.jsp</code>,
   once the page has been enabled as described in the section on <a href="../admin-guide/index.html#openam-ssoadm-jsp-overview" class="link">OpenAM ssoadm.jsp</a>
    in the <em class="citetitle">Administration Guide</em>.</p><p>Not all of the sub-commands available through the <span class="command"><strong>ssoadm</strong></span>
  command are available on the <code class="literal">ssoadm.jsp</code> web page.</p></li><li class="step"><p>If you connect to OpenAM over SSL (HTTPS), the <span class="command"><strong>ssoadm</strong></span>
   by default tries to trust the certificate based on the CA certificates in
   the Java <code class="literal">cacerts</code> truststore. This might not work for your
   deployment.</p><p>If the SSL certificate configured for the container where you deployed
   OpenAM was not signed by a recognized CA then the SSL connection process
   fails. For example, if you used a self-signed certificate as described in the
   <em class="citetitle">Administration Guide</em> procedure, <a href="../admin-guide/index.html#openam-with-https-on-tomcat" class="link"><em class="citetitle">To Set Up OpenAM
   With HTTPS on Tomcat</em></a>, then the <span class="command"><strong>ssoadm</strong></span>
   command cannot trust that certificate by default. To allow the
   <span class="command"><strong>ssoadm</strong></span> command to trust the certificate, edit the
   <span class="command"><strong>ssoadm</strong></span> (<span class="command"><strong>ssoadm.bat</strong></span> on Windows)
   script as follows.</p><p>Add two additional options to the <span class="command"><strong>java</strong></span> command in
   the script to identify the proper trust store and trust store password,
   depending on how you set up SSL. The following example points to the key
   store in which Tomcat holds the self-signed certificate that it presents
   when establishing an HTTPS connection.</p><pre class="literallayout">-D"javax.net.ssl.trustStore=/path/to/tomcat/conf/keystore.jks"
 -D"javax.net.ssl.trustStorePassword=changeit"</pre><p>If the <span class="command"><strong>ssoadm</strong></span> command cannot access the server
   key store in this way, set up your own trust store and import the server
   certificate using the Java <span class="command"><strong>keytool</strong></span> command.</p></li><li class="step"><p>If you have deployed OpenAM in a site configuration, edit the
   <span class="command"><strong>ssoadm</strong></span> (<span class="command"><strong>ssoadm.bat</strong></span> on Windows) script
   to map the site URL to the OpenAM server URL.</p><p>To do this, set a
   <code class="literal">com.iplanet.am.naming.map.site.to.server</code> system property
   option of the <span class="command"><strong>java</strong></span> command in the script. The option
   takes the following form.</p><pre class="literallayout">-D"com.iplanet.am.naming.map.site.to.server=<em class="replaceable"><code>lb-url</code></em>=<em class="replaceable"><code>openam-url</code></em>[,
 <em class="replaceable"><code>other-lb-url</code></em>=<em class="replaceable"><code>openam-url</code></em> ...]"</pre><p>The property maps each <em class="replaceable"><code>lb-url</code></em> key to an
   <em class="replaceable"><code>openam-url</code></em> value, where
   <em class="replaceable"><code>lb-url</code></em> is the URL to a site load balancer and
   <em class="replaceable"><code>openam-url</code></em> is the URL to the OpenAM server against
   which you set up the <span class="command"><strong>ssoadm</strong></span> command.</p><p>The <span class="command"><strong>ssoadm</strong></span> command is dependent on the OpenAM server
   against which you set it up, so always map site load balancer URLs to that
   server's <em class="replaceable"><code>openam-url</code></em>.</p><p>For example, if your site is behind
   <code class="literal">https://lb.example.com:443/openam</code>, and the OpenAM server
   against which you set up the <span class="command"><strong>ssoadm</strong></span> is at
   <code class="literal">http://openam.example.com:8080/openam</code>, then add the
   following property to the <span class="command"><strong>java</strong></span> command (all on one line
   without spaces).</p><pre class="literallayout">-D"com.iplanet.am.naming.map.site.to.server=
 https://lb.example.com:443/openam=http://openam.example.com:8080/openam"</pre><p>Repeat this step for each OpenAM server in your site configuration.
   You can install all your instances of <span class="command"><strong>ssoadm</strong></span> on the same
   host, but in each case the command should manage only one OpenAM
   server.</p></li></ol></div></div><div class="procedure" id="install-openam-config-tools"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;3.2.&nbsp;To Set Up Configuration Tools</div><a class="indexterm" name="d4462e2423"></a><ol class="procedure" type="1"><li class="step"><p>Make sure the <code class="literal">JAVA_HOME</code> environment variable
   is properly set.</p><pre class="cmdline prettyprint">$ echo $JAVA_HOME
/path/to/jdk</pre></li><li class="step"><p>Unpack the tools from where you unzipped OpenAM.</p><div class="informalexample"><pre class="cmdline prettyprint">$ cd /path/to/openam-tools/config
$ unzip ~/Downloads/openam/
Archive:  ~/Downloads/openam/
  inflating: README
  inflating: sampleconfiguration
  inflating: sampleupgrade
 extracting: 
 extracting: 
  inflating: license.txt</pre></div><p>Set up configuration files based on the
   <code class="filename">sampleconfiguration</code> example, and then apply the
   configuration to a deployed OpenAM .war file using the following
   command.</p><pre class="cmdline prettyprint">$ java -jar  -f <em><strong>config.file</strong></em></pre><p>The <em class="replaceable"><code>config.file</code></em> is set up by default to
   use the embedded data store with OpenAM installed on
   <code class="literal">server1.example.com</code>. You must edit the file before using
   it, as described in the <em class="citetitle">OpenAM Reference</em> for
   <a href="../reference/index.html#man-configurator-jar-1" class="link"><span class="command"><strong>configurator.jar</strong></span></a>.</p></li></ol></div></div></div><div lang="en" class="chapter" id="chap-install-das"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;4.&nbsp;Installing OpenAM Distributed Authentication</h1></div></div></div><a class="indexterm" name="d4462e2475"></a><p>You can minimize the exposure of OpenAM to the Internet. It is a relatively standard
 practice to protect an enterprise network with a pair of firewalls. Systems that require
 external access are placed between the firewalls in a semi-secure area known as a demilitarized
 zone (DMZ). You can deploy a small subset of OpenAM as the login interface in a DMZ. That
 subset is known as the distributed authentication service (DAS). Logins through the DAS are
 forwarded through the internal firewall to the OpenAM core server. For more information see
 the OpenAM Administration Guide section on <a href="../admin-guide/index.html#protect-network-access" class="link"><em class="citetitle">Protecting Network
 Access</em></a>.</p><p>To deploy the DAS securely, select a system in your DMZ. Then take the following
 general steps:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Make sure the cookie domain for the DAS is configured in OpenAM under
   Configuration &gt; System &gt; Platform.</p></li><li class="listitem"><p>Make sure the realms used have a Realm/DNS alias for the DAS
   configured in OpenAM under Access Control &gt; <em class="replaceable"><code>Realm
   Name</code></em> &gt; General.</p></li><li class="listitem"><p>Deploy the  file into your web application container.</p><p>How you deploy the DAS .war file depends on your web application
   container. The procedure in this section shows how to deploy on
   Apache Tomcat.</p></li><li class="listitem"><p>Configure the DAS UI to access OpenAM core services.</p></li><li class="listitem"><p>Configure your firewall to allow end user access to the DAS.</p><p>Firewall configuration is not described here.</p></li></ol></div><div class="panel panel-primary"><div class="panel-heading"><h3 class="panel-title">Important</h3></div><div class="panel-body"><p>The DAS relies on the classic OpenAM UI. If you customize the end
  user pages, follow the procedures for the classic UI described in
  <a href="../install-guide/index.html#chap-custom-ui" class="link"><em class="citetitle">Customizing the
  OpenAM End User Pages</em></a>.</p></div></div><div class="procedure" id="deploy-distributed-auth-on-tomcat"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;4.1.&nbsp;To Deploy the DAS on Tomcat</div><ol class="procedure" type="1"><li class="step"><p>Copy the <code class="filename"></code> file into the 
   <code class="filename">webapps/</code> directory.</p><pre class="cmdline prettyprint">cp ~/Downloads/openam/
 /path/to/tomcat/webapps</pre></li><li class="step"><p>Check that you see the initial DAS configuration screen
   in your browser.</p></li></ol></div></div><div class="procedure" id="configure-distributed-auth"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;4.2.&nbsp;To Configure the DAS</div><ol class="procedure" type="1"><li class="step"><p>Configure the DAS using the agent profile to connect to OpenAM.</p><div class="mediaobject" align="center" id="figure-das-complete-config"><a class="fancybox" href="images/das-complete-config.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_das-complete-config.png" align="middle" alt="Completed DAS configuration screen" title="Configure access to OpenAM."></a></div><p>Most DAS configuration choices require no clarification. Hints for
   equivocal parameters follow.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Debug Level</span></dt><dd><p>Default is <code class="literal">error</code>. Other options include
      <code class="literal">error</code>, <code class="literal">warning</code>,
      <code class="literal">message</code>, and <code class="literal">off</code>.</p></dd><dt><span class="term">Encryption Key</span></dt><dd><p>Do not change the password encryption key.</p></dd><dt><span class="term">Application User Name</span></dt><dd><p>The DAS uses this identity, such as
      <code class="literal">UrlAccessAgent</code>, to authenticate to OpenAM.</p></dd><dt><span class="term">Application User Password</span></dt><dd><p>The DAS uses this password to authenticate to OpenAM.</p></dd></dl></div></li><li class="step"><p>Login through the DAS to access OpenAM services.</p><p>For testing, you can login as user <code class="literal">demo</code>,
   password <code class="literal">changeit</code>.</p><div class="mediaobject" align="center" id="figure-das-login-success"><a class="fancybox" href="images/das-login-success.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_das-login-success.png" align="middle" alt="Successfully logged in through the DAS" title="The DAS UI redirects the user to the URL&#xA;    configured for the realm."></a></div><p>When the <code class="literal">/openam/idm/EndUser</code> page is inside the
   firewall, and therefore not visible to users outside, redirect the
   browser after successful login to a page that exists. One way to do this
   is to use the <code class="literal">goto</code> parameter in the URL.</p><pre class="literallayout">https://das.example.com/das/UI/Login?goto=<em class="replaceable"><code>absolute-successful-redirect-URL</code></em></pre><p>On successful login, your browser stores an
   <code class="literal">AMDistAuthConfig</code> cookie that identifies the DAS.</p></li><li class="step"><p>Restrict permissions to the configuration for the DAS under the
   <code class="filename">$HOME/FAMDistAuth</code> directory of the user who runs the
   web container where you deployed the service.</p><p>The configuration file name ends in
   <code class="filename">AMDistAuthConfig.properties</code>.</p><p>If you deploy multiple DAS servers, you can configure them to forward
   requests to each other based on the <code class="literal">AMDistAuthConfig</code>
   cookie by setting the <code class="literal">com.sun.identity.distauth.cluster</code>
   property in this file. The following example lines are wrapped to fit on the
   page, but you put the entire property on a single line in the configuration
   file.</p><pre class="codelisting prettyprint">com.sun.identity.distauth.cluster=
 http://das.example.com:8080/das/UI/Login,
 http://das2.example.com:8080/das/UI/Login</pre></li><li class="step"><p>If your deployment includes multiple OpenAM servers, then edit the
   DAS configuration file, <code class="filename">$HOME/FAMDistAuth/*AmDistAuthConfig.properties</code>,
   to include <code class="literal">X-Forwarded-For</code> in the list of
   <a href="../reference/index.html#openam-retained-http-request-headers" class="link"><code class="literal">openam.retained.http.request.headers</code></a>.</p><p>Example: <code class="literal">openam.retained.http.request.headers=X-DSAMEVersion,X-Forwarded-For</code></p><p>This ensures the authoritative OpenAM authentication server gets
   the client IP address in this header of the forwarded HTTP request. You can
   also add the header to the list for the
   <code class="literal">openam.retained.http.headers</code> property to have OpenAM copy
   the header to the response.</p></li><li class="step"><p>Some application servers such as JBoss 7 mount the content of the
   deployed .war file in a temporary location that can change on restart. To
   make sure that the DAS can find its bootstrap configuration in this case,
   specify the path to the bootstrap configuration file as a Java runtime option
   for the DAS, as in the following example. The property to set is
   <code class="literal">openam.das.bootstrap.file</code>.</p><pre class="codelisting prettyprint">-Dopenam.das.bootstrap.file=/home/openam/FAMDistAuth/AMDistAuthConfig.properties</pre><p>You must make sure that the value of the option corresponds to the path
   to the correct <code class="filename">AMDistAuthConfig.properties</code> file.</p></li></ol></div></div></div><div lang="en" class="chapter" id="chap-custom-ui"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;5.&nbsp;Customizing the OpenAM End User Pages</h1></div></div></div><a class="indexterm" name="d4462e2694"></a><p>When you deploy OpenAM to protect your web-based applications, users
 can be redirected to OpenAM pages for login and logout. ForgeRock provides
 pages localized for English, French, German, Spanish, Japanese, Korean,
 Simplified Chinese, and Traditional Chinese, but you might require additional
 language support for your organization.</p><p>Also, by default the end user pages have ForgeRock styling and branding.
 You likely want to change at least the images to reflect your organization.
 You might want to have different page customizations for different realms as
 well. This chapter address how to get started customizing OpenAM end user
 pages for your organizations and supported locales.</p><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>There is an evolving alternative UI available for OpenAM, known
  informally as the XUI. You can enable XUI in OpenAM Console under
  Configuration &gt; Authentication &gt; Core &gt; Global Attributes, by selecting XUI
  Interface Enabled and saving your work. See <a class="xref" href="#basic-xui-configuration" title="5.3.&nbsp;Configuring the XUI">Section&nbsp;5.3, &#8220;Configuring the XUI&#8221;</a> for more.</p></div></div><p>To customize the classic UI, first you copy the pages to customize to the
 proper location, and then you customize the files themselves.</p><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>Case mismatch can cause failures in the UI lookup for some systems. To ensure
  lookup success and for consistency, use lowercase names for your customized
  directories. All of the default directories are already lowercase.</p></div></div><p>Classic UI images described in this chapter are located in
 <code class="filename">/path/to/tomcat/webapps/openam/images/</code>, and CSS in
 <code class="filename">/path/to/tomcat/webapps/openam/css/</code>. If you choose
 to modify images for your deployment, you can maintain the sizes to avoid
 having to customize page layout extensively.</p><div class="section" id="update-classic-ui"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5.1.&nbsp;Updating the Classic UI</h2></div></div></div><p>When developing with a web container that deploys
         OpenAM in a temporary location, such as JBoss or Jetty, restarting the
         container can overwrite your changes with the deployable .war content. For
         those web containers, you should also prepare a deployable .war containing
         your changes, and redeploy that file to check your work.</p><div class="panel panel-success"><div class="panel-heading"><h3 class="panel-title">Tip</h3></div><div class="panel-body"><p>For production deployment you must package your changes in a custom
         OpenAM deployable .war file. To create a deployable .war, unpack the
         OpenAM .war file from <code class="filename">~/Downloads/openam</code>
         into a staging directory, apply your changes in the staging directory, and
         use the <span class="command"><strong>jar</strong></span> command  to prepare the deployable .war.</p></div></div><div class="itemizedlist"><p>The procedures below describe how to update a deployed version of
             OpenAM, so that you can see your changes without redeploying the application.
             This approach works for development as long as your web container does
             not overwrite changes.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="#copy-ui-to-customize-top-level-realm" title="Procedure&nbsp;5.1.&nbsp;To Copy the Pages to Customize For the Top-Level Realm">Procedure&nbsp;5.1, &#8220;To Copy the Pages to Customize For the Top-Level Realm&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#copy-ui-to-customize-subrealm" title="Procedure&nbsp;5.2.&nbsp;To Copy the Pages to Customize For Another Realm">Procedure&nbsp;5.2, &#8220;To Copy the Pages to Customize For Another Realm&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#customize-ui-copy" title="Procedure&nbsp;5.3.&nbsp;To Customize Files You Copied">Procedure&nbsp;5.3, &#8220;To Customize Files You Copied&#8221;</a></p></li></ul></div><div class="procedure" id="copy-ui-to-customize-top-level-realm"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;5.1.&nbsp;To Copy the Pages to Customize For the Top-Level Realm</div><p>Rather than changing the default pages, customize your own copy.</p><ol class="procedure" type="1"><li class="step"><p>Change to the <code class="filename">config/auth</code> directory where
   you deployed OpenAM.</p><pre class="cmdline prettyprint">$ cd /path/to/tomcat/webapps/openam/config/auth</pre></li><li class="step"><p>Copy the default files and optionally the localized files to
   <code class="filename"><em class="replaceable"><code>suffix</code></em>[_<em class="replaceable"><code>locale</code></em>]/html</code>,
   where <em class="replaceable"><code>suffix</code></em> is the value of the RDN of the
   configuration suffix, such as <code class="literal">openam</code> if you use the
   default configuration suffix <code class="literal"></code>,
   and the optional <em class="replaceable"><code>locale</code></em> is, for example,
   <code class="literal">jp</code> for Japanese, or <code class="literal">zh_CN</code> for
   Simplified Chinese.</p><p>The following example copies the files for the Top-Level Realm
   (<code class="literal">/</code>) for a custom French locale.</p><pre class="cmdline prettyprint">$ mkdir -p openam/html
$ cp -r default/* openam/html
$ mkdir -p openam_fr/html
$ cp -r default_fr/* openam_fr/html</pre><p>See <a class="link" href="#lookup-for-ui-files" title="5.2.&nbsp;How OpenAM Looks Up UI Files"><em class="citetitle">How OpenAM Looks Up
   UI files</em></a> for details.</p></li></ol></div></div><div class="procedure" id="copy-ui-to-customize-subrealm"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;5.2.&nbsp;To Copy the Pages to Customize For Another Realm</div><p>As for the top-level realm, customize your own copy rather than the
  default pages.</p><ol class="procedure" type="1"><li class="step"><p>Change to the <code class="filename">config/auth</code> directory where
   you deployed OpenAM.</p><pre class="cmdline prettyprint">$ cd /path/to/tomcat/webapps/openam/config/auth</pre></li><li class="step"><p>Depending on which locale you want to customize, copy the default
   files and optionally the localized files to
   <code class="filename"><em class="replaceable"><code>suffix</code></em>[_<em class="replaceable"><code>locale</code></em>]/services/<em class="replaceable"><code>realm</code></em>/html</code>, where
   <em class="replaceable"><code>suffix</code></em> is the value of the RDN of the
   configuration suffix, which is <code class="literal">openam</code> if you use the
   default configuration suffix <code class="literal"></code>.</p><p>The following example copies the files for a custom French locale and
   a realm named <code class="literal">ventes</code>.</p><pre class="cmdline prettyprint">$ mkdir -p openam/html/ventes/html
$ cp -r default/* openam/services/ventes/html
$ mkdir -p openam_fr/services/ventes/html
$ cp -r default_fr/* openam_fr/services/ventes/html</pre></li></ol></div></div><div class="procedure" id="customize-ui-copy"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;5.3.&nbsp;To Customize Files You Copied</div><p>The .jsp files from the <code class="filename">default/</code> directory
  reference the images used in the OpenAM pages, and retrieve localized text
  from the .xml files. Thus you customize appearance through the .jsp files,
  being careful not to change the functionality itself. You customize the
  localized text through the .xml files.</p><ol class="procedure" type="1"><li class="step"><p>Modify appearance if you must by editing the .jsp, image, and
   CSS files without changing any of the JSP tags that govern how the pages
   work.</p></li><li class="step"><p>Modify the localized text, using UTF-8 without escaped characters, by
   changing only the original text strings in the .xml files.</p><p>For example, to change the text in the default OpenAM login screen in
   the top-level realm for the French locale, edit
   <code class="filename">openam_fr/html/DataStore.xml</code>.</p></li><li class="step"><p>If necessary, restart OpenAM or the web container to test the changes
   you have made.</p><p>The following screen shot shows a customized French login page
   where the string <code class="literal">Nom d'utilisateur</code> has been replaced
   with the string <code class="literal">Votre identifiant</code>, and the string
   <code class="literal">Mot de passe</code> has been replaced with the string
   <code class="literal">Votre mot de passe</code> in
   <code class="filename">openam_fr/html/DataStore.xml</code>.</p><div class="mediaobject" align="center" id="figure-modified-fr-login"><a class="fancybox" href="images/modified-fr-login.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_modified-fr-login.png" align="middle" alt="Example customized OpenAM login page" title="This shows the customized page login described&#xA;    above."></a></div></li></ol></div></div></div><div class="section" id="lookup-for-ui-files"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5.2.&nbsp;How OpenAM Looks Up UI Files</h2></div></div></div><p>This section provides a more complete description of how OpenAM looks
  up UI files.</p><div class="variablelist"><p>OpenAM uses the following information to look up the UI files.</p><dl class="variablelist"><dt><span class="term">Configuration suffix RDN</span></dt><dd><p>When you set up the OpenAM to store its configuration in a directory
     server, you provide the distinguished name of the configuration suffix,
     by default <code class="literal"></code>, therefore, the
     relative distinguished name attribute value is <code class="literal">openam</code>.</p></dd><dt><span class="term">Client (browser) locale language</span></dt><dd><p>The client can specify a locale, which can consist of both a
     language and a territory, such as <code class="literal">en_GB</code> for British
     English. The language in this case is <code class="literal">en</code>.</p></dd><dt><span class="term">Client (browser) locale territory</span></dt><dd><p>If the client local is <code class="literal">en_GB</code>, then the territory
     in this case is <code class="literal">GB</code>.</p></dd><dt><span class="term">Platform locale language</span></dt><dd><p>The platform locale, defined for the platform where OpenAM runs,
     can also consist of both a language and a territory, such as
     <code class="literal">hu_HU</code>. In this example the platform locale language is
     <code class="literal">hu</code> for Hungarian.</p></dd><dt><span class="term">Platform locale territory</span></dt><dd><p>If the platform locale is <code class="literal">hu_HU</code>, the platform
     locale territory is <code class="literal">HU</code> for Hungary.</p></dd><dt><span class="term">Realm</span></dt><dd><p>Realms can be nested. OpenAM uses the nesting as necessary to look
     for files specific to a sub-realm before looking in the parent
     realm.</p><p>For all realms below the top level realm, OpenAM adds a 
     <code class="filename">services</code> directory before the realm to the search
     path.</p></dd><dt><span class="term">Client name</span></dt><dd><p>Client names identify the type of client. The default,
     <code class="literal">html</code>, is the only client name used unless client
     detection mode is enabled. When client detection mode is enabled, the
     client name can be different for mobile clients, for example.</p></dd><dt><span class="term">File name</span></dt><dd><p>File names are not themselves localized. Thus
     <code class="filename">Login.jsp</code> has the same name for all locales, for
     example.</p></dd></dl></div><p>OpenAM tries first to find the most specific file for the realm and
  local requested, gradually falling back on less specific alternatives, then
  on other locales. The first and most specific location as follows.</p><div class="literallayout"><p><em class="replaceable"><code>suffix</code></em>_<em class="replaceable"><code>client-locale-language</code></em>_<em class="replaceable"><code>client-locale-territory</code></em>/services/<em class="replaceable"><code>realm</code></em>/<em class="replaceable"><code>client-name</code></em>/<em class="replaceable"><code>file-name</code></em></p></div><div class="example" id="example-ui-file-lookup"><div class="example-title">Example&nbsp;5.1.&nbsp;UI File Lookup</div><div class="example-contents"><p>OpenAM looks up <code class="filename">Login.jsp</code> in the following order
   for a realm named <code class="literal">realm</code>, with the browser requesting
   <code class="literal">en_GB</code> locale, the platform locale being
   <code class="literal">hu_HU</code>, and the configuration suffix named
   <code class="literal">o=openam</code>. The client name used in this example is the
   generic client name <code class="literal">html</code>.</p><pre class="codelisting prettyprint lang-sh">openam_en_GB/services/realm/html/Login.jsp
openam_en_GB/services/realm/Login.jsp
openam_en_GB/services/html/Login.jsp
openam_en_GB/services/Login.jsp
openam_en_GB/html/Login.jsp
openam_en_GB/Login.jsp
openam_en/services/realm/html/Login.jsp
openam_en/services/realm/Login.jsp
openam_en/services/html/Login.jsp
openam_en/services/Login.jsp
openam_en/html/Login.jsp
openam_en/Login.jsp
openam_hu_HU/services/realm/html/Login.jsp
openam_hu_HU/services/realm/Login.jsp
openam_hu_HU/services/html/Login.jsp
openam_hu_HU/services/Login.jsp
openam_hu_HU/html/Login.jsp
openam_hu_HU/Login.jsp
openam_hu/services/realm/html/Login.jsp
openam_hu/services/realm/Login.jsp
openam_hu/services/html/Login.jsp
openam_hu/services/Login.jsp
openam_hu/html/Login.jsp
openam_hu/Login.jsp
openam/services/realm/html/Login.jsp
openam/services/realm/Login.jsp
openam/services/html/Login.jsp
openam/services/Login.jsp
openam/html/Login.jsp
openam/Login.jsp
default_en_GB/services/realm/html/Login.jsp
default_en_GB/services/realm/Login.jsp
default_en_GB/services/html/Login.jsp
default_en_GB/services/Login.jsp
default_en_GB/html/Login.jsp
default_en_GB/Login.jsp
default_en/services/realm/html/Login.jsp
default_en/services/realm/Login.jsp
default_en/services/html/Login.jsp
default_en/services/Login.jsp
default_en/html/Login.jsp
default_en/Login.jsp
default_hu_HU/services/realm/html/Login.jsp
default_hu_HU/services/realm/Login.jsp
default_hu_HU/services/html/Login.jsp
default_hu_HU/services/Login.jsp
default_hu_HU/html/Login.jsp
default_hu_HU/Login.jsp
default_hu/services/realm/html/Login.jsp
default_hu/services/realm/Login.jsp
default_hu/services/html/Login.jsp
default_hu/services/Login.jsp
default_hu/html/Login.jsp
default_hu/Login.jsp
default/services/realm/html/Login.jsp
default/services/realm/Login.jsp
default/services/html/Login.jsp
default/services/Login.jsp
default/html/Login.jsp
default/Login.jsp</pre></div></div><br class="example-break"></div><div class="section" id="basic-xui-configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5.3.&nbsp;Configuring the XUI</h2></div></div></div><p>XUI is a new, still evolving UI for OpenAM, based on the Backbone.js
     JavaScript Model-View-Controller (MVC) framework, Handlebars.js for
     templating the "View" in the MVC framework, Underscore.js for the
     JavaScript-related utility functions, and a programmable LESS CSS, working
     with the OpenAM REST API.</p><p>Interface Stability: <a href="../admin-guide/index.html#interface-stability" class="link">Internal</a> (not supported)</p><p>XUI is not supported for production use.</p><p>The main XUI configuration file is based on LESS CSS; for more
     information, see <a class="link" href="http://lesscss.org/" target="_blank"><em class="citetitle">LESS, the Dynamic Stylesheet Language</em></a>.
     If desired, you can incorporate additional LESS CSS features in the XUI,
     above and beyond what is shown in the <code class="filename">themeConfig.json</code>
     file described in this section.</p><p>If you want to test the XUI, the first step is to enable it on the login screen. To do so, login
     to the OpenAM console as the administrator, and browse to Configuration &gt; Authentication &gt;
     Core &gt; XUI Interface &gt; Enabled. The next time you start OpenAM, you will see the following screen:</p><div class="mediaobject" align="center" id="figure-xui-login"><a class="fancybox" href="images/xui-login.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_xui-login.png" align="middle" alt="The XUI Login Screen" title="The XUI is built with JavaScript rather than JATO."></a></div><p>The look and feel of this login screen and user profile page are defined by the main XUI configuration
     file, <code class="filename">themeConfig.json</code>. You can find this file in the
     <code class="filename">/path/to/openam/webapps/XUI</code> directory.</p><p>You can customize the settings in the <code class="filename">themeConfig.json</code> file. For
     more information on each parameter in this file, see the Reference Guide chapter on <a href="../reference/index.html#chap-xui-parameters" class="link">
     <em class="citetitle">XUI Configuration Parameters</em></a>.</p><p>If desired, you can create themes for different realms. This assumes that you have already
     configured a realm named <code class="literal">realm1</code>. For more information, see <a href="../admin-guide/index.html#chap-realms" class="link">
     <em class="citetitle">Configuring Realms</em></a> in the OpenAM Administration Guide.</p><p>Now to create a theme for the second realm, open the
     <code class="filename">themeConfig.json</code> file in a text editor. Make a copy of all lines between the
     left curly bracket <code class="literal">{</code> after the <code class="literal">themes</code> parameter, and the corresponding
     right curly bracket <code class="literal">}</code> towards the end of the file.</p><pre class="cmdline prettyprint">{
     "themes": [
        {
            "name": "default",
            "path": "",
            "realms": [".*"],
            "regex": true,

        . . .

                "footer": {
                    "mailto": "info@forgerock.com",
                    "phone": "+47 2150108"
                }
            }
        }
     ]
}</pre><p>For a new realm named <code class="literal">realm1</code>, the revised <code class="filename">themeConfig.json</code> file
     should look similar to:</p><pre class="cmdline prettyprint">{
     "themes": [
         {
            "name": "default",
            "path": "",
            "realms": [".*"],
            "regex"" true,

         . . .

                 "footer": {
                    "mailto": "info@forgerock.com",
                    "phone": "+47 2150108"
                 }
             }
         },
         {
            "name": "realm1",
            "path": "path/to/realm1/",
            "realms": ["realm1.*"],
            "regex": true,

         . . .

                "footer": {
                    "mailto": "info@example.com",
                    "phone": "+1 555 555 5555"
                }
            }
         }
     ]
}</pre><p>Be careful with the syntax. Do not forget the comma between realms. If in doubt about your JSON syntax,
     refer to a validation tool such as <a class="link" href="http://jsonlint.com" target="_blank"><em class="citetitle">The
     JSON Validator</em></a>.</p><p>If you want to keep a parameter used in the default realm, just delete it from the later realm. Except
     for the following parameters, realm parameters inherit values from the default: <code class="literal">name</code>,
     <code class="literal">path</code>, <code class="literal">realms</code>, and <code class="literal">regex</code>.</p><p>When configuring new or revised parameters, keep the following tips in mind:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <code class="literal">path</code> to the directory with custom realm settings require a
             trailing forward slash <code class="literal">/</code>.</p></li><li class="listitem"><p>Logos may require custom height and width parameters.</p></li><li class="listitem"><p>Each of the <code class="literal">lessVars</code> parameters are based on variables defined in files
             in the <code class="filename">/path/to/webapps/openam/XUI/css/user</code> directory.</p></li><li class="listitem"><p>After making changes, use available tools to make sure the file uses correct JSON syntax.</p></li><li class="listitem"><p>Each realm after the default requires at least the <code class="literal">name</code>,
             <code class="literal">path</code>, <code class="literal">realms</code>, and <code class="literal">regex</code>
             parameters.</p></li></ul></div><p>When testing different options, make sure to clear the browser cache on a regular basis. Otherwise, changes
     that you have made may not be shown in your browser.</p></div></div><div lang="en" class="chapter" id="chap-cts"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;6.&nbsp;Configuring the Core Token Service (CTS)</h1></div></div></div><a class="indexterm" name="d4462e3189"></a><p>The Core Token Service (CTS) provides persistent and highly available token storage for a several
  components within OpenAM, including sessions, as well as OAuth 2.0 and SAML 2.0 tokens. The CTS is set up in
  a generalized token storage format. That format is always used for OAuth 2.0 tokens. If so configured,
  it is also used to ensure persistence of session and SAML 2.0 tokens.</p><p>The CTS relies on OpenDJ to store and replicate tokens. No other directory service
  is supported for CTS. By default, the CTS uses the same embedded or external directory service as is
  configured for OpenAM's configuration data store.</p><p>CTS tokens may change frequently. Other data stored in an OpenDJ server is considerably more static.
  The relative performance tuning requirements are quite different. If your deployment is large, that may justify
  going beyond the default configuration. Nevertheless, it is easier to configure CTS if you can stick with
  the OpenDJ server embedded in an OpenAM installation.</p><p>
   If you use the OpenDJ service embedded within OpenAM, CTS schema is automatically included.
   You can choose, however, to manage CTS data in an external instance of OpenDJ.
  </p><p>If you choose to set up CTS in an external instance of OpenDJ, you will have to install OpenDJ
  separately. For more information, see the <a class="link" href="http://docs.forgerock.org/en/opendj/2.6.0/install-guide/" target="_blank"><em class="citetitle">OpenDJ Installation Guide</em></a>.</p><p>Once you have installed OpenDJ on an external server, you can set up schema definitions,
  specify tokens in a valid LDAP format, configure indexes to allow OpenAM to retrieve tokens,
  and quite possibly Access Control Instructions (ACIs) to give an appropriate user Create, Read,
  Update, and Delete (CRUD) privileges. But first, you should configure basic parameters for the CTS token
  data store in the OpenAM console.</p><div class="section" id="cts-config"><div class="titlepage"><div><div><h2 class="title" style="clear: both">6.1.&nbsp;CTS Configuration Parameters</h2></div></div></div><p>If you want to reconfigure an existing implementation of CTS, be prepared. Any reconfiguration
    will orphan any tokens that are currently stored. To keep this from happening, disable client access
    to OpenAM before making any changes. Any changes require a server restart to put them into
    effect.</p><p>To access the main CTS configuration page from the console, select Configuration &gt; Servers and Sites &gt;
    Default Server Settings &gt; CTS. The options that appear in the screenshot that follows are detailed in the
    <a href="../reference/index.html#servers-cts" class="link">
    <em class="citetitle">Reference</em></a> document. You can set a root suffix for CTS tokens in either the
    configuration store or an external token store.</p><p>If you select <code class="literal">Default Token Store</code>, OpenAM will use the embedded configuration
    store for CTS tokens.</p><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>If desired, you could make these changes from the command line with variations on the
    <a href="../reference/index.html#ssoadm-update-server-cfg" class="link"><span class="command"><strong>ssoadm update-server-cfg</strong></span></a>
    command, as described in the OpenAM Reference document.</p></div></div><div class="mediaobject" align="center" id="cts-default-store"><a class="fancybox" href="images/cts-default-store.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_cts-default-store.png" align="middle" alt="Configuring Default Server CTS Options" title="Shows the page used to customize CTS default and external token stores"></a></div><p>Possible options have been entered in the figure. If the <code class="literal">External Token Store</code>
    is selected, entries are required in all text boxes. The options shown in the figure are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">Root Suffix</code></p><p><code class="literal">ou=ctsData,dc=openam,dc=example,dc=com</code></p><p>
         When you configure a new OpenDJ suffix for the CTS,
         also consider creating a dedicated OpenDJ backend for the suffix.

         This allows you to manage CTS data separately from less volatile data.
        </p></li><li class="listitem"><p><code class="literal">SSL/TLS Enabled</code></p><p>disabled</p></li><li class="listitem"><p><code class="literal">Directory Name</code></p><p><code class="literal">opendj-cts.example.org</code></p></li><li class="listitem"><p><code class="literal">Port</code></p><p><code class="literal">389</code></p></li><li class="listitem"><p><code class="literal">Login Id</code></p><p><code class="literal">uid=openam,ou=admins,dc=example,dc=com</code></p><p>
         This is the DN of a user with administrative access to CTS data.

         The value here corresponds to the DN used in the examples in
         <a class="xref" href="#cts-acis" title="6.3.&nbsp;CTS Access Control Instructions">Section&nbsp;6.3, &#8220;CTS Access Control Instructions&#8221;</a>.

         You can bypass access control by binding with a root DN such as
         <code class="literal">cn=Directory Manager</code>.
        </p></li><li class="listitem"><p><code class="literal">Password</code></p></li><li class="listitem"><p><code class="literal">Max Connections</code></p><p><code class="literal">20</code> (arbitrary number)</p></li><li class="listitem"><p><code class="literal">Heartbeat</code></p><p><code class="literal">10</code> (default, in seconds)</p></li></ul></div><p>Navigate to Configuration &gt; Servers and Sites &gt; Default Server Settings &gt; CTS. Any options that
    you change under this tab are inherited as defaults by individual servers. To confirm, make a change, and then
    navigate to Configuration &gt; Servers and Sites &gt; [Server Name] &gt; CTS.</p></div><div class="section" id="cts-schema"><div class="titlepage"><div><div><h2 class="title" style="clear: both">6.2.&nbsp;Preparing an OpenDJ Directory Service for CTS</h2></div></div></div><p>OpenAM stores volatile CTS token data in an instance of OpenDJ. To make that possible, OpenDJ needs
    the associated configuration store indexes, which allow OpenAM to search CTS token data in an efficient
    manner.</p><p>Different schema files are available in the OpenAM
    <code class="filename">WEB-INF/template/ldif/sfha</code> directory. If you install OpenAM
    with the embedded version of OpenDJ, the schema from the <code class="filename">cts-add-schema.ldif</code>,
    <code class="filename">cts-container.ldif</code>, and <code class="filename">cts-indicies.ldif</code> files are installed.
    If you upgrade to OpenAM  from a previous version with embedded OpenDJ,
    the schema from the <code class="filename">99-cts-add-schema-backport.ldif</code> file is incorporated in your
    upgrade.</p><p>
     However, if you are configuring an external OpenDJ CTS server,
     you must add schema manually.

     You must also configure the indexes in the table shown below.

     To do so, you can use the <span class="command"><strong>dsconfig</strong></span>
     command depicted in the <em class="citetitle">OpenDJ Administration Guide</em>
     chapter on <a class="link" href="http://docs.forgerock.org/en/opendj/2.6.0/admin-guide/#configure-indexes" target="_blank"><em class="citetitle">Configuring a Standard Index</em></a>.
    </p><p>
     After creating indexes for the external OpenDJ CTS server,
     rebuild the indexes with the <span class="command"><strong>rebuild-index</strong></span> command
     described in the <em class="citetitle">OpenDJ Administration Guide</em>
     chapter on <a class="link" href="http://docs.forgerock.org/en/opendj/2.6.0/admin-guide/#rebuild-index" target="_blank"><em class="citetitle">Rebuilding Indexes</em></a>.
    </p><div class="table" id="cts-configuration-store-indexes"><div class="table-title">Table&nbsp;6.1.&nbsp;CTS Data Store Indexes</div><div class="table-contents"><table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="CTS Data Store Indexes" border="0"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th>Attribute</th><th>Indexes Required</th></tr></thead><tbody><tr><td><code class="literal">coreTokenDate01</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenDate02</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenDate03</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenDate04</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenDate05</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenExpirationDate</code></td><td>ordering</td></tr><tr><td><code class="literal">coreTokenInteger01</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger02</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger03</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger04</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger05</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger06</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger07</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger08</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger09</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger10</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString01</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString02</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString03</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString04</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString05</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString06</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString07</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString08</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString09</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString10</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString11</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString12</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString13</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString14</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString15</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenUserId</code></td><td>equality</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" id="cts-acis"><div class="titlepage"><div><div><h2 class="title" style="clear: both">6.3.&nbsp;CTS Access Control Instructions</h2></div></div></div><p>
     If you bind to the OpenDJ CTS server as a root DN user,
     such <code class="literal">cn=Directory Manager</code>, you can skip this section.
    </p><p>
     If you bind as a regular administrative user,
     you must give the user appropriate access to the CTS data.

     Give the regular administrative user access to
     add, delete, modify, read, and search CTS data,
     by setting access control instructions on the Root Suffix entry for CTS data.

     The user in examples shown here has DN
     <code class="literal">uid=openam,ou=admins,dc=example,dc=com</code>.
    </p><pre class="codelisting prettyprint">aci: (version 3.0;acl "Add config entry"; allow (add)(userdn = "ldap:///
 uid=openam,ou=admins,dc=example,dc=com");)
aci: (targetattr="*")(version 3.0;acl "Allow entry search"; allow (
 search, read)(userdn = "ldap:///uid=openam,ou=admins,dc=example,dc=com");)
aci: (targetattr="*")(version 3.0;acl "Modify entries"; allow (write)(
 userdn = "ldap:///uid=openam,ou=admins,dc=example,dc=com");)
aci: (version 3.0;acl "Delete entries"; allow (delete)(userdn = "ldap:///
 uid=openam,ou=admins,dc=example,dc=com");)
aci: (targetcontrol="2.16.840.1.113730.3.4.3")(version 3.0;acl "Allow
  persistent search"; allow (search, read)(userdn = "ldap:///uid=openam,
 ou=admins,dc=example,dc=com");)</pre><p>For detailed information on ACIs, with examples showing how you can use the <span class="command"><strong>dsconfig</strong></span>,
    as well as various <span class="command"><strong>ldap*</strong></span> commands to configure them, see the OpenDJ chapter on
    <a class="link" href="http://docs.forgerock.org/en/opendj/2.6.0/admin-guide/#chap-privileges-acis" target="_blank"><em class="citetitle">Configuring Privileges &amp; Access Control</em></a>.</p></div><div class="section" id="cts-replication"><div class="titlepage"><div><div><h2 class="title" style="clear: both">6.4.&nbsp;CTS and OpenDJ Replication</h2></div></div></div><p>Replication in this context is the process of copying updates between directory servers to help all servers
    converge to identical copies of directory, token, and session / SAML 2.0 / OAuth 2.0 data. OpenDJ uses advanced
    data replication methods to ensure that directory services remain available in the event of a server crash or
    network interruption.</p><p>The historical information needed to resolve the latest changes is periodically purged to avoid
    growing to unmanageable sizes. The age at which the information is purged is known as the
    <code class="literal">replication-purge-delay</code>.</p><p>With CTS, the default <code class="literal">replication-purge-delay</code> for OpenDJ is 3 days. Unless you have
    configured a separate OpenDJ server for CTS data, you may have to balance the needs for backups, the requirements
    for replication, disk space, and different useful lifetimes for CTS tokens and other OpenDJ data. So adjustments
    may be required. One way to set a new period for <code class="literal">replication-purge-delay</code> of
    <em class="replaceable"><code>n</code></em> hours is with the following command:</p><pre class="cmdline prettyprint">$ dsconfig
set-replication-server-prop
--port 4444
--hostname opendj-cts.example.org
--bindDN "cn=Directory Manager"
--bindPassword password
--provider-name "Multimaster Synchronization"
--set replication-purge-delay:<em><strong>n</strong></em>h
--no-prompt
--trustStorePath /path/to/truststore</pre><p>At this point, you need to understand whether CTS data backups are important in your deployment.
     Session, SAML 2.0, and OAuth 2.0 token data is often short-lived. In some deployments, the "worst-case"
     scenario is that users have to log in again.</p><p>If CTS data backups are important in your deployment, be warned. OpenDJ backups that are older
     than the <code class="literal">replication-purge-delay</code> are useless and must be discarded. You can use the
     OpenDJ <span class="command"><strong>backup</strong></span> to schedule backups. For example, the following command uses
     <code class="literal">crontab</code> format to configure daily backups
     for a hypothetical Base DN of <code class="literal">ctsData</code> at x minutes after every hour:</p><pre class="cmdline prettyprint"> $ backup
--port 4444
--bindDN "cn="Directory Manager"
--bindPassword password
--backendID ctsData
--backupDirectory /path/to/opendj/backup
--recurringTask "x * * * *"
--completionNotify backupadmin@example.com
--errorNotify backupadmin@example.com</pre><p>While you may choose to adjust the time periods associated with
    <code class="literal">replication-purge-delay</code> and backups, be sure that backups are performed more frequently.
    Otherwise, change log records that are required to restore data may be lost.</p></div><div class="section" id="cts-deployment"><div class="titlepage"><div><div><h2 class="title" style="clear: both">6.5.&nbsp;CTS Deployment Scenario</h2></div></div></div><p>When properly configured, CTS can help your deployment avoid single points of failure (SPOF). Session
    and SAML 2.0 tokens which are normally stored only in the memory of a single server are also written to the
    CTS as a secondary token store. If the OpenAM instance that owns the session or SAML 2.0 token fails, a second
    instance of OpenAM can allow access to the session or token. To reduce the impact of any given failure,
    consider the following options:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Start your implementation, if possible, with the CTS options available with the
            OpenDJ instance embedded in OpenAM. You can still set up a different backend on the embedded
            OpenDJ server. If the embedded OpenDJ server can handle your requirements, it
            will simplify implementation of CTS.</p></li><li class="listitem"><p>Isolate the user, configuration, and session stores from OpenAM in separate
            external OpenDJ servers.</p></li><li class="listitem"><p>Configure multiple directory stores for CTS, set up with load balancer(s).</p></li><li class="listitem"><p>Add separate servers for data store replication. For more information on how this is done
            with OpenDJ, see the OpenDJ documentation on <a class="link" href="http://docs.forgerock.org/en/opendj/2.6.0/admin-guide/#repl-dedicated-servers" target="_blank">
            <em class="citetitle">Stand-alone Replication Servers</em></a>.</p></li><li class="listitem"><p>Set up redundancy in the load balancer connections between OpenAM and the external
            data store.</p></li></ul></div><p>Deployment is easier if your requirements can be handled by the embedded instance of OpenDJ. But that
    may not be a viable for all situations. A relatively simplified method for configuring a more complex
    CTS deployment is depicted here:</p><div class="mediaobject" align="center" id="cts-deploy"><a class="fancybox" href="images/cts-deploy.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_cts-deploy.png" align="middle" alt="A Simplified CTS Deployment" title="Depicts a Simplified Configuration for CTS"></a></div><p>For clarity, the diagram does not include options that may be appropriate for a production deployment
    such as firewalls and OpenAM agents. It also does not include options required for multiple data centers.</p></div><div class="section" id="cts-token-size"><div class="titlepage"><div><div><h2 class="title" style="clear: both">6.6.&nbsp;Managing CTS Tokens</h2></div></div></div><p>There are five properties associated with token encryption, compression, and token
   cleanup frequency. The three that are associated with encryption and compression are disabled by default.
   The properties are as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">com.sun.identity.session.repository.enableEncryption</code></p><p>Supports encryption of CTS tokens.</p></li><li class="listitem"><p><code class="literal">com.sun.identity.session.repository.enableCompression</code></p><p>Enables GZip-based compression of CTS tokens.</p></li><li class="listitem"><p><code class="literal">com.sun.identity.session.repository.enableAttributeCompression</code></p><p>Supports compression over and above the GZip-based compression of CTS tokens.</p></li><li class="listitem"><p><code class="literal">com.sun.identity.session.repository.cleanupRunPeriod</code></p><p>Specifies a minimum CTS token lifetime. If there is no activity in the specified
           time period, the token is erased. Default: 300 seconds.</p></li><li class="listitem"><p><code class="literal">com.sun.identity.session.repository.healthCheckRunPeriod</code></p><p>Sets a period of time when requests are sent to make sure the current instance of
           OpenAM is running. Default: 60 seconds.</p></li></ul></div><p>To enable the encryption / compression options, navigate to Configuration &gt; Servers and Sites &gt;
   Default Server Settings &gt; Advanced. In the Advanced Properties window, you should see these entries
   in the <code class="literal">Property Name</code> column with the
   corresponding value in the <code class="literal">Property Value</code> column. To enable them, change <code class="literal">false</code>
   to <code class="literal">true</code> in the Property Value column associated with the desired property, and click Save.</p><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>If you are using SFO, or if you are using an external CTS directory, be consistent with these options.
   If you want to enable compression or encryption, you should enable all three on every instance of OpenAM
   within a deployment or replication group: <code class="literal">com.sun.identity.session.repository.enableEncryption</code>,
   <code class="literal">com.sun.identity.session.repository.enableCompression</code>, and
   <code class="literal">com.sun.identity.session.repository.enableAttributeCompression</code>.</p></div></div></div><div class="section" id="cts-general-recommend"><div class="titlepage"><div><div><h2 class="title" style="clear: both">6.7.&nbsp;General Recommendations for CTS Configuration</h2></div></div></div><p>When configuring CTS, start with the OpenDJ server embedded with an installation of OpenAM. As
        it already has required CTS indexes included, that simplifies your tasks.</p><p>If you are deploying on a single site, and want CTS replication limited to that site, the
        default configuration store may be sufficient for your particular needs. If your needs go beyond a
        higher-level performance threshold, you may want to move the CTS token storage to one or more dedicated
        systems. Alternatively, if you need global replication of session, SAML 2.0, and OAuth 2.0 tokens,
        that would also justify a move to dedicated systems as it can help to have
        that extra level of control over how much replication is taking place.</p><p>CTS generally cause much more replication traffic than less volatile configuration data.
        Therefore, in high volume deployments you can move CTS data to dedicated, properly sized
        directory servers to improve performance. In addition, token compression as discussed in
        <a class="xref" href="#cts-token-size" title="6.6.&nbsp;Managing CTS Tokens">Section&nbsp;6.6, &#8220;Managing CTS Tokens&#8221;</a>, is disabled by default. When enabled, token compression can reduce
        load requirements on the network connection between data stores.</p><p>While not recommended for high volume deployments, it is possible to use CTS in production within
        the default internal OpenDJ configuration store. That assumes a small scale deployment with a relatively
        simple topology.</p><p>The CTS is configured to work with a single OpenDJ directory server. That is a potential SPOF.
        To address that issue, set up a load balancer between OpenAM and the OpenDJ directory service used for
        the CTS. Redundant load balancers are preferred. If one instance of OpenDJ fails, the load balancer would
        redirect CTS requests to another instance of OpenDJ with a copy of the CTS tokens.</p><p>Once configured, the OpenDJ directory service replicates CTS data transmitted from OpenAM servers
        to connected OpenDJ servers. The amount of replication traffic can be significant, especially if
        replication proceeds over a WAN. You can limit this replication traffic by separating OpenDJ instances
        into directory and replication servers.</p></div></div><div lang="en" class="chapter" id="chap-session-failover"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;7.&nbsp;Setting Up OpenAM Session Failover</h1></div></div></div><a class="indexterm" name="d4462e3764"></a><a class="indexterm" name="d4462e3769"></a><p>This chapter covers setting up SFO when using multiple
 instances of OpenAM in a site configuration for high availability. The basic
 idea followed here is that you configure load balancing to be sticky, based
 on the value of an OpenAM cookie, <code class="literal">amlbcookie</code>, different
 for each OpenAM server. Should that server become unavailable, the load
 balancer fails client requests over to another OpenAM server. The other OpenAM
 server must then fail over the user session associated with the client.</p><p>SFO relies on a shared, highly available Core Token Service (CTS) to
 store user session data. The service is shared with other OpenAM servers in the
 same OpenAM site. When the OpenAM server where a user authenticated goes down,
 other servers in the site read user session information from the CTS, so the
 user with a valid session does not have to login again. When the original
 OpenAM server becomes available again, it can also read session information
 from the CTS, and can carry on serving users with active sessions.</p><div class="itemizedlist"><p>This chapter includes these procedures.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="#configure-site-after-installation" title="Procedure&nbsp;7.1.&nbsp;To Configure a Site with a First OpenAM Server">Procedure&nbsp;7.1, &#8220;To Configure a Site with a First OpenAM Server&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#configure-site-load-balancing" title="Procedure&nbsp;7.2.&nbsp;To Configure Site Load Balancing">Procedure&nbsp;7.2, &#8220;To Configure Site Load Balancing&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#enable-session-failover" title="Procedure&nbsp;7.3.&nbsp;To Configure Session Failover After Installation">Procedure&nbsp;7.3, &#8220;To Configure Session Failover After Installation&#8221;</a></p></li></ul></div><div class="procedure" id="configure-site-after-installation"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;7.1.&nbsp;To Configure a Site with a First OpenAM Server</div><p>Before you set up SFO, first configure OpenAM in a site configuration
  with a load balancer as the entry point to the site. The most expedient way
  to configure the site is to set it up during the initial OpenAM configuration.
  However, you may already have a working instance before realizing that
  multiple instances are necessary. The following steps walk you through setting
  up the site configuration for the first OpenAM server.</p><p>Once you have set up a site for the first OpenAM server, see <a href="../install-guide/index.html#add-servers-to-site" class="link"><em class="citetitle">To Add a Server
  to a Site</em></a> for instructions on configuring subsequent
  servers in the site.</p><ol class="procedure" type="1"><li class="step"><p>Login to OpenAM Console as <code class="literal">amadmin</code>, and then browse
   to Configuration &gt; Servers and Sites &gt; Sites.</p></li><li class="step"><p>Click New, and on the New Site page enter the site name, and set the
   Primary URL to the load balancer URL that is the entry point for the site,
   such as <code class="literal">https://lb.example.com/openam</code>.</p><p>The site URL is the URL to the load balancer in front of your OpenAM
   servers in the site. For example, if your load balancer listens for HTTPS on
   host <code class="literal">lb.example.com</code> and port <code class="literal">443</code>,
   with OpenAM under <code class="literal">/openam</code>, then your site URL is
   <code class="literal">https://lb.example.com/openam</code>.</p></li><li class="step"><p>Click Save to keep the site configuration.</p></li><li class="step"><p>Under Configuration &gt; Servers and Sites &gt; Server, click the link
   to the server configuration.</p></li><li class="step"><p>On the server configuration General tab page, set the Parent Site to
   the name of the site you just created, and then click Save to keep your
   changes.</p><p>At this point the server is part of the site you have configured.</p></li></ol></div></div><div class="procedure" id="configure-site-load-balancing"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;7.2.&nbsp;To Configure Site Load Balancing</div><p>If you did not set up the site during initial configuration,
  first follow the instructions in <a class="xref" href="#configure-site-after-installation" title="Procedure&nbsp;7.1.&nbsp;To Configure a Site with a First OpenAM Server">Procedure&nbsp;7.1, &#8220;To Configure a Site with a First OpenAM Server&#8221;</a>, and then follow all the
  steps below.</p><ol class="procedure" type="1"><li class="step"><p>For each OpenAM server in the site, select Configuration &gt;
   Servers and Sites &gt; Servers &gt; <em class="replaceable"><code>Server Name</code></em>,
   and then set Parent Site to the site you created before saving your
   work.</p></li><li class="step"><p>In an OpenAM site, the server that authenticated a user is the server
   that continues to manage that user's session, unless the server is no longer
   available. Therefore, you should use sticky load balancing. To do so,
   configure your load balancer to inspect the value of the
   <code class="literal">amlbcookie</code> so that it can determine which
   OpenAM server should receive the client request.</p><p>As your load balancer depends on the <code class="literal">amlbcookie</code>
   value, on each OpenAM server console in the site, select Configuration &gt;
   Servers and Sites &gt; Servers &gt; <em class="replaceable"><code>Server Name</code></em>
   &gt; Advanced, makes sure that
   <code class="literal">com.iplanet.am.lbcookie.value</code> is unique. By default
   the value of the <code class="literal">amlbcookie</code> is set to the server ID
   for the OpenAM instance.</p><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>When using SSL, the approach requires that you either terminate SSL
    on the load balancer and re-encrypt traffic from the load balancer
    to the OpenAM servers.</p></div></div><p>If you must change <code class="literal">amlbcookie</code> values to make them
   unique, then your changes take effect after you restart the OpenAM server.
   (To check, login to the console and check the cookie value in your
   browser.)</p></li><li class="step"><p>Restart each OpenAM server or the web containers where the OpenAM
   servers run so that all configuration changes take effect.</p></li></ol></div></div><div class="procedure" id="enable-session-failover"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;7.3.&nbsp;To Configure Session Failover After Installation</div><p>Session failover requires a site configuration with one or more servers
  and OpenDJ as a configuration store (embedded or external).</p><p>If you did not configure session persistence and availability during
  initial configuration, first complete the steps in <a class="xref" href="#configure-site-load-balancing" title="Procedure&nbsp;7.2.&nbsp;To Configure Site Load Balancing">Procedure&nbsp;7.2, &#8220;To Configure Site Load Balancing&#8221;</a>, and then follow these steps.</p><ol class="procedure" type="1"><li class="step"><p>In the OpenAM console for one of the servers in the site, under
   Configuration &gt; Global, click Session.</p></li><li class="step"><p>Under Secondary Configuration Instance, click New.</p><p>If the server is not part of a site, or if you are not using OpenDJ
   server, the New button is grayed out.</p></li><li class="step"><p>In the Add Sub Configuration page, check that the Name is set to the
   name of the site.</p></li><li class="step"><p>Activate the Session Persistence and High Availability Failover Enabled option.</p></li><li class="step"><p>Click Add to save your work.</p></li></ol></div></div></div><div lang="en" class="chapter" id="chap-uninstall"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;8.&nbsp;Removing OpenAM Software</h1></div></div></div><a class="indexterm" name="d4462e3915"></a><p>This chapter shows you how to uninstall OpenAM core software. See
 the <a href="../web-install-guide/index.html#web-install-guide" class="link"><em class="citetitle">OpenAM Web Policy
 Agent  Installation Guide</em></a>
 or <a href="../jee-install-guide/index.html#jee-install-guide" class="link"><em class="citetitle">OpenAM Java EE Policy
 Agent  Installation Guide</em></a> for 
 instructions on removing OpenAM agents.</p><div class="procedure" id="uninstall-OpenAM-core"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;8.1.&nbsp;To Remove OpenAM Core Software</div><p>After you have deployed and configured OpenAM core services, you have
  at least two, perhaps three or four, locations where OpenAM files are stored
  on your system.</p><p>You remove the internal OpenAM configuration store when you follow
  the procedure below. If you used an external configuration store, you can
  remove OpenAM configuration data after removing all the software.</p><ol class="procedure" type="1"><li class="step"><p>Shut down the web application container in which you deployed
   OpenAM.</p><pre class="cmdline prettyprint">$ /etc/init.d/tomcat stop
Password:
Using CATALINA_BASE:   /path/to/tomcat
Using CATALINA_HOME:   /path/to/tomcat
Using CATALINA_TMPDIR: /path/to/tomcat/temp
Using JRE_HOME:        /path/to/jdk/jre
Using CLASSPATH:       /path/to/tomcat/bin/bootstrap.jar:
 /path/to/tomcat/bin/tomcat-juli.jar</pre></li><li class="step"><p>Unconfigure OpenAM by removing configuration files found in the $HOME
   directory of the user running the web application container.</p><div class="itemizedlist"><p>For a full install of OpenAM core services, configuration files
    include the following.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The configuration directory, by default
     <code class="filename">$HOME/openam</code>. If you did not use the default
     configuration location, then check in the OpenAM console under
     Configuration &gt; Servers and Sites &gt; <em class="replaceable"><code>Server
     Name</code></em> &gt; General &gt; System &gt; Base installation
     directory.</p></li><li class="listitem"><p>The hidden file that points to the configuration directory.</p><p>For example, if you are using Apache Tomcat as the web container,
     this file could be
     <code class="filename">$HOME/.openamcfg/AMConfig_path_to_tomcat_webapps_openam_</code>
     OR
     <code class="filename">$HOME/.openssocfg/AMConfig_path_to_tomcat_webapps_openam_</code>.</p></li></ul></div><pre class="cmdline prettyprint">$ rm -rf $HOME/openam $HOME/.openamcfg</pre><p>or</p><pre class="cmdline prettyprint">$ rm -rf $HOME/openam $HOME/.openssocfg</pre><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>At this point, you can restart the web container and configure
    OpenAM anew if you only want to start over with a clean configuration
    rather than removing OpenAM completely.</p></div></div><p>If you used an external configuration store you must also remove
   the configuration manually from your external directory server. The default
   base DN for the OpenAM configuration is
   <code class="literal"></code>.</p></li><li class="step"><p>Undeploy the OpenAM web application.</p><p>For example, if you are using Apache Tomcat as the web container,
   remove the .war file and expanded web application from the container.</p><pre class="cmdline prettyprint">$ cd /path/to/tomcat/webapps/
$ rm -rf openam.war openam/</pre></li></ol></div></div></div><div class="index" id="d4462e3990"><div class="titlepage"><div><div><h1 class="title">Index</h1></div></div></div><div xmlns:xlink="http://www.w3.org/1999/xlink" class="index"><div class="indexdiv"><h3>C</h3><dl><dt id="ientry-d4462e3189">Core Token Service, <a class="indexterm" href="#chap-cts">Configuring the Core Token Service (CTS)</a></dt><dt id="ientry-d4462e2694">Custom end user pages, <a class="indexterm" href="#chap-custom-ui">Customizing the OpenAM End User Pages</a></dt></dl></div><div class="indexdiv"><h3>D</h3><dl><dt id="ientry-d4462e347">Directory service requirements, <a class="indexterm" href="#prerequisites-file-descriptors">Setting Maximum File Descriptors</a>, <a class="indexterm" href="#prepare-configuration-store">Preparing a Configuration Data Store</a>, <a class="indexterm" href="#prepare-identity-repository">Preparing an Identity Repository</a></dt><dt id="ientry-d4462e789">Downloading OpenAM, <a class="indexterm" href="#download-openam-software">Obtaining OpenAM Software</a></dt></dl></div><div class="indexdiv"><h3>I</h3><dl><dt id="ientry-d4462e1492">Installing</dt><dd><dl><dt>Behind the firewall, <a class="indexterm" href="#chap-install-das">Installing OpenAM Distributed Authentication</a></dt><dt>Full install, <a class="indexterm" href="#chap-install-core">Installing OpenAM Core Services</a></dt><dt>Interactive configuration, <a class="indexterm" href="#chap-install-core">Installing OpenAM Core Services</a></dt><dt>Load Balancer, <a class="indexterm" href="#chap-session-failover">Setting Up OpenAM Session Failover</a></dt><dt>No console, <a class="indexterm" href="#chap-install-core">Installing OpenAM Core Services</a></dt><dt>Session failover, <a class="indexterm" href="#chap-session-failover">Setting Up OpenAM Session Failover</a></dt><dt>Silent configuration, <a class="indexterm" href="#chap-install-tools">Installing OpenAM Tools</a></dt><dt>Starting over, <a class="indexterm" href="#chap-install-core">Installing OpenAM Core Services</a></dt><dt>Tools (ssoadm, etc.), <a class="indexterm" href="#chap-install-tools">Installing OpenAM Tools</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>J</h3><dl><dt id="ientry-d4462e265">Java requirements, <a class="indexterm" href="#prepare-java">Preparing a Java Environment</a></dt></dl></div><div class="indexdiv"><h3>P</h3><dl><dt id="ientry-d4462e228">Prerequisites, <a class="indexterm" href="#chap-prepare-install">Preparing For Installation</a></dt></dl></div><div class="indexdiv"><h3>U</h3><dl><dt id="ientry-d4462e3915">Uninstalling, <a class="indexterm" href="#chap-uninstall">Removing OpenAM Software</a></dt></dl></div></div></div></div><a href="#" class="back-to-top hidden-xs"><button type="button" class="btn btn-primary btn-default"><span class="glyphicon glyphicon-chevron-up"></span></button></a></div></div><div class="footer"><div class="container-fluid"><div class="footer-left"><span class="footer-item">Copyright &copy;
              2011-2013&nbsp;
              ForgeRock AS;&nbsp;
              &nbsp;
              &nbsp;
          </span></div><div class="footer-right"><a target="_blank" class="footer-item snap-left" href="legalnotice.html"><i class="glyphicon glyphicon-briefcase"></i> Legal Notice</a><a target="_blank" class="footer-item snap-left" href="https://github.com/OpenIdentityPlatform/OpenAM/issues"><i class="glyphicon glyphicon-ok-sign"></i> Feedback</a><a target="_blank" class="footer-item snap-left" href="#" data-toggle="modal" data-target="#myModal"><i class="glyphicon glyphicon-info-sign"></i> About</a></div></div></div></body></html>