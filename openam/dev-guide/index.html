<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <style type="text/css">
   /*
* The contents of this file are subject to the terms of the Common Development and
* Distribution License (the License). You may not use this file except in compliance with the
* License.
*
* You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the
* specific language governing permission and limitations under the License.
*
* When distributing Covered Software, include this CDDL Header Notice in each file and include
* the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL
* Header, with the fields enclosed by brackets [] replaced by your own identifying
* information: "Portions copyright [year] [name of copyright owner]".
*
* Copyright 2015 ForgeRock AS.
* Portions copyright 2024 3A Systems LLC.
*/

/***********************************/
/* Imported Styles
/***********************************/

@import url(https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,300,400,700);
@import url(https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css);
@import url(https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css);
/* @import url(https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css); */
@import url(https://cdnjs.cloudflare.com/ajax/libs/jquery.colorbox/1.4.33/example1/colorbox.css);

/***********************************/
/* General Styles
/***********************************/

html {
    height: 100%;
}

body {
    /* Dark Grey */

    color: #2a2f32;
    font-family: 'Open Sans', "proxima-nova", sans-serif;
}

a {
    /* Sea Green */
    color: #519387;
}

a.link[href^="http"] {
    background-image: url("includes/logos/Icon_External_Link.png");
    background-position: top right;
    background-repeat: no-repeat;
    padding-right: 15px;
    margin-right: 2px;
}

a.self-link, a.self-link:hover, a.self-link:active {
    color: inherit;
    text-decoration: none;
}

a[href].self-link:hover::after
{
    -moz-osx-font-smoothing: grayscale;
    content: "\e144";
    color: #519387;
    display: inline-block;
    font-family: "Glyphicons Halflings";
    font-size: 75%;
    font-style: normal;
    line-height: 1;
    padding-left: 5px;
    position: relative;
    top: 1px;
}


li.L0,
li.L1,
li.L2,
li.L3,
li.L5,
li.L6,
li.L7,
li.L8 {
    list-style-type: decimal !important
}

.section,
.chapter,
.preface,
.glossary,
.refentry,
.reference,
.appendix,
.index,
.titlepage h2,
.titlepage h3,
.titlepage h4,
.titlepage h5 {
    padding-top: 60px;
    margin-top: -50px;
}

.left-shape-content {
    background: url("includes/logos/left-shape-4.png") no-repeat scroll 0 0 rgba(0, 0, 0, 0);
    float: left;
    height: 566px;
    position: fixed;
    width: 57px;
    top: 60%;
    z-index: -1;
}

/***********************************/
/* Bootstrap Override Styles
/***********************************/

/* Button Styles */

.btn-primary {
    /* Sea Green */
    background-color: #519387;

    /* Dark Sea Green */
    border-color: #488378;
    color: #fff;
}

.btn-default {
    background-color: #A1A8AD;
    border-color: #8a9298;
    color: #ffffff;
}

.btn-default:hover,
.btn-default:focus,
.btn-default.focus,
.btn-default:active,
.btn-default.active,
.open > .dropdown-toggle.btn-default {
    background-color: #3f4b54;
    border-color: #1B2025;
    color: #ffffff;
}

/* Tooltip Styles */

.tooltip.in {
    opacity: 0.95;
}

.tooltip.bottom .tooltip-arrow {
    border-bottom-color: #519387;
}

.tooltip-inner {
    background-color: #519387;
}

/* List Styles */

.dl-horizontal dt {
    white-space: normal;
    padding: 0 3px 0 0;
    width: 200px;
}

.dl-horizontal dd {
    border-bottom: 1px dotted rgb(125, 179, 168);
    border-bottom: 1px dotted rgba(125, 179, 168, 0.8);
    margin-bottom: 18px;
    margin-left: 210px;
}

.dl-horizontal {
    border-top: 1px dotted rgb(125, 179, 168);
    border-top: 1px dotted rgba(125, 179, 168, 0.9);
    padding-top: 10px;
}

.variablelist dt {
    margin: 18px 0 5px 15px;
}

.variablelist dd {
    border-bottom: 1px dotted rgba(125, 179, 168, 0.8);
    margin: 5px 0 5px 30px;
}

.variablelist > dl {
    border-top: 1px dotted rgba(125, 179, 168, 0.8);
}


/***********************************/
/* Redirect Page Styles
/***********************************/

.index-redirect,
.index-redirect body {
    height: 100%;
    background-color: #333;
    font-family: 'Open Sans', "proxima-nova", sans-serif;
}
.index-redirect body {
    color: #fff;
    text-align: center;
}
.index-redirect .container {
    display: table;
    vertical-align: middle;
    height: 100%;
}
.index-redirect .btn-primary {
    /* Sea Green */
    background-color: #519387;

    /* Dark Sea Green */
    border-color: #488378;
    color: #fff;
}
.index-redirect .cover-heading {
    font-weight: 400 !important;
}
.index-redirect .vertical-center-row {
    display: table-cell;
    vertical-align: middle;
}

/***********************************/
/* Header Styles
/***********************************/

.navbar-brand {
    padding: 7px 15px;
    display: flex;
    align-items: center;
}
.navbar-brand > img {
    height: 100%;
}

.navbar.navbar-inverse.navbar-fixed-top {
    box-shadow: 0 0 10px 2px #111;
}
.nav > li > a {
    font-weight: 200;
}

/***********************************/
/* Banner Styles
/***********************************/

.jumbotron {
    /* Sea Green */
    background: url("includes/logos/hero-bg-01.png") no-repeat scroll left top #519387;
    color: white;
    box-shadow: 0 0 10px 2px grey;
    margin-top: 50px;
    padding: 0 0 10px;
}
.jumbotron small {
    color: white;
}
.jumbotron p {
    font-size: 12px;
    font-weight: 400;
    margin-bottom: 5px;
}
.jumbotron h1 {
    font-size: 23px !important;
    font-weight: 300 !important;
}

/***********************************/
/* Table of Contents Styles
/***********************************/

#sidebar .nav>li>a {
    /* Light Grey */

    color: #777;
    border-left: 4px solid transparent;
    padding: 4px 10px;
    font-size: 13px;
    font-weight: 400;
}
/* nested links */

#sidebar .nav .nav>li>a {
    padding-top: 2px;
    padding-bottom: 2px;
    padding-left: 30px;
    font-size: 12px;
}
/* nested nested links */

#sidebar .nav .nav .nav>li>a {
    font-size: 11px;
    padding-bottom: 2px;
    padding-left: 50px;
    padding-top: 4px;
}
/* nested nested nested links */

#sidebar .nav .nav .nav .nav>li>a {
    font-size: 11px;
    padding-bottom: 2px;
    padding-left: 70px;
    padding-top: 4px;
}
/* active and hover links */

#sidebar .nav>.active>a,
#sidebar .nav>.locked-active>a,
#sidebar .nav>li>a:hover,
#sidebar .nav>li>a:focus {
    text-decoration: none;
    /*
    background-color: rgb(125, 179, 168, 0.8);
    background-color: rgba(125, 179, 168, 0.8);
    border-color: rgb(45, 52, 55, 0.8);
    border-color: rgba(45, 52, 55, 0.8);
    color: white;
    */
    /* Bright Yellow */

    background-color: #eeea07;
    border-color: #eeea07;
    /* Grey */

    color: #2a2f32;
}
/* all active links */

#sidebar .nav>.active>a,
#sidebar .nav>.active:hover>a,
#sidebar .nav>.active:focus>a {
    font-weight: 600;
}
/* nested active links */

#sidebar .nav .nav>.active>a,
#sidebar .nav .nav>.active:hover>a,
#sidebar .nav .nav>.active:focus>a {
    font-weight: 400;
}
/* nested nested active links */

#sidebar .nav .nav .nav>.active>a,
#sidebar .nav .nav .nav>.active:hover>a,
#sidebar .nav .nav .nav>.active:focus>a {
    font-weight: 300;
}
/* nested nested active links */

#sidebar .nav .nav .nav>.active>a,
#sidebar .nav .nav .nav>.active:hover>a,
#sidebar .nav .nav .nav>.active:focus>a {
    font-weight: 300;
}
/* hide all (inactive) nested list */

#sidebar .nav ul.nav {
    display: none;
}
/* show active nested list */

#sidebar .nav>.active>ul.nav {
    display: block;
}
#sidebar.affix {
    top: 66px;
    position: fixed;
    bottom: 30px;
    height: auto;
    overflow-y: scroll;
}
#sidebar.affix-bottom {
    position: absolute;
}

/***********************************/
/* Content Styles
/***********************************/

/* Main Content Styles */

h1 {
    font-size: 40px !important;
    font-weight: 700 !important;
}

h1 span {
    margin-right: .3em;
}

#doc-content h1,
#doc-content .h1 {
    /* Sea Green */
    border-bottom: 2px solid #70ab9b;
    font-size: 36px;
    margin-top: 24px;
    padding-bottom: 5px;
}

h2 {
    font-size: 32px !important;
    font-weight: 700 !important;
}

h5, .h5 {
    border-bottom: 1px solid #d3d3d3;
    font-size: 16px;
    padding-bottom: 4px;
    font-style: italic;
}

.anchorjs-link .anchorjs-icon {
    color: #A1A8AD;
    text-decoration: none;
}
.anchorjs-link:hover .anchorjs-icon {
    color: #519387;
    text-decoration: none;
}

h1:hover > .anchorjs-link,
h2:hover > .anchorjs-link,
h3:hover > .anchorjs-link,
h4:hover > .anchorjs-link,
h5:hover > .anchorjs-link,
.anchorjs-link:focus {
    opacity: 1 !important;
    transition: color 0.16s linear 0s;
    text-decoration: none;
}

.chapter > p:first-of-type,
.preface > p:first-of-type {
    font-size: 21px;
    font-weight: 300;
    line-height: 1.4;
    margin-bottom: 20px;
}

#doc-content {
    padding: 0 20px 85px 10px;
}

div.procedure, div.table {
    margin-top:-50px;
    padding-top: 60px;
}

div.procedure-title, div.table-title {
    margin: 6px 0 8px;
}

div.procedure-inner {
    border-color: lightslategray;
    border-left: 6px solid lightslategray;
    border-style: dotted dotted dotted solid;
    border-width: 1px 1px 1px 6px;
    margin: 15px 0 10px;
    padding: 10px 15px 10px 10px;
}

.author {
    display: inline;
}

.table {
    font-size: 14px;
}

div.simplelist {
    margin-bottom: 10px;
    width: 100%;
    font-size: 15px;
}

/* Title Styles */

.procedure-title > a, .procedure-title > a:hover {
    color: lightslategray;
    font-size: 14pt;
    font-weight: 400;
}

.itemizedlist-title {
    font-size: 18px;
    font-weight: 600;
    margin: 12px 0 6px;
}

.figure-title {
    font-weight: bold;
    margin: 16px 0 4px;
    text-align: center;
}

.table-title {
    font-size: 12pt;
    font-weight: 700;
}

.variablelist-title {
    font-weight: bold;
    margin: 10px 0;
    text-decoration: underline;
}

/* Code Styles */

.btn-copy-cmdline,
.btn-copy-codelisting {
    /* White */

    background-color: #fff;
    /* Light Grey */

    border: 1px solid #e1e1e8;
    border-radius: 0 4px;
    color: #777;
    display: block;
    font-size: 12px;
    padding: 5px 8px;
    position: absolute;
    right: 5px;
    top: 5px;
    z-index: 10;
}

pre.prettyprint {
    border: 1px solid #ccc;
    padding: 9.5px;
    font-size: 12px;
}

.zero-clipboard {
    display: block;
    position: relative;
}
.zeroclipboard-is-hover {
    /* Light Sea Green */

    background-color: #6faa9b;
    border-color: #6faa9b;
    color: #fff;
    cursor: pointer;
}

.ui-effects-transfer {
    border: 1px dotted black;
    background-color: yellow;
    opacity: 0.4;
}

/* Modal Dialog Styles */

#doc-content .modal h1.title {
    font-size: 40px !important;
    font-weight: 500 !important;
    margin: 14px 0 5px;
}
#doc-content .modal h2.subtitle {
    font-size: 26px !important;
    font-weight: 400 !important;
    margin-bottom: 26px;
}
#doc-content .modal h3.author {
    font-size: 14px !important;
    font-style: italic;
    font-weight: 100 !important;
    margin: 4px 0 5px 18px;
}
#doc-content .modal .affiliation .orgname {
    display: block;
    font-size: 20px !important;
    font-weight: 400 !important;
    margin: 20px 0 0 0;
}
#doc-content .modal .affiliation .address p {
    font-size: 16px !important;
    font-weight: 100 !important;
    margin: 4px 0;
}
#doc-content .modal .copyright {
    display: none;
}
#doc-content .modal .copyright {
    display: none;
}
#doc-content .modal .abstract .abstract-title {
    font-size: 20px !important;
    font-weight: 400 !important;
}
#doc-content .modal .abstract > p {
    margin: 10px 0 5px 20px;
    font-size: 16px !important;
    font-weight: 100 !important;
}

/* Image Styles */

.fancybox > img {
    cursor: zoom-in;
}
a.fancybox {
    text-decoration: none;
}

#cboxTitle {
    color: #519387;
    font-size: 14px;
    font-weight: 700;
}

#cboxOverlay{
    background: none repeat scroll 0 0 rgba(66, 130, 116, 0.6);
}

img.img-responsive {
    margin-bottom: 20px;
}

/* Index Styles */

.indexdiv > h3 {
    border-bottom: 2px dotted lightgrey;
    padding-bottom: 5px;
}
.indexdiv > dl {
    margin-left: 30px;
}
.indexdiv dl {
    margin-bottom: 5px;
}
.indexdiv dt {
    margin: 5px 0 2px;
}
.indexdiv dd {
    margin-left: 35px;
}
.indexdiv .indexterm {
    font-weight: 200;
}

/* Reference Styles */

.refnamediv h2 {
    display: none;
}

.refsect1 h2,
.refsynopsisdiv h2 {
    font-size: 20px !important;
    font-weight: 400 !important;
}

.refnamediv p {
    font-size: 32px !important;
    font-weight: 700 !important;
}

/***********************************/
/* Footer Styles
/***********************************/

.back-to-top {
    position: fixed;
    bottom: 55px;
    right: 5px;
    display: none;
    z-index: 15;
}

#footer {
    display: none;
}

.footer {
    /* Light Grey */
    background-color: #f5f5f5;

    /* Medium Grey */
    border-top: 1px solid #ACB5BD;
    bottom: 0;
    font-size: 12px;
    height: 30px;
    padding-top: 4px;
    position: fixed;
    width: 100%;
    z-index: 100;
}

.footer h3 {
    margin: 0;
}

.footer a:hover {
    text-decoration: none;
}

.footer-item {
    line-height: 22px;
    margin-left: 10px;
}

.footer-item.highlighted {
    /* Orange */
    color: #f7a540;
}

.footer-item.highlighted:hover {
    /* Dark Orange */
    color: #c97208;
}

.footer span {
    /* Grey */
    color: #2a2f32;
    margin-bottom: 0;
}

.footer .footer-left {
    float: left;
}

.footer .footer-right {
    float: right;
}

/***********************************/

  </style><meta name="viewport" content="width=device-width, initial-scale=1"><title>OpenAM Developer's Guide</title><script src="https://code.jquery.com/jquery-1.11.2.min.js" type="text/javascript"></script><script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js" type="text/javascript"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="description" content="Guide to developing OpenAM client applications and service providers. OpenAM provides open source Authentication, Authorization, Entitlement and Federation software."><script type="text/javascript">
     /*
 * The contents of this file are subject to the terms of the Common Development and
 * Distribution License (the License). You may not use this file except in compliance with the
 * License.
 *
 * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the
 * specific language governing permission and limitations under the License.
 *
 * When distributing Covered Software, include this CDDL Header Notice in each file and include
 * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL
 * Header, with the fields enclosed by brackets [] replaced by your own identifying
 * information: "Portions copyright [year] [name of copyright owner]".
 *
 * Copyright 2015 ForgeRock AS.
 */

//

var loadJavaScriptsFN = function () {
    $.ajaxSetup({ cache: true });
    $.getScript("http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js", function () { prettyPrint() });
    $.getScript("http://cdnjs.cloudflare.com/ajax/libs/zeroclipboard/2.2.0/ZeroClipboard.min.js", function () {enableZeroClipboardFN() });
    $.getScript("http://cdnjs.cloudflare.com/ajax/libs/jquery.colorbox/1.4.33/jquery.colorbox-min.js", function () { enableColorboxFN() });
};

var wrapConfigurablesFn = function () {
    $('*:contains("https://openam.example.com:8443")').each(function(){
        if($(this).children().length < 1)
            $(this).html(
                $(this).text().replace(new RegExp("https://openam.example.com:8443", 'g'),'<span class="exampleUrl">https://openam.example.com:8443</span>')
            )
    });
    $('*:contains("amadmin")').each(function(){
        if($(this).children().length < 1)
            $(this).html(
                $(this).text().replace(new RegExp("amadmin", 'g'),'<span class="exampleAdmin">amadmin</span>')
            )
    });
    $('*:contains("iPlanetDirectoryPro")').each(function(){
        if($(this).children().length < 1)
            $(this).html(
                $(this).text().replace(new RegExp("iPlanetDirectoryPro", 'g'),'<span class="exampleSsoCookieName">iPlanetDirectoryPro</span>')
            )
    });
};

var btnClickHandler = function () {
    $("button#applyDocUpdate").click(function(){

        $('span.exampleUrl').fadeOut("slow", function(){
            $('span.exampleUrl').text($("input#exampleUrl").val());
            $('span.exampleUrl').fadeIn("slow");
        });

        $('span.exampleAdmin').fadeOut("slow", function(){
            $('span.exampleAdmin').text($("input#exampleAdmin").val());
            $('span.exampleAdmin').fadeIn("slow");
        });

        $('span.exampleSsoCookieName').fadeOut("slow", function(){
            $('span.exampleSsoCookieName').text($("input#exampleSsoCookieName").val());
            $('span.exampleSsoCookieName').fadeIn("slow");
        });

        $('#docConfig').modal('hide');
    });
};


var addCopyButtonFN = function () {
    $( ".cmdline" ).each(function() {
        $(this).before('<div class="zero-clipboard hidden-xs"><span class="btn-copy-cmdline"><span class="glyphicon glyphicon-pencil"></span> Copy<span class="hidden-sm"> command to clipboard</span></span></div>');
    });

    $( ".codelisting" ).each(function() {
        $(this).before('<div class="zero-clipboard hidden-xs"><span class="btn-copy-codelisting"><span class="glyphicon glyphicon-pencil"></span> Copy<span class="hidden-sm"> code to clipboard</span></span></div>');
    });
};
var enableScrollSpyFN = function () {
    $('body').scrollspy({
        target: '#sidebar',
        offset: 16
    });
};

var enableToolTipFN = function () {
    $(function () {
        $("[data-toggle='tooltip']").tooltip({placement: 'bottom'});
    });
};

var enableBackToTopFadeInFN = function () {
    var offset = 220;
    var duration = 500;
    $(window).scroll(function() {
        if ($(this).scrollTop() > offset) {
            $('.back-to-top').fadeIn(duration);
        } else {
            $('.back-to-top').fadeOut(duration);
        }
    });

    $('.back-to-top').click(function(event) {
        event.preventDefault();
        $('html, body').animate({scrollTop: 0}, duration);
        return false;
    })
};

var enableClampedWidthsFN = function () {

    /*
     * Clamped-width.
     * Usage:
     *  <div data-clampedwidth=".myParent">This long content will force clamped width</div>
     *
     * Author: LV
     */
    $('[data-clampedwidth]').each(function () {
        var elem = $(this);
        var parentPanel = elem.data('clampedwidth');
        var resizeFn = function () {
            var sideBarNavWidth = $(parentPanel).width() - parseInt(elem.css('paddingLeft')) - parseInt(elem.css('paddingRight')) - parseInt(elem.css('marginLeft')) - parseInt(elem.css('marginRight')) - parseInt(elem.css('borderLeftWidth')) - parseInt(elem.css('borderRightWidth'));
            elem.css('width', sideBarNavWidth);
        };

        resizeFn();
        $(window).resize(resizeFn);
    });
};

var affixToCFN = function() {
    $('#sidebar').affix({
        offset: {
            top: function () {
                return (this.top = $('.jumbotron').outerHeight(true)-66)
            }
        }
    });
};

var attachAnchorsToHeadings = function() {
    //addAnchors('h1.title, h2.title, h3.title, h4.title, h5.title');


    $('h1.title, h2.title, h3.title, h4.title, h5.title, .procedure-title, .table-title').each(function () {

        var href = $(this).closest("div[id]").attr("id");

        if (href === undefined || href === "") { // Unable to locate ID of parent element.
            return;
        }

        $(this).wrapInner('<a class=\"self-link" href=\"#' + href + '\"></a>');

    });
};

var addZeroClipboardToCmdlineButtonsFN = function () {
    var copycmdline = new ZeroClipboard( $('.btn-copy-cmdline') );

    copycmdline.on( 'ready', function(event) {
        // console.log( 'movie is loaded' );

        copycmdline.on( 'copy', function(event) {
            var wrappedText = "";
            $(event.target).parent().next().find("strong").each(function(index) {
                wrappedText += $(this).text() + "\n";
            });
            event.clipboardData.setData('text/plain', wrappedText);
        });

        copycmdline.on( 'aftercopy', function(event) {
            // console.log('Copied to clipboard: ' + event.data['text/plain']);
            $(event.target).parent().next().find("strong").each(function(index) {
                $(this).effect("transfer", { to: $(event.target)}, 750);
            });
        });
    });

    copycmdline.on( 'error', function(event) {
        console.log( 'ZeroClipboard error of type "' + event.name + '": ' + event.message );
        ZeroClipboard.destroy();
    });
};

var addZeroClipboardToCodeButtonsFN = function () {
    var copycodelisting = new ZeroClipboard( $('.btn-copy-codelisting') );

    copycodelisting.on( 'ready', function(event) {
        //console.log( 'movie is loaded' );

        copycodelisting.on( 'copy', function(event) {
            var wrappedText = "";
            $(event.target).parent().next(".codelisting.linenums").children().contents().each(function(index) {
                wrappedText += $(this).text() + "\n";
            });
            if(wrappedText == "") {
                wrappedText = $(event.target).parent().next(".codelisting").contents().text();
            };
            event.clipboardData.setData('text/plain', wrappedText);
        });

        copycodelisting.on( 'aftercopy', function(event) {
            // console.log('Copied code to clipboard: ' + event.data['text/plain']);
            $(event.target).parent().next(".codelisting").first().effect("transfer", { to: $(event.target)}, 750);
        });
    });

    copycodelisting.on( 'error', function(event) {
        console.log( 'ZeroClipboard error of type "' + event.name + '": ' + event.message );
        ZeroClipboard.destroy();
    });
};

var enableColorboxFN = function () {
    $(".fancybox").colorbox({
        title: function() {
            return $(this).children('img').attr('alt');
        },
        opacity: 1,
        transition:"elastic",
        initialWidth: 0,
        initialHeight: 0,
        maxWidth:"95%",
        maxHeight: "95%",
        scalePhotos: true,
        fixed: true
    });
};

var trackPageViewsFN = function () {

    $("a").click(function() {
        var href = $(this).attr('href');
        if(href) {
            var titleText =  $(this).text();
            if(href.charAt(0) === '#') {
                ga('send', {
                    'hitType': 'pageview',
                    'page': location.pathname + location.search + href,
                    'title': titleText
                });
            };
            if(href.charAt(0) === '.') {
                var lastHashPos = href.lastIndexOf('#');
                var cleanHref = href.slice(3,lastHashPos);
                var cleanFrag = href.slice(lastHashPos);
                if(window.location.href.search(cleanHref) > -1)
                {
                    ga('send', {
                        'hitType': 'pageview',
                        'page': location.pathname + location.search + cleanFrag,
                        'title': titleText
                    });
                }
            };
        }
    });
};

var enableZeroClipboardFN = function () {
    ZeroClipboard.config({
            swfPath:  "includes/swf/ZeroClipboard.swf",
            trustedDomains: ["*"],
            forceEnhancedClipboard: false,
            forceHandCursor: true,
            debug: false}
    );
    addCopyButtonFN();
    addZeroClipboardToCmdlineButtonsFN();
    addZeroClipboardToCodeButtonsFN();
};

$(document).ready(function() {
    //wrapConfigurablesFn();
    btnClickHandler();
    enableToolTipFN();
    enableBackToTopFadeInFN();
    enableClampedWidthsFN();
    enableScrollSpyFN();
    affixToCFN();
    attachAnchorsToHeadings();
    trackPageViewsFN();
    loadJavaScriptsFN();
});

//

    </script></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navbar navbar-inverse navbar-fixed-top"><nav class="container-fluid"><div class="navbar-header"><a href="/" class="navbar-brand"><span>Open Identity Platform</span></a></div><ul id="pdf-link"></ul></nav></div><div class="jumbotron"><div class="container-fluid"><h1>OpenAM  Developer's Guide<span></span><small></small></h1><p>Guide to developing OpenAM client applications and service providers.
   OpenAM provides open source Authentication, Authorization, Entitlement and
   Federation software.</p></div></div><div class="left-shape-content"></div><div class="container-fluid"><div class="row"><div class="col-sm-3 hidden-xs"><div id="sidebar" data-clampedwidth=".col-sm-3"><h4 class="toc-title">OpenAM  Developer's Guide<br><small class="toc-subtitle"></small></h4><ul class="nav nav-stacked"><li><a href="#preface">Preface</a><ul class="nav nav-stacked"><li><a href="#d14138e119">1. Who Should Use this Guide</a></li><li><a href="#formatting-conventions">2. Formatting Conventions</a></li><li><a href="#accessing-doc-online">3. Accessing Documentation Online</a></li><li><a href="#joining-the-community">4. Joining the Open Identity Platform Community</a></li></ul></li><li><a href="#chap-api-overview">1. OpenAM APIs and Protocols</a><ul class="nav nav-stacked"><li><a href="#openam-apis">1.1. OpenAM APIs</a></li><li><a href="#openam-spis">1.2. OpenAM SPIs</a></li><li><a href="#openam-ipv">1.3. OpenAM, IPv4, and IPv6</a></li></ul></li><li><a href="#chap-client-dev">2. Developing Client Applications</a></li><li><a href="#chap-rest">3. Using RESTful Web Services</a><ul class="nav nav-stacked"><li><a href="#about-openam-rest-api">3.1. About the RESTful API</a></li><li><a href="#c66-encoding">3.2. Token Encoding</a></li><li><a href="#rest-api-auth">3.3. Authentication &amp; Logout</a><ul class="nav nav-stacked"><li><a href="#rest-api-auth-json">3.3.1. Authentication &amp; Logout</a></li><li><a href="#rest-api-auth-legacy">3.3.2. Authentication &amp; Logout (Legacy API)</a></li></ul></li><li><a href="#rest-api-cookie-info">3.4. Cookie Information</a></li><li><a href="#rest-api-tokens">3.5. Token Validation, Attribute Retrieval</a></li><li><a href="#rest-api-authz">3.6. Authorization</a><ul class="nav nav-stacked"><li><a href="#rest-api-policy-decisions">3.6.1. Requesting Policy Decisions</a></li><li><a href="#rest-api-policy-management">3.6.2. Managing Policies</a><ul class="nav nav-stacked"><li><a href="#rest-api-policy-management-create">3.6.2.1. Creating Policies</a></li><li><a href="#rest-api-policy-management-read">3.6.2.2. Reading Policies</a></li><li><a href="#rest-api-policy-management-update">3.6.2.3. Updating Policies</a></li><li><a href="#rest-api-policy-management-delete">3.6.2.4. Deleting Policies</a></li><li><a href="#rest-api-policy-management-query">3.6.2.5. Querying Policies</a></li></ul></li></ul></li><li><a href="#rest-api-oauth2">3.7. OAuth 2.0 Authorization</a><ul class="nav nav-stacked"><li><a href="#rest-api-oauth2-client-endpoints">3.7.1. OAuth 2.0 Client &amp; Resource Server Endpoints</a></li><li><a href="#rest-api-oauth2-token-admin-endpoint">3.7.2. OAuth 2.0 Token Administration Endpoint</a></li><li><a href="#rest-api-oauth2-client-admin-endpoint">3.7.3. OAuth 2.0 Client Administration Endpoint</a></li></ul></li><li><a href="#rest-api-openid-connect">3.8. OpenID Connect 1.0</a><ul class="nav nav-stacked"><li><a href="#rest-api-openid-connect-discovery">3.8.1. Discovering OpenID Connect 1.0 Configuration</a></li><li><a href="#rest-api-openid-connect-dynamic-registration">3.8.2. Registering OpenID Connect 1.0 Clients</a></li><li><a href="#rest-api-openid-connect-authorization">3.8.3. Performing OpenID Connect 1.0 Client Authorization</a></li><li><a href="#rest-api-openid-connect-session">3.8.4. Managing OpenID Connect 1.0 Sessions</a></li></ul></li><li><a href="#rest-api-self-registration">3.9. User Self-Registration</a></li><li><a href="#rest-api-password-reset">3.10. Resetting Forgotten Passwords</a></li><li><a href="#rest-api-logging">3.11. Logging</a></li><li><a href="#rest-api-crud-identity">3.12. Identity Management</a><ul class="nav nav-stacked"><li><a href="#rest-api-create-identity">3.12.1. Creating Identities</a></li><li><a href="#rest-api-read-identity">3.12.2. Reading Identities</a></li><li><a href="#rest-api-update-identity">3.12.3. Updating Identities</a></li><li><a href="#rest-api-delete-identity">3.12.4. Deleting Identities</a></li><li><a href="#rest-api-query-identity">3.12.5. Listing Identities</a></li><li><a href="#rest-api-create-legacy">3.12.6. Creating Identities (Legacy API)</a></li><li><a href="#rest-api-read-legacy">3.12.7. Reading &amp; Searching for Identities (Legacy API)</a></li><li><a href="#rest-api-update-legacy">3.12.8. Updating Identities (Legacy API)</a></li><li><a href="#rest-api-delete-legacy">3.12.9. Deleting Identities (Legacy API)</a></li></ul></li><li><a href="#rest-api-crud-realm">3.13. Realm Management</a><ul class="nav nav-stacked"><li><a href="#rest-api-parameters-realm">3.13.1. Default Parameters for Realms</a></li><li><a href="#rest-api-create-realm">3.13.2. Creating Realms</a></li><li><a href="#rest-api-read-realm">3.13.3. Reading Realms</a></li><li><a href="#rest-api-update-realm">3.13.4. Updating Realms</a></li><li><a href="#rest-api-delete-realm">3.13.5. Deleting Realms</a></li></ul></li><li><a href="#rest-dashboard">3.14. Displaying Dashboard Applications</a></li><li><a href="#rest-api-status-codes">3.15. REST Status Codes</a></li></ul></li><li><a href="#chap-jdk">4. Using the OpenAM Java SDK</a><ul class="nav nav-stacked"><li><a href="#install-jdk-samples">4.1. Installing OpenAM Client SDK Samples</a></li><li><a href="#about-jdk">4.2. About the OpenAM Java SDK</a></li></ul></li><li><a href="#chap-authentication">5. Authenticating Using OpenAM Java SDK</a></li><li><a href="#chap-session">6. Handling Single Sign-On Using OpenAM Java SDK</a><ul class="nav nav-stacked"><li><a href="#session-receiving-notifications">6.1. Receiving Notifications</a></li></ul></li><li><a href="#chap-policy-decisions">7. Requesting Policy Decisions Using OpenAM Java SDK</a></li><li><a href="#chap-xacml">8. Requesting a XACML Policy Decision Using OpenAM Java SDK</a></li><li><a href="#chap-fedlet-java">9. Using Fedlets in Java Web Applications</a><ul class="nav nav-stacked"><li><a href="#create-install-java-fedlet">9.1. Creating &amp; Installing a Java Fedlet</a></li><li><a href="#fedlet-signing-encryption">9.2. Signing &amp; Encryption For a Fedlet</a></li><li><a href="#customize-java-fedlet">9.3. Customizing a Java Fedlet</a><ul class="nav nav-stacked"><li><a href="#fedlet-perform-sso">9.3.1. Performing Single Sign-On</a></li><li><a href="#fedlet-perform-slo">9.3.2. Performing Single Logout</a></li><li><a href="#fedlet-perform-attr-query">9.3.3. Performing Attribute Queries</a></li><li><a href="#fedlet-perform-xacml-query">9.3.4. Performing XACML Queries</a></li></ul></li></ul></li><li><a href="#chap-fedlet-dotnet">10. Using Fedlets in .NET Applications</a></li><li><a href="#chap-sae">11. Using Secure Attribute Exchange</a><ul class="nav nav-stacked"><li><a href="#sae-install-prerequisites">11.1. Installing the Samples</a></li><li><a href="#sae-security-prerequisites">11.2. Preparing to Secure SAE Communications</a></li><li><a href="#sae-secure-idp">11.3. Securing the Identity Provider Side</a></li><li><a href="#sae-secure-sp">11.4. Securing the Service Provider Side</a></li><li><a href="#sae-trying-it-out">11.5. Trying It Out</a></li></ul></li><li><a href="#chap-csdk">12. Using the OpenAM C API</a></li><li><a href="#chap-extending">13. Extending OpenAM</a></li><li><a href="#chap-custom-attr">14. Customizing Profile Attributes</a></li><li><a href="#chap-oauth2-scopes">15. Customizing OAuth 2.0 Scope Handling</a><ul class="nav nav-stacked"><li><a href="#design-oauth2-scopes-plugin">15.1. Designing an OAuth 2.0 Scopes Plugin</a></li><li><a href="#build-oauth2-scopes-plugin">15.2. Building an OAuth 2.0 Scopes Plugin</a></li><li><a href="#configure-oauth2-scopes-plugin">15.3. Configuring OpenAM to Use the Plugin</a></li><li><a href="#try-oauth2-scopes-plugin">15.4. Trying the Example Plugin</a></li></ul></li><li><a href="#chap-auth-spi">16. Customizing Authentication Modules</a><ul class="nav nav-stacked"><li><a href="#about-custom-auth-module">16.1. About the Sample Authentication Module</a></li><li><a href="#properties-sample-auth-module">16.2. Sample Auth Properties</a></li><li><a href="#callbacks-file-sample-auth-module">16.3. Sample Auth Callbacks</a></li><li><a href="#authentication-logic-sample-auth-module">16.4. The Sample Authentication Logic</a></li><li><a href="#principal-sample-auth-module">16.5. The Sample Auth Principal</a></li><li><a href="#service-conf-sample-auth-module">16.6. The Sample Auth Service Configuration</a></li><li><a href="#build-config-sample-auth-module">16.7. Building &amp; Installing the Sample Auth Module</a><ul class="nav nav-stacked"><li><a href="#building-sample-auth-module">16.7.1. Building the Module</a></li><li><a href="#installing-sample-auth-module">16.7.2. Installing the Module</a></li></ul></li><li><a href="#configuring-testing-sample-auth-module">16.8. Configuring &amp; Testing the Sample Auth Module</a></li></ul></li><li><a href="#chap-custom-quota-exhaustion-action">17. Customizing Session Quota Exhaustion Actions</a><ul class="nav nav-stacked"><li><a href="#create-custom-quota-exhaustion-action">17.1. Creating &amp; Installing a Custom Session Quota Exhaustion Action</a></li><li><a href="#list-custom-quota-exhaustion-actions">17.2. Listing Session Quota Exhaustion Actions</a></li><li><a href="#remove-custom-quota-exhaustion-actions">17.3. Removing a Session Quota Exhaustion Action</a></li></ul></li><li><a href="#chap-post-auth">18. Creating a Post Authentication Plugin</a><ul class="nav nav-stacked"><li><a href="#design-post-authentication-plugin">18.1. Designing Your Post Authentication Plugin</a></li><li><a href="#build-post-authentication-plugin">18.2. Building Your Sample Post Authentication Plugin</a></li><li><a href="#configure-post-authentication-plugin">18.3. Configuring Your Post Authentication Plugin</a></li><li><a href="#test-post-authentication-plugin">18.4. Testing Your Post Authentication Plugin</a></li></ul></li><li><a href="#chap-policy-spi">19. Customizing Policy Evaluation</a><ul class="nav nav-stacked"><li><a href="#about-sample-policy-plugins">19.1. About the Sample Plugins</a></li><li><a href="#configure-sample-policy-plugin">19.2. Configuring A Sample Policy Plugin</a></li></ul></li><li><a href="#chap-identity-repo-spi">20. Customizing Identity Data Storage</a><ul class="nav nav-stacked"><li><a href="#about-idrepo-plugin">20.1. About the Identity Repository Plugin</a><ul class="nav nav-stacked"><li><a href="#idrepo-plugin-inheritance">20.1.1. IdRepo Inheritance</a></li><li><a href="#idrepo-plugin-lifecycle">20.1.2. IdRepo Lifecycle</a></li><li><a href="#idrepo-plugin-capabilties">20.1.3. IdRepo Plugin Capabilities</a></li></ul></li><li><a href="#idrepo-plugin-implementation">20.2. Identity Repository Plugin Implementation</a></li><li><a href="#idrepo-plugin-deployment">20.3. Identity Repository Plugin Deployment</a></li></ul></li><li><a href="#d14138e6682">Index</a></li></ul></div></div><div id="doc-content" class="col-sm-9"><div class="titlepage modal fade" id="myModal"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">X</span></button><h4 class="modal-title">About this document</h4></div><div class="modal-body"><div><div><h1 class="title">OpenAM  Developer's Guide</h1></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Mark</span> <span class="surname">Craig</span></h3></div><div class="author"><h3 class="author"><span class="firstname">P&eacute;ter</span> <span class="surname">Major</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Mike</span> <span class="surname">Jang</span></h3></div></div></div><div><p class="releaseinfo"></p></div><div><p class="copyright">Copyright &copy; 2011-2013 ForgeRock AS</p></div><div><a href="legalnotice.html">Legal Notice</a></div><div><p class="pubdate">Publication date: July&nbsp;07,&nbsp;2024</p></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>Guide to developing OpenAM client applications and service providers.
   OpenAM provides open source Authentication, Authorization, Entitlement and
   Federation software.</p></div></div></div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><div lang="en" class="preface" id="preface"><div class="titlepage"><div><div><h1 class="title">Preface</h1></div></div></div><p>This guide demonstrates how to handle sessions to permit single sign
 on and single log out in OpenAM client applications. This guide further
 demonstrates how to use the OpenAM APIs including both APIs for client
 applications, and also SPIs for authentication, policy, service management,
 delegation, and identity storage. Finally, this guide demonstrates how to
 write your own web policy agent.</p><div class="section" id="d14138e119"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.&nbsp;Who Should Use this Guide</h2></div></div></div><p>This guide is written for developers who adapt client applications
  to use OpenAM access management capabilities. It is also written for
  designers and developers extending and integrating OpenAM services for
  their organizations.</p><p>You do not need to be an OpenAM wizard to learn something from
  this guide, though a background in access management and developing
  web applications or developing for web and application servers can help.
  You can nevertheless get started with this guide, and then learn more as you
  go along.</p></div><div lang="en" class="section" id="formatting-conventions"><div class="titlepage"><div><div><h2 class="title" style="clear: both">2.&nbsp;Formatting Conventions</h2></div></div></div><p>
  Most examples in the documentation are created in GNU/Linux or Mac OS X
  operating environments.

  If distinctions are necessary between operating environments,
  examples are labeled with the operating environment name in parentheses.

  To avoid repetition file system directory names are often given
  only in UNIX format as in <code class="filename">/path/to/server</code>,
  even if the text applies to <code class="filename">C:\path\to\server</code> as well.
 </p><p>
  Absolute path names usually begin with the placeholder
  <code class="filename">/path/to/</code>.

  This path might translate to <code class="filename">/opt/</code>,
  <code class="filename">C:\Program Files\</code>, or somewhere else on your system.
 </p><p>
  Command line, terminal sessions are formatted as follows:
 </p><pre class="cmdline prettyprint">$ <strong>echo $JAVA_HOME</strong>
<em>/path/to/jdk</em></pre><p>
  Command output is sometimes formatted for narrower, more readable output
  even though formatting parameters are not shown in the command.
  In the following example,
  the query string parameter <code class="literal">_prettyPrint=true</code> is omitted
  and some of the output is replaced with an ellipsis (<code class="literal">...</code>):
 </p><pre class="cmdline prettyprint">
$ <strong>curl https://bjensen:hifalutin@opendj.example.com:8443/users/newuser</strong>
<em>{
  "_rev" : "000000005b337348",
  "_id" : "newuser",
  ...
}</em>
 </pre><p>
  Program listings are formatted as follows:
 </p><pre class="codelisting prettyprint linenums lang-java">
class Test {
    public static void main(String [] args)  {
        System.out.println("This is a program listing.");
    }
}
 </pre></div><div lang="en" class="section" id="accessing-doc-online"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.&nbsp;Accessing Documentation Online</h2></div></div></div><p>
  Open Identity Platform core documentation, such as this document, aims to be
  technically accurate and complete with respect to the software documented.
 </p><div class="itemizedlist"><p>
   Core documentation therefore follows a three-phase review process
   designed to eliminate errors:
  </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
    Product managers and software architects review project documentation design
    with respect to the readers' software lifecycle needs.
   </p></li><li class="listitem"><p>
    Subject matter experts review proposed documentation changes for
    technical accuracy and completeness
    with respect to the corresponding software.
   </p></li><li class="listitem"><p>
    Quality experts validate implemented documentation changes
    for technical accuracy, completeness in scope,
    and usability for the readership.
   </p></li></ul></div><p>
  The review process helps to ensure that documentation published for
  a ForgeRock release is technically accurate and complete.
 </p><p>
  Fully reviewed, published core documentation is available at
  <a class="link" href="https://www.openidentityplatform.org/" target="_blank">https://www.openidentityplatform.org/</a>.
  Use this documentation when working with a ForgeRock Enterprise release.
 </p><p>
  You can find pre-release draft documentation at the online
  <a class="link" href="https://github.com/OpenIdentityPlatform" target="_blank">community resource center</a>.
  Use this documentation when trying a nightly build.
 </p></div><div lang="en" class="section" id="joining-the-community"><div class="titlepage"><div><div><h2 class="title" style="clear: both">4.&nbsp;Joining the Open Identity Platform Community</h2></div></div></div><p>
  Visit the
  <a class="link" href="https://github.com/OpenIdentityPlatform" target="_blank">community resource center</a>
  where you can find information about each project,
  download nightly builds, browse the resource catalog,
  ask and answer questions on the forums, find community events near you,
  and of course get the source code as well.
 </p></div></div><div lang="en" class="chapter" id="chap-api-overview"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;1.&nbsp;OpenAM APIs and Protocols</h1></div></div></div><p>Although policy agents and standards support make it possible for
 applications to use OpenAM for access management without changing your
 code, some deployments require tighter integration, or direct use of
 supported protocols and OpenAM APIs.</p><p>OpenAM supports a range of protocols and APIs that allow you not
 only to define specifically how access is managed in your client
 applications, but also to extend OpenAM capabilities to meet even
 those deployment requirements not yet covered in OpenAM.</p><p>This short chapter presents an overview of the APIs and protocols that
 OpenAM supports.</p><div class="mediaobject" align="center" id="figure-openam-apis-overview"><a class="fancybox" href="images/openam-apis-overview.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_openam-apis-overview.png" align="middle" alt="High-level view of OpenAM APIs and SPIs" title="OpenAM APIs and SPIs are shown in this diagram in orange, and&#xA;   briefly described in the following sections."></a></div><p>This guide primarily covers the OpenAM client APIs and SPIs, with
 emphasis on the Java APIs.</p><div class="section" id="openam-apis"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.1.&nbsp;OpenAM APIs</h2></div></div></div><p>OpenAM provides client application programming interfaces for a variety
  of needs.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The OpenAM Java APIs provided through the OpenAM Java SDK let your
    Java and Java EE applications call on OpenAM for authentication, and
    authorization in both OpenAM and federated environments.</p><p>Detailed reference information is provided in the <a class="link" href="${javadocBase}" target="_blank"><em class="citetitle">OpenAM Java SDK API Specification</em></a>.</p></li><li class="listitem"><p>The C SDK also provides APIs for native applications, such as new
    web server policy agents. The C SDK is delivered with OpenAM for Linux,
    Solaris, and Windows platforms.</p></li><li class="listitem"><p>OpenAM exposes a RESTful API that can return JSON or XML over HTTP,
    allowing you to access authentication, authorization, and identity
    services from your web applications using REST clients in the language of
    your choice.</p></li></ul></div></div><div class="section" id="openam-spis"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.2.&nbsp;OpenAM SPIs</h2></div></div></div><p>OpenAM provides Java based service provider interfaces to let you
  extend services for the requirements of your particular deployment.</p><div class="itemizedlist"><p>Some examples of the plugins you can write follow in the list below.
   This guide demonstrates how to implement such plugins.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Custom OAuth 2.0 scopes plugins define how OpenAM playing the role
    of authorization server handles scopes, including what token information to
    return regarding scopes set when authorization was granted.</p></li><li class="listitem"><p>Custom authentication plugins let OpenAM authenticate users against
    a new authentication service or an authentication service specific to your
    deployment</p></li><li class="listitem"><p>Post authentication plugins perform additional processing at the end
    of the authentication process, but before the subject is authenticated.
    Post authentication plugins can for example store information about the
    authentication in the user's profile, or call another system for audit
    logging purposes.</p></li><li class="listitem"><p>Policy evaluation plugins implement new policy conditions, send
    attributes from the user profile as part of a policy response, extend the
    definition of the subjects to whom the policy applies, or customize how
    policy management is delegated.</p></li><li class="listitem"><p>Identity repository plugins let OpenAM employ a new or custom user
    data store, other than a directory server or JDBC-accessible
    database.</p></li></ul></div></div><div class="section" id="openam-ipv"><div class="titlepage"><div><div><h2 class="title" style="clear: both">1.3.&nbsp;OpenAM, IPv4, and IPv6</h2></div></div></div><p>OpenAM provides functionality for IPv4, IPv6, and a hybrid of the two. 
  While the majority of the interaction is done on the backend, there are a few
  places where the GUI requires some inputs, such as setting up policy conditions.
  These areas follow the same standard that applies to IPv4 and IPv6. IPv4 uses a 32-bit 
  integer value, with a dot-decimal system. IPv6 uses a hexadecimal system, and the eight 
  groups of hexadecimal digits are separated by a colon.</p></div></div><div lang="en" class="chapter" id="chap-client-dev"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;2.&nbsp;Developing Client Applications</h1></div></div></div><p>Client applications access OpenAM services for authentication,
 authorization, and single sign on/single log out through the use of
 sessions. Client applications can also be allowed to manage authorization
 policies.</p><p>Client application integration with OpenAM can be coupled loosely,
 as in the case of an application running in a web server with an OpenAM
 policy agent to handle interaction with OpenAM service, more directly,
 as in the case where the client interacts with OpenAM over protocol, or
 tightly, as in the case of an application using the OpenAM Java or C API
 to interact with OpenAM services.</p><p>This part of the guide covers client interaction with OpenAM
 over supported protocols and using OpenAM APIs.</p></div><div lang="en" class="chapter" id="chap-rest"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;3.&nbsp;Using RESTful Web Services</h1></div></div></div><a class="indexterm" name="d14138e302"></a><p>This chapter shows how to use the OpenAM RESTful interfaces for direct
 integration between web client applications and OpenAM.</p><div class="section" id="about-openam-rest-api"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.1.&nbsp;About the RESTful API</h2></div></div></div><p>Interface Stability: <a href="../admin-guide/index.html#interface-stability" class="link">Evolving</a></p><p>OpenAM offers a RESTful API for these access and identity management
  operations:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="#rest-api-auth" title="3.3.&nbsp;Authentication &amp; Logout">Authentication</a> (login)</p></li><li class="listitem"><p><a class="link" href="#rest-api-auth" title="3.3.&nbsp;Authentication &amp; Logout">Logout</a></p></li><li class="listitem"><p><a class="link" href="#rest-api-cookie-info" title="3.4.&nbsp;Cookie Information">Cookie information</a></p></li><li class="listitem"><p><a class="link" href="#rest-api-tokens" title="3.5.&nbsp;Token Validation, Attribute Retrieval">Token attribute retrieval</a></p></li><li class="listitem"><p><a class="link" href="#rest-api-tokens" title="3.5.&nbsp;Token Validation, Attribute Retrieval">Token validation</a></p></li><li class="listitem"><p><a class="link" href="#rest-api-authz" title="3.6.&nbsp;Authorization">Authorization</a></p></li><li class="listitem"><p><a class="link" href="#rest-api-oauth2" title="3.7.&nbsp;OAuth 2.0 Authorization">OAuth 2.0 Authorization</a></p></li><li class="listitem"><p><a class="link" href="#rest-api-openid-connect" title="3.8.&nbsp;OpenID Connect 1.0">OpenID Connect 1.0</a></p></li><li class="listitem"><p><a class="link" href="#rest-api-self-registration" title="3.9.&nbsp;User Self-Registration">User self-registration</a></p></li><li class="listitem"><p><a class="link" href="#rest-api-password-reset" title="3.10.&nbsp;Resetting Forgotten Passwords">Resetting forgotten passwords</a></p></li><li class="listitem"><p><a class="link" href="#rest-api-logging" title="3.11.&nbsp;Logging">Logging</a></p></li><li class="listitem"><p><a class="link" href="#rest-api-crud-identity" title="3.12.&nbsp;Identity Management">Identity management</a> (creating,
    reading, updating, deleting identities)</p></li><li class="listitem"><p><a class="link" href="#rest-api-crud-realm" title="3.13.&nbsp;Realm Management">Realm management</a> (creating,
    reading, updating, deleting realms)</p></li><li class="listitem"><p><a class="link" href="#rest-dashboard" title="3.14.&nbsp;Displaying Dashboard Applications">Displaying Dashboard Applications</a></p></li></ul></div><p>This chapter also includes a section on <a class="xref" href="#rest-api-status-codes" title="3.15.&nbsp;REST Status Codes">Section&nbsp;3.15, &#8220;REST Status Codes&#8221;</a>.</p><p>In this chapter, long URLs are wrapped to fit the printed page, as some
  of the output is formatted for easier reading.</p></div><div class="section" id="c66-encoding"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.2.&nbsp;Token Encoding</h2></div></div></div><p>Valid tokens in OpenAM requires configuration either in percent encoding or in <span class="emphasis"><em>C66Encode</em></span>
  format. C66Encode format is encouraged. It is the default token format for OpenAM, and is used in this chapter.
  The following is an example token that has not been encoded:</p><pre class="literallayout">AQIC5wM2LY4SfczntBbXvEAOuECbqMY3J4NW3byH6xwgkGE=@AAJTSQACMDE=#</pre><p>This token includes reserved characters such as <code class="literal">+</code>, <code class="literal">/</code>,
  and <code class="literal">=</code> (The <code class="literal">@</code>, <code class="literal">#</code>, and <code class="literal">*</code> are not
  reserved characters per se, but substitutions are still required). To c66encode this token,
  you would substitute certain characters for others, as follows:</p><pre>+ is replaced with -
/ is replaced with _
= is replaced with .
@ is replaced with *
# is repalced with *
* (first instance) is replaced with @
* (subsequent instances) is replaced with #</pre><p>In this case, the translated token would appear as shown here:</p><pre class="literallayout">AQIC5wM2LY4SfczntBbXvEAOuECbqMY3J4NW3byH6xwgkGE.*AAJTSQACMDE.*</pre></div><div class="section" id="rest-api-auth"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.3.&nbsp;Authentication &amp; Logout</h2></div></div></div><a class="indexterm" name="d14138e421"></a><a class="indexterm" name="d14138e426"></a><p>OpenAM provides REST APIs for authentication and for logout.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Under <code class="literal">/json/authenticate</code> and
    <code class="literal">/json/sessions</code>, you find the newer JSON-based APIs.</p><p>See <a class="xref" href="#rest-api-auth-json" title="3.3.1.&nbsp;Authentication &amp; Logout">Section&nbsp;3.3.1, &#8220;Authentication &amp; Logout&#8221;</a> below.</p></li><li class="listitem"><p>Under <code class="literal">/identity/authenticate</code> and
    <code class="literal">/identity/logout</code>, you find the backwards-compatible,
    legacy API.</p><p>See <a class="xref" href="#rest-api-auth-legacy" title="3.3.2.&nbsp;Authentication &amp; Logout (Legacy API)">Section&nbsp;3.3.2, &#8220;Authentication &amp; Logout (Legacy API)&#8221;</a> below.</p></li></ul></div><div class="section" id="rest-api-auth-json"><div class="titlepage"><div><div><h3 class="title">3.3.1.&nbsp;Authentication &amp; Logout</h3></div></div></div><p>The simplest user name/password authentication returns a
   <code class="literal">tokenId</code> that applications can present as a cookie
   value for other operations that require authentication. In this case use
   HTTP POST to prevent the web container from logging the credentials.
   Pass the user name in an <code class="literal">X-OpenAM-Username</code> header, and
   the password in an <code class="literal">X-OpenAM-Password</code> header.</p><pre class="cmdline prettyprint">$ curl --request POST
 --header "X-OpenAM-Username: demo" --header "X-OpenAM-Password: changeit"
 --header "Content-Type: application/json" --data "{}"
 https://openam.example.com:8443/openam/json/authenticate

{ "tokenId": "AQIC5w...NTcy*", "successUrl": "/openam/console" }</pre><p>This "zero page login" mechanism works only for name/password
   authentication. If you include a POST body with the request, it must
   be an empty JSON string as shown in the example. Alternatively, you can
   leave the POST body empty. Otherwise, OpenAM interprets the body as a
   continuation of an existing authentication attempt, one that uses a
   supported callback mechanism.</p><p>The authentication service at <code class="literal">/json/authenticate</code>
   supports callback mechanisms that make it possible to perform other types of
   authentication in addition to simple user name/password login.</p><p>Callbacks that are not completed based on the content of the client
   HTTP request are returned in JSON as a response to the request. Each
   callback has an array of output suitable for displaying to the end user,
   and input which is what the client must complete and send back to
   OpenAM. The default is still user name/password authentication.</p><pre class="cmdline prettyprint">$ curl --request POST --header "Content-Type: application/json"
 https://openam.example.com:8443/openam/json/authenticate

{
    "authId": "...jwt-value...",
    "template": "",
    "stage": "DataStore1",
    "callbacks": [
        {
            "type": "NameCallback",
            "output": [
                {
                    "name": "prompt",
                    "value": " User Name: "
                }
            ],
            "input": [
                {
                    "name": "IDToken1",
                    "value": ""
                }
            ]
        },
        {
            "type": "PasswordCallback",
            "output": [
                {
                    "name": "prompt",
                    "value": " Password: "
                }
            ],
            "input": [
                {
                    "name": "IDToken2",
                    "value": ""
                }
            ]
        }
    ]
}</pre><p>The "authId" value is a JSON Web Token (JWT) that uniquely identifies
   the authentication context to OpenAM, and so must also be sent back with the
   requests.</p><p>To respond to the callback, send back the JSON object with the missing
   values filled, as in this case where the user name is <code class="literal">demo</code>
   and the password is <code class="literal">changeit</code>.</p><div class="informalexample"><pre class="cmdline prettyprint">$ curl --request POST --header "Content-Type: application/json"
 --data '{ "authId": "...jwt-value...", "template": "", "stage": "DataStore1",
   "callbacks": [ { "type": "NameCallback", "output": [ { "name": "prompt",
   "value": " User Name: " } ], "input": [ { "name": "IDToken1", "value": "demo" } ] },
   { "type": "PasswordCallback", "output": [ { "name": "prompt", "value": " Password: " } ],
   "input": [ { "name": "IDToken2", "value": "changeit" } ] } ] }'
 https://openam.example.com:8443/openam/json/authenticate

{ "tokenId": "AQIC5wM2...U3MTE4NA..*", "successUrl": "/openam/console" }</pre></div><p>The response is a token ID holding the SSO Token value.</p><p>Alternatively, you can authenticate without requesting a session
   using the <code class="literal">noSession</code> query string parameter.</p><div class="informalexample"><pre class="cmdline prettyprint">$ curl --request POST --header "Content-Type: application/json"
 --data '{ "authId": "...jwt-value...", "template": "", "stage": "DataStore1",
   "callbacks": [ { "type": "NameCallback", "output": [ { "name": "prompt",
   "value": " User Name: " } ], "input": [ { "name": "IDToken1", "value": "demo" } ] },
   { "type": "PasswordCallback", "output": [ { "name": "prompt", "value": " Password: " } ],
   "input": [ { "name": "IDToken2", "value": "changeit" } ] } ] }'
 https://openam.example.com:8443/openam/json/authenticate?noSession=true

{ "message": "Authentication Successful", "successUrl": "/openam/console" }</pre></div><p>OpenAM can be configured to return a failure URL value when
   authentication fails. No failure URL is configured by default. The Default
   Failure Login URL can be configured for the <a href="../admin-guide/index.html#core-module-conf-hints" class="link">Core</a> authentication
   module. Alternatively, failure URLs can be configured per authentication
   chain, which your client can specify using the <code class="literal">service</code>
   parameter described below. On failure OpenAM then returns HTTP status
   code 401 Unauthorized, and the JSON in the reply indicates the failure
   URL.</p><pre class="cmdline prettyprint">$ curl --request POST --header "Content-Type: application/json"
 --header "X-OpenAM-Username: demo" --header "X-OpenAM-Password: badpassword"
 https://openam.example.com:8443/openam/json/authenticate

{ "errorMessage": "Invalid Password!!",
  "failureUrl": "http://www.example.com/401.html" }</pre><p>You can set the realm by using the realm query string parameter as
   in <code class="literal">?realm=myRealm</code>.</p><div class="variablelist"><p>You can use the <code class="literal">authIndexType</code> and
    <code class="literal">authIndexValue</code> query string parameters as a pair
    to provide additional information about how you are authenticating.
    The <code class="literal">authIndexType</code> can be one of the following
    types.</p><dl class="variablelist"><dt><span class="term">composite</span></dt><dd><p>Set the value to a composite advice string.</p></dd><dt><span class="term">level</span></dt><dd><p>Set the value to the authentication level.</p></dd><dt><span class="term">module</span></dt><dd><p>Set the value to the name of an authentication module.</p></dd><dt><span class="term">resource</span></dt><dd><p>Set the value to a URL protected by an OpenAM policy.</p></dd><dt><span class="term">role</span></dt><dd><p>Set the value to an OpenAM role.</p></dd><dt><span class="term">service</span></dt><dd><p>Set the value to the name of an authentication chain.</p></dd><dt><span class="term">user</span></dt><dd><p>Set the value to an OpenAM user ID.</p></dd></dl></div><div class="itemizedlist"><p>OpenAM uses the following callback types depending on the
    authentication module in use.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ChoiceCallback</p></li><li class="listitem"><p>ConfirmationCallback</p></li><li class="listitem"><p>HttpCallback</p></li><li class="listitem"><p>LanguageCallback</p></li><li class="listitem"><p>NameCallback</p></li><li class="listitem"><p>PasswordCallback</p></li><li class="listitem"><p>RedirectCallback</p></li><li class="listitem"><p>TextInputCallback</p></li><li class="listitem"><p>TextOutputCallback</p></li><li class="listitem"><p>X509CertificateCallback</p></li></ul></div><p>Authenticated users can log out with the token cookie value and an HTTP
   POST to <code class="literal">/json/sessions/?_action=logout</code>.</p><pre class="cmdline prettyprint">$ curl
 --request POST
 --header "iplanetDirectoryPro: AQIC5wM2...U3MTE4NA..*"
 "https://openam.example.com:8443/openam/json/sessions/?_action=logout"

{"result":"Successfully logged out"}</pre></div><div class="section" id="rest-api-auth-legacy"><div class="titlepage"><div><div><h3 class="title">3.3.2.&nbsp;Authentication &amp; Logout (Legacy API)</h3></div></div></div><p>Interface Stability: <a href="../admin-guide/index.html#interface-stability" class="link">Deprecated</a></p><p>Simple authentication with a user name and password returns a
    token.</p><pre class="cmdline prettyprint">$ curl --request POST --data "username=bjensen&amp;password=hifalutin"
 https://openam.example.com:8443/openam/identity/authenticate

token.id=AQIC5wM2LY4SfcxvdvHOXjtC_eWSs2RB54tgvgK8SuYi7aQ.*AAJTSQACMDE.*</pre><p>If you must specify parameters as when authenticating to
    <code class="literal">/UI/Login</code>, you provide a percent encoded string of the
    parameters as the value of the <code class="literal">uri</code> parameter. The
    <code class="literal">/UI/Login</code> parameter deals with the <code class="literal">realm</code>,
    <code class="literal">module</code>, and <code class="literal">service</code> parameters. Setting the
    <code class="literal">client</code> parameter sets the user's IP address as part of the
    token following successful authentication. The default for the <code class="literal">client</code>
    parameter is the IP of the machine making the REST request.</p><pre class="cmdline prettyprint">$ curl --request POST --data "username=bjensen
 &amp;password=hifalutin
 &amp;uri=realm%3D%2F%26module%3DDataStore
 &amp;client=192.168.1.1"
 https://openam.example.com:8443/openam/identity/authenticate

token.id=AQIC5wM2LY4SfcxvdvHOXjtC_eWSs2RB54tgvgK8SuYi7aQ.*AAJTSQACMDE.*</pre><p>You log out using the token to end the user session.</p><pre class="cmdline prettyprint">$ curl --request POST --data "subjectid=AQIC5w...*AAJTSQACMDE.*"
https://openam.example.com:8443/openam/identity/logout</pre></div></div><div class="section" id="rest-api-cookie-info"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.4.&nbsp;Cookie Information</h2></div></div></div><p>You can retrieve the cookie domains that OpenAM supports by HTTP GET on
  <code class="literal">/json/serverinfo/cookieDomains</code>.</p><pre class="cmdline prettyprint">$ curl https://openam.example.com:8443/openam/json/serverinfo/cookieDomains
{"domains":[".example.com"]}</pre><p>You can retrieve the name of the cookie used for storing the session
  token. By default it is <code class="literal">iPlanetDirectoryPro</code>.</p><pre class="cmdline prettyprint">$ curl https://openam.example.com:8443/openam/identity/getCookieNameForToken
string=iPlanetDirectoryPro</pre><p>You can also retrieve the name of the cookie used for storing the session
  token and the names of the cookies to forward with requests.</p><pre class="cmdline prettyprint">$ curl https://openam.example.com:8443/openam/identity/getCookieNamesToForward
string=iPlanetDirectoryPro
string=amlbcookie</pre></div><div class="section" id="rest-api-tokens"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.5.&nbsp;Token Validation, Attribute Retrieval</h2></div></div></div><p>You check whether a token is valid as follows.</p><pre class="cmdline prettyprint">$ curl --request POST --data "tokenid=AQIC5w...*AAJTSQACMDE.*" 
  https://openam.example.com:8443/openam/identity/isTokenValid
boolean=true</pre><p>An invalid token returns <code class="literal">boolean=false</code>.</p><pre class="cmdline prettyprint">$ curl --request POST --data "tokenid=INVALID" 
  https://openam.example.com:8443/openam/identity/isTokenValid
boolean=false</pre><p>With a valid token, you can retrieve attributes about the subject.
  OpenAM returns a series of <em class="replaceable"><code>name</code></em>,
  <em class="replaceable"><code>value</code></em> pairs.</p><p>The newer API for retrieving user information is demonstrated in
  <a class="xref" href="#rest-api-read-identity" title="3.12.2.&nbsp;Reading Identities">Section&nbsp;3.12.2, &#8220;Reading Identities&#8221;</a>. What follows describes the
  legacy API.</p><a class="indexterm" name="d14138e712"></a><pre class="cmdline prettyprint">$ curl --request POST --data "subjectid=AQIC5w...*AAJTSQACMDE.*" 
  https://openam.example.com:8443/openam/identity/attributes
userdetails.token.id=
 AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*
userdetails.attribute.name=uid
userdetails.attribute.value=bjensen
userdetails.attribute.name=mail
userdetails.attribute.value=bjensen@example.com
userdetails.attribute.name=sn
userdetails.attribute.value=Jensen
userdetails.attribute.name=userpassword
userdetails.attribute.value={SSHA}rhusOfYpkapDWEHcfT2Y7y83LMuC++F4Abqvig==
userdetails.attribute.name=cn
userdetails.attribute.value=Babs Jensen
userdetails.attribute.value=Barbara Jensen
userdetails.attribute.name=givenname
userdetails.attribute.value=Barbara
userdetails.attribute.name=dn
userdetails.attribute.value=uid=bjensen,ou=people,dc=example,dc=com
userdetails.attribute.name=telephonenumber
userdetails.attribute.value=+1 408 555 1862
userdetails.attribute.name=objectclass
userdetails.attribute.value=organizationalPerson
userdetails.attribute.value=person
userdetails.attribute.value=posixAccount
userdetails.attribute.value=inetOrgPerson
userdetails.attribute.value=krbprincipalaux
userdetails.attribute.value=krbTicketPolicyAux
userdetails.attribute.value=top</pre><p>You can specify attributes to limit what you retrieve.</p><pre class="cmdline prettyprint">$ curl "https://openam.example.com:8443/openam/identity/attributes?
 subjectid=AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*
 &amp;attributenames=mail
 &amp;attributenames=uid"
userdetails.token.id=
 AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*
userdetails.attribute.name=uid
userdetails.attribute.value=bjensen
userdetails.attribute.name=mail
userdetails.attribute.value=bjensen@example.com</pre><p>When retrieving attributes, you can refresh the session thus setting
  the idle time to 0, by adding the boolean parameter
  <code class="literal">refresh=true</code> to the query string.</p><pre class="cmdline prettyprint">$ curl "https://openam.example.com:8443/openam/identity/attributes?
 subjectid=AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*
 &amp;attributenames=cn
 &amp;refresh=true"
userdetails.token.id=
 AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*
userdetails.attribute.name=cn
userdetails.attribute.value=Babs Jensen
userdetails.attribute.value=Barbara Jensen</pre></div><div class="section" id="rest-api-authz"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.6.&nbsp;Authorization</h2></div></div></div><a class="indexterm" name="d14138e733"></a><p>You can call on OpenAM to decide whether to authorize access to a
  protected resource based on a valid token. Of course, you must percent
  encode the resource URI.</p><pre class="cmdline prettyprint">$ curl "https://openam.example.com:8443/openam/identity/authorize?
 uri=http%3A%2F%2Fwww.example.com%3A8080%2Fexamples%2Findex.html
 &amp;subjectid=AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*"
boolean=true</pre><p>To indicate access denied, OpenAM returns
  <code class="literal">boolean=false</code>.</p><div class="section" id="rest-api-policy-decisions"><div class="titlepage"><div><div><h3 class="title">3.6.1.&nbsp;Requesting Policy Decisions</h3></div></div></div><p>OpenAM provides additional REST APIs for requesting policy
   decisions.</p><div class="itemizedlist"><p>The policy decision interfaces use the following path suffixes and
    query string parameters.</p><p>Path suffixes for policy decision requests include the following.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">ws/1/entitlement/decision</code>: request a decision
     pertaining to a single resource</p></li><li class="listitem"><p><code class="literal">ws/1/entitlement/decisions</code>: request decisions
     pertaining to multiple resources</p></li><li class="listitem"><p><code class="literal">ws/1/entitlement/entitlement</code>: request decisions
     for a specified resource URL and all resources underneath</p></li></ul></div><div class="itemizedlist"><p>Query string parameters for policy decision requests include the
    following.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">subject=<em class="replaceable"><code>encoded-token</code></em></code>,
     where the token is encoded using the method implemented in <a class="link" href="http://sources.forgerock.org/browse/~raw,r=6/openam/trunk/opensso/www/public/use/docs/fampdf/Encoder.java" target="_blank"><code class="filename">Encoder.java</code></a>.</p><p>In the examples for this section, the token ID obtained during
     authentication for <code class="literal">amadmin</code> is abbreviated as
     <code class="literal">AQIC5...DU3*</code> and the encoded token ID for the subject
     is <code class="literal">MJ3QFTr4ZV2QrtlJvXlg0Q2dMRM=</code>.</p></li><li class="listitem"><p><code class="literal">action=get</code>, or <code class="literal">action=post</code>,
     which identifies the user agent action when requesting a decision.</p></li><li class="listitem"><p><code class="literal">application=iPlanetAMWebAgentService</code></p></li><li class="listitem"><p><code class="literal">resource=<em class="replaceable"><code>resource-url</code></em></code>,
     or multiple <code class="literal">resources=<em class="replaceable"><code>resource-url</code></em></code>
     parameters for multiple decisions.</p></li><li class="listitem"><p><code class="literal">env=<em class="replaceable"><code>requestDnsName%3Dfqdn</code></em></code>,
     <code class="literal">env=<em class="replaceable"><code>requestIP%3Ddotted-quads</code></em></code>,
     <code class="literal">env=<em class="replaceable"><code>requestTime%3Dseconds-since-epoch</code></em></code>,
     and <code class="literal">env=<em class="replaceable"><code>requestDnsName%3Dtime-zone</code></em></code>
     where <em class="replaceable"><code>time-zone</code></em> is from Java
     <code class="literal">TimeZone.getTimeZone().getID()</code>. The
     <code class="literal">env</code> parameters thus express conditions.</p></li></ul></div><p>Authentication for these interfaces uses cookies, so if your
   application is not running in a browser, first authenticate as described in
   <a class="xref" href="#rest-api-auth" title="3.3.&nbsp;Authentication &amp; Logout">Section&nbsp;3.3, &#8220;Authentication &amp; Logout&#8221;</a>.</p><p>To request a decision for a single resource, use an HTTP GET on
   <code class="literal">/ws/1/entitlement/decision</code> as in the following example.</p><pre class="cmdline prettyprint">$ curl
 --request GET
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*"
 "https://openam.example.com:8443/openam/ws/1/entitlement/decision
 ?subject=MJ3QFTr4ZV2QrtlJvXlg0Q2dMRM=&amp;action=GET
 &amp;application=iPlanetAMWebAgentService
 &amp;resource=http%3A%2F%2Fwww.example.com%2Findex.html"
allow</pre><p>If access is denied, the result is <code class="literal">deny</code>.</p><p>To request decisions for multiple resources, use an HTTP GET on
   <code class="literal">/ws/1/entitlement/decisions</code> as in the following example.</p><pre class="cmdline prettyprint">$ curl
 --request GET
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*"
 "https://openam.example.com:8443/openam/ws/1/entitlement/decisions
 ?subject=MJ3QFTr4ZV2QrtlJvXlg0Q2dMRM=&amp;action=GET
 &amp;application=iPlanetAMWebAgentService
 &amp;resources=http%3A%2F%2Fwww.example.com%2Findex.html
 &amp;resources=http%3A%2F%2Fwww.example.com%2Ffavicon.ico"
{
    "statusCode": 200,
    "body": {
        "results": [
            {
                "actionsValues": {
                    "POST": true,
                    "GET": true
                },
                "attributes": {},
                "advices": {},
                "resourceName": "http://www.example.com:80/index.html"
            },
            {
                "actionsValues": {
                    "POST": true,
                    "GET": true
                },
                "attributes": {},
                "advices": {},
                "resourceName": "http://www.example.com:80/favicon.ico"
            }
        ]
    },
    "statusMessage": "OK"
}</pre><p>To request decisions for all resource underneath a given resource, use
   an HTTP GET on <code class="literal">/ws/1/entitlement/entitlement</code> as in the
   following example.</p><pre class="cmdline prettyprint">$ curl
 --request GET
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*"
 "https://openam.example.com:8443/openam/ws/1/entitlement/entitlement
 ?subject=MJ3QFTr4ZV2QrtlJvXlg0Q2dMRM=
 &amp;application=iPlanetAMWebAgentService
 &amp;resource=http%3A%2F%2Fwww.example.com%2F*"
{
    "statusCode": 200,
    "body": {
        "actionsValues": {
            "POST": true,
            "GET": true
        },
        "attributes": {},
        "advices": {},
        "resourceName": "http://www.example.com:80/*"
    },
    "statusMessage": "OK"
}</pre></div><div class="section" id="rest-api-policy-management"><div class="titlepage"><div><div><h3 class="title">3.6.2.&nbsp;Managing Policies</h3></div></div></div><p>OpenAM exposes a REST API through the
   <code class="literal">/ws/1/entitlement/privilege</code> endpoint under the
   deployment URI. The API lets you create, read, update, delete, and query
   policies.</p><p>Authentication for these interfaces uses cookies, so if your
   application is not running in a browser, first authenticate as described in
   <a class="xref" href="#rest-api-auth" title="3.3.&nbsp;Authentication &amp; Logout">Section&nbsp;3.3, &#8220;Authentication &amp; Logout&#8221;</a>.</p><div class="section" id="rest-api-policy-management-create"><div class="titlepage"><div><div><h4 class="title">3.6.2.1.&nbsp;Creating Policies</h4></div></div></div><p>You create a policy by using an HTTP POST of the JSON representation
    to the endpoint. You must URL encode the JSON before passing it to
    OpenAM.</p><pre class="cmdline prettyprint">$ cat entitlement.json
{
    "name": "Example HTTP",
    "eSubject": {
        "state": {
            "className": "com.sun.identity.policy.plugins.AuthenticatedUsers",
            "exclusive": false,
            "name": "All Authenticated Users",
            "values": []
        },
        "className": "com.sun.identity.entitlement.opensso.PolicySubject"
    },
    "entitlement": {
        "actionsValues": {
            "POST": true,
            "GET": true
        },
        "applicationName": "iPlanetAMWebAgentService",
        "name": "authorize",
        "resourceNames": [
            "http://www.example.com:80/*"
        ]
    }
}$ curl
 --request POST
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*"
 --data-urlencode "privilege.json@entitlement.json"
 https://openam.example.com:8443/openam/ws/1/entitlement/privilege
{"statusCode":201,"body":"Created","statusMessage":"Created"}

$ cat entitlement2.json
{
    "name": "Example HTTPS",
    "eSubject": {
        "state": {
            "className": "com.sun.identity.policy.plugins.AuthenticatedUsers",
            "exclusive": false,
            "name": "All Authenticated Users",
            "values": []
        },
        "className": "com.sun.identity.entitlement.opensso.PolicySubject"
    },
    "entitlement": {
        "actionsValues": {
            "POST": false,
            "GET": true
        },
        "applicationName": "iPlanetAMWebAgentService",
        "name": "authorize",
        "resourceNames": [
            "https://www.example.com:443/*?*"
        ]
    }
}$ curl
 --request POST
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*"
 --data-urlencode "privilege.json@entitlement2.json"
 https://openam.example.com:8443/openam/ws/1/entitlement/privilege
{"statusCode":201,"body":"Created","statusMessage":"Created"}</pre></div><div class="section" id="rest-api-policy-management-read"><div class="titlepage"><div><div><h4 class="title">3.6.2.2.&nbsp;Reading Policies</h4></div></div></div><p>To read a policy, use an HTTP GET on the endpoint followed by
    the URL-encoded name of the policy.</p><p>Notice that the "state" is returned as a long string, and so is not
    shown here in full.</p><pre class="cmdline prettyprint">$ curl
 --request GET
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*"
 https://openam.example.com:8443/openam/ws/1/entitlement/privilege/Example%20HTTP
{
    "statusCode": 200,
    "body": {
        "results": {
            "name": "Example HTTP",
            "eSubject": {
                "state": "{\n  \"className\": \"com.sun.identity.policy...}",
                "className": "com.sun.identity.entitlement.opensso.PolicySubject"
            },
            "entitlement": {
                "actionsValues": {
                    "POST": true,
                    "GET": true
                },
                "applicationName": "iPlanetAMWebAgentService",
                "name": "authorize",
                "resourceNames": [
                    "http://www.example.com:80/*"
                ]
            }
        }
    },
    "statusMessage": "OK"
}

$ curl
 --request GET
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*"
 https://openam.example.com:8443/openam/ws/1/entitlement/privilege/Example%20HTTPS
{
    "statusCode": 200,
    "body": {
        "results": {
            "name": "Example HTTPS",
            "eSubject": {
                "state": "{\n  \"className\": \"com.sun.identity.policy...}",
                "className": "com.sun.identity.entitlement.opensso.PolicySubject"
            },
            "entitlement": {
                "actionsValues": {
                    "POST": false,
                    "GET": true
                },
                "applicationName": "iPlanetAMWebAgentService",
                "name": "authorize",
                "resourceNames": [
                    "https://www.example.com:443/*?*"
                ]
            }
        }
    },
    "statusMessage": "OK"
}</pre></div><div class="section" id="rest-api-policy-management-update"><div class="titlepage"><div><div><h4 class="title">3.6.2.3.&nbsp;Updating Policies</h4></div></div></div><p>To update a policy, use an HTTP PUT on the endpoint followed by the
    URL-encoded name of the policy.</p><pre class="cmdline prettyprint">$ cat update.json {
    "name": "Example HTTP",
    "eSubject": {
        "state": {
            "className": "com.sun.identity.policy.plugins.AuthenticatedUsers",
            "exclusive": false,
            "name": "All Authenticated Users",
            "values": []
        },
        "className": "com.sun.identity.entitlement.opensso.PolicySubject"
    },
    "entitlement": {
        "actionsValues": {
            "POST": false,
            "GET": true
        },
        "applicationName": "iPlanetAMWebAgentService",
        "name": "authorize",
        "resourceNames": [
            "http://www.example.com:80/*?*"
        ]
    }
}$ curl
 --request PUT
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*"
 --data-urlencode "privilege.json@update.json"
 https://openam.example.com:8443/openam/ws/1/entitlement/privilege/Example%20HTTP
{"statusCode":200,"body":"OK","statusMessage":"OK"}</pre></div><div class="section" id="rest-api-policy-management-delete"><div class="titlepage"><div><div><h4 class="title">3.6.2.4.&nbsp;Deleting Policies</h4></div></div></div><p>To delete a policy, use an HTTP DELETE on the endpoint followed by
    the URL-encoded name of the policy.</p><pre class="cmdline prettyprint">$ curl
 --request DELETE
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*"
 https://openam.example.com:8443/openam/ws/1/entitlement/privilege/Example%20HTTPS
{"statusCode":200,"body":"OK","statusMessage":"OK"}</pre></div><div class="section" id="rest-api-policy-management-query"><div class="titlepage"><div><div><h4 class="title">3.6.2.5.&nbsp;Querying Policies</h4></div></div></div><p>To get the names of policies, use an HTTP GET on the endpoint.</p><pre class="cmdline prettyprint">$ curl
 --request GET
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*"
 https://openam.example.com:8443/openam/ws/1/entitlement/privilege
{
    "statusCode": 200,
    "body": {
        "results": [
            "Example HTTPS",
            "Example HTTP"
        ]
    },
    "statusMessage": "OK"
}</pre><p>You can pass a filter query parameter to get only policies
    that match the filter. Make sure you URL encode the filter value.</p><pre class="cmdline prettyprint">$ curl
 --request GET
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*"
 "https://openam.example.com:8443/openam/ws/1/entitlement/privilege
 ?subject=MJ3QFTr4ZV2QrtlJvXlg0Q2dMRM=&amp;filter=name%3D*HTTP"
{
    "statusCode": 200,
    "body": {
        "results": [
            "Example HTTP"
        ]
    },
    "statusMessage": "OK"
}
</pre></div></div></div><div class="section" id="rest-api-oauth2"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.7.&nbsp;OAuth 2.0 Authorization</h2></div></div></div><a class="indexterm" name="d14138e940"></a><div class="itemizedlist"><p>OpenAM exposes the following REST endpoints for different OAuth 2.0
   purposes.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Endpoints for <a class="link" href="#rest-api-oauth2-client-endpoints" title="3.7.1.&nbsp;OAuth 2.0 Client &amp; Resource Server Endpoints">OAuth
    2.0 clients and resource servers</a>, mostly defined in RFC 6749,
    <a class="link" href="http://tools.ietf.org/html/rfc6749" target="_blank"><em class="citetitle">The OAuth 2.0 Authorization Framework</em></a>, with
    an additional <code class="literal">tokeninfo</code> endpoint useful to resource
    servers.</p></li><li class="listitem"><p>An endpoint for <a class="link" href="#rest-api-oauth2-token-admin-endpoint" title="3.7.2.&nbsp;OAuth 2.0 Token Administration Endpoint">OAuth 2.0 token administration</a>. This is specific to OpenAM.</p></li><li class="listitem"><p>An endpoint for <a class="link" href="#rest-api-oauth2-client-admin-endpoint" title="3.7.3.&nbsp;OAuth 2.0 Client Administration Endpoint">OAuth 2.0 client administration</a>. This is specific to OpenAM.</p></li></ul></div><p>When accessing the APIs, browser-based REST clients can rely on OpenAM
  to handle the session as usual. First authenticate with OpenAM. Then perform
  the operations in the browser session.</p><p>Clients not running in a browser can authenticate as described in
  <a class="xref" href="#rest-api-auth" title="3.3.&nbsp;Authentication &amp; Logout">Section&nbsp;3.3, &#8220;Authentication &amp; Logout&#8221;</a>, whereby OpenAM returns a
  <code class="literal">token.id</code> value. Clients pass the
  <code class="literal">token.id</code> value in a header named after the
  authentication cookie, by default <code class="literal">iplanetDirectoryPro</code>.</p><div class="section" id="rest-api-oauth2-client-endpoints"><div class="titlepage"><div><div><h3 class="title">3.7.1.&nbsp;OAuth 2.0 Client &amp; Resource Server Endpoints</h3></div></div></div><p>As described in the <em class="citetitle">Administration Guide</em> chapter
   on <a href="../admin-guide/index.html#chap-oauth2" class="link"><em class="citetitle">Managing OAuth
   2.0 Authorization</em></a>, OpenAM exposes REST endpoints for
   making calls to OpenAM acting as an authorization server.</p><div lang="en" class="variablelist"><p>In addition to the standard authorization and token endpoints
 described in RFC 6749, OpenAM also exposes a token information endpoint
 for resource servers to get information about access tokens so they can
 determine how to respond to requests for protected resources. OpenAM as
 authorization server exposes the following endpoints for clients and
 resource servers.</p><dl class="variablelist"><dt><span class="term"><code class="literal">/oauth2/authorize</code></span></dt><dd><p>Authorization endpoint defined in RFC 6749, used to obtain an
   authorization grant from the resource owner</p><p>Example: <code class="literal">https://openam.example.com:8443/openam/oauth2/authorize</code></p></dd><dt><span class="term"><code class="literal">/oauth2/access_token</code></span></dt><dd><p>Token endpoint defined in RFC 6749, used to obtain an access token
   from the authorization server</p><p>Example: <code class="literal">https://openam.example.com:8443/openam/oauth2/access_token</code></p></dd><dt><span class="term"><code class="literal">/oauth2/tokeninfo</code></span></dt><dd><p>Endpoint not defined in RFC 6749, used to validate tokens, and to
   retrieve information such as scopes</p><p>Given an access token, a resource server can perform an HTTP GET on
   <code class="literal">/oauth2/tokeninfo?access_token=<em class="replaceable"><code>token-id</code></em></code>
   to retrieve a JSON object indicating <code class="literal">token_type</code>,
   <code class="literal">expires_in</code>, <code class="literal">scope</code>, and the
   <code class="literal">access_token</code> ID.</p><p>Example: <code class="literal">https://openam.example.com:8443/openam/oauth2/tokeninfo</code></p></dd></dl></div><p>The <code class="literal">/oauth2/authorize</code>, and
   <code class="literal">/oauth2/access_token</code> endpoints function as described
   in RFC 6749.</p><p>The <code class="literal">/oauth2/authorize</code> endpoint is protected by the
   policy created during OAuth 2.0 authorization server configuration, which
   grants all authenticated users access.</p><p>The <code class="literal">/oauth2/tokeninfo</code> endpoint takes an HTTP GET
   on <code class="literal">/oauth2/tokeninfo?access_token=<em class="replaceable"><code>token-id</code></em></code>, and returns information about the
   token.</p><p>Resource servers &#8212; or any party having the token ID &#8212; can
   get token information through this endpoint without authenticating. This
   means any application or user can validate the token without having to be
   registered with OpenAM.</p><p>The following example shows OpenAM issuing an access token, and
   then returning token information.</p><pre class="cmdline prettyprint">$ curl
 --request POST
 --user "myClientID:password"
 --data "grant_type=password&amp;username=demo&amp;password=changeit&amp;scope=cn%20mail"
 https://openam.example.com:8443/openam/oauth2/access_token
{
    "expires_in": 599,
    "token_type": "Bearer",
    "refresh_token": "f6dcf133-f00b-4943-a8d4-ee939fc1bf29",
    "access_token": "f9063e26-3a29-41ec-86de-1d0d68aa85e9"
}
$ curl https://openam.example.com:8443/openam/oauth2/tokeninfo
 ?access_token=f9063e26-3a29-41ec-86de-1d0d68aa85e9
{
    "mail": "demo@example.com",
    "scope": [
        "mail",
        "cn"
    ],
    "cn": "demo",
    "realm": "/",
    "token_type": "Bearer",
    "expires_in": 577,
    "access_token": "f9063e26-3a29-41ec-86de-1d0d68aa85e9"
}</pre><p>The resource server making decisions about whether the token is valid
   can thus use the <code class="literal">/oauth2/tokeninfo</code> endpoint to retrieve
   expiration information about the token. Depending on the scopes
   implementation, the JSON response about the token can also contain scope
   information. As described in the <em class="citetitle">Administration Guide</em>,
   the default scopes implementation in OpenAM considers scopes to be names of
   attributes in the resource owner's user profile. Notice that the JSON
   response contains the values for those attributes from the user's profile,
   as in the preceding example, with scopes set to <code class="literal">mail</code> and
   <code class="literal">cn</code>.</p><p>Both the <code class="literal">/oauth2/authorize</code> and
   <code class="literal">/oauth2/access_token</code> endpoints can take additional
   parameters. In particular you must specify the realm using the
   <code class="literal">realm=<em class="replaceable"><code>realm-name</code></em></code> parameter if
   the OpenAM OAuth 2.0 provider is configured for a subrealm rather than /
   (Top-Level Realm). For example, if the OAuth 2.0 provider is configured
   for the <code class="literal">/customers</code> realm, then use
   <code class="literal">/oauth2/authorize?realm=/customers</code> and
   <code class="literal">/oauth2/access_token?realm=/customers</code>.</p><p>The <code class="literal">/oauth2/authorize</code> endpoint can also take
   <code class="literal">module</code> and <code class="literal">service</code> parameters. Use
   either as described in <a href="../admin-guide/index.html#authn-from-browser" class="link"><em class="citetitle">Authenticating
   To OpenAM</em></a>, where <code class="literal">module</code> specifies the
   authentication module instance to use or <code class="literal">service</code>
   specifies the authentication chain to use when authenticating the resource
   owner.</p></div><div class="section" id="rest-api-oauth2-token-admin-endpoint"><div class="titlepage"><div><div><h3 class="title">3.7.2.&nbsp;OAuth 2.0 Token Administration Endpoint</h3></div></div></div><p>The OpenAM-specific OAuth 2.0 token administration endpoint lets
   administrators read, list, and delete OAuth 2.0 tokens. OAuth 2.0 clients
   can also manage their own tokens.</p><p>OpenAM exposes the token administration endpoint at
   <code class="literal">/frrest/oauth2/token</code>, such as
   <code class="literal">https://openam.example.com:8443/openam/frrest/oauth2/token</code>.</p><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>This endpoint location is likely to change in the future.</p></div></div><p>To get a token, perform an HTTP GET on
   <code class="literal">/frrest/oauth2/token/<em class="replaceable"><code>token-id</code></em></code>,
   as in the following example.</p><pre class="cmdline prettyprint">$ curl
 --request POST
 --user "myClientID:password"
 --data "grant_type=password&amp;username=demo&amp;password=changeit&amp;scope=cn%20mail"
 https://openam.example.com:8443/openam/oauth2/access_token
{
    "expires_in": 599,
    "token_type": "Bearer",
    "refresh_token": "f838e7d4-7e84-4743-af7c-9a9c42c2969e",
    "access_token": "9c6a48fc-44b1-4a0c-b4f0-672fba468b0f"
}
$ curl
 --header "iplanetDirectoryPro: AQIC5wM2LY4Sfcxs...EwNDU2NjE0*"
 https://openam.example.com:8443/openam/frrest/oauth2/token/9c6a48fc...fba468b0f
{
    "scope": [
        "mail",
        "cn"
    ],
    "type": [
        "access_token"
    ],
    "username": [
        "demo"
    ],
    "realm": [
        "/"
    ],
    "id": [
        "9c6a48fc-44b1-4a0c-b4f0-672fba468b0f"
    ],
    "parent": [
        "f838e7d4-7e84-4743-af7c-9a9c42c2969e"
    ],
    "expiry_time": [
        "1355741494888"
    ],
    "client_id": [
        "myClientID"
    ]
}</pre><p>To list tokens, perform an HTTP GET on
   <code class="literal">/frrest/oauth2/token/?_query_id=<em class="replaceable"><code>conditions</code></em></code>,
   where <em class="replaceable"><code>conditions</code></em> is a comma-separated list of
   <code class="literal"><em class="replaceable"><code>field</code></em>=<em class="replaceable"><code>value</code></em></code>
   conditions. The <em class="replaceable"><code>field</code></em>s are taken from the fields
   returned in the token object through this endpoint.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">"expiry_time"</code></span></dt><dd><p>Token expiration time in milliseconds since 00:00:00 UTC, January 1,
      1970.</p></dd><dt><span class="term"><code class="literal">"type"</code></span></dt><dd><p>Either <code class="literal">"access_token"</code> or
      <code class="literal">"refresh_token"</code>.</p></dd><dt><span class="term"><code class="literal">"username"</code></span></dt><dd><p>OAuth 2.0 client to whom the token was issued.</p></dd><dt><span class="term"><code class="literal">"realm"</code></span></dt><dd><p>The realm for which the token was issued.</p></dd><dt><span class="term"><code class="literal">"id"</code></span></dt><dd><p>Unique ID of the token.</p></dd></dl></div><p>The following example shows a search for current access tokens that
   were issued to <code class="literal">myClientID</code>.</p><pre class="cmdline prettyprint">$ curl
 --header "iplanetDirectoryPro: AQIC5wM2LY4Sfcxs...EwNDU2NjE0*"
 https://openam.example.com:8443/openam/frrest/oauth2/token/?_queryID
 =username%3DmyClientID%2Ctype%3Daccess_token
{
    "result": [
        {
            "scope": [
                "mail",
                "cn"
            ],
            "id": [
                "1b836369-4fcf-4fb2-b819-ee4b1314d4f1"
            ],
            "type": [
                "access_token"
            ],
            "username": [
                "myClientID"
            ],
            "realm": [
                "/"
            ],
            "expiry_time": [
                "1355741986154"
            ]
        },
        {
            "scope": [
                "mail",
                "cn"
            ],
            "type": [
                "access_token"
            ],
            "username": [
                "myClientID"
            ],
            "realm": [
                "/"
            ],
            "id": [
                "5f1763fc-37ae-4698-9e84-d301d49e1f7e"
            ],
            "expiry_time": [
                "1355741982091"
            ]
        }
    ],
    "pagedResultsCookie": null,
    "remainingPagedResults": -1
}</pre><p>To delete a token, perform an HTTP DELETE on
   <code class="literal">/frrest/oauth2/token/<em class="replaceable"><code>token-id</code></em></code>,
   as in the following example.</p><pre class="cmdline prettyprint">$ curl
 --request POST
 --data "grant_type=client_credentials&amp;username=demo&amp;password=changeit
 &amp;client_id=myClientID&amp;client_secret=password&amp;scope=cn%20mail"
 https://openam.example.com:8443/openam/oauth2/access_token
{
    "expires_in": 599,
    "token_type": "Bearer",
    "access_token": "867aaab2-61d7-4b78-9b80-4f9098034540"
}
$ curl
 --request DELETE
 --header "iplanetDirectoryPro: AQIC5wM2LY4Sfcxs...EwNDU2NjE0*"
 https://openam.example.com:8443/openam/frrest/oauth2/token/867aaab2..098034540
{
    "success": "true"
}</pre></div><div class="section" id="rest-api-oauth2-client-admin-endpoint"><div class="titlepage"><div><div><h3 class="title">3.7.3.&nbsp;OAuth 2.0 Client Administration Endpoint</h3></div></div></div><p>The OAuth 2.0 administration endpoint lets OpenAM administrators and
   agent administrators create (that is, register) and delete OAuth 2.0
   clients.</p><p>OpenAM exposes this endpoint at <code class="literal">/frrest/oauth2/client</code>,
   such as
   <code class="literal">https://openam.example.com:8443/openam/frrest/oauth2/client</code>.</p><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>This endpoint location is likely to change in the future.</p></div></div><p>To create an OAuth 2.0 client, perform an HTTP POST to
   <code class="literal">/frrest/oauth2/client/?_action=create</code>
   with a JSON object fully specifying the client, as in the following
   example.</p><pre class="cmdline prettyprint">$ curl --request POST --header "iplanetDirectoryPro: AQIC5wM...3MTYxOA..*"
 --header "Content-Type: application/json"
 --data '{"client_id":["testClient"],
          "realm":["/"]
          "userpassword":["secret12"],
          "com.forgerock.openam.oauth2provider.clientType":["Confidential"],
          "com.forgerock.openam.oauth2provider.redirectionURIs":
            ["www.client.com","www.example.com"],
          "com.forgerock.openam.oauth2provider.scopes":["cn","sn"],
          "com.forgerock.openam.oauth2provider.defaultScopes":["cn"],
          "com.forgerock.openam.oauth2provider.name":["My Test Client"],
          "com.forgerock.openam.oauth2provider.description":["OAuth 2.0 Client"]
         }'
 https://openam.example.com:8443/openam/frrest/oauth2/client/?_action=create
 {"success":"true"}</pre><div class="variablelist"><p>When creating an OAuth 2.0 client, use the following fields in your
    JSON object.</p><dl class="variablelist"><dt><span class="term"><code class="literal">"client_id"</code></span></dt><dd><p>(Required) This field takes an array containing the client
      identifier as defined in RFC 6749.</p></dd><dt><span class="term"><code class="literal">"realm"</code></span></dt><dd><p>(Required) This field takes an array containing the OpenAM realm
      in which to create the client as defined in RFC 6749.</p></dd><dt><span class="term"><code class="literal">"userpassword"</code></span></dt><dd><p>(Required) This field takes an array containing the client
      secret as defined in RFC 6749.</p></dd><dt><span class="term"><code class="literal">"com.forgerock.openam.oauth2provider.clientType"</code></span></dt><dd><p>(Required) This field takes an array containing the client
      type, either <code class="literal">"Confidential"</code> or
      <code class="literal">"Public"</code> as defined in RFC 6749.</p></dd><dt><span class="term"><code class="literal">"com.forgerock.openam.oauth2provider.redirectionURIs"</code></span></dt><dd><p>(Optional for confidential clients) This field takes an array of
      client redirection endpoints as defined in RFC 6749.</p></dd><dt><span class="term"><code class="literal">"com.forgerock.openam.oauth2provider.scopes"</code></span></dt><dd><p>(Optional) This field takes an array of scopes as defined in RFC
      6749. The default scopes implementation takes scopes to be names of
      attributes in the resource owner profile.</p><p>Specify localized scopes in <code class="literal"><em class="replaceable"><code>scope</code></em>|<em class="replaceable"><code>locale</code></em>|<em class="replaceable"><code>localized description</code></em></code> format.</p></dd><dt><span class="term"><code class="literal">"com.forgerock.openam.oauth2provider.defaultScopes"</code></span></dt><dd><p>(Optional) This field takes an array of default scopes set
      automatically when tokens are issued.</p></dd><dt><span class="term"><code class="literal">"com.forgerock.openam.oauth2provider.name"</code></span></dt><dd><p>(Optional) This field takes an array containing the client name to
      display to the resource owner when the resource owner must authorize
      client access to protected resources.</p><p>Specify localized names in <code class="literal"><em class="replaceable"><code>locale</code></em>|<em class="replaceable"><code>localized name</code></em></code>
      format.</p></dd><dt><span class="term"><code class="literal">"com.forgerock.openam.oauth2provider.description"</code></span></dt><dd><p>(Optional) This field takes an array containing the description to
      display to the resource owner when the resource owner must authorize
      client access to protected resources.</p><p>Specify localized descriptions in <code class="literal"><em class="replaceable"><code>locale</code></em>|<em class="replaceable"><code>localized description</code></em></code>
      format.</p></dd></dl></div><p>To delete an OAuth 2.0 client, perform an HTTP DELETE on
   <code class="literal">/frrest/oauth2/client/<em class="replaceable"><code>client-id</code></em></code>,
   as in the following example.</p><pre class="cmdline prettyprint">$ curl --request DELETE
 --header "iplanetDirectoryPro: AQIC5wM...3MTYxOA..*"
 https://openam.example.com:8443/openam/frrest/oauth2/client/testClient
{"success":"true"}</pre></div></div><div class="section" id="rest-api-openid-connect"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.8.&nbsp;OpenID Connect 1.0</h2></div></div></div><a class="indexterm" name="d14138e1383"></a><p>OpenID Connect 1.0 extends OAuth 2.0 so the client can verify claims
  about the identity of the end user, get profile information about the end
  user, and log the user out at the end of the OpenAM session.</p><div class="itemizedlist"><p>OpenAM exposes the following REST endpoints for <a class="link" href="http://openid.net/connect/" target="_blank">OpenID Connect 1.0</a>
   purposes.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Endpoints for <a class="link" href="#rest-api-openid-connect-discovery" title="3.8.1.&nbsp;Discovering OpenID Connect 1.0 Configuration">discovering information</a>.</p></li><li class="listitem"><p>An endpoint for <a class="link" href="#rest-api-openid-connect-dynamic-registration" title="3.8.2.&nbsp;Registering OpenID Connect 1.0 Clients">registering client applications</a>.</p></li><li class="listitem"><p>Endpoints for <a class="link" href="#rest-api-openid-connect-authorization" title="3.8.3.&nbsp;Performing OpenID Connect 1.0 Client Authorization">client authorization</a>.</p></li><li class="listitem"><p>Endpoints for <a class="link" href="#rest-api-openid-connect-session" title="3.8.4.&nbsp;Managing OpenID Connect 1.0 Sessions">session management</a>.</p></li></ul></div><div class="section" id="rest-api-openid-connect-discovery"><div class="titlepage"><div><div><h3 class="title">3.8.1.&nbsp;Discovering OpenID Connect 1.0 Configuration</h3></div></div></div><p>OpenAM exposes endpoints for discovering information about the provider
   configuration, and about the provider for a given end user.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">/.well-known/openid-configuration</code> allows clients
     to retrieve OpenID Provider configuration by HTTP GET as specified by
     OpenID Connect Discovery 1.0.</p></li><li class="listitem"><p><code class="literal">/.well-known/webfinger</code> allows clients to retrieve
     the provider URL for an end user by HTTP GET as specified by OpenID Connect
     Discovery 1.0.</p></li></ul></div><p>For examples, see <a href="../admin-guide/index.html#configure-openid-connect-discovery" class="link"><em class="citetitle">Configuring
   OpenAM For OpenID Connect Discovery</em></a>.</p></div><div class="section" id="rest-api-openid-connect-dynamic-registration"><div class="titlepage"><div><div><h3 class="title">3.8.2.&nbsp;Registering OpenID Connect 1.0 Clients</h3></div></div></div><p>OpenAM allows both static and dynamic registration of OpenID Connect
   client applications. For dynamic registration according to the OpenID Connect
   Dynamic Client Registration 1.0 specification, the endpoint is
   <code class="literal">/oauth2/connect/register</code>. See <a href="../admin-guide/index.html#register-openid-connect-client-dynamic" class="link"><em class="citetitle">To Register a
   Client Dynamically</em></a> for details.</p></div><div class="section" id="rest-api-openid-connect-authorization"><div class="titlepage"><div><div><h3 class="title">3.8.3.&nbsp;Performing OpenID Connect 1.0 Client Authorization</h3></div></div></div><p>Registered clients can request authorization through OpenAM.</p><p>OpenID Connect 1.0 supports both a Basic Client Profile using the
   OAuth 2.0 authorization code grant, and an Implicit Client Profile using the
   OAuth 2.0 implicit grant. These client profiles rely on the OAuth 2.0
   endpoints for authorization. Those endpoints are described in
   <a class="xref" href="#rest-api-oauth2-client-endpoints" title="3.7.1.&nbsp;OAuth 2.0 Client &amp; Resource Server Endpoints">Section&nbsp;3.7.1, &#8220;OAuth 2.0 Client &amp; Resource Server Endpoints&#8221;</a>.</p><p>In addition, authorized clients can access end user information through
   the OpenID Connect 1.0 specific endpoint
   <code class="literal">/oauth2/userinfo</code>.</p><p>For examples, see <a href="../admin-guide/index.html#openid-connect-examples" class="link"><em class="citetitle">Client
   Examples</em></a>.</p></div><div class="section" id="rest-api-openid-connect-session"><div class="titlepage"><div><div><h3 class="title">3.8.4.&nbsp;Managing OpenID Connect 1.0 Sessions</h3></div></div></div><p>Registered clients can use OpenID Connect Session Management 1.0 to
   handle end user logout actions.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">/oauth2/connect/checkSession</code> allows clients
     to retrieve session status notifications.</p></li><li class="listitem"><p><code class="literal">/oauth2/connect/endSession</code> allows clients to
     terminate end user sessions.</p></li></ul></div><p>For an example, see <a href="../admin-guide/index.html#manage-sessions-openid-connect" class="link"><em class="citetitle">Managing User
   Sessions</em></a>.</p></div></div><div class="section" id="rest-api-self-registration"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.9.&nbsp;User Self-Registration</h2></div></div></div><a class="indexterm" name="d14138e1499"></a><p>The OpenAM REST API for users provides an action for
  self-registration.</p><p>The feature works by sending an email to the user in response to RESTful
  HTTP POST requesting registration with an email address. When the user clicks
  the link received by mail, an application intercepts the HTTP GET,
  transforms the query string values into an HTTP POST to confirm the operation.
  OpenAM responds to the application with a JSON object that the application
  can further use to request creation of the user account to complete the
  transaction.</p><div class="orderedlist"><p>An example follows, showing the steps in more detail.</p><ol class="orderedlist" type="1"><li class="listitem"><p>Configure the Email Service and REST Security.</p><p>In particular, you must configure the Email Service to send mail
    to users who self-register, and you must enable self-registration in the
    REST Security service.</p><p>You can configure these globally in OpenAM Console at Configuration &gt;
    Global &gt; Email Service for notifications and Configuration &gt; Global &gt;
    REST Security to allow self-registration.</p><p>Alternatively, you can configure them for an individual realm under
    Access Control &gt; <em class="replaceable"><code>Realm Name</code></em> &gt; Services.</p></li><li class="listitem"><p>Perform an HTTP POST on <code class="literal">/json/users?_action=register</code>
    with the new user's mail.</p><p>Notice that authentication is not required.</p><pre class="cmdline prettyprint">$ curl
 --request POST --header "Content-Type: application/json"
 --data '{"email":"newuser@example.com"}'
 https://openam.example.com:8443/openam/json/users?_action=register
{}</pre><p>On success, the response is an empty JSON object <code class="literal">{}</code>
    as shown in the example.</p></li><li class="listitem"><p>The user receives an email message that includes a URL as in the
    following example.</p><pre class="literallayout">https://openam.example.com:8443/openam/json/confirmation/register?confirmationId=P23PK5kyAgNdqeNJpAvq1ebcpcg=&amp;email=newuser@example.com&amp;tokenId=+8rWf5O8KG0rfz3Pa+WwDLkH9Ac=</pre></li><li class="listitem"><p>Intercept the HTTP GET request to this URL when the user clicks the
    link.</p><p>Your application must use the confirmation link to construct an HTTP
    POST to <code class="literal">/json/users?_action=confirm</code> from the query string
    parameters as shown in the following example.</p><pre class="cmdline prettyprint">$ curl --request POST --header "Content-Type: application/json"
 --data '{"email":"newuser@example.com",
     "tokenId":"+8rWf5O8KG0rfz3Pa+WwDLkH9Ac=",
     "confirmationId":"P23PK5kyAgNdqeNJpAvq1ebcpcg="}'
 https://openam.example.com:8443/openam/json/users?_action=confirm
{
    "email": "newuser@example.com",
    "tokenId": "+8rWf5O8KG0rfz3Pa+WwDLkH9Ac=",
    "confirmationId": "P23PK5kyAgNdqeNJpAvq1ebcpcg="
}</pre><p>The response is a further confirmation that the account can be
    created.</p></li><li class="listitem"><p>Using the confirmation, your application must make an authenticated
    HTTP POST to <code class="literal">/json/users?_action=anonymousCreate</code> to
    create the user as shown in the following example.</p><pre class="cmdline prettyprint">$ curl --request POST --header "iPlanetDirectoryPro: AQIC5wM...3MTYxOA..*"
 --header "Content-Type: application/json"
 --data '{"email":"newuser@example.com",
     "tokenId":"+8rWf5O8KG0rfz3Pa+WwDLkH9Ac=",
     "confirmationId":"P23PK5kyAgNdqeNJpAvq1ebcpcg=",
     "name":"newuser","userpassword":"password"}'
 https://openam.example.com:8443/openam/json/users?_action=anonymousCreate
{
    "username": "mark",
    "realm": "/",
    "uid": [
        "newuser"
    ],
    "mail": [
        "newuser@example.com"
    ],
    "sn": [
        "newuser"
    ],
    "userPassword": [
        "{SSHA}dAiONYMxqFiNilXeLXUQoDpHlePYtiJcjYw8Dw=="
    ],
    "cn": [
        "newuser"
    ],
    "inetUserStatus": [
        "Active"
    ],
    "dn": [
        "uid=newuser,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "objectClass": [
        "devicePrintProfilesContainer",
        "person",
        "sunIdentityServerLibertyPPService",
        "inetorgperson",
        "sunFederationManagerDataStore",
        "iPlanetPreferences",
        "iplanet-am-auth-configuration-service",
        "organizationalperson",
        "sunFMSAML2NameIdentifier",
        "inetuser",
        "forgerock-am-dashboard-service",
        "iplanet-am-managed-person",
        "iplanet-am-user-service",
        "sunAMAuthAccountLockout",
        "top"
    ],
    "universalid": [
        "id=newuser,ou=user,dc=openam,dc=forgerock,dc=org"
    ]
}</pre></li></ol></div><p>At this point the user is registered, active, and can authenticate
  with OpenAM.</p></div><div class="section" id="rest-api-password-reset"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.10.&nbsp;Resetting Forgotten Passwords</h2></div></div></div><a class="indexterm" name="d14138e1566"></a><p>The OpenAM REST API for users provides an action for handling forgotten
  passwords as long as the user has a valid email address in their profile.</p><p>The option is disabled by default. You can enable it in the OpenAM Console
  globally via Configuration &gt; Global &gt; REST Security.</p><p>Alternatively, you can enable it for an individual realm under
  Access Control &gt; <em class="replaceable"><code>Realm Name</code></em> &gt; Services &gt; Add &gt;
  REST Security.</p><div class="orderedlist"><p>An example follows, showing the steps in more detail.</p><ol class="orderedlist" type="1"><li class="listitem"><p>Configure the Email Service.</p><p>In particular, you must configure the Email Service to send mail
    allowing the user to reset the forgotten password.</p><p>You can configure the service globally in the OpenAM Console via
    Configuration &gt; Global &gt; Email Service.</p><p>Alternatively, you can configure it for an individual realm under
    Access Control &gt; <em class="replaceable"><code>Realm Name</code></em> &gt; Services.</p></li><li class="listitem"><p>Perform an HTTP POST on <code class="literal">/json/users?_action=forgotPassword</code>
    with the user's ID.</p><p>Notice that authentication is not required.</p><pre class="cmdline prettyprint">curl --request POST --header "Content-Type: application/json"
 --data '{"username":"demo"}'
 https://openam.example.com:8443/openam/json/users?_action=forgotPassword
{}</pre><p>On success, the response is an empty JSON object <code class="literal">{}</code>
    as shown in the example.</p></li><li class="listitem"><p>OpenAM looks up the email address in the user profile, and sends an
    email message that includes a URL as in the following example.</p><pre class="literallayout">https://openam.example.com:8443/openam/json/confirmation/forgotPassword?confirmationId=jrUZ3E7CK4UQJM5jnDHGNKH1UaQ=&amp;tokenId=M8cVqWqbKtCtpd/UqEAr0x25fxA=&amp;username=demo</pre></li><li class="listitem"><p>Intercept the HTTP GET request to this URL when the user clicks the
    link.</p><p>Your application must use the confirmation link to construct an HTTP
    POST to <code class="literal">/json/users?_action=forgotPasswordReset</code> from the
    query string parameters as shown in the following example.</p><p>Your POST includes the new password as the value of the "userpassword"
    field in the JSON payload.</p><pre class="cmdline prettyprint">$ curl --request POST --header "Content-Type: application/json"
 --data '{"username":"demo",
     "userpassword":"password",
     "tokenId":"M8cVqWqbKtCtpd/UqEAr0x25fxA=",
     "confirmationId":"jrUZ3E7CK4UQJM5jnDHGNKH1UaQ="}'
 https://openam.example.com:8443/openam/json/users?_action=forgotPasswordReset
{
    "name": "demo",
    "realm": "/",
    "uid": [
        "demo"
    ],
    "mail": [
        "demo@example.com"
    ],
    "sn": [
        "demo"
    ],
    "userPassword": [
        "{SSHA}zgeBu4yOAy1i9QAgnldMCzW8LWX36ViVj9leig=="
    ],
    "cn": [
        "demo"
    ],
    "inetUserStatus": [
        "Active"
    ],
    "objectClass": [
        "devicePrintProfilesContainer",
        "person",
        "sunIdentityServerLibertyPPService",
        "inetorgperson",
        "sunFederationManagerDataStore",
        "iPlanetPreferences",
        "iplanet-am-auth-configuration-service",
        "organizationalperson",
        "sunFMSAML2NameIdentifier",
        "inetuser",
        "forgerock-am-dashboard-service",
        "iplanet-am-managed-person",
        "iplanet-am-user-service",
        "sunAMAuthAccountLockout",
        "top"
    ],
    "universalid": [
        "id=demo,ou=user,dc=openam,dc=forgerock,dc=org"
    ]
}</pre><p>On success, the response is the JSON representation of the user
    profile with the new password hashed according to the password storage
    scheme for the identity repository.</p></li></ol></div><p>At this point the user can authenticate with the new password.</p></div><div class="section" id="rest-api-logging"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.11.&nbsp;Logging</h2></div></div></div><p>You can send OpenAM messages to log, specifying the message content
  and the log file in which to write your message.</p><pre class="cmdline prettyprint">$ curl "https://openam.example.com:8443/openam/identity/log?
 appid=AQIC5wM2LY4SfcwyCZkk-1JXzx6q1EzgagabHfBjMidb5jI.*AAJTSQACMDE.*
 &amp;subjectid=AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*
 &amp;logname=rest.access
 &amp;message=Hello%20World"</pre><p>Logging takes a valid <code class="literal">appid</code> token for the subject
  with access to log the message, and also a <code class="literal">subjectid</code> token
  for the user whom the message concerns. If the tokens are valid and the
  access rights correct, your message ends up in the log specified.</p><pre class="cmdline prettyprint">$ cat openam/openam/log/rest.access 
#Version: 1.0
#Fields: time   Data    LoginID ContextID   IPAddr  LogLevel    Domain 
 LoggedBy    MessageID   ModuleName  NameID  HostName    
"2011-09-14 16:38:17"   /home/mark/openam/openam/log/
   "cn=dsameuser,ou=DSAME Users,o=openam"  aa307b2dcb721d4201
   "Not Available" INFO    o=openam    "cn=dsameuser,ou=DSAME Users,o=openam"
   LOG-1   rest.access "Not Available"192.168.56.2 
"2011-09-14 16:38:17"   "Hello World"   id=bjensen,ou=user,o=openam
   8a4025a2b3af291d01  "Not Available" INFO    o=openam
   id=amadmin,ou=user,o=openam "Not Available" rest.access "Not Available"
   192.168.56.2</pre></div><div class="section" id="rest-api-crud-identity"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.12.&nbsp;Identity Management</h2></div></div></div><a class="indexterm" name="d14138e1650"></a><p>This section shows how to create, read, update, delete, and list
  identities using the RESTful APIs.</p><div class="panel panel-primary"><div class="panel-heading"><h3 class="panel-title">Important</h3></div><div class="panel-body"><p>OpenAM is not primarily an identity data store, nor is it provisioning
   software. For storing identity data, consider <a class="link" href="http://forgerock.com/what-we-offer/open-identity-stack/opendj/" target="_blank">OpenDJ</a>.
   For provisioning, consider <a class="link" href="http://forgerock.com/what-we-offer/open-identity-stack/openidm/" target="_blank">OpenIDM</a>.
   Both of these products provide REST APIs as well.</p></div></div><div class="itemizedlist"><p>OpenAM has two REST APIs for managing identities.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Under the <code class="literal">/json/agents</code>,
    <code class="literal">/json/groups</code>, and <code class="literal">/json/users</code>,
    you find the newer JSON-based APIs. The newer APIs follow the ForgeRock
    common REST pattern creating, reading, updating, deleting, and querying
    resources.</p><p>Examples in this section do not repeat the authentication shown
    in <a class="xref" href="#rest-api-auth" title="3.3.&nbsp;Authentication &amp; Logout">Section&nbsp;3.3, &#8220;Authentication &amp; Logout&#8221;</a>. For browser-based clients, you
    can rely on OpenAM cookies rather than construct the header in your
    application. Managing agent profiles, groups, realms, and users with
    these APIs of course require authorization. The examples shown in this
    section were performed with the token ID gained after authenticating
    as OpenAM administrator.</p><p>Although the examples here show user management, you can use
    <code class="literal">/json/agents</code>, <code class="literal">/json/groups</code>,
    <code class="literal">/json/realms</code> in similar fashion. See
    <a class="xref" href="#rest-api-crud-realm" title="3.13.&nbsp;Realm Management">Section&nbsp;3.13, &#8220;Realm Management&#8221;</a> for examples related to realms.</p><div class="itemizedlist"><p>The following sections cover this JSON-based API.</p><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><a class="xref" href="#rest-api-create-identity" title="3.12.1.&nbsp;Creating Identities">Section&nbsp;3.12.1, &#8220;Creating Identities&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#rest-api-read-identity" title="3.12.2.&nbsp;Reading Identities">Section&nbsp;3.12.2, &#8220;Reading Identities&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#rest-api-update-identity" title="3.12.3.&nbsp;Updating Identities">Section&nbsp;3.12.3, &#8220;Updating Identities&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#rest-api-delete-identity" title="3.12.4.&nbsp;Deleting Identities">Section&nbsp;3.12.4, &#8220;Deleting Identities&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#rest-api-query-identity" title="3.12.5.&nbsp;Listing Identities">Section&nbsp;3.12.5, &#8220;Listing Identities&#8221;</a></p></li></ul></div></li><li class="listitem"><p>Under the <code class="literal">/identity</code> endpoint, you find the
    backwards-compatible, legacy API.</p><div class="itemizedlist"><p>The following sections cover this backwards-compatible API.</p><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><a class="xref" href="#rest-api-create-legacy" title="3.12.6.&nbsp;Creating Identities (Legacy API)">Section&nbsp;3.12.6, &#8220;Creating Identities (Legacy API)&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#rest-api-read-legacy" title="3.12.7.&nbsp;Reading &amp; Searching for Identities (Legacy API)">Section&nbsp;3.12.7, &#8220;Reading &amp; Searching for Identities (Legacy API)&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#rest-api-update-legacy" title="3.12.8.&nbsp;Updating Identities (Legacy API)">Section&nbsp;3.12.8, &#8220;Updating Identities (Legacy API)&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#rest-api-delete-legacy" title="3.12.9.&nbsp;Deleting Identities (Legacy API)">Section&nbsp;3.12.9, &#8220;Deleting Identities (Legacy API)&#8221;</a></p></li></ul></div></li></ul></div><div class="section" id="rest-api-create-identity"><div class="titlepage"><div><div><h3 class="title">3.12.1.&nbsp;Creating Identities</h3></div></div></div><p>OpenAM lets administrators create a user profile by making 
   an HTTP POST of the JSON representation of the profile to
   <code class="literal">/json/<em class="replaceable"><code>subrealm</code></em>/users/?_action=create</code>.
   To add a user to the Top Level Realm, you do not need to specify the realm.</p><p>The following example shows an administrator creating a new user. The
   only required fields are <code class="literal">username</code> and
   <code class="literal">userpassword</code>. If no other name is provided, the entry
   you make for <code class="literal">username</code> defaults to both the user id and the
   user's last name.</p><pre class="cmdline prettyprint">$ curl --request POST --header "iplanetDirectoryPro: AQIC5w...2NzEz*"
 --header "Content-Type: application/json"
 --data '{ "username": "bjensen", "userpassword": "secret12",
           "mail": "bjensen@example.com" }'
 https://openam.example.com:8443/openam/json/users/?_action=create
{
    "username": "bjensen",
    "realm": "/",
    "uid": [
        "bjensen"
    ],
    "mail": [
        "bjensen@example.com"
    ],
    "sn": [
        "bjensen"
    ],
    "userpassword": [
        "{SSHA}0pXpKLPRKCGY7g3YqZygJmKMW6IC2BLJimmlwg=="
    ],
    "cn": [
        "bjensen"
    ],
    "inetuserstatus": [
        "Active"
    ],
    "dn": [
        "uid=bjensen,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "objectclass": [
        "person",
        "sunIdentityServerLibertyPPService",
        "sunFederationManagerDataStore",
        "inetorgperson",
        "iPlanetPreferences",
        "iplanet-am-auth-configuration-service",
        "organizationalperson",
        "sunFMSAML2NameIdentifier",
        "inetuser",
        "iplanet-am-managed-person",
        "sunAMAuthAccountLockout",
        "iplanet-am-user-service",
        "top"
    ],
    "universalid": [
        "id=bjensen,ou=user,dc=openam,dc=forgerock,dc=org"
    ]
}</pre><p>Alternatively, administrators can create user profiles with specific
    user IDs by doing an HTTP PUT of the JSON representation of the changes to
    <code class="literal">/json/users/<em class="replaceable"><code>user-id</code></em></code>, as
    shown in the following example.</p><pre class="cmdline prettyprint">$ curl --request PUT --header "iplanetDirectoryPro: AQIC5w...2NzEz*"
 --header "Content-Type: application/json" --header "If-None-Match: *"
 --data '{ "username": "janedoe" userpassword": "secret12", "mail": "janedoe@example.com" }'
 https://openam.example.com:8443/openam/json/users/janedoe
{
    "username": "janedoe",
    "realm": "/",
    "uid": [
        "janedoe"
    ],
    "mail": [
        "janedoe@example.com"
    ],
    "sn": [
        "janedoe"
    ],
    "userpassword": [
        "{SSHA}e4DJoxvYVW/nsp62XJf29ZADE16YQgrxK+XuKA=="
    ],
    "cn": [
        "janedoe"
    ],
    "inetuserstatus": [
        "Active"
    ],
    "dn": [
        "uid=janedoe,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "objectclass": [
        "devicePrintProfilesContainer",
        "person",
        "sunIdentityServerLibertyPPService",
        "inetorgperson",
        "sunFederationManagerDataStore",
        "iPlanetPreferences",
        "iplanet-am-auth-configuration-service",
        "organizationalperson",
        "sunFMSAML2NameIdentifier",
        "inetuser",
        "forgerock-am-dashboard-service",
        "iplanet-am-managed-person",
        "iplanet-am-user-service",
        "sunAMAuthAccountLockout",
        "top"
    ],
    "universalid": [
        "id=janedoe,ou=user,dc=openam,dc=forgerock,dc=org"
    ]
}</pre><p>As shown in the examples, OpenAM returns the JSON representation of
   the profile on successful creation. On failure, OpenAM returns a JSON
   representation of the error including the
   <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>.</p><p>The same HTTP POST and PUT mechanisms also work for other objects
   such as policy agent profiles and groups.</p><pre class="cmdline prettyprint">$ curl --request POST --header "iPlanetDirectoryPro: AQIC5w...2NzEz*"
 --header "Content-Type: application/json"
 --data '{"name":"myWebAgent","realm":"/",
  "com.sun.identity.agents.config.fqdn.default":["www.example.com"],
  "sunidentityserverdevicekeyvalue":["agentRootURL=http://www.example.com:80/"],
  "com.sun.identity.agents.config.remote.logfile":["amAgent_www_example_com_80.log"],
  "com.sun.identity.agents.config.repository.location":["centralized"],
  "agenttype":["WebAgent"],
  "com.sun.identity.agents.config.cdsso.cdcservlet.url":
  ["[0]=https://openam.example.com:8443/openam/cdcservlet"],
  "com.sun.identity.client.notification.url":
  ["http://www.example.com:80/UpdateAgentCacheServlet?shortcircuit=false"],
  "com.sun.identity.agents.config.agenturi.prefix":
  ["http://www.example.com:80/amagent"],
  "userpassword":["password"],
  "com.sun.identity.agents.config.login.url":
  ["[0]=https://openam.example.com:8443/openam/UI/Login"],
  "com.sun.identity.agents.config.logout.url":
  ["[0]=https://openam.example.com:8443/openam/UI/Logout"],
  "sunidentityserverdevicestatus":["Active"]}'
 https://openam.example.com:8443/openam/json/agents/?_action=create
{
    "name": "myWebAgent",
    "realm": "/",
    "com.sun.identity.agents.config.cdsso.enable": [
        "false"
    ],
    "com.sun.identity.agents.config.cdsso.cookie.domain": [
        "[0]="
    ],
    "com.sun.identity.agents.config.get.client.host.name": [
        "false"
    ],
    "com.sun.identity.agents.config.profile.attribute.fetch.mode": [
        "NONE"
    ],
    "com.sun.identity.agents.config.notenforced.ip": [
        "[0]="
    ],
    "com.sun.identity.agents.config.fqdn.check.enable": [
        "true"
    ],
    "com.sun.identity.agents.config.cleanup.interval": [
        "30"
    ],
    "com.sun.identity.agents.config.notenforced.url.attributes.enable": [
        "false"
    ],
    "com.sun.identity.agents.config.ignore.preferred.naming.url": [
        "true"
    ],
    "com.sun.identity.agents.config.client.ip.header": [],
    "com.sun.identity.agents.config.session.attribute.mapping": [
        "[]="
    ],
    "com.sun.identity.agents.config.audit.accesstype": [
        "LOG_NONE"
    ],
    "com.sun.identity.agents.config.proxy.override.host.port": [
        "false"
    ],
    "com.sun.identity.agents.config.load.balancer.enable": [
        "false"
    ],
    "com.sun.identity.agents.config.encode.url.special.chars.enable": [
        "false"
    ],
    "com.sun.identity.agents.config.convert.mbyte.enable": [
        "false"
    ],
    "com.sun.identity.agents.config.domino.check.name.database": [
        "false"
    ],
    "com.sun.identity.agents.config.iis.owa.enable": [
        "false"
    ],
    "com.sun.identity.agents.config.override.port": [
        "false"
    ],
    "com.sun.identity.agents.config.policy.clock.skew": [
        "0"
    ],
    "com.sun.identity.agents.config.sso.only": [
        "false"
    ],
    "com.sun.identity.agents.config.iis.owa.enable.session.timeout.url": [],
    "com.sun.identity.agents.config.domino.ltpa.config.name": [
        "LtpaToken"
    ],
    "com.sun.identity.agents.config.cookie.reset": [
        "[0]="
    ],
    "com.sun.identity.agents.config.fqdn.default": [
        "www.example.com"
    ],
    "sunIdentityServerDeviceKeyValue": [
        "agentRootURL=http://www.example.com:80/"
    ],
    "com.sun.identity.agents.config.domino.ltpa.cookie.name": [
        "LtpaToken"
    ],
    "com.sun.identity.agents.config.iis.password.header": [
        "false"
    ],
    "com.sun.identity.agents.config.response.attribute.mapping": [
        "[]="
    ],
    "com.sun.identity.agents.config.userid.param.type": [
        "session"
    ],
    "com.sun.identity.agents.config.url.comparison.case.ignore": [
        "true"
    ],
    "com.sun.identity.agents.config.profile.attribute.cookie.maxage": [
        "300"
    ],
    "com.sun.identity.agents.config.remote.logfile": [
        "amAgent_www_example_com_80.log"
    ],
    "com.sun.identity.agents.config.domino.ltpa.enable": [
        "false"
    ],
    "com.sun.identity.agents.config.notenforced.url": [
        "[0]="
    ],
    "com.sun.identity.agents.config.notification.enable": [
        "true"
    ],
    "com.sun.identity.agents.config.profile.attribute.cookie.prefix": [
        "HTTP_"
    ],
    "com.sun.identity.agents.config.logout.cookie.reset": [
        "[0]="
    ],
    "com.sun.identity.agents.config.polling.interval": [
        "60"
    ],
    "com.sun.identity.agents.config.attribute.multi.value.separator": [
        "|"
    ],
    "com.sun.identity.agents.config.debug.file.rotate": [
        "true"
    ],
    "com.sun.identity.agents.config.debug.level": [
        "Error"
    ],
    "com.sun.identity.agents.config.local.log.rotate": [
        "false"
    ],
    "com.sun.identity.agents.config.repository.location": [
        "centralized"
    ],
    "com.sun.identity.agents.config.client.ip.validation.enable": [
        "false"
    ],
    "com.sun.identity.agents.config.override.protocol": [
        "false"
    ],
    "AgentType": [
        "WebAgent"
    ],
    "com.sun.identity.agents.config.logout.redirect.url": [],
    "com.sun.identity.agents.config.ignore.path.info": [
        "false"
    ],
    "com.sun.identity.agents.config.override.notification.url": [
        "false"
    ],
    "com.sun.identity.agents.config.session.attribute.fetch.mode": [
        "NONE"
    ],
    "com.sun.identity.agents.config.policy.cache.polling.interval": [
        "3"
    ],
    "com.sun.identity.agents.config.cdsso.cdcservlet.url": [
        "[0]=https://openam.example.com:8443/openam/cdcservlet"
    ],
    "com.sun.identity.agents.config.cookie.name": [
        "iPlanetDirectoryPro"
    ],
    "com.sun.identity.agents.config.profile.attribute.mapping": [
        "[]="
    ],
    "com.sun.identity.agents.config.iis.filter.priority": [
        "HIGH"
    ],
    "com.sun.identity.agents.config.iis.auth.type": [],
    "com.sun.identity.client.notification.url": [
        "http://www.example.com:80/UpdateAgentCacheServlet?shortcircuit=false"
    ],
    "com.sun.identity.agents.config.cookie.secure": [
        "false"
    ],
    "com.sun.identity.agents.config.ignore.path.info.for.not.enforced.list": [
        "true"
    ],
    "com.sun.identity.agents.config.remote.log.interval": [
        "5"
    ],
    "com.sun.identity.agents.config.notenforced.url.invert": [
        "false"
    ],
    "universalid": [
        "id=myWebAgent,ou=agent,dc=openam,dc=forgerock,dc=org"
    ],
    "com.sun.identity.agents.config.replaypasswd.key": [],
    "com.sun.identity.agents.config.iis.owa.enable.change.protocol": [
        "false"
    ],
    "com.sun.identity.agents.config.userid.param": [
        "UserToken"
    ],
    "userpassword": [
        "{SHA-1}W6ph5Mm5Pz8GgiULbPgzG37mj9g="
    ],
    "com.sun.identity.agents.config.response.attribute.fetch.mode": [
        "NONE"
    ],
    "com.sun.identity.agents.config.freeformproperties": [
        "sunidentityserverdevicestatus=Active",
        "sunidentityserverdevicekeyvalue=agentRootURL=http://www.example.com:80/",
        "realm=/",
        "name=myWebAgent"
    ],
    "com.sun.identity.agents.config.postdata.preserve.enable": [
        "false"
    ],
    "com.sun.identity.agents.config.log.disposition": [
        "REMOTE"
    ],
    "com.sun.identity.agents.config.agenturi.prefix": [
        "http://www.example.com:80/amagent"
    ],
    "com.sun.identity.agents.config.override.host": [
        "false"
    ],
    "com.sun.identity.agents.config.cookie.reset.enable": [
        "false"
    ],
    "com.sun.identity.agents.config.local.log.size": [
        "52428800"
    ],
    "com.sun.identity.agents.config.access.denied.url": [],
    "com.sun.identity.agents.config.debug.file.size": [
        "10000000"
    ],
    "com.sun.identity.agents.config.change.notification.enable": [
        "true"
    ],
    "com.sun.identity.agents.config.anonymous.user.enable": [
        "false"
    ],
    "com.sun.identity.agents.config.domino.ltpa.org.name": [],
    "com.sun.identity.agents.config.agent.logout.url": [
        "[0]="
    ],
    "com.sun.identity.agents.config.poll.primary.server": [
        "5"
    ],
    "com.sun.identity.agents.config.fqdn.mapping": [
        "[]="
    ],
    "com.sun.identity.agents.config.auth.connection.timeout": [
        "2"
    ],
    "com.sun.identity.agents.config.client.hostname.header": [],
    "com.sun.identity.agents.config.iis.logonuser": [
        "false"
    ],
    "com.sun.identity.agents.config.ignore.server.check": [
        "false"
    ],
    "com.sun.identity.agents.config.fetch.from.root.resource": [
        "false"
    ],
    "com.sun.identity.agents.config.login.url": [
        "[0]=https://openam.example.com:8443/openam/UI/Login"
    ],
    "com.sun.identity.agents.config.redirect.param": [
        "goto"
    ],
    "com.sun.identity.agents.config.logout.url": [
        "[0]=https://openam.example.com:8443/openam/UI/Logout"
    ],
    "sunIdentityServerDeviceStatus": [
        "Active"
    ],
    "com.sun.identity.agents.config.sso.cache.polling.interval": [
        "3"
    ],
    "com.sun.identity.agents.config.anonymous.user.id": [
        "anonymous"
    ],
    "com.sun.identity.agents.config.encode.cookie.special.chars.enable": [
        "false"
    ],
    "com.sun.identity.agents.config.locale": [
        "en_US"
    ],
    "com.sun.identity.agents.config.postcache.entry.lifetime": [
        "10"
    ]
}</pre><pre class="cmdline prettyprint">$ curl --request POST --header "iPlanetDirectoryPro: AQIC5w...2NzEz*"
 --header "Content-Type: application/json"
 --data '{"name":"newGroup","realm":"/",
    "uniquemember":["uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"]}'
 "https://openam.example.com:8443/openam/json/groups?_action=create"
{
    "name": "newGroup",
    "realm": "/",
    "uniqueMember": [
        "uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "cn": [
        "newGroup"
    ],
    "objectclass": [
        "groupofuniquenames",
        "top"
    ],
    "universalid": [
        "id=newGroup,ou=group,dc=openam,dc=forgerock,dc=org"
    ]
}

$ curl --request PUT --header "If-None-Match: *"
 --header "iPlanetDirectoryPro: AQIC5w...2NzEz*"
 --header "Content-Type: application/json"
 --data '{"name":"anotherGroup","realm":"/",
    "uniquemember":["uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"]}'
 https://openam.example.com:8443/openam/json/groups/anotherGroup
{
    "name": "anotherGroup",
    "realm": "/",
    "uniqueMember": [
        "uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "cn": [
        "anotherGroup"
    ],
    "objectclass": [
        "groupofuniquenames",
        "top"
    ],
    "universalid": [
        "id=anotherGroup,ou=group,dc=openam,dc=forgerock,dc=org"
    ]
}</pre></div><div class="section" id="rest-api-read-identity"><div class="titlepage"><div><div><h3 class="title">3.12.2.&nbsp;Reading Identities</h3></div></div></div><p>OpenAM lets users and administrators read profiles by requesting an HTTP
   GET on <code class="literal">/json/<em class="replaceable"><code>subrealm</code></em>/users/<em class="replaceable"><code>user-id</code></em></code>.
   This allows users and administrators to verify user data, status, and directory.
   If users or administrators see missing or incorrect information, they can write 
   down the correct information and add it using <a class="xref" href="#rest-api-update-identity" title="3.12.3.&nbsp;Updating Identities">Section&nbsp;3.12.3, &#8220;Updating Identities&#8221;</a>.
   To read a profile on the Top Level Realm, you do not need to specify the realm.</p><p>Users can review the data associated with their accounts and administrators 
   can read other user's profiles. The following example shows an administrator 
   accessing user data. Users can view their information by changing
   <code class="literal">username=amadmin</code> to <code class="literal"><em class="replaceable"><code>user-id</code></em></code>.</p><pre class="cmdline prettyprint">$ curl --header "iplanetDirectoryPro: AQIC5w...2NzEz*"
 https://openam.example.com:8443/openam/json/users/demo
{
    "username": "demo",
    "realm": "/",
    "uid": [
        "demo"
    ],
    "sn": [
        "demo"
    ],
    "userpassword": [
        "{SSHA}S14oR2gusLWtiDkAS4twj63slXNNaMKpwrOWdw=="
    ],
    "cn": [
        "demo"
    ],
    "inetuserstatus": [
        "Active"
    ],
    "dn": [
        "uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "objectclass": [
        "person",
        "sunIdentityServerLibertyPPService",
        "sunFederationManagerDataStore",
        "inetorgperson",
        "iPlanetPreferences",
        "iplanet-am-auth-configuration-service",
        "organizationalperson",
        "sunFMSAML2NameIdentifier",
        "inetuser",
        "iplanet-am-managed-person",
        "sunAMAuthAccountLockout",
        "iplanet-am-user-service",
        "top"
    ],
    "universalid": [
        "id=demo,ou=user,dc=openam,dc=forgerock,dc=org"
    ]
}</pre><p>Use the <code class="literal">_fields</code> query string parameter to restrict
   the list of attributes returned. This parameter takes a comma-separated list
   of JSON object fields to include in the result.</p><pre class="cmdline prettyprint">$ curl --header "iPlanetDirectoryPro: AQIC5w...2NzEz*"
 https://openam.example.com:8443/openam/json/users/demo?_fields=name,uid
{"name":"demo","uid":["demo"]}</pre><p>As shown in the examples, OpenAM returns the JSON representation of the
   profile on success. On failure, OpenAM returns a JSON representation of the
   error including the
   <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>.</p><p>Using HTTP GET to read also works for other objects such as agent
   profiles and groups.</p><pre class="cmdline prettyprint">$ curl --header "iplanetDirectoryPro: AQIC5w...2NzEz*"
 https://openam.example.com:8443/openam/json/agents/myClientID
{
    "name": "myClientID",
    "realm": "/",
    "com.forgerock.openam.oauth2provider.accessToken": [],
    "com.forgerock.openam.oauth2provider.clientSessionURI": [],
    "com.forgerock.openam.oauth2provider.subjectType": [
        "Pairwise"
    ],
    "com.forgerock.openam.oauth2provider.defaultScopes": [
        "[1]=profile",
        "[0]=openid"
    ],
    "com.forgerock.openam.oauth2provider.clientType": [
        "Confidential"
    ],
    "universalid": [
        "id=myClientID,ou=agent,dc=openam,dc=forgerock,dc=org"
    ],
    "userpassword": [
        "{SHA-1}W6ph5Mm5Pz8GgiULbPgzG37mj9g="
    ],
    "com.forgerock.openam.oauth2provider.name": [
        "[0]="
    ],
    "com.forgerock.openam.oauth2provider.redirectionURIs": [
        "[1]=https://openam.example.com:8443/openid/cb-implicit.html",
        "[0]=https://openam.example.com:8443/openid/cb-basic.html"
    ],
    "com.forgerock.openam.oauth2provider.scopes": [
        "[1]=profile",
        "[0]=openid"
    ],
    "com.forgerock.openam.oauth2provider.idTokenSignedResponseAlg": [
        "HmacSHA256"
    ],
    "com.forgerock.openam.oauth2provider.postLogoutRedirectURI": [],
    "sunIdentityServerDeviceStatus": [
        "Active"
    ],
    "AgentType": [
        "OAuth2Client"
    ],
    "com.forgerock.openam.oauth2provider.description": [
        "[0]="
    ]
}</pre><p>The <code class="literal">_prettyPrint</code> query string parameter can make
   the resulting JSON easier to read when you are viewing the resulting JSON
   directly.</p><pre class="cmdline prettyprint">$ curl --header "iPlanetDirectoryPro: AQIC5w...2NzEz*"
 "https://openam.example.com:8443/openam/json/groups/myGroup?_prettyPrint=true"
{
  "name" : "myGroup",
  "realm" : "/",
  "uniquemember" : [ "uid=demo,ou=people,dc=openam,dc=forgerock,dc=org" ],
  "cn" : [ "myGroup" ],
  "objectclass" : [ "groupofuniquenames", "top" ],
  "universalid" : [ "id=myGroup,ou=group,dc=openam,dc=forgerock,dc=org" ]
}</pre></div><div class="section" id="rest-api-update-identity"><div class="titlepage"><div><div><h3 class="title">3.12.3.&nbsp;Updating Identities</h3></div></div></div><p>OpenAM lets users update their own profiles, and lets administrators
   update other users' profiles. To update an identity do an HTTP PUT of the JSON 
   representation of the changes to <code class="literal">/json/<em class="replaceable"><code>subrealm</code></em>/users/<em class="replaceable"><code>user-id</code></em></code>.
   To update a profile on the Top Level Realm, you do not need to specify the realm.</p><p>The following example shows how users can update their own
    profiles.</p><pre class="cmdline prettyprint">$ curl --request PUT --header "iplanetDirectoryPro: AQIC5...Y3MTAx*"
 --header "Content-Type: application/json"
 --data '{ "mail": "demo@example.com" }'
 https://openam.example.com:8443/openam/json/users/demo
{
    "username": "demo",
    "realm": "/",
    "uid": [
        "demo"
    ],
    "mail": [
        "demo@example.com"
    ],
    "sn": [
        "demo"
    ],
    "userpassword": [
        "{SSHA}S14oR2gusLWtiDkAS4twj63slXNNaMKpwrOWdw=="
    ],
    "cn": [
        "demo"
    ],
    "inetuserstatus": [
        "Active"
    ],
    "dn": [
        "uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "objectclass": [
        "person",
        "sunIdentityServerLibertyPPService",
        "sunFederationManagerDataStore",
        "inetorgperson",
        "iPlanetPreferences",
        "iplanet-am-auth-configuration-service",
        "organizationalperson",
        "sunFMSAML2NameIdentifier",
        "inetuser",
        "iplanet-am-managed-person",
        "sunAMAuthAccountLockout",
        "iplanet-am-user-service",
        "top"
    ],
    "universalid": [
        "id=demo,ou=user,dc=openam,dc=forgerock,dc=org"
    ]
}</pre><p>As shown in the example, OpenAM returns the JSON representation of the
   profile on success. On failure, OpenAM returns a JSON representation of the
   error including the
   <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>.</p><p>You can use HTTP PUT to update other objects as well, such as policy
   agent profiles groups.</p><pre class="cmdline prettyprint">$ curl --request PUT --header "iPlanetDirectoryPro: AQIC5...Y3MTAx*"
 --header "Content-Type: application/json"
 --data '{"name":"masterClient","realm":"/","accesstoken":[],
    "clientsessionuri":[],"subjecttype":["Pairwise"],
    "defaultscopes":["[0]=openid"],"clienttype":["Confidential"],
    "universalid":["id=masterClient,ou=agent,dc=openam,dc=forgerock,dc=org"],
    "userpassword":"changeit","name":["[0]="],"redirectionuris":["[0]="],
    "idtokensignedresponsealg":["HmacSHA512"],"scopes":["[0]=openid"],
    "postlogoutredirecturi":[],"sunidentityserverdevicestatus":["Active"],
    "agenttype":["OAuth2Client"],"description":["[0]="]}'
 https://openam.example.com:8443/openam/json/agents/masterClient
{
    "name": "masterClient",
    "realm": "/",
    "com.forgerock.openam.oauth2provider.accesstoken": [],
    "com.forgerock.openam.oauth2provider.clientsessionuri": [],
    "com.forgerock.openam.oauth2provider.subjecttype": [
        "Pairwise"
    ],
    "com.forgerock.openam.oauth2provider.defaultscopes": [
        "[0]="
    ],
    "com.forgerock.openam.oauth2provider.clienttype": [
        "Confidential"
    ],
    "universalid": [
        "id=masterClient,ou=agent,dc=openam,dc=forgerock,dc=org"
    ],
    "userpassword": [
        "{SHA-1}W6ph5Mm5Pz8GgiULbPgzG37mj9g="
    ],
    "com.forgerock.openam.oauth2provider.name": [
        "[0]="
    ],
    "com.forgerock.openam.oauth2provider.redirectionuris": [
        "[0]="
    ],
    "com.forgerock.openam.oauth2provider.idtokensignedresponsealg": [
        "HmacSHA256"
    ],
    "com.forgerock.openam.oauth2provider.scopes": [
        "[0]="
    ],
    "com.forgerock.openam.oauth2provider.postlogoutredirecturi": [],
    "sunidentityserverdevicestatus": [
        "Active"
    ],
    "agenttype": [
        "OAuth2Client"
    ],
    "com.forgerock.openam.oauth2provider.description": [
        "[0]="
    ]
}</pre><p>Notice in the following example that updates <code class="literal">myGroup</code>
   the object class value is not included in the JSON sent to OpenAM.</p><pre class="cmdline prettyprint">$ curl --request PUT --header "iPlanetDirectoryPro: AQIC5...Y3MTAx*"
 --header "Content-Type: application/json"
 --data '{"name":"myGroup","realm":"/",
    "uniquemember":["uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"],
    "cn":["myGroup"],"description":["Updated the group"]}'
    https://openam.example.com:8443/openam/json/groups/myGroup
{
    "name": "myGroup",
    "realm": "/",
    "uniqueMember": [
        "uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "cn": [
        "myGroup"
    ],
    "dn": [
        "cn=myGroup,ou=groups,dc=openam,dc=forgerock,dc=org"
    ],
    "objectclass": [
        "groupofuniquenames",
        "top"
    ],
    "universalid": [
        "id=myGroup,ou=group,dc=openam,dc=forgerock,dc=org"
    ]
}
</pre></div><div class="section" id="rest-api-delete-identity"><div class="titlepage"><div><div><h3 class="title">3.12.4.&nbsp;Deleting Identities</h3></div></div></div><p>OpenAM lets administrators delete a user profile by making an HTTP DELETE 
   call to <code class="literal">/json/<em class="replaceable"><code>subrealm</code></em>/users/<em class="replaceable"><code>user-id</code></em></code>.
   To delete a user from the Top Level Realm, you do not need to specify the realm.</p><p>The following example removes a user from the top level
   realm. Only administrators should delete users. The user id is the only
   field required to delete a user.</p><pre class="cmdline prettyprint">$ curl --request DELETE --header "iplanetDirectoryPro: AQIC5w...2NzEz*"
 https://openam.example.com:8443/openam/json/users/bjensen
{"success":"true"}</pre><p>On success, OpenAM returns a JSON object indicating success. On
   failure, OpenAM returns a JSON representation of the error including the
   <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>.</p><p>You can use this same logic for other resources such as performing an
   HTTP DELETE of an agent profile or of a group.</p><pre class="cmdline prettyprint">$ curl --request DELETE --header "iplanetDirectoryPro: AQIC5w...2NzEz*"
 https://openam.example.com:8443/openam/json/agents/myOAuth2ClientAgent
{"success":"true"}</pre><pre class="cmdline prettyprint">$ curl --request DELETE --header "iPlanetDirectoryPro: AQIC5w...2NzEz*"
 https://openam.example.com:8443/openam/json/groups/myGroup
{"success":"true"}</pre></div><div class="section" id="rest-api-query-identity"><div class="titlepage"><div><div><h3 class="title">3.12.5.&nbsp;Listing Identities</h3></div></div></div><p>OpenAM lets administrators list identities by making an HTTP GET
   call to <code class="literal">/json/<em class="replaceable"><code>subrealm</code></em>/users/?_queryId=*</code>. To query the Top Level Realm, you do not need
   to specify the realm.</p><pre class="cmdline prettyprint">$ curl --header "iPlanetDirectoryPro: AQIC5w...2NzEz*"
 "https://openam.example.com:8443/openam/json/users?_queryID=*"
{
  "result" : [ "amAdmin", "demo", "anonymous" ],
  "resultCount" : 3,
  "pagedResultsCookie" : null,
  "remainingPagedResults" : -1
}</pre><p>This also works for other types of objects, such as agent profiles and
   groups.</p><pre class="cmdline prettyprint">$ curl --header "iPlanetDirectoryPro: AQIC5w...2NzEz*"
 "https://openam.example.com:8443/openam/json/agents?_queryID=*"
{
  "result" : [ "wsp", "wsc", "agentAuth", "SecurityTokenService" ],
  "resultCount" : 4,
  "pagedResultsCookie" : null,
  "remainingPagedResults" : -1
}</pre><pre class="cmdline prettyprint">$ curl --header "iPlanetDirectoryPro: AQIC5w...2NzEz*"
 "https://openam.example.com:8443/openam/json/groups?_queryID=*"
{
  "result" : [ "myOtherGroup", "myGroup" ],
  "resultCount" : 2,
  "pagedResultsCookie" : null,
  "remainingPagedResults" : -1
}</pre><p>As the result lists include all objects, this capability to list
   identity names is mainly useful in testing.</p><p>As shown in the examples, OpenAM returns the JSON representation of
   the resource list if successful. On failure, OpenAM returns a JSON
   representation of the error including the
   <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>.</p></div><div class="section" id="rest-api-create-legacy"><div class="titlepage"><div><div><h3 class="title">3.12.6.&nbsp;Creating Identities (Legacy API)</h3></div></div></div><p>Interface Stability: <a href="../admin-guide/index.html#interface-stability" class="link">Deprecated</a></p><p>OpenAM lets you create user profiles, and also create web and J2EE
   policy agent profiles. When you create an entry, you must provide the
   following parameters.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">admin</span></dt><dd><p>Valid token for the user with permissions to add the identity</p></dd><dt><span class="term">identity_name</span></dt><dd><p>A unique name for the identity to create</p></dd><dt><span class="term">identity_attribute_names</span></dt><dd><p>LDAP attribute names for attributes to create</p></dd><dt><span class="term">identity_attribute_values_<em class="replaceable"><code>name</code></em></span></dt><dd><p>LDAP attribute values for the identity to create. For example,
      <code class="literal">identity_attribute_names=sn&amp;identity_attribute_values_sn=Jensen</code>.</p></dd><dt><span class="term">identity_realm</span></dt><dd><p>The realm in which to create the identity</p></dd><dt><span class="term">identity_type</span></dt><dd><p>Either <code class="literal">user</code> or <code class="literal">AgentOnly</code></p></dd></dl></div><pre class="cmdline prettyprint">$ curl "https://openam.example.com:8443/openam/identity/create?
 admin=AQIC5wM2LY4SfcxSYA8eG-vrNHb_W7nG8XkfAGyRyuaebDY.*AAJTSQACMDE.*
 &amp;identity_name=testuser
 &amp;identity_attribute_names=cn
 &amp;identity_attribute_values_cn=Test%20User
 &amp;identity_attribute_names=sn
 &amp;identity_attribute_values_sn=User
 &amp;identity_attribute_names=userpassword
 &amp;identity_attribute_values_userpassword=secret12
 &amp;identity_realm=%2F
 &amp;identity_type=user"</pre></div><div class="section" id="rest-api-read-legacy"><div class="titlepage"><div><div><h3 class="title">3.12.7.&nbsp;Reading &amp; Searching for Identities (Legacy API)</h3></div></div></div><p>Interface Stability: <a href="../admin-guide/index.html#interface-stability" class="link">Deprecated</a></p><p>Reading is similar to attribute retrieval, as described in
   <a class="xref" href="#rest-api-tokens" title="3.5.&nbsp;Token Validation, Attribute Retrieval">Section&nbsp;3.5, &#8220;Token Validation, Attribute Retrieval&#8221;</a>, but obtained using the token of
   a user with permissions to perform the search, as shown in the following
   example.</p><pre class="cmdline prettyprint">$ curl "https://openam.example.com:8443/openam/identity/read?
 admin=AQIC5wM2LY4SfcxSYA8eG-vrNHb_W7nG8XkfAGyRyuaebDY.*AAJTSQACMDE.*
 &amp;name=testuser
 &amp;attributes_names=realm
 &amp;attributes_values_realm=%2F"
identitydetails.name=testuser
identitydetails.type=user
identitydetails.realm=o=openam
identitydetails.attribute=
identitydetails.attribute.name=uid
identitydetails.attribute.value=testuser
identitydetails.attribute=
identitydetails.attribute.name=sn
identitydetails.attribute.value=User
identitydetails.attribute=
identitydetails.attribute.name=userpassword
identitydetails.attribute.value={SSHA}AzpT+N1sjrQhL1wfX2ETWh/Aqbd+lH9LOlhDqg==
identitydetails.attribute=
identitydetails.attribute.name=cn
identitydetails.attribute.value=Test User
identitydetails.attribute=
identitydetails.attribute.name=inetuserstatus
identitydetails.attribute.value=Active
identitydetails.attribute=
identitydetails.attribute.name=dn
identitydetails.attribute.value=uid=testuser,ou=people,dc=example,dc=com
identitydetails.attribute=
identitydetails.attribute.name=objectclass
identitydetails.attribute.value=person
identitydetails.attribute.value=sunIdentityServerLibertyPPService
identitydetails.attribute.value=inetorgperson
identitydetails.attribute.value=sunFederationManagerDataStore
identitydetails.attribute.value=iPlanetPreferences
identitydetails.attribute.value=iplanet-am-auth-configuration-service
identitydetails.attribute.value=organizationalperson
identitydetails.attribute.value=sunFMSAML2NameIdentifier
identitydetails.attribute.value=inetuser
identitydetails.attribute.value=iplanet-am-managed-person
identitydetails.attribute.value=iplanet-am-user-service
identitydetails.attribute.value=sunAMAuthAccountLockout
identitydetails.attribute.value=top
identitydetails.attribute=
identitydetails.attribute.name=universalid
identitydetails.attribute.value=id=testuser,ou=user,o=openam</pre><p>You can search for user IDs by providing the following
   parameters.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">admin</span></dt><dd><p>Valid token for the user with access to perform the search</p></dd><dt><span class="term">attributes_names</span></dt><dd><p>LDAP attribute names for attributes to search</p></dd><dt><span class="term">attributes_values_<em class="replaceable"><code>name</code></em></span></dt><dd><p>LDAP attribute values for the identity to search. For example,
      <code class="literal">attribute_names=sn&amp;attribute_values_sn=Jensen</code>.</p></dd><dt><span class="term">filter</span></dt><dd><p>Additional LDAP filter component to limit the search results
      returned</p></dd></dl></div><pre class="cmdline prettyprint">$ curl "https://openam.example.com:8443/openam/identity/search?
 admin=AQIC5wM2LY4SfcxSYA8eG-vrNHb_W7nG8XkfAGyRyuaebDY.*AAJTSQACMDE.*
 &amp;attributes_names=sn
 &amp;attributes_values_sn=Jensen
 &amp;attributes_names=mail
 &amp;attributes_values_mail=bjensen*
 &amp;attributes_names=realm
 &amp;attributes_values_realm=%2F"
string=bjensen</pre></div><div class="section" id="rest-api-update-legacy"><div class="titlepage"><div><div><h3 class="title">3.12.8.&nbsp;Updating Identities (Legacy API)</h3></div></div></div><p>Interface Stability: <a href="../admin-guide/index.html#interface-stability" class="link">Deprecated</a></p><p>You can update an identity with the same parameters used to create
   identities, provided the token corresponds to a user with access to
   update the identity.</p><pre class="cmdline prettyprint">$ curl "https://openam.example.com:8443/openam/identity/update?
 admin=AQIC5wM2LY4SfcxSYA8eG-vrNHb_W7nG8XkfAGyRyuaebDY.*AAJTSQACMDE.*
 &amp;identity_name=testuser
 &amp;identity_attribute_names=mail
 &amp;identity_attribute_values_mail=testuser%40example.com
 &amp;identity_realm=%2F
 &amp;identity_type=user"</pre></div><div class="section" id="rest-api-delete-legacy"><div class="titlepage"><div><div><h3 class="title">3.12.9.&nbsp;Deleting Identities (Legacy API)</h3></div></div></div><p>Interface Stability: <a href="../admin-guide/index.html#interface-stability" class="link">Deprecated</a></p><p>You can also delete an identity.</p><pre class="cmdline prettyprint">$ curl "https://openam.example.com:8443/openam/identity/delete?
 admin=AQIC5wM2LY4SfcxSYA8eG-vrNHb_W7nG8XkfAGyRyuaebDY.*AAJTSQACMDE.*
 &amp;identity_name=testuser
 &amp;identity_realm=%2F
 &amp;identity_type=user"</pre></div></div><div class="section" id="rest-api-crud-realm"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.13.&nbsp;Realm Management</h2></div></div></div><a class="indexterm" name="d14138e2047"></a><p>This section shows how to create, read, update, and delete realms 
  using the RESTful APIs.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Under the <code class="literal">/json/realms</code> endpoint, you find the 
    newer JSON-based API.</p><div class="itemizedlist"><p>The following sections cover this JSON-based API.</p><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><a class="xref" href="#rest-api-parameters-realm" title="3.13.1.&nbsp;Default Parameters for Realms">Section&nbsp;3.13.1, &#8220;Default Parameters for Realms&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#rest-api-create-realm" title="3.13.2.&nbsp;Creating Realms">Section&nbsp;3.13.2, &#8220;Creating Realms&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#rest-api-read-realm" title="3.13.3.&nbsp;Reading Realms">Section&nbsp;3.13.3, &#8220;Reading Realms&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#rest-api-update-realm" title="3.13.4.&nbsp;Updating Realms">Section&nbsp;3.13.4, &#8220;Updating Realms&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#rest-api-delete-realm" title="3.13.5.&nbsp;Deleting Realms">Section&nbsp;3.13.5, &#8220;Deleting Realms&#8221;</a></p></li></ul></div></li></ul></div><div class="section" id="rest-api-parameters-realm"><div class="titlepage"><div><div><h3 class="title">3.13.1.&nbsp;Default Parameters for Realms</h3></div></div></div><p>Realms have a number of fields entered with the default loading.
    The following table provides information on what the default realm settings are,
    and these settings can be updated, added, or deleted when updating
    a realm.</p><div class="table" id="realm-parameter"><div class="table-title">Table&nbsp;3.1.&nbsp;Realm Parameters for JSON-based API</div><div class="table-contents"><table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Realm Parameters for JSON-based API" width="100%" border="0"><colgroup><col width="33%"><col width="33%"><col width="34%"></colgroup><thead><tr><th>Realm Parameter</th><th>Default</th><th>Purpose</th></tr></thead><tbody><tr><td>realm</td><td>None - the only required field to add a realm</td><td><p>The name of the realm</p>
         <p>Example: <code class="literal">testRealm</code></p></td></tr><tr><td>sunOrganizationStatus</td><td>None</td><td><p>The status of the realm</p>
         <p><code class="literal">Active</code> or <code class="literal">Inactive</code></p></td></tr><tr><td>sunOrganizationAliases</td><td>None</td><td><p>Any applicable aliases associated with the realm. Be aware that
        an alias can only be used once. Entering an alias used by another realm
        will remove the alias from that realm and you will lose configuration.</p>
         <p>Example: <code class="literal">opensso.example.com</code></p></td></tr><tr><td>serviceNames</td><td><code class="literal">sunAMAuthHOTPService</code>
        <code class="literal">iPlanetAMAuthConfiguration</code>        
        <code class="literal">sunAMAuthFederationService</code>
        <code class="literal">sunIdentityRepositoryService</code>
        <code class="literal">iPlanetAMPolicyConfigService</code>
        <code class="literal">iPlanetAMAuthService</code>
        <code class="literal">iPlanetAMAuthLDAPService</code>
        <code class="literal">sunAMAuthDataStoreService</code>
        <code class="literal">sunAMAuthSAEService</code>
        <code class="literal">sunAMDelegationService</code>
        <code class="literal">sunAMAuthWSSAuthModuleService</code>
        <code class="literal">iPlanetAMAuthOATHService</code>
        </td><td>Services needed for the realm, including authentication modules</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" id="rest-api-create-realm"><div class="titlepage"><div><div><h3 class="title">3.13.2.&nbsp;Creating Realms</h3></div></div></div><p>OpenAM lets administrators create a realm by making 
   an HTTP POST of the JSON representation of the profile to
   <code class="literal">/json/realms/?_action=create</code>.</p><p>You can create realms using an HTTP POST of the JSON representation 
    of the profile to <code class="literal">/json/realms/?_action=create</code>, as shown in 
    the following example. The only required field is <code class="literal">realm</code>, 
    but the realm will not be active if the status is not set.</p><pre class="cmdline prettyprint">$ curl --request POST --header "iplanetDirectoryPro: AQIC5w...2NzEz*"
 --header "Content-Type: application/json"
 --data '{ "realm": "testRealm" }'
 https://openam.example.com:8443/openam/json/realms/?_action=create
{"realmCreated":"/testRealm"}</pre><p>You can also set the <code class="literal">sunOrganizationAliases</code> parameter,
    but it can only be assigned to one realm (usually the top level realm). Before
    setting this parameter, make sure it is not already assigned elsewhere. If you 
    replace remove it from another realm, you will lose your configuration.</p><p>Alternatively, administrators can create realms by the specific realm
    name using the HTTP PUT of the JSON representation of the changes to 
    <code class="literal">/json/realms/<em class="replaceable"><code>realm-id</code></em></code>, as
    shown in the following example.</p><pre class="cmdline prettyprint">$ curl --request PUT --header "iplanetDirectoryPro: AQIC5w...2NzEz*"
 --header "Content-Type: application/json"
 --data '{ "sunOrganizationStatus": "Active" }'
 https://openam.example.com:8443/openam/json/realms/testRealm
{</pre><p>As shown in the examples, OpenAM returns the JSON representation of
    the profile on successful creation. On failure, OpenAM returns a JSON
    representation of the error including the
    <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>.</p></div><div class="section" id="rest-api-read-realm"><div class="titlepage"><div><div><h3 class="title">3.13.3.&nbsp;Reading Realms</h3></div></div></div><p>OpenAM lets administrators read realms by requesting an HTTP GET on 
   <code class="literal">/json/realms/<em class="replaceable"><code>realm-id</code></em></code>. This 
   allows administrators to review all active realm services for the realm, 
   like policy configuration and modules. If users or administrators see missing 
   information (such as Active status) or incorrect information, they can write 
   down the correct information and add it using <a class="xref" href="#rest-api-update-realm" title="3.13.4.&nbsp;Updating Realms">Section&nbsp;3.13.4, &#8220;Updating Realms&#8221;</a></p><p>The following example shows an administrator receiving information about
    the <code class="literal">testRealm</code>.</p><pre class="cmdline prettyprint">$ curl --header "iplanetDirectoryPro: AQIC5w...2NzEz*"
 https://openam.example.com:8443/openam/json/realms/testRealm
{
    "serviceNames":[
                  "sunAMAuthHOTPService",
                  "iPlanetAMAuthConfiguration",
                  "sunAMAuthFederationService",
                  "sunIdentityRepositoryService",
                  "iPlanetAMPolicyConfigService",
                  "iPlanetAMAuthService",
                  "iPlanetAMAuthLDAPService",
                  "sunAMAuthDataStoreService",
                  "sunAMAuthSAEService",
                  "sunAMDelegationService",
                  "sunAMAuthWSSAuthModuleService",
                  "iPlanetAMAuthOATHService"
    ]
}</pre><p>As shown in the example, OpenAM returns the JSON representation of the
    profile on success. On failure, OpenAM returns a JSON representation of the
    error including the
    <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>.</p></div><div class="section" id="rest-api-update-realm"><div class="titlepage"><div><div><h3 class="title">3.13.4.&nbsp;Updating Realms</h3></div></div></div><p>OpenAM lets administrators update realms. To update a realm, do an HTTP PUT 
   of the JSON representation of the changes to
   <code class="literal">/json/realms/<em class="replaceable"><code>realm-id</code></em></code>.</p><p>The following example shows how to update a realm.</p><pre class="cmdline prettyprint">$ curl --request PUT --header "iplanetDirectoryPro: AQIC5...Y3MTAx*"
 --header "Content-Type: application/json"
 --data '{ "sunOrganizationStatus": "Active" }'
 https://openam.example.com:8443/openam/json/realms/testRealm</pre><p>As shown in the example, OpenAM returns the JSON representation of the
    profile on success. On failure, OpenAM returns a JSON representation of the
    error including the
    <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>.</p></div><div class="section" id="rest-api-delete-realm"><div class="titlepage"><div><div><h3 class="title">3.13.5.&nbsp;Deleting Realms</h3></div></div></div><p>OpenAM lets administrators delete a realm by making an HTTP DELETE call to
   <code class="literal">/json/realms/<em class="replaceable"><code>realm-id</code></em></code>.</p><p>The following example deletes a realm. The top level realm cannot
    be deleted. Only administrators should delete realms. The name of the realm
    is the only field required to delete the realm.</p><p>Make sure that you do not have any information you need within a realm 
    before deleting it. Once a realm is deleted, the only way to restore it is 
    to return to a backed up deployment of OpenAM.</p><pre class="cmdline prettyprint">$ curl --request DELETE --header "iplanetDirectoryPro: AQIC5w...2NzEz*"
 https://openam.example.com:8443/openam/json/realms/testRealm
 {"success":"true"}</pre><p>On success, OpenAM returns a JSON object indicating success. On
    failure, OpenAM returns a JSON representation of the error including the
    <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>.</p></div></div><div class="section" id="rest-dashboard"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.14.&nbsp;Displaying Dashboard Applications</h2></div></div></div><a class="indexterm" name="d14138e2283"></a><p>OpenAm lets administrators configure online applications to display
    applications on user Dashboards. You can used exposed REST API to display
    information about the online applications.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">/dashboard/assigned</code></span></dt><dd><p>This endpoint retrieves the list of applications assigned to the 
       authenticated user.</p><pre class="cmdline prettyprint">$ curl --header "iplanetDirectoryPro: AQIC5w...2NzEz*"
 https://openam.example.com:8443/openam/json/dashboard/assigned
{
  "google": {
      "dashboardIcon": [
          "Google.gif"
      ],
      "dashboardName": [
          "Google"
      ],
      "dashboardLogin": [
          "http://www.google.com"
      ],
      "ICFIdentifier": [
          ""
      ],
      "dashboardDisplayName": [
          "Google"
      ],
      "dashboardClassName": [
          "SAML2ApplicationClass"
      ]
   }
}</pre></dd><dt><span class="term"><code class="literal">/dashboard/available</code></span></dt><dd><p>This endpoint retrieves the list of applications available in the
       authenticated user's realm. The example is based on two of the default 
       Dashboard applications: Google and Salesforce.</p><pre class="cmdline prettyprint">$ curl --header "iplanetDirectoryPro: AQIC5w...2NzEz*"
 https://openam.example.com:8443/openam/json/dashboard/available
{
  "google": {
      "dashboardIcon": [
          "Google.gif"
      ],
      "dashboardName": [
          "Google"
      ],
      "dashboardLogin": [
          "http://www.google.com"
      ],
      "ICFIdentifier": [
          ""
      ],
      "dashboardDisplayName": [
          "Google"
      ],
      "dashboardClassName": [
          "SAML2ApplicationClass"
      ]
  }
  "salesforce": {
      "dashboardIcon": [
          "salesforce.gif"
      ],
      "dashboardName": [
          "Salesforce"
      ],
      "dashboardLogin": [
          "http://salesforce.com"
      ],
      "ICFIdentifier": [
          ""
      ],
      "dashboardDisplayName": [
          "Salesforce"
      ],
      "dashboardClassName": [
          "SAML2ApplicationClass"
      ]
  }
}</pre></dd><dt><span class="term"><code class="literal">/dashboard/defined</code></span></dt><dd><p>This endpoint retrieves the list of all applications available defined
       for the OpenAM Dashboard service. The example is based on the three default 
       Dashboard applications: Google, Salesforce, and Zendesk.</p><pre class="cmdline prettyprint">$ curl --header "iplanetDirectoryPro: AQIC5w...2NzEz*"
 https://openam.example.com:8443/openam/json/dashboard/defined
{
    "google": {
        "dashboardIcon": [
            "Google.gif"
        ],
        "dashboardName": [
            "Google"
        ],
        "dashboardLogin": [
            "http://www.google.com"
        ],
        "ICFIdentifier": [
            "idm magic 34"
        ],
        "dashboardDisplayName": [
            "Google"
        ],
        "dashboardClassName": [
            "SAML2ApplicationClass"
        ]
    },
    "salesforce": {
        "dashboardIcon": [
            "salesforce.gif"
        ],
        "dashboardName": [
            "SalesForce"
        ],
        "dashboardLogin": [
            "http://www.salesforce.com"
        ],
        "ICFIdentifier": [
            "idm magic 12"
        ],
        "dashboardDisplayName": [
            "Salesforce"
        ],
        "dashboardClassName": [
            "SAML2ApplicationClass"
        ]
    },
    "zendesk": {
        "dashboardIcon": [
            "ZenDesk.gif"
        ],
        "dashboardName": [
            "ZenDesk"
        ],
        "dashboardLogin": [
            "http://www.ZenDesk.com"
        ],
        "ICFIdentifier": [
            "idm magic 56"
        ],
        "dashboardDisplayName": [
            "ZenDesk"
        ],
        "dashboardClassName": [
            "SAML2ApplicationClass"
        ]
    }
}</pre></dd></dl></div><p>If your application runs in a user-agent such as a browser, you can
    rely on OpenAM to handle authentication.</p></div><div class="section" id="rest-api-status-codes"><div class="titlepage"><div><div><h2 class="title" style="clear: both">3.15.&nbsp;REST Status Codes</h2></div></div></div><p>OpenAM REST APIs respond to successful requests with HTTP status codes
   in the 2xx range. OpenAM REST APIs respond to error conditions with HTTP
   status codes in the 4xx and 5xx range. Status codes used are described in the
   following list.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">200 OK</span></dt><dd><p>The request was successful and a resource returned, depending on the
      request. For example, a successful HTTP GET on
      <code class="literal">/users/myUser</code> returns a user profile and status code
      200, whereas a successful HTTP DELETE returns
      <code class="literal">{"success","true"}</code> and status code 200.</p></dd><dt><span class="term">201 Created</span></dt><dd><p>The request succeeded and the resource was created.</p></dd><dt><span class="term">400 Bad Request</span></dt><dd><p>The request was malformed as in the following example, which is
      sending bad data in the payload for the action.</p><pre class="cmdline prettyprint">$ curl --request POST --header "Content-Type: application/json"
 --data '{"bad":"data"}'
 https://openam.example.com:8443/openam/json/users?_action=forgotPassword

{"code":400,"reason":"Bad Request","message":"Username not provided"}</pre></dd><dt><span class="term">401 Unauthorized</span></dt><dd><p>The request requires user authentication as in the following
      example, which is missing an SSO Token value.</p><pre class="cmdline prettyprint">$ curl --request POST
 https://openam.example.com:8443/openam/json/sessions?_action=logout

{ "code": 401, "reason": "Unauthorized", "message": "Access denied" }</pre></dd><dt><span class="term">403 Forbidden</span></dt><dd><p>Access was forbidden during an operation on a resource as in the
      following example, which has a regular user trying to read the OpenAM
      administrator profile.</p><pre class="cmdline prettyprint">$ curl --request POST
 --header "X-OpenAM-Username: demo" --header "X-OpenAM-Password: changeit"
 https://openam.example.com:8443/openam/json/authenticate

{ "tokenId": "AQIC5w...YyMA..*" }

$ curl --header "iplanetDirectoryPro: AQIC5w...YyMA..*"
 https://openam.example.com:8443/openam/json/users/amadmin
{
    "code": 403,
    "reason": "Forbidden",
    "message": "Permission to perform the read operation denied to
                id=demo,ou=user,dc=openam,dc=forgerock,dc=org"
}</pre></dd><dt><span class="term">404 Not Found</span></dt><dd><p>The specified resource could not be found as in the following
      example, which is attempting to read a nonexistent user's profile.</p><pre class="cmdline prettyprint">$ curl --header "iplanetDirectoryPro: AQIC5w...NTcy*"
 https://openam.example.com:8443/openam/json/users/missing

  {"code":404,"reason":"Not Found","message":"Resource cannot be found."}</pre></dd><dt><span class="term">405 Method Not Allowed</span></dt><dd><p>The HTTP method is not allowed for the requested resource.</p></dd><dt><span class="term">409 Conflict</span></dt><dd><p>The request would have resulted in a conflict with the current
      state of the resource.</p></dd><dt><span class="term">415 Unsupported Media Type</span></dt><dd><p>The request is in a format not supported by the requested resource
      for the requested method as in the following example, which is attempting
      to pass basic authentication credentials as form-encoded data rather than
      query string parameters.</p><pre class="cmdline prettyprint">$ curl --request POST --data "username=demo&amp;password=changeit"
 https://openam.example.com:8443/openam/json/authenticate
...
HTTP Status 415
...
The server refused this request because the request entity is in a
 format not supported by the requested resource for the requested method
...</pre></dd><dt><span class="term">500 Internal Server Error</span></dt><dd><p>The server encountered an unexpected condition which prevented it
      from fulfilling the request.</p></dd><dt><span class="term">501 Not Implemented</span></dt><dd><p>The resource does not support the functionality required to fulfill
      the request as in the following example, which is attempting to delete
      an entry as a delete action instead of using an HTTP DELETE request.</p><pre class="cmdline prettyprint">curl --request POST --header "iplanetDirectoryPro: AQIC5w...NTcy*"
 https://openam.example.com:8443/openam/json/users/demo?_action=delete

{
    "code": 501,
    "reason": "Not Implemented",
    "message": "Actions are not supported for resource instances"
}</pre></dd><dt><span class="term">503 Service Unavailable</span></dt><dd><p>The requested resource was temporarily unavailable.</p></dd></dl></div></div></div><div lang="en" class="chapter" id="chap-jdk"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;4.&nbsp;Using the OpenAM Java SDK</h1></div></div></div><p>This chapter introduces OpenAM Java SDK. OpenAM Java SDK is delivered
 with the full version of OpenAM,
 <code class="filename"></code>.</p><div class="section" id="install-jdk-samples"><div class="titlepage"><div><div><h2 class="title" style="clear: both">4.1.&nbsp;Installing OpenAM Client SDK Samples</h2></div></div></div><a class="indexterm" name="d14138e2427"></a><p>The full OpenAM download,
  <code class="filename"></code>, contains the Java Client
  SDK library, <code class="filename"></code>, as well as
  samples for use on the command line in
  <code class="filename"></code>, and samples in a
  web application, <code class="filename"></code>.
  The <a class="link" href="${javadocBase}" target="_blank"><em class="citetitle">OpenAM Java
  SDK API Specification</em></a> provides a reference to the public
  APIs.</p><div class="procedure" id="deploy-client-sdk-war"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;4.1.&nbsp;To Deploy the Sample Web Application</div><p>The sample web application deploys in your container to show you
   the client SDK samples in action.</p><ol class="procedure" type="1"><li class="step"><p>Deploy the .war in your Java web application container such as
    Apache Tomcat or JBoss.</p><pre class="cmdline prettyprint">$ cp  /path/to/tomcat/webapps/client.war</pre></li><li class="step"><p>Browse to the location where you deployed the client, and configure
    the application to access OpenAM using the application user name,
    <code class="literal">UrlAccessAgent</code>, and password configured when you set up
    OpenAM.</p><div class="mediaobject" align="center" id="figure-config-client-sdk-war"><a class="fancybox" href="images/config-client-sdk-war.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_config-client-sdk-war.png" align="middle" alt="Sample web app configuration screen" title="The sample web application configuration screen lets you&#xA;     configure access to OpenAM."></a></div><div class="variablelist"><p>Use the following hints to complete the configuration.</p><dl class="variablelist"><dt><span class="term">Server Protocol</span></dt><dd><p>Protocol to access OpenAM (<code class="literal">http</code> or
       <code class="literal">https</code>)</p></dd><dt><span class="term">Server Host</span></dt><dd><p>Fully qualified domain name for OpenAM, such as
       <code class="literal">openam.example.com</code></p></dd><dt><span class="term">Server Port</span></dt><dd><p>OpenAM port number such as 8080 or 8443</p></dd><dt><span class="term">Server Deployment URI</span></dt><dd><p>URI entry point to OpenAM such as <code class="literal">/openam</code></p></dd><dt><span class="term">Debug directory</span></dt><dd><p>Where to write the debug messages for the client samples</p></dd><dt><span class="term">Application user name</span></dt><dd><p>An user agent configured to access OpenAM, such as
       <code class="literal">UrlAccessAgent</code> set up when OpenAM was installed</p></dd><dt><span class="term">Application user password</span></dt><dd><p>The user agent password</p></dd></dl></div><p>The sample client writes configuration information under
    <code class="filename">$HOME/OpenAMClient/</code>, where $HOME is that of the user
    running the web application container.</p></li><li class="step"><p>Verify that you have properly configured the sample web application.</p><ol type="a" class="substeps"><li class="step"><p>In another browser tab page of the same browser instance, login to
      OpenAM as the OpenAM Administrator, <code class="literal">amadmin</code>.</p><p>This signs you into OpenAM, storing the cookie in your browser.</p></li><li class="step"><p>On the Samples tab page, click the link under Single Sign On Token
      Verification Servlet.</p><p>If the sample web application is properly configured, you should
      see something like the following text in your browser.</p><pre>SSOToken host name: 127.0.0.1
SSOToken Principal name: id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org
Authentication type used: DataStore
IPAddress of the host: 127.0.0.1
SSO Token validation test succeeded
The token id is AQIC5...CMDEAAlNLABQtODY0Mjc5MDUwNDQzOTA2MzYxNg..*
...
User Attributes: {... givenName=[amAdmin], ...roles=[Top-level Admin Role], ...}</pre></li></ol></li></ol></div></div><div class="procedure" id="build-cli-samples"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;4.2.&nbsp;To Build the Command-Line Sample Applications</div><p>Follow these steps to set up the command-line examples.</p><ol class="procedure" type="1"><li class="step"><p>Unpack the sample applications and related libraries.</p><pre class="cmdline prettyprint">$ mkdir sdk &amp;&amp; cd sdk
$ unzip ~/Downloads/</pre></li><li class="step"><p>Configure the samples to access OpenAM.</p><pre class="cmdline prettyprint">$ sh scripts/setup.sh
Debug directory (make sure this directory exists): /Users/me/openam/openam/debug
Application user (e.g. URLAccessAgent) password: secret12
Protocol of the server: http
Host name of the server: openam.example.com
Port of the server: 8080
Server's deployment URI: openam
Naming URL (hit enter to accept default value,
 http://openam.example.com:8080/openam/namingservice):
$</pre></li><li class="step"><p>Verify that you have properly configured the samples.</p><pre class="cmdline prettyprint">$ sh scripts/Login.sh
Realm (e.g. /): /
Login module name (e.g. DataStore or LDAP): DataStore
Login locale (e.g. en_US or fr_FR): fr_FR
DataStore: Obtained login context
Nom d'utilisateur&nbsp;:demo
Mot de passe&nbsp;:changeit
Login succeeded.
Logged Out!!</pre></li></ol></div></div></div><div class="section" id="about-jdk"><div class="titlepage"><div><div><h2 class="title" style="clear: both">4.2.&nbsp;About the OpenAM Java SDK</h2></div></div></div><div class="itemizedlist"><p>After installing the Java SDK command line samples, you see the
   following content.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">lib/</code>: SDK and other libraries</p></li><li class="listitem"><p><code class="filename">resources/</code>: properties configuration files for
    the SDK and samples</p></li><li class="listitem"><p><code class="filename">scripts/</code>: scripts to run the samples</p></li><li class="listitem"><p><code class="filename">source/</code>: sample code</p></li></ul></div><p>After deploying the Java SDK web application archive, you find the
  following content where the .war file was unpacked.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">META-INF/</code>: build information</p></li><li class="listitem"><p><code class="filename">WEB-INF/</code>: sample classes and libraries</p></li><li class="listitem"><p><code class="filename">console/</code>: images for sample UI</p></li><li class="listitem"><p><code class="filename">index.html</code>: sample home page</p></li><li class="listitem"><p><code class="filename">keystore.jks</code>: OpenAM test certificate, alias:
    <code class="literal">test</code>, key store password: <code class="literal">changeit</code></p></li><li class="listitem"><p><code class="filename">policy/</code>: Policy Evaluator Client Sample page</p></li><li class="listitem"><p><code class="filename">saml2/</code>: Secure Attribute Exchange example</p></li><li class="listitem"><p><code class="filename">sample.css</code>: sample styles</p></li><li class="listitem"><p><code class="filename">sm/</code>: Service Configuration sample</p></li><li class="listitem"><p><code class="filename">um/</code>: User Profile sample</p></li></ul></div><div class="itemizedlist" id="jdk-shutdown-hooks"><div class="itemizedlist-title">Registering Your Java SDK Client to Shut Down Gracefully</div><p>When writing a client using the OpenAM Java SDK, make sure you register
    hooks to make sure the application can be shut down gracefully. How you
    register for shutdown depends on the type of application.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>For Java EE applications, make sure the OpenAM client SDK shuts down
    successfully by including the following context listener in your
    application's <code class="filename">web.xml</code> file.</p><pre class="codelisting prettyprint lang-xml">&lt;listener&gt;
 &lt;listener-class&gt;
  com.sun.identity.common.ShutdownServletContextListener
 &lt;/listener-class&gt;
&lt;/listener&gt;</pre></li><li class="listitem"><p>For standalone applications, set the following JVM property.</p><pre class="literallayout">-Dopenam.runtime.shutdown.hook.enabled=true</pre></li></ul></div></div></div><div lang="en" class="chapter" id="chap-authentication"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;5.&nbsp;Authenticating Using OpenAM Java SDK</h1></div></div></div><a class="indexterm" name="d14138e2678"></a><p>This chapter looks at authentication with the OpenAM Java SDK and at the
 sample client, <code class="filename">Login.java</code>, which demonstrates
 authenticating to OpenAM from a client application, provided a realm, user
 name, and password. This is the sample you ran to test installation of the
 command-line SDK samples. The class shown in this chapter is
 <code class="literal">com.sun.identity.samples.authentication.Login</code>.</p><div class="orderedlist"><p>With OpenAM, your client application performs the following steps
  to handle authentication.</p><ol class="orderedlist" type="1"><li class="listitem"><p>Sets up an <code class="literal">AuthContext</code>, based on the realm in
   which the user authenticates.</p></li><li class="listitem"><p>Starts the login process by calling the <code class="literal">AuthContext</code>
   <code class="literal">login()</code> method.</p></li><li class="listitem"><p>Handling authentication callbacks to retrieve credentials from the
   user who is authenticating.</p><p>Your application loops through the authentication callbacks by using
   the <code class="literal">AuthContext</code> <code class="literal">getRequirements()</code> and
   <code class="literal">hasMoreRequirements()</code> methods. Each time it finishes
   populating a callback with the credentials retrieved, your application calls
   <code class="literal">submitRequirements()</code> to send the credentials to
   OpenAM's Authentication Service.</p></li><li class="listitem"><p>After handling all authentication callbacks, your application
   calls the <code class="literal">AuthContext</code> <code class="literal">getStatus()</code>
   method.</p><p>On login success, OpenAM sets up an <code class="literal">SSOToken</code> that
   holds information about the authentication, and also about the user's
   environment and session.</p></li><li class="listitem"><p>When the user logs out, your application can end the session by
   calling the <code class="literal">AuthContext</code> <code class="literal">logout()</code>
   method.</p></li></ol></div><p>The <code class="literal">AuthContext</code> class is provided by the
 <code class="literal">com.sun.identity.authentication</code> package, part of the
 OpenAM client API. Callback classes are provided by the
 <code class="literal">javax.security.auth.callback</code> package, which provides
 callbacks for choices, confirmations, locales, names, passwords, text input,
 and text output.</p><p>See the <a class="link" href="${javadocBase}" target="_blank"><em class="citetitle">OpenAM Public API JavaDoc</em></a> for
 reference.</p><p>As the sample client gets the realm (called organization in the sample),
 locale, and authentication module to set up the authentication context,
 there is not need for a language callback to get the local afterwards. The
 <code class="filename">Login.java</code> example does, however, show simple ways of
 handling callbacks for the command-line context. The implementation of
 the sample client follows.</p><pre class="codelisting prettyprint linenums lang-java">package com.sun.identity.samples.authentication;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.io.IOException;
import javax.security.auth.callback.Callback;
import javax.security.auth.callback.ChoiceCallback;
import javax.security.auth.callback.NameCallback;
import javax.security.auth.callback.PasswordCallback;
import javax.security.auth.callback.TextInputCallback;
import javax.security.auth.callback.TextOutputCallback;
import javax.security.auth.callback.UnsupportedCallbackException;
import com.sun.identity.authentication.AuthContext;
import com.sun.identity.authentication.spi.AuthLoginException;
import com.sun.identity.shared.debug.Debug;

public class Login {
    private String loginIndexName;
    private String orgName;
    private String locale;
    
    private Login(String loginIndexName, String orgName) {
        this.loginIndexName = loginIndexName;
        this.orgName = orgName;
    }
    
    private Login(String loginIndexName, String orgName, String locale) {
        this.loginIndexName = loginIndexName;
        this.orgName = orgName;
        this.locale = locale;
    }
    
    protected AuthContext getAuthContext()
        throws AuthLoginException {
        AuthContext lc = new AuthContext(orgName);
        AuthContext.IndexType indexType = AuthContext.IndexType.MODULE_INSTANCE;
        if (locale == null || locale.length() == 0) {
            lc.login(indexType, loginIndexName);
        } else {
            lc.login(indexType, loginIndexName, locale);
        }
        debugMessage(loginIndexName + ": Obtained login context");
        return lc;
    }
    
    private void addLoginCallbackMessage(Callback[] callbacks)
    throws UnsupportedCallbackException {
        int i = 0;
        try {
            for (i = 0; i &lt; callbacks.length; i++) {
                if (callbacks[i] instanceof TextOutputCallback) {
                    handleTextOutputCallback((TextOutputCallback)callbacks[i]);
                } else if (callbacks[i] instanceof NameCallback) {
                    handleNameCallback((NameCallback)callbacks[i]);
                } else if (callbacks[i] instanceof PasswordCallback) {
                    handlePasswordCallback((PasswordCallback)callbacks[i]);
                } else if (callbacks[i] instanceof TextInputCallback) {
                    handleTextInputCallback((TextInputCallback)callbacks[i]);
                } else if (callbacks[i] instanceof ChoiceCallback) {
                    handleChoiceCallback((ChoiceCallback)callbacks[i]);
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
            throw new UnsupportedCallbackException(callbacks[i],e.getMessage());
        }
    }
    
    private void handleTextOutputCallback(TextOutputCallback toc) {
        debugMessage("Got TextOutputCallback");
        // display the message according to the specified type
        
        switch (toc.getMessageType()) {
            case TextOutputCallback.INFORMATION:
                debugMessage(toc.getMessage());
                break;
            case TextOutputCallback.ERROR:
                debugMessage("ERROR: " + toc.getMessage());
                break;
            case TextOutputCallback.WARNING:
                debugMessage("WARNING: " + toc.getMessage());
                break;
            default:
                debugMessage("Unsupported message type: " +
                    toc.getMessageType());
        }
    }
    
    private void handleNameCallback(NameCallback nc)
        throws IOException {
        // prompt the user for a username
        System.out.print(nc.getPrompt());
        System.out.flush();
        nc.setName((new BufferedReader
            (new InputStreamReader(System.in))).readLine());
    }
    
    private void handleTextInputCallback(TextInputCallback tic)
        throws IOException {
        // prompt for text input
        System.out.print(tic.getPrompt());
        System.out.flush();
        tic.setText((new BufferedReader
            (new InputStreamReader(System.in))).readLine());
    }
    
    private void handlePasswordCallback(PasswordCallback pc)
        throws IOException {
        // prompt the user for sensitive information
        System.out.print(pc.getPrompt());
        System.out.flush();
        String passwd = (new BufferedReader(new InputStreamReader(System.in))).
            readLine();
        pc.setPassword(passwd.toCharArray());
    }
    
    private void handleChoiceCallback(ChoiceCallback cc)
        throws IOException {
        // ignore the provided defaultValue
        System.out.print(cc.getPrompt());
        
        String[] strChoices = cc.getChoices();
        for (int j = 0; j &lt; strChoices.length; j++) {
            System.out.print("choice[" + j + "] : " + strChoices[j]);
        }
        System.out.flush();
        cc.setSelectedIndex(Integer.parseInt((new BufferedReader
            (new InputStreamReader(System.in))).readLine()));
    }
    
    protected boolean login(AuthContext lc)
        throws UnsupportedCallbackException {
        boolean succeed = false;
        Callback[] callbacks = null;
        
        // get information requested from module
        while (lc.hasMoreRequirements()) {
            callbacks = lc.getRequirements();
            if (callbacks != null) {
                addLoginCallbackMessage(callbacks);
                lc.submitRequirements(callbacks);
            }
        }
        
        if (lc.getStatus() == AuthContext.Status.SUCCESS) {
            System.out.println("Login succeeded.");
            succeed = true;
        } else if (lc.getStatus() == AuthContext.Status.FAILED) {
            System.out.println("Login failed.");
        } else {
            System.out.println("Unknown status: " + lc.getStatus());
        }
        
        return succeed;
    }
    
    protected void logout(AuthContext lc)
        throws AuthLoginException {
        lc.logout();
        System.out.println("Logged Out!!");
    }
    
    static void debugMessage(String msg) {
        System.out.println(msg);
    }
    
    public static void main(String[] args) {
        try {
            System.out.print("Realm (e.g. /): ");
            String orgName = (new BufferedReader(
                new InputStreamReader(System.in))).readLine();

            System.out.print("Login module name (e.g. DataStore or LDAP): ");
            String moduleName = (new BufferedReader(
                new InputStreamReader(System.in))).readLine();
            
            System.out.print("Login locale (e.g. en_US or fr_FR): ");
            String locale = (new BufferedReader(
                new InputStreamReader(System.in))).readLine();
            
            Login login = new Login(moduleName, orgName, locale);
            AuthContext lc = login.getAuthContext();
            if (login.login(lc)) {
                login.logout(lc);
            }
        } catch (IOException e) {
            e.printStackTrace();
        } catch (AuthLoginException e) {
            e.printStackTrace();
        } catch (UnsupportedCallbackException e) {
            e.printStackTrace();
        }
        System.exit(0);
    }
}</pre></div><div lang="en" class="chapter" id="chap-session"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;6.&nbsp;Handling Single Sign-On Using OpenAM Java SDK</h1></div></div></div><a class="indexterm" name="d14138e2777"></a><p>This chapter looks at handling session tokens with the OpenAM Java SDK.
 The class shown in this chapter is
 <code class="literal">com.sun.identity.samples.sso.SSOTokenSample</code>.</p><p>When a user authenticates successfully, OpenAM sets up a single sign-on
 (SSO) session for the user. The session is associated with an SSO token that
 holds information about the authentication, and also about the user's
 environment and session. OpenAM deletes the session when the authentication
 context <code class="literal">logout()</code> method is called, or when a session timeout
 is reached. At that point the SSO token is no longer valid.</p><p>When your application has an <code class="literal">AuthContext</code> after
 successful authentication, you can retrieve the SSO token from the context.
 You also can get the token as shown in the sample client by passing an SSO
 token ID from OpenAM to an <code class="literal">SSOTokenManager</code>.</p><p>If your application needs to be notified of changes, you can register
 an <code class="literal">SSOTokenListener</code> on the token by using the token's
 <code class="literal">addSSOTokenListener()</code> method. OpenAM then calls your
 <code class="literal">SSOTokenListener</code> <code class="literal">ssoTokenChanged()</code>
 method when the session times out, is disposed of, or has a property that
 changes.</p><p>The sample client takes an SSO token ID to get the token from OpenAM,
 and then displays some information from the SSO token. The implementation of
 the sample client follows.</p><pre class="codelisting prettyprint linenums lang-java">package com.sun.identity.samples.sso;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.io.IOException;
import java.net.InetAddress;
import com.iplanet.sso.SSOException;
import com.iplanet.sso.SSOToken;
import com.iplanet.sso.SSOTokenID;
import com.iplanet.sso.SSOTokenManager;

public class SSOTokenSample {
    private SSOTokenManager manager;
    private SSOToken token;

    private SSOTokenSample(String tokenID)
        throws SSOException
    {
        if (validateToken(tokenID)) {
            setGetProperties(token);
        }
    }

    private boolean validateToken(String tokenID)
        throws SSOException
    {
        boolean validated = false;
        manager = SSOTokenManager.getInstance();
        token = manager.createSSOToken(tokenID);

        // isValid method returns true for valid token.
        if (manager.isValidToken(token)) {
                // let us get all the values from the token
            String host = token.getHostName();
            java.security.Principal principal = token.getPrincipal();
            String authType = token.getAuthType();
            int level = token.getAuthLevel();
            InetAddress ipAddress = token.getIPAddress();
            long maxTime = token.getMaxSessionTime();
            long idleTime = token.getIdleTime();
            long maxIdleTime = token.getMaxIdleTime();
                
            System.out.println("SSOToken host name: " + host);
            System.out.println("SSOToken Principal name: " +
                principal.getName());
            System.out.println("Authentication type used: " + authType);
            System.out.println("IPAddress of the host: " +
                ipAddress.getHostAddress());
            validated = true;
        }

        return validated;
    }

    private void setGetProperties(SSOToken token)
        throws SSOException
    {
        /*
         * Validate the token again, with another method
         * if token is invalid, this method throws an exception
         */
        manager.validateToken(token);
        System.out.println("SSO Token validation test Succeeded.");
            
        // Get the SSOTokenID associated with the token and print it.
        SSOTokenID id = token.getTokenID();
        String tokenId = id.toString();
        System.out.println("Token ID: " + tokenId);

        // Set and get properties in the token.
        token.setProperty("TimeZone", "PST");
        token.setProperty("County", "SantaClara");
        String tZone = token.getProperty("TimeZone");
        String county = token.getProperty("County");

        System.out.println("Property: TimeZone: " + tZone); 
        System.out.println("Property: County: " + county); 
    }

    public static void main(String[] args) {
        try {
            System.out.print("Enter SSOToken ID: ");
            String ssoTokenID = (new BufferedReader(
                new InputStreamReader(System.in))).readLine();
            new SSOTokenSample(ssoTokenID.trim());
        } catch (SSOException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }
        System.exit(0);
    }

}</pre><p>Before you run the script that calls the sample, authenticate to OpenAM
 in order to have OpenAM generate the SSO token ID. To see the SSO token ID,
 use the RESTful <code class="literal">authenticate</code> command as shown in the
 following example, or alternatively run the
 <code class="literal">SSOTokenSampleServlet</code> web-based sample.</p><pre class="cmdline prettyprint">$ curl
 --request POST
 --data "username=demo&amp;password=changeit"
 http://openam.example.com:8080/openam/identity/authenticate
token.id=AQIC5wM2LY4Sfcyy10grl...AlNLABQtNjI4OTkyNTUxNTc4MDQ3NzEzOQ..*
$ sh scripts/SSOTokenSample.sh
Enter SSOToken ID: AQIC5wM2LY4Sfcyy10grl...AlNLABQtNjI4OTkyNTUxNTc4MDQ3NzEzOQ..*
SSOToken host name: 172.16.203.239
SSOToken Principal name: id=demo,ou=user,dc=openam,dc=forgerock,dc=org
Authentication type used: DataStore
IPAddress of the host: 172.16.203.239
SSO Token validation test Succeeded.
Token ID: AQIC5wM2LY4Sfcyy10grl...AlNLABQtNjI4OTkyNTUxNTc4MDQ3NzEzOQ..*
Property: TimeZone: PST
Property: County: SantaClara</pre><p>Notice both the properties populated by OpenAM, and also the two
 properties, <code class="literal">TimeZone</code> and <code class="literal">County</code>, that
 are set by the sample client.</p><div class="section" id="session-receiving-notifications"><div class="titlepage"><div><div><h2 class="title" style="clear: both">6.1.&nbsp;Receiving Notifications</h2></div></div></div><p>If your application implements a listener for change notification, such
  as a <code class="literal">SessionListener</code> to handle notification when a session
  is invalidated, then you must configure the following settings in the
  <code class="filename">AMConfig.properties</code> configuration file for your
  application.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">com.iplanet.am.notification.url</span></dt><dd><p>Set this parameter to
     <code class="literal">http://<em class="replaceable"><code>host</code></em>:<em class="replaceable"><code>port</code></em>/<em class="replaceable"><code>context</code></em>/notificationservice</code>.</p></dd><dt><span class="term">com.iplanet.am.sdk.caching.enabled</span></dt><dd><p>Set this parameter to <code class="literal">true</code>.</p></dd><dt><span class="term">com.iplanet.am.serverMode</span></dt><dd><p>Set this parameter to <code class="literal">false</code>.</p></dd><dt><span class="term">com.sun.identity.client.notification.url</span></dt><dd><p>Set this parameter to
     <code class="literal">http://<em class="replaceable"><code>host</code></em>:<em class="replaceable"><code>port</code></em>/<em class="replaceable"><code>context</code></em>/notificationservice</code>.</p></dd><dt><span class="term">com.sun.identity.idm.cache.enabled</span></dt><dd><p>Set this parameter to <code class="literal">true</code>.</p></dd><dt><span class="term">com.sun.identity.idm.remote.notification.enabled</span></dt><dd><p>Set this parameter to <code class="literal">true</code>.</p></dd><dt><span class="term">com.sun.identity.sm.cache.enabled</span></dt><dd><p>Set this parameter to <code class="literal">true</code>.</p></dd><dt><span class="term">com.sun.identity.sm.enableDataStoreNotification</span></dt><dd><p>Set this parameter to <code class="literal">true</code>.</p></dd></dl></div><p>The above configuration to access the notification service also applies
  for other types of listeners, such as <code class="literal">ServiceListener</code>, and
  <code class="literal">IdEventListener</code> implementations. See the <a class="link" href="${javadocBase}" target="_blank"><em class="citetitle">OpenAM Java SDK API
  Specification</em></a> for details on the available listener
  interfaces.</p></div></div><div lang="en" class="chapter" id="chap-policy-decisions"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;7.&nbsp;Requesting Policy Decisions Using OpenAM Java SDK</h1></div></div></div><a class="indexterm" name="d14138e2954"></a><p>This chapter shows how to request policy decision by using OpenAM Java
 SDK. The chapter focuses on the sample client,
 <code class="filename">source/samples/policy/PolicyEvaluationSample.java</code>, which
 demonstrates making a request to OpenAM for a policy decision about access to
 a web resource.</p><p>OpenAM centralizes policy administration, policy evaluation, and policy
 decision making so that your applications do not have to do so. In many
 deployments, OpenAM policy agents and the Open Identity gateway can handle
 policy enforcement independently from your application code.</p><p>If your application does need to request a policy decision from OpenAM,
 then your application can retrieve a <code class="literal">PolicyEvaluator</code> from
 a client-side <code class="literal">PolicyEvaluatorFactory</code>, and then call the
 <code class="literal">PolicyEvaluator</code> <code class="literal">getPolicyDecision()</code>
 method. For boolean decisions such as allow or deny, your application can also
 call the <code class="literal">isAllowed()</code> method.</p><p>To make a policy decision, OpenAM needs an <code class="literal">SSOToken</code>,
 the resource to access, the action the user wants to perform on the resource
 such as HTTP <code class="literal">GET</code> or <code class="literal">POST</code>, and a
 <code class="literal">Map</code> of environment settings you can use to specify
 conditions and attributes in the session or can pass back as an empty
 <code class="literal">Map</code> if your policy does not include conditions and
 response attributes.</p><p>The <code class="literal">PolicyEvaluationSample</code> class takes as its
 configuration the user credentials, service name, resource, and action that
 you provide in a Java properties file. It then authenticates the user to get
 an <code class="literal">SSOToken</code> using the <code class="filename">TokenUtils.java</code>
 helper methods. At that point it has sufficient information to request a
 policy decision.</p><p>The implementation of the sample client follows.</p><pre class="codelisting prettyprint linenums lang-java">package samples.policy;

import com.iplanet.sso.SSOToken;
import com.iplanet.sso.SSOTokenManager;

import com.sun.identity.policy.PolicyDecision;
import com.sun.identity.policy.client.PolicyEvaluator;
import com.sun.identity.policy.client.PolicyEvaluatorFactory;

import samples.policy.TokenUtils;

import java.util.Enumeration;
import java.util.HashMap;
import java.util.Map;
import java.util.HashSet;
import java.util.Properties;
import java.util.MissingResourceException;
import java.util.ResourceBundle;
import java.util.Set;

public class PolicyEvaluationSample {


    public PolicyEvaluationSample() {
    }

    public static void main(String[] args) throws Exception {
        PolicyEvaluationSample clientSample = new PolicyEvaluationSample();
        clientSample.runSample(args);
        System.exit(0);
    }

    public void runSample(String[] args) throws Exception {
        if (args.length == 0 || args.length &gt; 1) {
            System.out.println("Missing argument:"
                    + "properties file name not specified");
        } else {
            System.out.println("Using properties file:" + args[0]);
            Properties sampleProperties = getProperties(args[0]);
            SSOToken ssoToken = getSSOToken(
                (String)sampleProperties.get("user.name"),
                (String)sampleProperties.get("user.password")
            );
            getPolicyDecision(
                ssoToken,
                (String)sampleProperties.get("service.name"),
                (String)sampleProperties.get("resource.name"),
                (String)sampleProperties.get("action.name")
            );
        }
    }

    private SSOToken getSSOToken(
            String userName, String password) throws Exception {
        System.out.println("Entering getSSOToken():"
                + "userName=" + userName + ","
                + "password=" + password);
        SSOToken ssoToken = TokenUtils.getSessionToken("/",
                userName, password);
        System.out.println("TokenID:" + ssoToken.getTokenID().toString());
        System.out.println("returning from getSSOToken()");
        return ssoToken;
    }

    private void getPolicyDecision(
            SSOToken ssoToken,
            String serviceName,
            String resourceName,
            String actionName)
            throws Exception {

        System.out.println("Entering getPolicyDecision():"
                + "resourceName=" + resourceName + ","
                + "serviceName=" + serviceName + ","
                + "actionName=" + actionName);
        PolicyEvaluator pe = PolicyEvaluatorFactory.getInstance().
                    getPolicyEvaluator(serviceName);

        Map env = new HashMap();
        Set attrSet = new HashSet();
        Set actions = new HashSet();
        actions.add(actionName);
        PolicyDecision pd = pe.getPolicyDecision(ssoToken, resourceName,
                actions, env);
        System.out.println("policyDecision:" + pd.toXML());

        System.out.println("returning from getPolicyDecision()");
    }

    private Properties getProperties(String file)
      throws MissingResourceException {
        Properties properties = new Properties();
        ResourceBundle bundle = ResourceBundle.getBundle(file);
        Enumeration e = bundle.getKeys();
        System.out.println("sample properties:");
        while (e.hasMoreElements()) {
            String key = (String) e.nextElement();
            String value = bundle.getString(key);
            properties.put(key, value);
            System.out.println(key + ":" + value);
        }
        return properties;
    }
}</pre><p>Before you run the script that calls the sample, edit the properties
 file, <code class="filename">resources/policyEvaluationSample.properties</code>, to
 indicate the user credentials, resource to access, and HTTP method to
 use. You can use a resource that might not exist for the purposes of this
 example, but you will need to set up a policy for that resource to get
 meaningful results.</p><pre class="codelisting prettyprint linenums lang-java">user.name=demo
user.password=changeit
service.name=iPlanetAMWebAgentService
resource.name=http://www.example.com:80/banner.html
action.name=GET</pre><p>Also, set up a policy in OpenAM that corresponds to the resource in
 question. You can set up the policy in OpenAM console under Access Control
 &gt; <em class="replaceable"><code>Realm Name</code></em> &gt; Policies. Concerning the
 <em class="replaceable"><code>Realm Name</code></em>, notice that unless you change the code,
 the sample uses the top-level realm, <code class="literal">/</code> to authenticate the
 user.</p><p>With the properties configured and policy in place, get the decision
 from OpenAM using the script,
 <code class="filename">scripts/run-policy-evaluation-sample.sh</code>.</p><pre class="cmdline prettyprint">$ sh scripts/run-policy-evaluation-sample.sh
Using properties file:policyEvaluationSample
sample properties:
user.password:changeit
service.name:iPlanetAMWebAgentService
user.name:demo
resource.name:http://www.example.com:80/banner.html
action.name:GET
------------------------------------------------------------------------------:
Entering getSSOToken():userName=demo,password=changeit
TokenID:AQIC5wM2LY4Sfcx3aQGFRKu5-r1a-Vfyjb...5ODM4NDY0MzE0ODYzODQ1*
returning from getSSOToken()
Entering getPolicyDecision():resourceName=http://www.example.com:80/banner.html,
 serviceName=iPlanetAMWebAgentService,actionName=GET
policyDecision:&lt;PolicyDecision&gt;
&lt;ResponseAttributes&gt;
&lt;/ResponseAttributes&gt;
&lt;ActionDecision timeToLive="9223372036854775807"&gt;
&lt;AttributeValuePair&gt;
&lt;Attribute name="GET"/&gt;
&lt;Value&gt;allow&lt;/Value&gt;
&lt;/AttributeValuePair&gt;
&lt;Advices&gt;
&lt;/Advices&gt;
&lt;/ActionDecision&gt;
&lt;/PolicyDecision&gt;

returning from getPolicyDecision()</pre><p>As you see, the policy decision response is formatted here as an XML
 document.<a href="#ftn.d14138e3042" class="footnote"><sup class="footnote" id="d14138e3042">[1]</sup></a> Notice here the line showing that
 OpenAM has allowed access to the resource.</p><pre class="literallayout">&lt;Value&gt;allow&lt;/Value&gt;</pre><div class="footnotes"><br><hr class="footnote-hr"><div id="ftn.d14138e3042" class="footnote"><p><a href="#d14138e3042" class="para"><sup class="para">[1] </sup></a>The <code class="literal">PolicyDecision</code> element is
 defined in
 <code class="filename"><em class="replaceable"><code>openam</code></em>/WEB-INF/remoteInterface.dtd</code>
 where <em class="replaceable"><code>openam</code></em> is the location where the OpenAM web
 application is deployed.</p></div></div></div><div lang="en" class="chapter" id="chap-xacml"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;8.&nbsp;Requesting a XACML Policy Decision Using OpenAM Java SDK</h1></div></div></div><p>This chapter shows how to request a XACML policy decision with OpenAM
 Java SDK, using the sample client,
 <code class="filename">source/samples/xacml/XACMLClientSample.java</code>.
 The sample client relies on an OpenAM server acting as a policy decision point
 and another OpenAM server acting as a policy enforcement point.</p><p>The sample client uses the XACML <code class="literal">ContextFactory</code> to
 create the XACML request. It then uses the
 <code class="literal">XACMLRequestProcessor</code> to get a decision as XACML
 <code class="literal">Response</code> from OpenAM. Most of the work in the sample
 is done setting up the request.</p><p>The implementation of the <code class="literal">XACMLClientSample</code> class
 follows.</p><pre class="codelisting prettyprint linenums lang-java">package samples.xacml;

import com.sun.identity.saml2.common.SAML2Exception;

import com.sun.identity.xacml.client.XACMLRequestProcessor;
import com.sun.identity.xacml.common.XACMLConstants;
import com.sun.identity.xacml.common.XACMLException;
import com.sun.identity.xacml.context.ContextFactory;
import com.sun.identity.xacml.context.Action;
import com.sun.identity.xacml.context.Attribute;
import com.sun.identity.xacml.context.Environment;
import com.sun.identity.xacml.context.Request;
import com.sun.identity.xacml.context.Resource;
import com.sun.identity.xacml.context.Response;
import com.sun.identity.xacml.context.Subject;

import java.net.URI;
import java.net.URISyntaxException;

import java.io.PrintWriter;

import java.util.ArrayList;
import java.util.Enumeration;
import java.util.List;
import java.util.MissingResourceException;
import java.util.Properties;
import java.util.ResourceBundle;

public class XACMLClientSample {


    public XACMLClientSample() {
    }

    public static void main(String[] args) throws Exception {
        XACMLClientSample clientSample = new XACMLClientSample();
        clientSample.runSample(args);
        System.exit(0);
    }

    public void runSample(String[] args) throws Exception {
        if (args.length == 0 || args.length &gt; 1) {
            System.out.println("Missing argument:"
                    + "properties file name not specified");
        } else {
            System.out.println("Using properties file:" + args[0]);
            Properties sampleProperties = getProperties(args[0]);
            testProcessRequest(
                (String)sampleProperties.get("pdp.entityId"),
                (String)sampleProperties.get("pep.entityId"),
                (String)sampleProperties.get("subject.id"),
                (String)sampleProperties.get("subject.id.datatype"),
                (String)sampleProperties.get("subject.category"),
                (String)sampleProperties.get("resource.id"),
                (String)sampleProperties.get("resource.id.datatype"),
                (String)sampleProperties.get("resource.servicename"),
                (String)sampleProperties.get("resource.servicename.datatype"),
                (String)sampleProperties.get("action.id"),
                (String)sampleProperties.get("action.id.datatype")
            );
        }
    }

    private void testProcessRequest(
            String pdpEntityId, String pepEntityId,
            String subjectId, String subjectIdType,
            String subjectCategory,
            String resourceId, String resourceIdType,
            String serviceName, String serviceNameType,
            String actionId, String actionIdType) 
            throws XACMLException, SAML2Exception, 
            URISyntaxException, Exception {

        Request xacmlRequest = createSampleXacmlRequest(
            subjectId, subjectIdType,
            subjectCategory,
            resourceId, resourceIdType,
            serviceName, serviceNameType,
            actionId, actionIdType); 

        System.out.println("\ntestProcessRequest():xacmlRequest:\n" 
                + xacmlRequest.toXMLString(true, true));

        Response xacmlResponse = XACMLRequestProcessor.getInstance()
                .processRequest(xacmlRequest, pdpEntityId, pepEntityId);

        System.out.println("testProcessRequest():xacmlResponse:\n"
                + xacmlResponse.toXMLString(true, true));
    }

    private Request createSampleXacmlRequest(
            String subjectId, String subjectIdType,
            String subjectCategory,
            String resourceId, String resourceIdType,
            String serviceName, String serviceNameType,
            String actionId, String actionIdType) 
            throws XACMLException, URISyntaxException {

        Request request = ContextFactory.getInstance().createRequest();

        //Subject
        Subject subject = ContextFactory.getInstance().createSubject();
        subject.setSubjectCategory(new URI(subjectCategory));

        //set subject id
        Attribute attribute = ContextFactory.getInstance().createAttribute();
        attribute.setAttributeId(new URI(XACMLConstants.SUBJECT_ID));
        attribute.setDataType(new URI(subjectIdType));
        List valueList = new ArrayList();
        valueList.add(subjectId); 
        attribute.setAttributeStringValues(valueList);
        List attributeList = new ArrayList();
        attributeList.add(attribute);
        subject.setAttributes(attributeList);


        //set Subject in Request
        List subjectList = new ArrayList();
        subjectList.add(subject);
        request.setSubjects(subjectList);

        //Resource
        Resource resource = ContextFactory.getInstance().createResource();

        //set resource id
        attribute = ContextFactory.getInstance().createAttribute();
        attribute.setAttributeId(new URI(XACMLConstants.RESOURCE_ID));
        attribute.setDataType( new URI(resourceIdType));
        valueList = new ArrayList();
        valueList.add(resourceId);
        attribute.setAttributeStringValues(valueList);
        attributeList = new ArrayList();
        attributeList.add(attribute);

        //set serviceName
        attribute = ContextFactory.getInstance().createAttribute();
        attribute.setAttributeId(new URI(XACMLConstants.TARGET_SERVICE));
        attribute.setDataType(new URI(serviceNameType));
        valueList = new ArrayList();
        valueList.add(serviceName);
        attribute.setAttributeStringValues(valueList);
        attributeList.add(attribute);
        resource.setAttributes(attributeList);

        //set Resource in Request
        List resourceList = new ArrayList();
        resourceList.add(resource);
        request.setResources(resourceList);

        //Action
        Action action = ContextFactory.getInstance().createAction();
        attribute = ContextFactory.getInstance().createAttribute();
        attribute.setAttributeId(new URI(XACMLConstants.ACTION_ID));
        attribute.setDataType(new URI(actionIdType));

        //set actionId
        valueList = new ArrayList();
        valueList.add(actionId);
        attribute.setAttributeStringValues(valueList);
        attributeList = new ArrayList();
        attributeList.add(attribute);
        action.setAttributes(attributeList);

        //set Action in Request
        request.setAction(action);

        //Environment, our PDP does not use environment now
        Environment environment = ContextFactory.getInstance()
            .createEnvironment();
        request.setEnvironment(environment);
        return request;
    }

    private Properties getProperties(String file)
        throws MissingResourceException {
        Properties properties = new Properties();
        ResourceBundle bundle = ResourceBundle.getBundle(file);
        Enumeration e = bundle.getKeys();
        System.out.println("sample properties:");
        while (e.hasMoreElements()) {
            String key = (String) e.nextElement();
            String value = bundle.getString(key);
            properties.put(key, value);
            System.out.println(key + ":" + value);
        }
        return properties;
    }
}</pre><p>Before running the sample client, you must set up the configuration as
 described in the comments at the outset of the
 <code class="filename">scripts/run-xacml-client-sample.sh</code> script.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Edit <code class="filename">resources/xacmlClientSample.properties</code>
   and <code class="filename">resources/policyEvaluationSample.properties</code>
   to set up the configuration for the sample client.</p><p>The relevant settings from
   <code class="filename">resources/xacmlClientSample.properties</code> are the
   following.</p><pre class="codelisting prettyprint">pdp.entityId=xacmlPdpEntity
pep.entityId=xacmlPepEntity
subject.id=id=demo,ou=user,
subject.id.datatype=urn:oasis:names:tc:xacml:1.0:data-type:x500Name
subject.category=urn:oasis:names:tc:xacml:1.0:subject-category:access-subject
resource.id=http://www.example.com:80/banner.html
resource.id.datatype=http://www.w3.org/2001/XMLSchema#string
resource.servicename=iPlanetAMWebAgentService
resource.servicename.datatype=http://www.w3.org/2001/XMLSchema#string
action.id=GET
action.id.datatype=http://www.w3.org/2001/XMLSchema#string</pre><p>The relevant settings from
   <code class="filename">resources/policyEvaluationSample.properties</code> are the
   following.</p><pre class="codelisting prettyprint">user.name=demo
user.password=changeit
service.name=iPlanetAMWebAgentService
resource.name=http://www.example.com:80/banner.html
action.name=GET</pre></li><li class="listitem"><p>The client accesses an OpenAM server acting as the policy enforcement
    point, configured in a circle of trust with the OpenAM server acting as the
    policy decision point. When you set up the sample clients, you pointed them
    to an OpenAM server. For this example, configure that server to function
    as a policy enforcement point and also as a policy decision point.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>In OpenAM console, browse to Configuration &gt; Global &gt; SAMLv2
      SOAP Binding, and configure a new request handler with Key
      <code class="literal">/xacmlPdpEntity</code> and Class
      <code class="literal">com.sun.identity.xacml.plugins.XACMLAuthzDecisionQueryHandler</code>.</p></li><li class="listitem"><p>Set up the circle of trust, and then create and import the metadata
      for the policy enforcement point and the policy decision point. In the
      following simplified example, both the policy enforcement point and policy
      decision point are hosted on the same OpenAM server. You could also set
      up the policy enforcement point and policy decision point on separate
      servers, as long as the circles of trust on both servers each include both
      the policy enforcement point and the policy decision point. You can
      set up the trust relationship between the two entities either by using
      the <span class="command"><strong>ssoadm</strong></span> command as shown below, or by using the
      <code class="literal">ssoadm.jsp</code> page, which you can activate as described in
      <a href="../admin-guide/index.html#openam-ssoadm-jsp-overview" class="link"><em class="citetitle">OpenAM
      ssoadm.jsp</em></a>.</p><pre class="cmdline prettyprint">$ ssoadm
 create-cot
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --cot cot

Circle of trust, cot was created.
$ ssoadm
 create-metadata-templ
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --entityid xacmlPepEntity
 --xacmlpep /xacmlPepEntity
 --meta-data-file xacmlPep.xml
 --extended-data-file xacmlPep-extended.xml

Hosted entity configuration was written to xacmlPep-extended.xml.
Hosted entity descriptor was written to xacmlPep.xml.
$ ssoadm
 import-entity
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --cot cot
 --meta-data-file xacmlPep.xml
 --extended-data-file xacmlPep-extended.xml

Import file, xacmlPep.xml.
Import file, xacmlPep-extended.xml.
$ ssoadm
 create-metadata-templ
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --entityid xacmlPdpEntity
 --xacmlpep /xacmlPdpEntity
 --meta-data-file xacmlPdp.xml
 --extended-data-file xacmlPdp-extended.xml

Hosted entity configuration was written to xacmlPdp-extended.xml.
Hosted entity descriptor was written to xacmlPdp.xml.
$ ssoadm
 import-entity
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --cot cot
 --meta-data-file xacmlPdp.xml
 --extended-data-file xacmlPdp-extended.xml

Import file, xacmlPdp.xml.
Import file, xacmlPdp-extended.xml.</pre></li></ol></div></li><li class="listitem"><p>Create a policy that allows
   authenticated users to perform an HTTP <code class="literal">GET</code> on the sample
   <code class="literal">resource.id</code> URL you configured, such as
   <code class="literal">http://www.example.com:80/banner.html</code>.</p><p>See <a href="../admin-guide/index.html#configure-authz-policy" class="link"><em class="citetitle">Configuring Policies</em></a> for details.</p></li></ul></div><p>After you have configured OpenAM and the properties files, run the
 sample client script, and observe the XACML request and response.</p><pre class="cmdline prettyprint">$ sh scripts/run-xacml-client-sample.sh
Using properties file:xacmlClientSample
sample properties:
subject.id.datatype:urn:oasis:names:tc:xacml:1.0:data-type:x500Name
pdp.entityId:xacmlPdpEntity
resource.servicename.datatype:http://www.w3.org/2001/XMLSchema#string
resource.id:http://www.example.com:80/banner.html
resource.servicename:iPlanetAMWebAgentService
action.id.datatype:http://www.w3.org/2001/XMLSchema#string
resource.id.datatype:http://www.w3.org/2001/XMLSchema#string
action.id:GET
subject.category:urn:oasis:names:tc:xacml:1.0:subject-category:access-subject
pep.entityId:xacmlPepEntity
subject.id:id=demo,ou=user,dc=openam,dc=forgerock,dc=org

testProcessRequest():xacmlRequest:

&lt;xacml-context:Request
 xmlns:xacml-context="urn:oasis:names:tc:xacml:2.0:context:schema:os"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="urn:oasis:names:tc:xacml:2.0:context:schema:os
  http://docs.oasis-open.org/xacml/access_control-xacml-2.0-context-schema-os.xsd"&gt;
&lt;Subject SubjectCategory=
 "urn:oasis:names:tc:xacml:1.0:subject-category:access-subject"&gt;
&lt;Attribute
 AttributeId="urn:oasis:names:tc:xacml:1.0:subject:subject-id"
 DataType="urn:oasis:names:tc:xacml:1.0:data-type:x500Name" &gt;
&lt;AttributeValue
 &gt;id=demo,ou=user,&lt;/AttributeValue&gt;
&lt;/Attribute&gt;
&lt;/Subject&gt;
&lt;xacml-context:Resource&gt;
&lt;Attribute
 AttributeId="ResourceId"
 DataType="http://www.w3.org/2001/XMLSchema#string" &gt;
&lt;AttributeValue&gt;http://www.example.com:80/banner.html&lt;/AttributeValue&gt;
&lt;/Attribute&gt;
&lt;Attribute
  AttributeId="urn:sun:names:xacml:2.0:resource:target-service"
  DataType="http://www.w3.org/2001/XMLSchema#string" &gt;
&lt;AttributeValue&gt;iPlanetAMWebAgentService&lt;/AttributeValue&gt;
&lt;/Attribute&gt;
&lt;/xacml-context:Resource&gt;
&lt;xacml-context:Action&gt;
&lt;Attribute
 AttributeId="urn:oasis:names:tc:xacml:1.0:action:action-id"
 DataType="http://www.w3.org/2001/XMLSchema#string" &gt;
&lt;AttributeValue&gt;GET&lt;/AttributeValue&gt;
&lt;/Attribute&gt;
&lt;/xacml-context:Action&gt;
&lt;xacml-context:Environment&gt;&lt;/xacml-context:Environment&gt;
&lt;/xacml-context:Request&gt;

testProcessRequest():xacmlResponse:
&lt;xacml-context:Response
 xmlns:xacml-context="urn:oasis:names:tc:xacml:2.0:context:schema:os" &gt;
&lt;xacml-context:Result ResourceId="http://www.example.com:80/banner.html"&gt;
&lt;xacml-context:Decision&gt;Permit&lt;/xacml-context:Decision&gt;
&lt;xacml-context:Status&gt;
&lt;xacml-context:StatusCode
 Value="urn:oasis:names:tc:xacml:1.0:status:ok"&gt;
&lt;/xacml-context:StatusCode&gt;
&lt;xacml-context:StatusMessage&gt;ok&lt;/xacml-context:StatusMessage&gt;
&lt;xacml-context:StatusDetail
 xmlns:xacml-context="urn:oasis:names:tc:xacml:2.0:context:schema:cd:04"&gt;
&lt;xacml-context:StatusDetail/&gt;&lt;/xacml-context:StatusDetail&gt;
&lt;/xacml-context:Status&gt;
&lt;/xacml-context:Result&gt;
&lt;/xacml-context:Response&gt;</pre></div><div lang="en" class="chapter" id="chap-fedlet-java"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;9.&nbsp;Using Fedlets in Java Web Applications</h1></div></div></div><a class="indexterm" name="d14138e3169"></a><p>This chapter introduces OpenAM Fedlets, and shows how to use the Fedlet
 as part of your Java web application.</p><div class="section" id="create-install-java-fedlet"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.1.&nbsp;Creating &amp; Installing a Java Fedlet</h2></div></div></div><p>An OpenAM <em class="firstterm">Fedlet</em> is a small web application that
  can do federation in your service provider application with OpenAM acting as
  the identity provider. The Fedlet does not require an entire OpenAM
  installation alongside your application, but instead can redirect to OpenAM
  for single sign on, and to retrieve SAML assertions.</p><p>The process for creating and installing a Java Fedlet is divided into several procedures.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="#create-a-java-fedlet" title="Procedure&nbsp;9.1.&nbsp;To Create a Fedlet">Procedure&nbsp;9.1, &#8220;To Create a Fedlet&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#install-fedlet-as-demo" title="Procedure&nbsp;9.2.&nbsp;To Install the Fedlet as a Demo Application">Procedure&nbsp;9.2, &#8220;To Install the Fedlet as a Demo Application&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#try-fedlet-attribute-query" title="Procedure&nbsp;9.3.&nbsp;To Try the Fedlet Attribute Query">Procedure&nbsp;9.3, &#8220;To Try the Fedlet Attribute Query&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#try-fedlet-xacml-query" title="Procedure&nbsp;9.4.&nbsp;To Try the Fedlet XACML Query">Procedure&nbsp;9.4, &#8220;To Try the Fedlet XACML Query&#8221;</a></p></li></ul></div><div class="procedure" id="create-a-java-fedlet"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;9.1.&nbsp;To Create a Fedlet</div><p>The OpenAM administrator running the identity provider server creates
   a <code class="filename">Fedlet.zip</code> file for your service provider application,
   and then sends you the .zip.</p><ol class="procedure" type="1"><li class="step"><p>Before creating the Fedlet, create a Hosted Identity Provider if
    you have not already done so, using the test certificate for the signing
    key.</p><p>The single sign-on and single logout features that the Java Fedlet
    demonstrates do work with the Hosted Identity Provider you create starting
    from the Common Tasks page. The Java Fedlet Attribute Query and XACML Query
    tests require additional configuration, however.</p><p>See <a class="xref" href="#try-fedlet-attribute-query" title="Procedure&nbsp;9.3.&nbsp;To Try the Fedlet Attribute Query">Procedure&nbsp;9.3, &#8220;To Try the Fedlet Attribute Query&#8221;</a> and
    <a class="xref" href="#try-fedlet-xacml-query" title="Procedure&nbsp;9.4.&nbsp;To Try the Fedlet XACML Query">Procedure&nbsp;9.4, &#8220;To Try the Fedlet XACML Query&#8221;</a> for details.</p></li><li class="step"><p>On the Common Tasks page of the OpenAM console, click Create
    Fedlet.</p></li><li class="step"><p>Note that the Circle of Trust includes your hosted identity provider,
    and that Identity Provider is set to your to hosted identity
    provider.</p></li><li class="step"><p>Name the Fedlet, and also set the Destination URL.</p><p>You can use the deployment URL, such as
    <code class="literal">http://openam.example.com:8080/fedlet</code> as both the name and
    the destination URL.</p></li><li class="step"><p>Click create to generate the Fedlet.zip file, such as
    <code class="filename">$HOME/openam/myfedlets/httpopenamexamplecom8080fedlet/Fedlet.zip</code>.</p></li><li class="step"><p>Provide the Fedlet to the service provider, or install it yourself to
    demonstrate the Fedlet's features.</p></li></ol></div></div><div class="procedure" id="install-fedlet-as-demo"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;9.2.&nbsp;To Install the Fedlet as a Demo Application</div><p><code class="filename">Fedlet.zip</code> includes the
   <code class="filename">fedlet.war</code> archive corresponding to the identity
   provider, and a <code class="filename">README</code> file.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <code class="filename">fedlet.war</code> archive contains both the Fedlet
     as a demo web application, and also the files you use to include the Fedlet
     in your service provider application.</p></li><li class="listitem"><p>The README file describes how to use the Fedlet.</p></li></ul></div><p>Perform the following steps to try single sign-on and single logout
   tests. For the attribute query and XACML query tests, additional configuration
   is required.</p><ol class="procedure" type="1"><li class="step"><p>Deploy the Fedlet in your web container.</p><pre class="cmdline prettyprint">$ unzip Fedlet.zip
$ mv fedlet.war /path/to/tomcat/webapps</pre></li><li class="step"><p>Browse to the Fedlet URL, and then click the links to set up the
    configuration directory in <code class="filename">$HOME/fedlet</code>, where $HOME
    corresponds to the user running the web application container.</p></li><li class="step"><p>Try one or more examples from the Fedlet home page to validate Fedlet
    setup.</p><div class="mediaobject" align="center" id="figure-fedlet-demo"><a class="fancybox" href="images/fedlet-demo.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_fedlet-demo.png" align="middle" alt="Home page for demo Fedlet" title="The home page for the demo Fedlet lets you try Fedlet (SP)&#xA;      initiated and IDP initiated single sign on and single logout."></a></div><p>After setting up OpenAM with the default subjects, you can login on
    the identity provider with user name <code class="literal">demo</code> and password
    <code class="literal">changeit</code>.</p></li></ol></div></div><div class="procedure" id="try-fedlet-attribute-query"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;9.3.&nbsp;To Try the Fedlet Attribute Query</div><p>To try the Fedlet Attribute Query test, the Identity Provider
   must be configured with the Attribute Authority (<code class="literal">AttrAuth</code>)
   type and should sign responses. The Fedlet must be configured to deal with
   signed responses. Furthermore, map the attributes to request in both the
   Identity Provider and the Fedlet configurations.</p><ol class="procedure" type="1"><li class="step"><p>Add the Attribute Authority type to the hosted Identity Provider.</p><ol type="a" class="substeps"><li class="step"><p>On OpenAM where the Identity Provider is hosted, log in to OpenAM
      console as <code class="literal">amadmin</code>.</p></li><li class="step"><p>Under Federation &gt; Entity Providers, select the Identity Provider,
      and then click New..., even though you plan to change the configuration
      rather than create a new provider.</p></li><li class="step"><p>Select the protocol of the provider: SAMLv2.</p></li><li class="step"><p>In the Create SAMLv2 Entity Provider page, do the following.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Set the Realm.</p></li><li class="listitem"><p>Set the Entity Identifier to the same entity identifier you
        selected in the previous screen.</p></li><li class="listitem"><p>In the Attribute Authority section, set the Meta Alias for example
        to <code class="literal">/attra</code>, and set the Signing certificate alias and
        Encryption certificate alias values to <code class="literal">test</code> (to use
        the test certificate).</p></li><li class="listitem"><p>Click Create to save your changes.</p><p>Disregard any error messages stating that the entity already
        exists.</p></li></ul></div><p><code class="literal">AttrAuth</code> now appears in the list of Types for
      your Identity Provider.</p></li></ol></li><li class="step"><p>Under Federation &gt; Entity Providers, click the Identity Provider
    link to open the provider's configuration.</p></li><li class="step"><p>Make sure attributes for the query are mapped on the Identity
    Provider.</p><p>Under IDP &gt; Attribute Mapper, add the following values to the
    Attribute Map if they are not yet present.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">cn=cn</code></p></li><li class="listitem"><p><code class="literal">sn=sn</code></p></li><li class="listitem"><p><code class="literal">uid=uid</code></p></li></ul></div><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Note</h3></div><div class="panel-body"><p>Make sure to use thread-safe code if you implement the AttributeAuthorityMapper.
     You can use the attributes on the HttpRequest instead of synchronizing them. The 
     default AttributeAuthorityMapper uses an attribute on the HttpServletRequest to
     pass information to the AttributeQueryUtil.</p></div></div><p>Click Save to save your changes.</p></li><li class="step"><p>Create the Fedlet as described in <a class="xref" href="#create-a-java-fedlet" title="Procedure&nbsp;9.1.&nbsp;To Create a Fedlet">Procedure&nbsp;9.1, &#8220;To Create a Fedlet&#8221;</a>,
    making sure you map the attributes.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">cn=cn</code></p></li><li class="listitem"><p><code class="literal">sn=sn</code></p></li><li class="listitem"><p><code class="literal">uid=uid</code></p></li></ul></div><p>This step creates a Fedlet with updated Identity Provider metadata.
    If you already created a Fedlet, either use a different name, or delete
    the existing Fedlet.</p></li><li class="step"><p>Deploy the new Fedlet .war as described in <a class="xref" href="#install-fedlet-as-demo" title="Procedure&nbsp;9.2.&nbsp;To Install the Fedlet as a Demo Application">Procedure&nbsp;9.2, &#8220;To Install the Fedlet as a Demo Application&#8221;</a>.</p></li><li class="step"><p>Edit the new Fedlet configuration to request signing and encryption,
    and replace the existing configuration in OpenAM with the edited
    configuration.</p><ol type="a" class="substeps"><li class="step"><p>Copy the test key store from OpenAM, and prepare password files.</p><pre class="cmdline prettyprint">$ scp user@openam:/home/user/openam/openam/keystore.jks ~/fedlet/</pre><p>The Fedlet uses password files when accessing the keystore. These
      password files contain encoded passwords, where the encoding is specific
      to the Fedlet.</p><p>To encode the password, use <code class="literal">fedletEncode.jsp</code>.
      <code class="literal">fedletEncode.jsp</code> is in the deployed Fedlet, for example
      <code class="literal">http://openam.example.com:8080/fedlet/fedletEncode.jsp</code>.
      The only password to encode for OpenAM's test keystore is
      <code class="literal">changeit</code>, because the key store and private key
      passwords are both the same.</p><p>Use the encoded value to create the password files as in the
      following example.</p><pre class="cmdline prettyprint">$ echo AQIC5BHNSjLwT303GqndmHbyYvzP9Tz7OAnK &gt; ~/fedlet/.storepass
$ echo AQIC5BHNSjLwT303GqndmHbyYvzP9Tz7OAnK &gt; ~/fedlet/.keypass</pre></li><li class="step"><p>Edit <code class="filename">~/fedlet/sp.xml</code> to use the test
      certificate for the attribute query.</p><p>Change the following:</p><pre class="codelisting prettyprint lang-xml">&lt;RoleDescriptor xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:query="urn:oasis:names:tc:SAML:metadata:ext:query"
    xsi:type="query:AttributeQueryDescriptorType"
    protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
 &lt;/RoleDescriptor&gt;</pre><p>To:</p><pre class="codelisting prettyprint lang-xml"> &lt;RoleDescriptor xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:query="urn:oasis:names:tc:SAML:metadata:ext:query"
    xsi:type="query:AttributeQueryDescriptorType"
    protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
  &lt;KeyDescriptor use="signing"&gt;
   &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
    &lt;ds:X509Data&gt;
     &lt;ds:X509Certificate&gt;
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==
     &lt;/ds:X509Certificate&gt;
    &lt;/ds:X509Data&gt;
   &lt;/ds:KeyInfo&gt;
  &lt;/KeyDescriptor&gt;
  &lt;KeyDescriptor use="encryption"&gt;
   &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
    &lt;ds:X509Data&gt;
     &lt;ds:X509Certificate&gt;
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==
     &lt;/ds:X509Certificate&gt;
    &lt;/ds:X509Data&gt;
   &lt;/ds:KeyInfo&gt;
   &lt;EncryptionMethod Algorithm="http://www.w3.org/2001/04/xmlenc#aes128-cbc"&gt;
    &lt;xenc:KeySize xmlns:xenc="http://www.w3.org/2001/04/xmlenc#"
      &gt;128&lt;/xenc:KeySize&gt;
   &lt;/EncryptionMethod&gt;
  &lt;/KeyDescriptor&gt;
 &lt;/RoleDescriptor&gt;</pre></li><li class="step"><p>Edit <code class="filename">~/fedlet/sp-extended.xml</code> to use the test
      certificate for the attribute query.</p><p>Change the following, assuming your Circle of Trust is called
      <code class="literal">cot</code>:</p><pre class="codelisting prettyprint lang-xml">&lt;AttributeQueryConfig metaAlias="/attrQuery"&gt;
    &lt;Attribute name="signingCertAlias"&gt;
        &lt;Value&gt;&lt;/Value&gt;
    &lt;/Attribute&gt;
    &lt;Attribute name="encryptionCertAlias"&gt;
        &lt;Value&gt;&lt;/Value&gt;
    &lt;/Attribute&gt;
    &lt;Attribute name="wantNameIDEncrypted"&gt;
        &lt;Value&gt;&lt;/Value&gt;
    &lt;/Attribute&gt;
    &lt;Attribute name="cotlist"&gt;
        &lt;Value&gt;cot&lt;/Value&gt;
    &lt;/Attribute&gt;
&lt;/AttributeQueryConfig&gt;</pre><p>To:</p><pre class="codelisting prettyprint lang-xml">&lt;AttributeQueryConfig metaAlias="/attrQuery"&gt;
    &lt;Attribute name="signingCertAlias"&gt;
        &lt;Value&gt;test&lt;/Value&gt;
    &lt;/Attribute&gt;
    &lt;Attribute name="encryptionCertAlias"&gt;
        &lt;Value&gt;test&lt;/Value&gt;
    &lt;/Attribute&gt;
    &lt;Attribute name="wantNameIDEncrypted"&gt;
        &lt;Value&gt;true&lt;/Value&gt;
    &lt;/Attribute&gt;
    &lt;Attribute name="cotlist"&gt;
        &lt;Value&gt;cot&lt;/Value&gt;
    &lt;/Attribute&gt;
&lt;/AttributeQueryConfig&gt;</pre></li><li class="step"><p>In OpenAM Console, under Federation &gt; Entity Providers, delete
      the existing configuration for your new Fedlet.</p></li><li class="step"><p>Under Federation &gt; Entity Providers, click Import Entity... and
      import your updated Fedlet configuration.</p><p>This ensures OpenAM has the correct service provider configuration
      for your new Fedlet.</p></li><li class="step"><p>Restart the Fedlet or the container where it is deployed.</p></li></ol></li><li class="step"><p>Try the Attribute Query test.</p><ol type="a" class="substeps"><li class="step"><p>Access the Fedlet.</p><div class="mediaobject" align="center" id="figure-fedlet-sso-request"><a class="fancybox" href="images/fedlet-sso-request.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_fedlet-sso-request.png" align="middle" alt="Home page for demo Fedlet" title="The home page for the demo Fedlet lets you try Fedlet (SP)&#xA;        initiated and IDP initiated single sign on and single logout."></a></div></li><li class="step"><p>Try SSO with user name <code class="literal">demo</code>, password
      <code class="literal">changeit</code>.</p><div class="mediaobject" align="center" id="figure-fedlet-sso-response"><a class="fancybox" href="images/fedlet-sso-response.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_fedlet-sso-response.png" align="middle" alt="Fedlet SSO response page" title="After signing in, you should see information about the&#xA;        authentication and also other tests to try."></a></div></li><li class="step"><p>Click Fedlet Attribute Query, set the attributes in the Attribute
      Query page to match the mapped attributes, and then click Submit.</p><div class="mediaobject" align="center" id="figure-fedlet-attr-query-request"><a class="fancybox" href="images/fedlet-attr-query-request.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_fedlet-attr-query-request.png" align="middle" alt="Fedlet Attribute Query request page" title="After signing in, you can try the Attribute Query demo."></a></div></li><li class="step"><p>Check that you see the attribute values in the response.</p><div class="mediaobject" align="center" id="figure-fedlet-attr-query-response"><a class="fancybox" href="images/fedlet-attr-query-response.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_fedlet-attr-query-response.png" align="middle" alt="Fedlet Attribute Query response page" title="The responses for each attribute value in this case should be&#xA;        demo."></a></div></li></ol></li></ol></div></div><div class="procedure" id="try-fedlet-xacml-query"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;9.4.&nbsp;To Try the Fedlet XACML Query</div><p>To try the Fedlet XACML Query test, the Identity Provider
   must have a policy configured, must be configured with the Policy Decision
   Point (<code class="literal">XACML PDP</code>) type, and must have a SAMLv2 SOAP Binding
   PDP handler configured.</p><ol class="procedure" type="1"><li class="step"><p>Configure a policy on the hosted Identity Provider.</p><p>OpenAM uses the policy to make the decision whether to permit or deny
    access to a resource. For the purpose of the demonstration, configure a
    simple policy that allows all authenticated users HTTP GET access on
    <code class="literal">http://www.example.com/</code>.</p><ol type="a" class="substeps"><li class="step"><p>Log in to OpenAM console as <code class="literal">amadmin</code>.</p></li><li class="step"><p>Under Access Control &gt; <em class="replaceable"><code>realm-name</code></em> &gt;
      Policies, click New Policy...</p></li><li class="step"><p>Set Name: Test policy.</p></li><li class="step"><p>Click Rules &gt; New... and set the following.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Service Type: <code class="literal">URL Policy Agent</code></p></li><li class="listitem"><p>Name: <code class="literal">http://www.example.com/</code></p></li><li class="listitem"><p>Resource Name: <code class="literal">http://www.example.com/</code></p></li><li class="listitem"><p>Actions: allow <code class="literal">GET</code></p></li></ul></div><p>Then click Finish.</p></li><li class="step"><p>Click Subjects &gt; New... and set the following.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Type: <code class="literal">Authenticated Users</code></p></li><li class="listitem"><p>Name: <code class="literal">All authenticated users</code></p></li></ul></div><p>Then click Finish.</p></li><li class="step"><p>Click OK to save the new Test policy.</p></li></ol></li><li class="step"><p>Add the Policy Decision Point type to the Identity Provider.</p><ol type="a" class="substeps"><li class="step"><p>Under Federation &gt; Entity Providers, select the Identity Provider,
      and then click New..., even though you plan to change the configuration
      rather than create a new provider.</p></li><li class="step"><p>Select the protocol of the provider: SAMLv2.</p></li><li class="step"><p>In the Create SAMLv2 Entity Provider page, do the following.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Set the Realm.</p></li><li class="listitem"><p>Set the Entity Identifier to the entity identifier for the hosted
        Identity Provider.</p></li><li class="listitem"><p>In the XACML Policy Decision Point section, set the Meta Alias for
        example to <code class="literal">/pdp</code>.</p></li><li class="listitem"><p>Click Create to save your changes.</p><p>Disregard any error messages stating that the entity already
        exists.</p></li></ul></div><p><code class="literal">XACML PDP</code> now appears in the list of Types for
      your identity provider.</p></li></ol></li><li class="step"><p>Add the PDP handler for the SAMLv2 SOAP Binding.</p><ol type="a" class="substeps"><li class="step"><p>Under Configuration &gt; Global &gt; SAMLv2 SOAP Binding, click
      New...</p></li><li class="step"><p>Set the new key to match the meta alias you used when adding the
      XACML PDP type to the Identity Provider configuration, for example
      <code class="literal">/pdp</code>.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Key: <code class="literal">/pdp</code></p></li><li class="listitem"><p>Class: <code class="literal">com.sun.identity.xacml.plugins.XACMLAuthzDecisionQueryHandler</code></p></li></ul></div><p>Click OK. (Your changes are not saved, yet.)</p></li><li class="step"><p>Click Save to actually save the new Key:Class pair.</p></li></ol></li><li class="step"><p>Create the Fedlet as described in <a class="xref" href="#create-a-java-fedlet" title="Procedure&nbsp;9.1.&nbsp;To Create a Fedlet">Procedure&nbsp;9.1, &#8220;To Create a Fedlet&#8221;</a>.</p><p>This step creates a Fedlet with updated identity provider metadata.
    If you already created a Fedlet, either use a different name, or delete
    the existing Fedlet.</p></li><li class="step"><p>Deploy the new Fedlet .war as described in <a class="xref" href="#install-fedlet-as-demo" title="Procedure&nbsp;9.2.&nbsp;To Install the Fedlet as a Demo Application">Procedure&nbsp;9.2, &#8220;To Install the Fedlet as a Demo Application&#8221;</a>.</p></li><li class="step"><p>Try the XACML Query test.</p><ol type="a" class="substeps"><li class="step"><p>Access the Fedlet.</p><div class="mediaobject" align="center" id="figure-fedlet-sso-request-xacml"><a class="fancybox" href="images/fedlet-sso-request.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_fedlet-sso-request.png" align="middle" alt="Home page for demo Fedlet" title="The home page for the demo Fedlet lets you try Fedlet (SP)&#xA;        initiated and IDP initiated single sign on and single logout."></a></div></li><li class="step"><p>Try SSO with user name <code class="literal">demo</code>, password
      <code class="literal">changeit</code>.</p><div class="mediaobject" align="center" id="figure-fedlet-sso-response-xacml"><a class="fancybox" href="images/fedlet-sso-response.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_fedlet-sso-response.png" align="middle" alt="Fedlet SSO response page" title="After signing in, you should see information about the&#xA;        authentication and also other tests to try."></a></div></li><li class="step"><p>Click XACML Attribute Query, set the Resource URL in the XACML
      Query page to <code class="literal">http://www.example.com/</code>, and then
      click Submit.</p><div class="mediaobject" align="center" id="figure-fedlet-xacml-query-request"><a class="fancybox" href="images/fedlet-xacml-query-request.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_fedlet-xacml-query-request.png" align="middle" alt="Fedlet XACML Query request page" title="After signing in, you can try the XACML Query demo."></a></div></li><li class="step"><p>Check that you see the permit decision in the response.</p><div class="mediaobject" align="center" id="figure-fedlet-xacml-query-response"><a class="fancybox" href="images/fedlet-xacml-query-response.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_fedlet-xacml-query-response.png" align="middle" alt="Fedlet XACML Query response page" title="The response is to permit the user to access the resource."></a></div></li></ol></li></ol></div></div></div><div class="section" id="fedlet-signing-encryption"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.2.&nbsp;Signing &amp; Encryption For a Fedlet</h2></div></div></div><p>By default when you create the Java Fedlet, signing and encryption are
  not configured. You can however set up OpenAM and the fedlet to sign and
  to verify XML signatures and to encrypt and to decrypt data such as SAML
  assertions. If you have tried the Attribute Query demonstration, then you
  have already configured the Fedlet to request signing and encryption using
  the test keys from the identity provider.</p><div class="itemizedlist"><p>Enable signing and encryption for the Java Fedlet involves the
   following high level stages.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Before you create the Fedlet, configure the IDP to sign and encrypt
    data. See Federation &gt; Entity Providers &gt; <em class="replaceable"><code>IDP
    Name</code></em> &gt; Signing and Encryption in the OpenAM console.</p><p>For evaluation, you can use the <code class="literal">test</code> certificate
    delivered with OpenAM.</p></li><li class="listitem"><p>Initially deploy and configure the Fedlet, but do not use the Fedlet
    until you finish.</p></li><li class="listitem"><p>On the Fedlet side set up a JKS keystore used for signing and
    encryption. For evaluation, you can use copy the
    <code class="filename">keystore.jks</code> file delivered with OpenAM. You can find
    the file under the configuration directory for OpenAM, such as
    <code class="filename">$HOME/openam/openam/</code> for a server instance with
    base URI <code class="literal">openam</code>. The built-in keystore includes the
    <code class="literal">test</code> certificate.</p><p>You must also set up <code class="filename">.storepass</code> and
    <code class="filename">.keypass</code> files using the
    <code class="filename">fedletEncode.jsp</code> page, such as
    <code class="literal">http://openam.example.com:8080/fedlet/fedletEncode.jsp</code>, to
    encode passwords on the Fedlet side. The passwords for the test key store
    and private key are both <code class="literal">changeit</code>.</p></li><li class="listitem"><p>Configure the Fedlet to perform signing and encryption by ensuring
    the Fedlet has access to the key store, and by updating the SP metadata
    for the Fedlet.</p></li><li class="listitem"><p>Import the updated SP metadata into the IDP to replace the default
    Fedlet configuration.</p></li><li class="listitem"><p>Restart the Fedlet or container in which the Fedlet runs for the
    changes you made on the Fedlet side to take effect.</p></li></ul></div><div class="procedure" id="fedlet-conf-signing-encryption"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;9.5.&nbsp;To Configure the Fedlet For Signing &amp; Encryption</div><p>The <code class="filename">FederationConfig.properties</code> file specifies
   the paths to the JKS keystore holding the signing or encryption keys for
   the Fedlet, the keystore password file, and the private key password
   file.</p><ol class="procedure" type="1"><li class="step"><p>After setting up your keystore and password files as described above,
    edit the properties file in the configuration directory, such as
    <code class="filename">$HOME/fedlet/FederationConfig.properties</code>, to point
    to the keystore and password files.</p></li><li class="step"><p>Export the certificate to use for signing and encryption
    purposes.</p><pre class="cmdline prettyprint">$ keytool -export -rfc -keystore keystore.jks -alias test
Enter keystore password:
-----BEGIN CERTIFICATE-----
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==</pre></li><li class="step"><p>Edit the standard metadata file for the Fedlet, such as
    <code class="filename">$HOME/fedlet/sp.xml</code>, to include the certificate
    in KeyDescriptor elements, that are children of the SPSSODescriptor
    element.</p><pre class="codelisting prettyprint lang-xml">&lt;EntityDescriptor
 xmlns="urn:oasis:names:tc:SAML:2.0:metadata"
 entityID="http://www.example.com:8080/fedlet"&gt;
 &lt;SPSSODescriptor
  AuthnRequestsSigned="true"
  WantAssertionsSigned="true"
  protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
  &lt;KeyDescriptor use="signing"&gt;
   &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
    &lt;ds:X509Data&gt;
     &lt;ds:X509Certificate&gt;
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==
     &lt;/ds:X509Certificate&gt;
    &lt;/ds:X509Data&gt;
   &lt;/ds:KeyInfo&gt;
  &lt;/KeyDescriptor&gt;
  &lt;KeyDescriptor use="encryption"&gt;
   &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
    &lt;ds:X509Data&gt;
     &lt;ds:X509Certificate&gt;
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==
     &lt;/ds:X509Certificate&gt;
    &lt;/ds:X509Data&gt;
   &lt;/ds:KeyInfo&gt;
   &lt;EncryptionMethod Algorithm="http://www.w3.org/2001/04/xmlenc#aes128-cbc"&gt;
    &lt;xenc:KeySize xmlns:xenc="http://www.w3.org/2001/04/xmlenc#"&gt;
     128
    &lt;/xenc:KeySize&gt;
   &lt;/EncryptionMethod&gt;
  &lt;/KeyDescriptor&gt;
  &lt;SingleLogoutService
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
   Location="http://www.example.com:8080/fedlet/fedletSloRedirect"
   ResponseLocation="http://www.example.com:8080/fedlet/fedletSloRedirect" /&gt;
  &lt;SingleLogoutService
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
   Location="http://www.example.com:8080/fedlet/fedletSloPOST"
   ResponseLocation="http://www.example.com:8080/fedlet/fedletSloPOST" /&gt;
  &lt;SingleLogoutService
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:SOAP"
   Location="http://www.example.com:8080/fedlet/fedletSloSoap" /&gt;
  &lt;NameIDFormat&gt;
   urn:oasis:names:tc:SAML:2.0:nameid-format:transient
  &lt;/NameIDFormat&gt;
  &lt;AssertionConsumerService
   index="0"
   isDefault="true"
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
   Location="http://www.example.com:8080/fedlet/fedletapplication" /&gt;
  &lt;AssertionConsumerService
   index="1"
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact"
   Location="http://www.example.com:8080/fedlet/fedletapplication" /&gt;
 &lt;/SPSSODescriptor&gt;
 &lt;RoleDescriptor
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:query="urn:oasis:names:tc:SAML:metadata:ext:query"
  xsi:type="query:AttributeQueryDescriptorType"
  protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
 &lt;/RoleDescriptor&gt;
 &lt;XACMLAuthzDecisionQueryDescriptor
  WantAssertionsSigned="false"
  protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol" /&gt;
&lt;/EntityDescriptor&gt;</pre></li><li class="step"><p>Edit the extended metadata file for the Fedlet, such as
    <code class="filename">$HOME/fedlet/sp-extended.xml</code>, to set the certificate
    alias names to the alias for the Fedlet certificate, and the
    <code class="literal">want*Signed</code> and <code class="literal">want*Encrypted</code> values
    to <code class="literal">true</code>.</p><p>If you reformat the file, take care not to add white space around
    string values in elements.</p><pre class="codelisting prettyprint lang-xml">
&lt;EntityConfig xmlns="urn:sun:fm:SAML:2.0:entityconfig"
 xmlns:fm="urn:sun:fm:SAML:2.0:entityconfig" hosted="1"
 entityID="http://www.example.com:8080/fedlet"&gt;
 &lt;SPSSOConfig metaAlias="/sp"&gt;
  &lt;Attribute name="description"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="signingCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="encryptionCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthOn"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthUser"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthPassword"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="autofedEnabled"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="autofedAttribute"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="transientUser"&gt;
   &lt;Value&gt;anonymous&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAdapter"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAdapterEnv"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="fedletAdapter"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultFedletAdapter&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="fedletAdapterEnv"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAccountMapper"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultLibrarySPAccountMapper&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="useNameIDAsSPUserID"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAttributeMapper"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultSPAttributeMapper&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAuthncontextMapper"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultSPAuthnContextMapper&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAuthncontextClassrefMapping"&gt;
   &lt;Value
   &gt;urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport|0|default&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAuthncontextComparisonType"&gt;
   &lt;Value&gt;exact&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="attributeMap"&gt;
   &lt;Value&gt;*=*&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="saml2AuthModuleName"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="localAuthURL"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="intermediateUrl"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="defaultRelayState"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="appLogoutUrl"&gt;
   &lt;Value&gt;http://www.example.com:8080/fedlet/logout&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="assertionTimeSkew"&gt;
   &lt;Value&gt;300&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantAttributeEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantAssertionEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantNameIDEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantPOSTResponseSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantArtifactResponseSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantLogoutRequestSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantLogoutResponseSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantMNIRequestSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantMNIResponseSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="responseArtifactMessageEncoding"&gt;
   &lt;Value&gt;URI&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="cotlist"&gt;
   &lt;Value&gt;fedlet-cot&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="saeAppSecretList"&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="saeSPUrl"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="saeSPLogoutUrl"&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="ECPRequestIDPListFinderImpl"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.ECPIDPFinder&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="ECPRequestIDPList"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="ECPRequestIDPListGetComplete"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="enableIDPProxy"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="idpProxyList"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="idpProxyCount"&gt;
   &lt;Value&gt;0&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="useIntroductionForIDPProxy"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spSessionSyncEnabled"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="relayStateUrlList"&gt;
  &lt;/Attribute&gt;
 &lt;/SPSSOConfig&gt;
 &lt;AttributeQueryConfig metaAlias="/attrQuery"&gt;
  &lt;Attribute name="signingCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="encryptionCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantNameIDEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="cotlist"&gt;
   &lt;Value&gt;fedlet-cot&lt;/Value&gt;
  &lt;/Attribute&gt;
 &lt;/AttributeQueryConfig&gt;
 &lt;XACMLAuthzDecisionQueryConfig metaAlias="/pep"&gt;
  &lt;Attribute name="signingCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="encryptionCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthOn"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthUser"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthPassword"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantXACMLAuthzDecisionResponseSigned"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantAssertionEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="cotlist"&gt;
   &lt;Value&gt;fedlet-cot&lt;/Value&gt;
  &lt;/Attribute&gt;
 &lt;/XACMLAuthzDecisionQueryConfig&gt;
&lt;/EntityConfig&gt;</pre></li><li class="step"><p>In OpenAM console delete the original SP entity configuration for the
    Fedlet, and then import the updated metadata for the new configuration into
    OpenAM on the IDP side.</p></li><li class="step"><p>Restart the Fedlet or the container in which it runs in order for
    the Fedlet to pick up the changes to the configuration properties and the
    metadata.</p></li></ol></div></div></div><div class="section" id="customize-java-fedlet"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.3.&nbsp;Customizing a Java Fedlet</h2></div></div></div><p>You can customize the Java Fedlet to perform many of the SAML 2.0
  service provider operations. The Java Fedlet has the SAML 2.0 capabilities
  identified in the table in the <em class="citetitle">Administration Guide</em>,
  <a href="../admin-guide/index.html#fedlet-saml2-features" class="link"><em class="citetitle">Fedlet Support for
  SAML 2.0 Features</em></a>.</p><div class="procedure" id="hello-world-with-fedlet"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;9.6.&nbsp;To Add Your Application</div><div class="variablelist"><p>The Fedlet includes the following files that you use when building
    your own service provider application based on the demo web application,
    including a set of JavaServer Pages (JSP) examples.</p><dl class="variablelist"><dt><span class="term"><code class="filename">conf/</code></span></dt><dd><p>Configuration files copied to <code class="filename">$HOME/fedlet</code> when
      you first deploy and configure the Fedlet. When deploying your application,
      you can move these to an alternate location passed to the Java virtual
      machine for the web application container at startup. For example, if
      you store the configuration under <code class="filename">/export/fedlet/</code>,
      then you could pass the following property to the JVM.</p><pre class="literallayout">-Dcom.sun.identity.fedlet.home=/export/fedlet/conf</pre><p>You do not need to include these files in your application.</p></dd><dt><span class="term"><code class="filename">fedletAttrQuery.jsp</code>, </span><span class="term"><code class="filename">fedletAttrResp.jsp</code></span></dt><dd><p>Sample SAML attribute query and response handlers.</p></dd><dt><span class="term"><code class="filename">fedletEncode.jsp</code></span></dt><dd><p>Utility JSP to encode a password, such as the password used to
      protect a Java keystore</p></dd><dt><span class="term"><code class="filename">fedletSampleApp.jsp</code>, </span><span class="term"><code class="filename">index.jsp</code></span></dt><dd><p>Demo application. You can remove these before deployment to replace
      them with your application.</p></dd><dt><span class="term"><code class="filename">fedletXACMLQuery.jsp</code>, </span><span class="term"><code class="filename">fedletXACMLResp.jsp</code></span></dt><dd><p>Sample SAML XACML query and response handlers.</p></dd><dt><span class="term"><code class="filename">logout.jsp</code></span></dt><dd><p>Utility page to perform single log out</p></dd><dt><span class="term"><code class="filename">saml2/jsp/</code></span></dt><dd><p>JSPs to initiate single sign on and single logout, and to handle
      errors, and also a JSP for obtaining Fedlet metadata,
      <code class="filename">saml2/jsp/exportmetadata.jsp</code></p></dd><dt><span class="term"><code class="filename">WEB-INF/classes/</code></span></dt><dd><p>Localized Java properties files for strings used in the Fedlet user
      interface</p></dd><dt><span class="term"><code class="filename">WEB-INF/lib/</code></span></dt><dd><p>Fedlet libraries required by your application</p></dd><dt><span class="term"><code class="filename">WEB-INF/web.xml</code></span></dt><dd><p>Fedlet web application configuration, showing how JSPs map to URLs
      used in the Fedlet. Add mappings for your application before
      deployment.</p><p>In the <code class="filename">web.xml</code> mappings, your application must
      be mapped to <code class="literal">/fedletapplication</code>, as this is the
      assertion consumer URL set in the Fedlet metadata.</p><pre class="codelisting prettyprint lang-xml">&lt;servlet&gt;
    &lt;servlet-name&gt;yourApp&lt;/servlet-name&gt;
    &lt;jsp-file&gt;/fedletSampleApp.jsp&lt;/jsp-file&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;yourApp&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/fedletapplication&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</pre></dd></dl></div><p>Follow these steps for a very simple demonstration of how to customize
   the Fedlet.</p><ol class="procedure" type="1"><li class="step"><p>Backup <code class="filename">fedletSampleApp.jsp</code>.</p><pre class="cmdline prettyprint">$ cd /path/to/tomcat/webapps/fedlet/
$ cp fedletSampleApp.jsp fedletSampleApp.jsp.orig</pre></li><li class="step"><p>Edit <code class="filename">fedletSampleApp.jsp</code> to reduce it to a single
    redirection to <code class="filename">myapp.jsp</code>. An implementation of the
    &lt;html&gt; element of the file follows below.</p><pre class="codelisting prettyprint linenums lang-html">&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Fedlet Sample Application&lt;/title&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;%
    // BEGIN : following code is a must for Fedlet (SP) side application
    Map map;
    try {
        // invoke the Fedlet processing logic. this will do all the
        // necessary processing conforming to SAMLv2 specifications,
        // such as XML signature validation, Audience and Recipient
        // validation etc.
        map = SPACSUtils.processResponseForFedlet(request, response);
        response.sendRedirect("myapp.jsp");
    } catch (SAML2Exception sme) {
        SAMLUtils.sendError(request, response,
            response.SC_INTERNAL_SERVER_ERROR, "failedToProcessSSOResponse",
            sme.getMessage());
        return;
    } catch (IOException ioe) {
        SAMLUtils.sendError(request, response,
            response.SC_INTERNAL_SERVER_ERROR, "failedToProcessSSOResponse",
            ioe.getMessage());
        return;
    } catch (SessionException se) {
        SAMLUtils.sendError(request, response,
            response.SC_INTERNAL_SERVER_ERROR, "failedToProcessSSOResponse",
            se.getMessage());
        return;
    } catch (ServletException se) {
        SAMLUtils.sendError(request, response,
            response.SC_BAD_REQUEST, "failedToProcessSSOResponse",
            se.getMessage());
        return;
    }
    // END : code is a must for Fedlet (SP) side application
%&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></li><li class="step"><p>Add a <code class="filename">myapp.jsp</code> page to the Fedlet, such as the
    following.</p><pre class="codelisting prettyprint linenums lang-html">&lt;html&gt;
&lt;head&gt;
&lt;title&gt;My Application&lt;/title&gt;
&lt;meta http-equiv="Content-Type" content="text/html" /&gt;
&lt;/head&gt;

&lt;body&gt;

&lt;h1&gt;My Application&lt;/h1&gt;

&lt;p&gt;After you change the &lt;code&gt;fedletSampleApp.jsp&lt;/code&gt;,
   all it does is redirect to this home page after
   successful login.&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;</pre></li><li class="step"><p>Browse to the Fedlet URL, such as
    <code class="literal">http://openam.example.com:8080/fedlet/</code>, and try one
    of the login methods.</p><p>After login you are redirected to <code class="filename">myapp.jsp</code>.</p></li></ol></div></div><div class="section" id="fedlet-perform-sso"><div class="titlepage"><div><div><h3 class="title">9.3.1.&nbsp;Performing Single Sign-On</h3></div></div></div><p>The Java Fedlet includes a JSP file,
   <code class="filename">saml2/jsp/fedletSSOInit.jsp</code>, that you can call to
   initiate single sign-on from the Fedlet (SP) side. The Fedlet home page,
   <code class="filename">index.jsp</code>, calls this page when the user does
   Fedlet-initiated single sign-on.</p><p>When calling this JSP, the parameters to use are those also used by
   <code class="filename">saml2/jsp/spSSOInit.jsp</code> in OpenAM. Those parameters are
   described in the <em class="citetitle">Administration Guide</em> section,
   <a href="../admin-guide/index.html#spssoinit-parameters" class="link"><em class="citetitle"><code class="filename">spSSOInit.jsp</code> Parameters</em></a>.</p><p>For IDP-initiated single sign-on, call the appropriate page on the
   Identity Provider. OpenAM's page is described in the
   <em class="citetitle">Administration Guide</em> section,
   <a href="../admin-guide/index.html#idpssoinit-parameters" class="link"><em class="citetitle"><code class="filename">idpSSOInit.jsp</code> Parameters</em></a>.</p><p>After single sign-on, the user-agent is directed by default to the
   assertion consumer URI set in the Fedlet metadata, which by default is
   <code class="literal">/fedletapplication</code>. Also by default that URI points to
   the JSP, <code class="filename">fedletSampleApp.jsp</code></p></div><div class="section" id="fedlet-perform-slo"><div class="titlepage"><div><div><h3 class="title">9.3.2.&nbsp;Performing Single Logout</h3></div></div></div><p>The Java Fedlet includes a JSP file,
   <code class="filename">saml2/jsp/spSingleLogoutInit.jsp</code>, that you can call to
   initiate single logout from the Fedlet (SP) side. The Fedlet assertion
   consumer page, <code class="filename">fedletSampleApp.jsp</code>, calls this when
   the user does Fedlet-initiated single logout.</p><p>When calling this JSP, the parameters to use are those also used by
   <code class="filename">saml2/jsp/spSingleLogoutInit.jsp</code> in OpenAM. Those
   parameters are described in the <em class="citetitle">Administration Guide</em>
   section, <a href="../admin-guide/index.html#spsloinit-parameters" class="link"><em class="citetitle"><code class="filename">spSingleLogoutInit.jsp</code> Parameters</em></a>.</p><p>For IDP-initiated single logout, call the appropriate page on the
   Identity Provider. OpenAM's page is described in the
   <em class="citetitle">Administration Guide</em> section,
   <a href="../admin-guide/index.html#idpsloinit-parameters" class="link"><em class="citetitle"><code class="filename">idpSingleLogoutInit.jsp</code> Parameters</em></a>.</p><p>Set the <code class="literal">RelayState</code> parameter when initiating logout
   to redirect the user-agent appropriately when the process is complete.</p></div><div class="section" id="fedlet-perform-attr-query"><div class="titlepage"><div><div><h3 class="title">9.3.3.&nbsp;Performing Attribute Queries</h3></div></div></div><p>As seen in the procedure, <a class="xref" href="#try-fedlet-attribute-query" title="Procedure&nbsp;9.3.&nbsp;To Try the Fedlet Attribute Query">Procedure&nbsp;9.3, &#8220;To Try the Fedlet Attribute Query&#8221;</a>,
   an attribute query allows the Fedlet to get profile information about a
   subject from the Attribute Authority. The Fedlet must be configured to deal
   with responses from the Attribute Authority, including configuration for
   signing and encryption. Also, an Identity Provider and Attribute Authority
   is likely to share only those attributes that the Fedlet absolutely requires
   to provide service, such as, for example, a name to customize a page. The
   attributes must then be mapped in the Attribute Authority and Fedlet
   metadata.</p><p>The Java Fedlet includes a JSP file,
   <code class="filename">fedletAttrQuery.jsp</code>, which is used in the procedure
   described above to prepare an attribute query using the transient subject
   identifier obtained during single sign-on. The
   <code class="filename">fedletAttrQuery.jsp</code> also supports using the Subject
   name from an X.509 identity certificate.</p><p>Another JSP file, <code class="filename">fedletAttrResp.jsp</code>, sends the
   query to the Attribute Authority using
   <code class="literal">com.sun.identity.saml2.profile.AttributeQueryUtil.html.getAttributesForFedlet()</code>,
   and if successful processes the result, which is a
   <code class="literal">java.util.Map</code> of the attribute types and their
   values.</p></div><div class="section" id="fedlet-perform-xacml-query"><div class="titlepage"><div><div><h3 class="title">9.3.4.&nbsp;Performing XACML Queries</h3></div></div></div><p>As seen in the procedure, <a class="xref" href="#try-fedlet-xacml-query" title="Procedure&nbsp;9.4.&nbsp;To Try the Fedlet XACML Query">Procedure&nbsp;9.4, &#8220;To Try the Fedlet XACML Query&#8221;</a>,
   a XACML query allows the Fedlet to request a policy decision from a XACML
   PDP. You can configure OpenAM to respond to such queries as described in that
   procedure.</p><p>The Java Fedlet includes a JSP file,
   <code class="filename">fedletXACMLQuery.jsp</code>, which is used in the procedure
   described above to prepare a XACML query, identifying a resource URL and a
   type of HTTP operation to perform, and specifying the subject identifier
   obtained during single sign-on.</p><p>Another JSP file, <code class="filename">fedletXACMLResp.jsp</code>, sends the
   query to the XACML PDP using
   <code class="literal">com.sun.identity.saml2.profile.XACMLQueryUtil.getPolicyDecisionForFedlet()</code>,
   and if successful processes the result, which is a
   <code class="literal">java.lang.String</code> representing the decision, such as
   <code class="literal">Permit</code> if the decision is to allow access, or
   <code class="literal">Deny</code> if the decision is to deny access.</p></div></div></div><div lang="en" class="chapter" id="chap-fedlet-dotnet"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;10.&nbsp;Using Fedlets in .NET Applications</h1></div></div></div><a class="indexterm" name="d14138e4155"></a><p>This chapter explains how to use the Fedlet in your .NET application.
 You must configure the OpenAM .NET Fedlet to work with the identity
 provider.</p><p>Before you try the .NET Fedlet with OpenAM, create a hosted identity
 provider in a Circle of Trust to which you plan to add the Fedlet. You can
 perform these steps using the Create Hosted Identity Provider wizard on the
 Common Tasks page of the OpenAM console. The .NET Fedlet demo requires a
 signing key for the Identity Provider. For evaluation, use the
 <code class="literal">test</code> certificate installed with OpenAM.</p><p>Before configuring the .NET Fedlet, prepare Microsoft IIS 7 with ASP.NET
 v4. Import and configure access on Windows to any certificates and private
 keys the .NET Fedlet needs. Also prepare Windows to allow the .NET Fedlet to
 log messages to Windows Event Log.</p><div class="itemizedlist"><p>This chapter covers the following topics.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="#prepare-iis-for-fedlet" title="Procedure&nbsp;10.1.&nbsp;To Prepare IIS For Installing the .NET Fedlet">Procedure&nbsp;10.1, &#8220;To Prepare IIS For Installing the .NET Fedlet&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#import-fedlet-key-pairs-windows" title="Procedure&nbsp;10.2.&nbsp;To Import Test Key Pairs on Windows">Procedure&nbsp;10.2, &#8220;To Import Test Key Pairs on Windows&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#prepare-windows-dotnet-fedlet-event-log" title="Procedure&nbsp;10.3.&nbsp;To Prepare Windows For .NET Fedlet Event Logging">Procedure&nbsp;10.3, &#8220;To Prepare Windows For .NET Fedlet Event Logging&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#install-dotnet-fedlet" title="Procedure&nbsp;10.4.&nbsp;To Install the .NET Fedlet as a Demo Application">Procedure&nbsp;10.4, &#8220;To Install the .NET Fedlet as a Demo Application&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#try-dotnet-fedlet-attribute-query" title="Procedure&nbsp;10.5.&nbsp;To Try the .NET Fedlet Attribute Query">Procedure&nbsp;10.5, &#8220;To Try the .NET Fedlet Attribute Query&#8221;</a></p></li></ul></div><div class="procedure" id="prepare-iis-for-fedlet"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;10.1.&nbsp;To Prepare IIS For Installing the .NET Fedlet</div><p>Microsoft Internet Information Server must be installed with ASP.NET v4
  in order to support the .NET Fedlet application. The following steps describe
  how to set up IIS on Windows Server 2008 R2 to support the .NET Fedlet.</p><ol class="procedure" type="1"><li class="step"><p>Logon to the Windows server as Administrator.</p></li><li class="step"><p>In Server Manager, add the IIS 7 role to install IIS 7.</p><p>When adding the IIS 7 role, the wizard presents you with additional
   installation options. Under Application Development, select ASP.NET.</p></li><li class="step"><p>Under Roles &gt; Web Server (IIS) &gt; Internet Information Services (IIS)
   Manager &gt; <em class="replaceable"><code>server-name</code></em> &gt; Application Pools,
   change .NET Framework Version for your application pools to v4.0.</p></li></ol></div></div><div class="procedure" id="import-fedlet-key-pairs-windows"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;10.2.&nbsp;To Import Test Key Pairs on Windows</div><p>OpenAM ships with a test key pair unpacked during deployment into a
  Java Key Store under OpenAM's configuration directory. You can import this
  key pair on Windows, so that the .NET Fedlet demo can use the certificate and
  private key to perform signing, encryption, and logging in Windows Event Log.
  The following steps describe how to get the key pair imported and available
  to the .NET Fedlet on Windows Server 2008 R2.</p><p>See Windows documentation for instructions on using your own key
  pair when you plan to deploy the .NET Fedlet in production.</p><ol class="procedure" type="1"><li class="step"><p>Move the key pair from the Java Key Store to a PKCS#12 key store.</p><p>You can use the Java <span class="command"><strong>keytool</strong></span> command to perform
   this step on the system where OpenAM is installed if you do not have the
   command installed on the Windows system.</p><pre class="cmdline prettyprint">$ keytool
 -importkeystore
 -srckeystore keystore.jks
 -destkeystore keystore.p12
 -srcstoretype JKS
 -deststoretype PKCS12
 -srcstorepass changeit
 -deststorepass changeit
 -srcalias test
 -destalias test
 -srckeypass changeit
 -destkeypass changeit
 -noprompt</pre></li><li class="step"><p>If necessary, copy the resulting <code class="filename">keystore.p12</code> file
   to the Windows system.</p></li><li class="step"><p>Open Microsoft Management Console.</p><p>Select Start &gt; Run, then enter <code class="literal">mmc</code>.</p></li><li class="step"><p>In the console, add the Certificates snap-in for the Local Computer
   store.</p></li><li class="step"><p>Select Certificates &gt; Personal &gt; More Actions &gt; All Tasks &gt; Import...</p></li><li class="step"><p>In the Certificate Import Wizard select the
   <code class="filename">keystore.p12</code> file to import the keys. The password is
   <code class="literal">changeit</code>.</p><p>Also select Mark this key as exportable.</p><p>Accept other defaults until you click Finish.</p></li><li class="step"><p>In Certificates &gt; Personal &gt; Certificates &gt; test &gt; More Actions &gt;
   Properties, make sure the Friendly name is test.</p></li><li class="step"><p>Certificates &gt; Personal &gt; Certificates &gt; test &gt; More Actions &gt; All
   Tasks &gt; Manage Private Keys, add access for Everyone (or at least the
   IIS 7 account, IUSR).</p></li></ol></div></div><div class="procedure" id="prepare-windows-dotnet-fedlet-event-log"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;10.3.&nbsp;To Prepare Windows For .NET Fedlet Event Logging</div><p>After importing the key pair for the .NET Fedlet, edit the registry
  to add the key that allows the .NET Fedlet to write to the Windows
  Event Log, and create an Event Log Custom View for the .NET Fedlet.</p><ol class="procedure" type="1"><li class="step"><p>Edit the Windows registry.</p><ol type="a" class="substeps"><li class="step"><p>Open the Windows registry editor.</p><p>Select Start &gt; Run, then enter <code class="literal">regedit</code>.</p></li><li class="step"><p>Browse to
     <code class="literal">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Eventlog\Application</code>.</p></li><li class="step"><p>Add a new key named <code class="literal">Fedlet</code>.</p><p>Right-click Application &gt; New &gt; Key.</p></li><li class="step"><p>Close the Windows registry editor.</p></li></ol></li><li class="step"><p>Add the Event Log Custom View.</p><ol type="a" class="substeps"><li class="step"><p>Select Start &gt; Administrative Tools &gt; Event Viewer.</p></li><li class="step"><p>Select Action &gt; Create Custom View...</p></li><li class="step"><p>Select all Event level options.</p></li><li class="step"><p>Select By source, and then in the drop-down menu, select Fedlet.</p></li><li class="step"><p>Click OK to finish creating the custom view.</p><p>When the .NET Fedlet logs messages, you can read them under Event
     Viewer (Local) &gt; Custom Views &gt; Fedlet.</p></li></ol></li></ol></div></div><div class="procedure" id="install-dotnet-fedlet"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;10.4.&nbsp;To Install the .NET Fedlet as a Demo Application</div><p>Follow these steps to configure and install the .NET Fedlet demo
  application. These instructions are sufficient to test single sign-on and
  single logout. If you want to try the attribute query test, see the procedure,
  <a class="xref" href="#try-dotnet-fedlet-attribute-query" title="Procedure&nbsp;10.5.&nbsp;To Try the .NET Fedlet Attribute Query">Procedure&nbsp;10.5, &#8220;To Try the .NET Fedlet Attribute Query&#8221;</a>.</p><ol class="procedure" type="1"><li class="step"><p>Download the .NET Fedlet (<code class="filename">Fedlet-aspnet.zip</code>) from
   the OpenAM <a class="link" href="http://forgerock.org/openam.html" target="_blank">nightly builds page</a>.
   Contact <a class="link" href="mailto:info@forgerock.com" target="_top">info@forgerock.com</a>
   if you need .NET Fedlet support.</p><p>Next, unpack the contents of the .zip file into a working directory.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">bin\</code></span></dt><dd><p>This folder contains the <code class="filename">Fedlet.dll</code> library,
      that you copy to your application's <code class="filename">bin\</code>
      folder.</p></dd><dt><span class="term"><code class="filename">conf\</code></span></dt><dd><p>This folder contains the templates you edit to prepare your Fedlet
      configuration, including the identity provider and Fedlet (SP) metadata
      for federation. The completed configuration files belong in your
      application's <code class="filename">App_Data\</code> folder.</p></dd><dt><span class="term"><code class="filename">readme.txt</code></span></dt><dd><p>This file describes how to set up and configure .NET Fedlets.</p></dd><dt><span class="term"><code class="filename">SampleApp\</code></span></dt><dd><p>This folder contains the demo application.</p></dd></dl></div></li><li class="step"><p>To ensure the .NET Fedlet can write messages to Windows Event Log,
   edit <code class="filename">SampleApp\Web.config</code>, to make sure that the
   certificate alias reflects the key pair installed in the Windows Local
   Computer Store and available to the IIS 7 application pool user.</p><p>Default settings set the log level to write informational messages, and
   use the test key pair shipped with OpenAM.</p><pre class="codelisting prettyprint lang-xml">&lt;appSettings&gt;
    &lt;add key="fedletLogLevel" value="info" /&gt;
    &lt;add key="fedletMutualAuthCertAlias" value="test" /&gt;
&lt;/appSettings&gt;</pre><p>The key pair specified by the
   <code class="literal">fedletMutualAuthCertAlias</code> is used for SSL Mutual
   Certificate authentication when the certificate based authentication is
   required by and configured for the web container where the Identity
   Provider is deployed.</p></li><li class="step"><p>Edit the template files in the <code class="filename">SampleApp\App_Data\</code>
   folder based on where you deploy the Fedlet demo application, and on how your
   identity provider is configured.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Edit <code class="filename">fedlet.cot</code> to set
     <code class="literal">cot-name</code> to the name of the Circle of Trust, and to set
     <code class="literal">sun-fm-trusted-providers</code> to include the entity ID of
     the identity provider, and the entity ID of the Fedlet service
     provider.</p></li><li class="listitem"><p>Edit <code class="filename">sp.xml</code> and
     <code class="filename">sp-extended.xml</code> to configure the entity IDs, URLs,
     and Circle of Trust names to correspond to your sample application.</p></li></ul></div><div class="itemizedlist"><p>Example files for a .NET Fedlet deployed at
   <code class="literal">http://openam.example.com/fedlet</code> and an Identity Provider
   in OpenAM deployed at <code class="literal">http://openam.example.com:8080/openam</code>
   are available on the OpenAM Community Site. The Circle of Trust name in the
   examples is <code class="literal">cot</code>, and both entities use the test key
   pair.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="${dotnetFedletBase}/fedlet.cot" target="_blank">fedlet.cot</a></p></li><li class="listitem"><p><a class="link" href="${dotnetFedletBase}/idp.xml" target="_blank">idp.xml</a></p></li><li class="listitem"><p><a class="link" href="${dotnetFedletBase}/idp-extended.xml" target="_blank">idp-extended.xml</a></p></li><li class="listitem"><p><a class="link" href="${dotnetFedletBase}/sp.xml" target="_blank">sp.xml</a></p></li><li class="listitem"><p><a class="link" href="${dotnetFedletBase}/sp-extended.xml" target="_blank">sp-extended.xml</a></p></li></ul></div></li><li class="step"><p>Export the identity provider metadata from OpenAM, and copy the
   resulting <code class="filename">idp.xml</code> and
   <code class="filename">idp-extended.xml</code> metadata to the Fedlet
   <code class="filename">SampleApp\App_Data\</code> folder.</p><pre class="cmdline prettyprint">$ ssoadm
 create-metadata-templ
 --entityid "http://openam.example.com:8080/openam"
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --identityprovider /idp
 --meta-data-file idp.xml
 --extended-data-file idp-extended.xml
 --idpscertalias test

Hosted entity configuration was written to idp-extended.xml.
Hosted entity descriptor was written to idp.xml.</pre><p>You can also perform this step using <code class="literal">ssoadm.jsp</code>
   if it is enabled.</p></li><li class="step"><p>Register the Fedlet with OpenAM as a remote service provider using the
   <code class="filename">sp.xml</code> and <code class="filename">sp-extended.xml</code>
   metadata.</p><pre class="cmdline prettyprint">$ ssoadm
 import-entity
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --cot fedlet-cot
 --meta-data-file sp.xml
 --extended-data-file sp-extended.xml

Import file, sp.xml.
Import file, sp-extended.xml.</pre><p>You can also perform this step in OpenAM console by selecting
   Federation &gt; Entity Providers &gt; Import Entity...</p></li><li class="step"><p>Deploy the .NET Fedlet demo application in IIS.</p><ol type="a" class="substeps"><li class="step"><p>Add read and execute permissions for <code class="literal">Everyone</code> to
     the <code class="filename">SampleApp</code> folder.</p></li><li class="step"><p>Add the .NET Fedlet as an application.</p><p>Select IIS console &gt; <em class="replaceable"><code>server-name</code></em> &gt; Sites &gt;
     Default Web Site &gt; View Applications &gt; Add Applications.</p><p>In the window to add the application, Alias is the deployment URI to
     the .NET Fedlet, so <code class="literal">fedlet</code> for
     <code class="literal">/fedlet</code>. Physical path is the file system path to the
     <code class="filename">SampleApp</code> folder.</p></li><li class="step"><p>Restart IIS.</p></li></ol></li><li class="step"><p>Try the demo application links to run .NET Fedlet initiated single
   sign-on.</p><p>At first try the .NET Fedlet as Administrator using Internet Explorer
   on the Windows system where you installed the Fedlet. This allows you to see
   more explicit error messages should any such messages appear.</p><ol type="a" class="substeps"><li class="step"><p>Access the .NET Fedlet.</p><div class="mediaobject" align="center" id="figure-dotnet-fedlet-sso-request"><a class="fancybox" href="images/dotnet-fedlet-sso-request.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_dotnet-fedlet-sso-request.png" align="middle" alt="Home page for demo .NET Fedlet" title="The home page for the demo .NET Fedlet lets you try Fedlet (SP)&#xA;       initiated and IDP initiated single sign on and single logout."></a></div></li><li class="step"><p>Try SSO with user name <code class="literal">demo</code>, password
     <code class="literal">changeit</code>.</p><div class="mediaobject" align="center" id="figure-dotnet-fedlet-sso-response"><a class="fancybox" href="images/dotnet-fedlet-sso-response.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_dotnet-fedlet-sso-response.png" align="middle" alt=".NET Fedlet SSO response page" title="After signing in, you should see information about the&#xA;       authentication and also other tests to try."></a></div><p>If you instead get HTTP 500.19 error status, ASP.NET did not register
     correctly. Register ASP.NET v4 manually as Administrator.</p><pre class="cmdline prettyprint">PS C:\&gt; C:\Windows\Microsoft.NET\Framework64\v4.0.30319\aspnet_regiis.exe -i
Start installing ASP.NET (4.0.30319).
....
Finished installing ASP.NET (4.0.30319).</pre></li></ol></li></ol></div></div><div class="procedure" id="try-dotnet-fedlet-attribute-query"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;10.5.&nbsp;To Try the .NET Fedlet Attribute Query</div><p>To try the .NET Fedlet Attribute Query test, the Identity Provider
  must be configured with the Attribute Authority (<code class="literal">AttrAuth</code>)
  type and should sign responses. The Fedlet must be configured to deal with
  signed and encrypted responses. Furthermore, map the attributes to request
  in both the Identity Provider and the Fedlet configurations.</p><ol class="procedure" type="1"><li class="step"><p>Add the Attribute Authority type to the hosted Identity Provider.</p><ol type="a" class="substeps"><li class="step"><p>On OpenAM where the Identity Provider is hosted, log in to OpenAM
     console as <code class="literal">amadmin</code>.</p></li><li class="step"><p>Under Federation &gt; Entity Providers, select the Identity Provider,
     and then click New..., even though you plan to change the configuration
     rather than create a new provider.</p></li><li class="step"><p>Select the protocol of the provider: SAMLv2.</p></li><li class="step"><p>In the Create SAMLv2 Entity Provider page, do the following.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Set the Realm.</p></li><li class="listitem"><p>Set the Entity Identifier to the same entity identifier you
       selected in the previous screen.</p></li><li class="listitem"><p>In the Attribute Authority section, set the Meta Alias for example
       to <code class="literal">/attra</code>, and set the Signing certificate alias and
       Encryption certificate alias values to <code class="literal">test</code> (to use
       the test certificate).</p></li><li class="listitem"><p>Click Create to save your changes.</p><p>Disregard any error messages stating that the entity already
       exists.</p></li></ul></div><p><code class="literal">AttrAuth</code> now appears in the list of Types for
     your Identity Provider.</p></li></ol></li><li class="step"><p>Under Federation &gt; Entity Providers, click the Identity Provider
   link to open the provider's configuration.</p></li><li class="step"><p>Make sure attributes for the query are mapped on the Identity
   Provider.</p><p>Under IDP &gt; Attribute Mapper, add the following values to the
   Attribute Map if they are not yet present.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">cn=cn</code></p></li><li class="listitem"><p><code class="literal">sn=sn</code></p></li><li class="listitem"><p><code class="literal">uid=uid</code></p></li></ul></div><p>Click Save to save your changes.</p></li><li class="step"><p>As described in the procedure, <a class="xref" href="#install-dotnet-fedlet" title="Procedure&nbsp;10.4.&nbsp;To Install the .NET Fedlet as a Demo Application">Procedure&nbsp;10.4, &#8220;To Install the .NET Fedlet as a Demo Application&#8221;</a>,
   export the Identity Provider metadata from OpenAM, and copy the
   resulting <code class="filename">idp.xml</code> and
   <code class="filename">idp-extended.xml</code> metadata to the .NET Fedlet
   <code class="filename">SampleApp\App_Data\</code> folder.</p></li><li class="step"><p>Update the .NET Fedlet configuration and metadata.</p><ol type="a" class="substeps"><li class="step"><p>To ensure the .NET Fedlet can write messages to Windows Event Log,
     edit <code class="filename">SampleApp\Web.config</code>, to make sure that the
     certificate alias reflects the key pair installed in the Windows Local
     Computer Store and available to the IIS 7 application pool user.</p><p>Default settings set the log level to write informational messages,
     and use the test key pair shipped with OpenAM.</p><pre class="codelisting prettyprint lang-xml">&lt;appSettings&gt;
    &lt;add key="fedletLogLevel" value="info" /&gt;
    &lt;add key="fedletMutualAuthCertAlias" value="test" /&gt;
&lt;/appSettings&gt;</pre><p>The key pair specified by the
     <code class="literal">fedletMutualAuthCertAlias</code> is used for SSL Mutual
     Certificate authentication when the certificate based authentication is
     required by and configured for the web container where the Identity
     Provider is deployed.</p></li><li class="step"><p>Edit the .NET Fedlet metadata files in
     <code class="filename">SampleApp\App_Data</code>, <code class="filename">fedlet.cot</code>,
     <code class="filename">sp.xml</code>, and <code class="filename">sp-extended.xml</code> to
     replace the following if you have not already done so.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Replace <code class="literal">FEDLET_COT</code> with the name of the
       Circle of Trust.</p></li><li class="listitem"><p>Replace <code class="literal">FEDLET_ENTITY_ID</code> with the entity
       identifier such as <code class="literal">http://openam.example.com/fedlet</code>.</p></li><li class="listitem"><p>Replace <code class="literal">FEDLET_DEPLOY_URI</code> with the URL to the
       .NET Fedlet, generally theh same as the entity identifier.</p></li><li class="listitem"><p>Replace <code class="literal">IDP_ENTITY_ID</code> with the entity identifier
       of the Identity Provider such as
       <code class="literal">http://openam.example.com:8080/openam</code>.</p></li></ul></div></li><li class="step"><p>Set up signing and encryption in <code class="filename">sp.xml</code> for
     the .NET Fedlet.</p><p>The Attribute Authority encrypts the response with the Fedlet's
     public key, and the Fedlet decrypts the response with its private key. You
     can set up both signing and encryption by adding a &lt;KeyDescriptor&gt; as
     the first element in the &lt;SSODescriptor&gt;, as in the following
     example.</p><pre class="codelisting prettyprint lang-xml">&lt;KeyDescriptor use="signing"&gt;
      &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
        &lt;ds:X509Data&gt;
          &lt;ds:X509Certificate&gt;
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==
          &lt;/ds:X509Certificate&gt;
        &lt;/ds:X509Data&gt;
      &lt;/ds:KeyInfo&gt;
    &lt;/KeyDescriptor&gt;
    &lt;KeyDescriptor use="encryption"&gt;
      &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
        &lt;ds:X509Data&gt;
          &lt;ds:X509Certificate&gt;
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==
          &lt;/ds:X509Certificate&gt;
        &lt;/ds:X509Data&gt;
      &lt;/ds:KeyInfo&gt;
      &lt;EncryptionMethod
        Algorithm="http://www.w3.org/2001/04/xmlenc#aes128-cbc"&gt;
        &lt;xenc:KeySize
          xmlns:xenc="http://www.w3.org/2001/04/xmlenc#"
          &gt;128&lt;/xenc:KeySize&gt;
      &lt;/EncryptionMethod&gt;
    &lt;/KeyDescriptor&gt;</pre><p>For the Attribute Query feature, add a &lt;RoleDescriptor&gt; to the
     &lt;EntityDescriptor&gt; after the &lt;SSODescriptor&gt;. The &lt;RoleDescriptor&gt;
     describes the certificates that are used for signing and encryption.</p><pre class="codelisting prettyprint lang-xml">&lt;RoleDescriptor
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:query="urn:oasis:names:tc:SAML:metadata:ext:query"
        xsi:type="query:AttributeQueryDescriptorType"
        protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
    &lt;KeyDescriptor use="signing"&gt;
      &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
        &lt;ds:X509Data&gt;
          &lt;ds:X509Certificate&gt;
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==
          &lt;/ds:X509Certificate&gt;
        &lt;/ds:X509Data&gt;
      &lt;/ds:KeyInfo&gt;
    &lt;/KeyDescriptor&gt;
    &lt;KeyDescriptor use="encryption"&gt;
      &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
        &lt;ds:X509Data&gt;
          &lt;ds:X509Certificate&gt;
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==
          &lt;/ds:X509Certificate&gt;
        &lt;/ds:X509Data&gt;
      &lt;/ds:KeyInfo&gt;
      &lt;EncryptionMethod
        Algorithm="http://www.w3.org/2001/04/xmlenc#aes128-cbc"&gt;
        &lt;xenc:KeySize
          xmlns:xenc="http://www.w3.org/2001/04/xmlenc#"
          &gt;128&lt;/xenc:KeySize&gt;
      &lt;/EncryptionMethod&gt;
    &lt;/KeyDescriptor&gt;
  &lt;/RoleDescriptor&gt;</pre></li><li class="step"><p>Edit <code class="filename">sp-extended.xml</code> for your configuration.</p><p>Set the signing and encryption certificate aliases.</p><pre class="codelisting prettyprint lang-xml">&lt;Attribute name="signingCertAlias"&gt;
  &lt;Value&gt;test&lt;/Value&gt;
&lt;/Attribute&gt;
&lt;Attribute name="encryptionCertAlias"&gt;
  &lt;Value&gt;test&lt;/Value&gt;
&lt;/Attribute&gt;</pre><p>Update the attribute map in to coincide with the mapped attributes
     on the Identity Provider.</p><pre class="codelisting prettyprint lang-xml">&lt;Attribute name="attributeMap"&gt;
   &lt;Value&gt;cn=cn&lt;/Value&gt;
   &lt;Value&gt;sn=sn&lt;/Value&gt;
   &lt;Value&gt;uid=uid&lt;/Value&gt;
&lt;/Attribute&gt;</pre><p>Add a logout URL.</p><pre class="codelisting prettyprint lang-xml">&lt;Attribute name="appLogoutUrl"&gt;
   &lt;Value&gt;http://openam.example.com/fedlet/logout.aspx&lt;/Value&gt;
&lt;/Attribute&gt;</pre><p>Add an &lt;AttributeQueryConfig&gt; to the &lt;EntityDescriptor&gt; that
     references the certificate aliases.</p><pre class="codelisting prettyprint lang-xml">&lt;AttributeQueryConfig metaAlias="/attrQuery"&gt;
  &lt;Attribute name="signingCertAlias"&gt;
    &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="encryptionCertAlias"&gt;
    &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantNameIDEncrypted"&gt;
    &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="cotlist"&gt;
    &lt;Value&gt;cot&lt;/Value&gt;
  &lt;/Attribute&gt;
&lt;/AttributeQueryConfig&gt;</pre></li><li class="step"><p>Check your work by comparing and contrasting your configuration with
     the sample configuration files on the OpenAM Community Site.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="${dotnetFedletBase}/fedlet.cot" target="_blank">fedlet.cot</a></p></li><li class="listitem"><p><a class="link" href="${dotnetFedletBase}/idp.xml" target="_blank">idp.xml</a></p></li><li class="listitem"><p><a class="link" href="${dotnetFedletBase}/idp-extended.xml" target="_blank">idp-extended.xml</a></p></li><li class="listitem"><p><a class="link" href="${dotnetFedletBase}/sp.xml" target="_blank">sp.xml</a></p></li><li class="listitem"><p><a class="link" href="${dotnetFedletBase}/sp-extended.xml" target="_blank">sp-extended.xml</a></p></li></ul></div></li><li class="step"><p>In OpenAM console where the hosted Identity Provider is configured,
     under Federation &gt; Entity Providers delete the .NET Fedlet configuration
     if it exists.</p></li><li class="step"><p>Under Federation &gt; Entity Providers, click Import Entity..., and
     then import the .NET Fedlet configuration using your
     <code class="filename">sp.xml</code> and <code class="filename">sp-extended.xml</code>
     metadata files.</p></li></ol></li><li class="step"><p>Deploy the .NET Fedlet as described in the deploy step of the procedure,
   <a class="xref" href="#install-dotnet-fedlet" title="Procedure&nbsp;10.4.&nbsp;To Install the .NET Fedlet as a Demo Application">Procedure&nbsp;10.4, &#8220;To Install the .NET Fedlet as a Demo Application&#8221;</a>, making sure you restart IIS.</p></li><li class="step"><p>Try the .NET Fedlet Attribute Query test.</p><p>At first try the .NET Fedlet as Administrator using Internet Explorer
   on the Windows system where you installed the Fedlet. This allows you to see
   more explicit error messages should any such messages appear.</p><ol type="a" class="substeps"><li class="step"><p>Access the .NET Fedlet.</p><div class="mediaobject" align="center" id="figure-dotnet-fedlet-sso-request-attr-query"><a class="fancybox" href="images/dotnet-fedlet-sso-request.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_dotnet-fedlet-sso-request.png" align="middle" alt="Home page for demo .NET Fedlet" title="The home page for the demo .NET Fedlet lets you try Fedlet (SP)&#xA;       initiated and IDP initiated single sign on and single logout."></a></div></li><li class="step"><p>Try SSO with user name <code class="literal">demo</code>, password
     <code class="literal">changeit</code>.</p><div class="mediaobject" align="center" id="figure-dotnet-fedlet-sso-response-attr-query"><a class="fancybox" href="images/dotnet-fedlet-sso-response.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_dotnet-fedlet-sso-response.png" align="middle" alt=".NET Fedlet SSO response page" title="After signing in, you should see information about the&#xA;       authentication and also other tests to try."></a></div><p>If you instead get HTTP 500.19 error status, ASP.NET did not register
     correctly. Register ASP.NET v4 manually as Administrator.</p><pre class="cmdline prettyprint">PS C:\&gt; C:\Windows\Microsoft.NET\Framework64\v4.0.30319\aspnet_regiis.exe -i
Start installing ASP.NET (4.0.30319).
....
Finished installing ASP.NET (4.0.30319).</pre></li><li class="step"><p>At the bottom of the web page, et the attributes in the Attribute
      Query page to match the mapped attributes, and then click Send.</p></li><li class="step"><p>Check that you see the attribute values in the response page.</p><div class="mediaobject" align="center" id="figure-dotnet-fedlet-attr-query-response"><a class="fancybox" href="images/dotnet-fedlet-attr-query-response.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_dotnet-fedlet-attr-query-response.png" align="middle" alt=".NET Fedlet Attribute Query response page" title="The responses for each attribute value in this case should be&#xA;        demo."></a></div></li></ol></li><li class="step"><p>Adapt the SSL/TLS protocol version used by the .NET Fedlet client to
   the needs of your deployment. The default setting for .NET v4 is to use
   either SSLv3 or TLSv1 depending on what the remote peer supports.</p><p>For IIS 6 on Windows Server 2003, see the Windows Server
   documentation on <a class="link" href="http://technet.microsoft.com/en-us/library/cc776467%28WS.10%29.aspx" target="_blank"><em class="citetitle">TLS/SSL Tools and Settings</em></a>.</p><p>For IIS 7.5 on Windows Server 2008 R2, also consider the explanation
   in an online article, <a class="link" href="http://www.derekseaman.com/2010/06/enable-tls-12-aes-256-and-sha-256-in.html" target="_blank"><em class="citetitle">Enable TLS 1.2 Ciphers in IIS 7.5, Server 2008 R2</em></a>.</p><p>For reference, Microsoft Developer Network has an article describing
   <a class="link" href="http://msdn.microsoft.com/en-us/library/aa374757(VS.85).aspx" target="_blank"><em class="citetitle">Cipher Suites in Schannel</em></a>.</p></li></ol></div></div></div><div lang="en" class="chapter" id="chap-sae"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;11.&nbsp;Using Secure Attribute Exchange</h1></div></div></div><a class="indexterm" name="d14138e4868"></a><p>Most deployments can rely on OpenAM to handle authentication and provide
 identity assertions. Not only does OpenAM support a wide variety of
 authentication scenarios out of the box, but OpenAM also makes it possible to
 add custom authentication modules. Furthermore OpenIG lets you integrate
 legacy systems into your access management deployment.</p><p>In a deployment where you need OpenAM to act as a SAML 2.0 gateway to a
 legacy application that serves as an identity provider, you can use OpenAM
 Secure Attribute Exchange (SAE). On the identity provider side, SAE lets
 OpenAM retrieve the information needed to create assertions from an external
 authentication service, bypassing OpenAM authentication and trusting the
 external service as the authoritative source of authentication. On the service
 provider side, SAE lets OpenAM securely provide attributes to an application
 that makes its own policy decision based on the attributes rather than rely on
 OpenAM for the policy decision.</p><div class="mediaobject" align="center" id="figure-sae"><a class="fancybox" href="images/sae.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_sae.png" align="middle" alt="External applications use SAE to participate in federation." title="External applications use SAE to communicate with OpenAM providers.&#xA;   The providers in turn use SAML 2.0 to communicate with other&#xA;   providers."></a></div><p>When you use SAE on the identity provider side, an external application
 acts as the authoritative source of authentication. After a user authenticates
 successfully, the application lets OpenAM know to create a session by sending
 a secure HTTP GET or POST to OpenAM that asserts the identity of the user.
 OpenAM processes the assertion to create a session for the user. If the user
 is already authenticated and comes back to access the application, the
 application sends a secure HTTP POST to OpenAM to assert both the user's
 identity and also any necessary attributes related to the user. OpenAM
 processes the assertion to create the session for the user and populate the
 attributes in the user's session. When the user logs out, the external
 authentication application can initiate single logout from the identity
 provider OpenAM server by sending the <code class="literal">sun.cmd=logout</code>
 attribute to OpenAM using SAE.</p><p>On the service provider side OpenAM communicates using SAML 2.0 with
 OpenAM on the identity provider side. OpenAM can use SAE to transmit
 attributes to an application through a secure HTTP POST.</p><p>SAE relies either on shared keys and symmetric encryption, or on public
 and private keys and asymmetric encryption to protect attributes communicated
 between OpenAM and external applications.</p><p>OpenAM ships with sample JSPs that demonstrate secure attribute
 exchange. In order to try the sample, you must set up an OpenAM circle of
 trust to include an identity provider and a service provider, install the SDK
 sample web application on each provider and then configure the providers
 appropriately as described in this chapter to secure communications with the
 sample SAE applications on both the identity provider and service provider
 sides.</p><div class="section" id="sae-install-prerequisites"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.1.&nbsp;Installing the Samples</h2></div></div></div><p>Set up an OpenAM server as an identity provider, and another as a
  service provider, connecting the two in a circle of trust called
  <code class="literal">samplesaml2cot</code>. Configure both the hosted providers and
  also the remote providers as described in <a href="../admin-guide/index.html#set-up-federation" class="link"><em class="citetitle">Setting Up SAML
  2.0 SSO</em></a>. This chapter assumes you set up the hosted
  identity provider at <code class="literal">http://idp.example.com:8080/openam</code>
  and the hosted service provider at
  <code class="literal">http://sp.example.com:8080/openam</code>. Use Common Tasks &gt;
  Test Federation Connectivity in OpenAM console to make sure Federation is
  working before you add secure attribute exchange applications that rely
  on functioning SAML 2.0 communications between the providers.</p><p>Set up the sample web application as described in <a href="../dev-guide/index.html#install-jdk-samples" class="link"><em class="citetitle">Installing OpenAM
  Client SDK Samples</em></a>, both on the identity provider side
  and also on the service provider side. The SAE samples are found under
  <code class="filename">/saml2/sae</code> where you installed the samples.
  <code class="filename">saeIDPApp.jsp</code> is the identity provider side external
  application. <code class="filename">saeSPApp.jsp</code> is the service provider side
  external application.</p></div><div class="section" id="sae-security-prerequisites"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.2.&nbsp;Preparing to Secure SAE Communications</h2></div></div></div><p>In order for SAE to be secure, you must both set up a trust
  relationship between the application on the identity provider side and
  the OpenAM server acting as identity provider, and also set up a trust
  relationship between the application on the service provider side and
  the OpenAM server acting as the service provider. These trust
  relationships can be based on a shared secret and symmetric encryption,
  or on public and private key pairs and asymmetric encryption. The trust
  relationships on either side are independent. In other words you can for
  example use a shared secret on the identity provider side and
  certificates on the service provider side if you chose.</p><p>When using symmetric encryption, you must define a shared secret
  string used both for the application and the provider. The sample uses
  <code class="literal">secret12</code> as the shared secret. To simplify
  configuration, the sample uses the same shared secret, and thus
  symmetric encryption, for both trust relationships.</p><p>When using symmetric encryption, you must also use the encoded
  version of your shared secret. To get the encoded version of a shared
  secret string, use the <code class="filename">encode.jsp</code> page on the
  provider, as in
  <code class="literal">http://idp.example.com:8080/openam/encode.jsp</code> and
  <code class="literal">http://sp.example.com:8080/openam/encode.jsp</code>. An
  encoded version of <code class="literal">secret12</code> looks something like
  <code class="literal">AQICEcFhDWmb6sVmMuCJuVh43306HVacDte9</code>.</p><p>When using asymmetric encryption, you must obtain a public-private
  key pair for the application, and store the keys in a key store on the
  application side. Also store the public key from OpenAM which is acting
  as the provider in the application's key store. Make note of the
  certificate aliases for your application's private key, and for OpenAM's
  public key. Also note the path to the key store for your application,
  the key store password, and the private key password.</p></div><div class="section" id="sae-secure-idp"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.3.&nbsp;Securing the Identity Provider Side</h2></div></div></div><p>This configuration uses the default sample settings with a shared
  secret of <code class="literal">secret12</code>, without encryption of the
  attributes.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Login as <code class="literal">amadmin</code> to the OpenAM server console
    where you set up the hosted identity provider (IDP).</p></li><li class="listitem"><p>As the sample includes a <code class="literal">branch</code> attribute not
    found in user profiles by default, under Access Control &gt;
    <em class="replaceable"><code>Realm Name</code></em> &gt; Authentication &gt; All Core
    Settings..., set User Profile to Ignored, and then Save your work.</p></li><li class="listitem"><div class="itemizedlist"><p>Under Federation &gt; Entity Providers, click the name for the
     Hosted IDP in order to access the IDP configuration.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Under Assertion Processing &gt; Attribute Mapper, add both
      <code class="literal">mail=mail</code> and <code class="literal">branch=branch</code> to
      the attribute map, and then Save your work.</p></li><li class="listitem"><p>Under Advanced &gt; SAE Configuration, make sure the IDP URL
      reflects an endpoint on the IDP such as
      <code class="literal">http://idp.example.com:8080/openam/idpsaehandler/metaAlias/idp</code>,
      and then Save your work.</p></li><li class="listitem"><p>Also under Advanced &gt; SAE Configuration &gt; Application
      Security Configuration, add the URL value for the kind of encryption you
      are using, and then Save your work.</p><p>When using the defaults, the value is something like
      <code class="literal">url=http://idp.example.com:8080/samples/saml2/sae/saeIDPApp.jsp|type=symmetric|secret=<em class="replaceable"><code>encoded-secret</code></em></code>, where the OpenAM SDK sample web
      application is deployed on the IDP side with context root
      <code class="literal">/samples</code> and the
      <em class="replaceable"><code>encoded-secret</code></em> is something like
      <code class="literal">AQICEcFhDWmb6sVmMuCJuVh43306HVacDte9</code>.</p><p>If you use a different mechanism to secure the communications
      between the SAE application and the provider, read the online help in the
      console to see how to construct your URL value.</p></li></ul></div></li><li class="listitem"><div class="itemizedlist"><p>Under Federation &gt; Entity Providers, click the name for the
     Remote SP in order to access the SP configuration on the IDP side.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Under Assertion Processing &gt; Attribute Mapper, add both
      <code class="literal">mail=mail</code> and <code class="literal">branch=branch</code> to
      the attribute map, and then Save your work.</p></li><li class="listitem"><p>Under Advanced &gt; SAE Configuration, make sure the SP URL
      reflects an endpoint on the SP such as
      <code class="literal">http://sp.example.com:8080/openam/spsaehandler/metaAlias/sp</code>,
      and then Save your work.</p></li><li class="listitem"><p>Also under Advanced &gt; SAE Configuration, add the URL to the
      sample SAE application as the SP Logout URL such as
      <code class="literal">http://sp.example.com:8080/samples/saml2/sae/saeSPApp.jsp</code>,
      and then Save your work.</p></li></ul></div></li></ol></div></div><div class="section" id="sae-secure-sp"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.4.&nbsp;Securing the Service Provider Side</h2></div></div></div><p>This configuration uses the default sample setting of symmetric
  encryption, with a shared secret of <code class="literal">secret12</code>.</p><div class="orderedlist"><p>Login as <code class="literal">amadmin</code> to the OpenAM server console where
   you set up the hosted service provider (SP).</p><ol class="orderedlist" type="1"><li class="listitem"><p>As the sample includes a <code class="literal">branch</code> attribute not
    found in user profiles by default, under Access Control &gt;
    <em class="replaceable"><code>Realm Name</code></em> &gt; Authentication &gt; All Core
    Settings..., set User Profile to Ignored, and then Save your work.</p></li><li class="listitem"><div class="itemizedlist"><p>Under Federation &gt; Entity Providers, click the name for the
     Hosted SP in order to access the SP configuration.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Under Assertion Processing &gt; Attribute Mapper, add both
      <code class="literal">mail=mail</code> and <code class="literal">branch=branch</code> to
      the attribute map, and then Save your work.</p></li><li class="listitem"><p>Also under Assertion Processing &gt; Attribute Mapper &gt; Auto
      Federation, select Enabled, set the Attribute to <code class="literal">mail</code>,
      and then Save your work.</p></li><li class="listitem"><p>Under Advanced &gt; SAE Configuration, make sure the SP URL
      reflects an endpoint on the SP such as
      <code class="literal">http://sp.example.com:8080/openam/spsaehandler/metaAlias/sp</code>,
      and then Save your work.</p></li><li class="listitem"><p>Furthermore, under Advanced &gt; SAE Configuration, add the URL to
      the sample SAE application as the SP Logout URL such as
      <code class="literal">http://sp.example.com:8080/samples/saml2/sae/saeSPApp.jsp</code>,
      and then Save your work.</p></li><li class="listitem"><p>Also under Advanced &gt; SAE Configuration &gt; Application Security
      Configuration, add the URL value for the kind of encryption you are using,
      and then Save your work.</p><p>When using the defaults, the value is something like
      <code class="literal">url=http://sp.example.com:8080/samples/saml2/sae/saeSPApp.jsp|type=symmetric|secret=<em class="replaceable"><code>encoded-secret</code></em></code>, where the OpenAM SDK sample web
      application is deployed on the IDP side with context root
      <code class="literal">/samples</code> and the
      <em class="replaceable"><code>encoded-secret</code></em> is something like
      <code class="literal">AQICkX24RbZboAVgr2FG1kWoqRv1zM2a6KEH</code>.</p><p>If you use a different mechanism to secure the communications
      between the SAE application and the provider, read the online help in the
      console to see how to construct your URL value.</p></li></ul></div></li></ol></div></div><div class="section" id="sae-trying-it-out"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.5.&nbsp;Trying It Out</h2></div></div></div><p>After completing the setup described above, navigate to the IDP side
  SAE application, for example at
  <code class="literal">http://idp.example.com:8080/samples/saml2/sae/saeIDPApp.jsp</code>.</p><div class="variablelist"><p>Make sure you set at least the "SP App URL" and "SAE URL on IDP end"
   to fit your configuration. For example if you used the settings above then
   use the following values.</p><dl class="variablelist"><dt><span class="term">SP App URL</span></dt><dd><p><code class="literal">http://sp.example.com:8080/samples/saml2/sae/saeSPApp.jsp</code></p></dd><dt><span class="term">SAE URL on IDP end</span></dt><dd><p><code class="literal">http://idp.example.com:8080/openam/idpsaehandler/metaAlias/idp</code></p></dd></dl></div><p>Check the settings, and then click Generate URL to open the Secure
  Attributes Exchange IDP APP SAMPLE page.</p><p>Click the <code class="literal">ssourl</code> link in the page to start the
  exchange.</p><p>The resulting web page shows the attributes exchanged, including the
  mail and branch values used. The text of that page is something like the
  following.</p><pre>SAE SP APP SAMPLE

Secure Attrs :
mail            testuser@foo.com
sun.idpentityid http://idp.example.com:8080/openam
sun.spentityid  http://sp.example.com:8080/openam
branch          mainbranch
sun.authlevel   0</pre></div></div><div lang="en" class="chapter" id="chap-csdk"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;12.&nbsp;Using the OpenAM C API</h1></div></div></div><a class="indexterm" name="d14138e5161"></a><p>This chapter introduces OpenAM C SDK. OpenAM C SDK is available for
 selected platforms on the OpenAM <a class="link" href="http://forgerock.org/openam.html" target="_blank">nightly builds page</a>.
 Contact <a class="link" href="mailto:info@forgerock.com" target="_top">info@forgerock.com</a>
 if you need OpenAM C SDK support.</p><p>To prepare to install OpenAM C SDK, first download the version for your
 platform and unpack the archive as in the following example.</p><pre class="cmdline prettyprint"># mkdir -p /path/to/openam-client
# cd /path/to/openam-client
$ unzip ~/Downloads/common_3_0_Linux_64bit.zip</pre><p>All C SDK deliveries are .zip files, and the filenames are self-explanatory.
 The <code class="filename">SunOS</code> in some of the .zip files refer to the Solaris
 OS.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">common_3_0_Linux.zip</code></p></li><li class="listitem"><p><code class="filename">common_3_0_Linux_64bit.zip</code></p></li><li class="listitem"><p><code class="filename">common_3_0_windows.zip</code></p></li><li class="listitem"><p><code class="filename">common_3_0_windows_64bit.zip</code></p></li><li class="listitem"><p><code class="filename">common_3_0_SunOS_x86.zip</code></p></li><li class="listitem"><p><code class="filename">common_3_0_SunOS_64bit.zip</code></p></li><li class="listitem"><p><code class="filename">common_3_0_SunOS_sparc.zip</code></p></li><li class="listitem"><p><code class="filename">common_3_0_SunOS_sparc_64bit.zip</code></p></li></ul></div><div class="variablelist"><p>Once unpacked, you have several directories that include
  the SDK, and also sample client applications.</p><dl class="variablelist"><dt><span class="term"><code class="filename">bin/</code></span></dt><dd><p>The <span class="command"><strong>crypt_util</strong></span> or <span class="command"><strong>cryptit.exe</strong></span>
    command for encrypting passwords</p></dd><dt><span class="term"><code class="filename">config/</code></span></dt><dd><p>Configuration data for the SDK</p></dd><dt><span class="term"><code class="filename">include/</code></span></dt><dd><p>Header files for the SDK</p></dd><dt><span class="term"><code class="filename">lib/</code></span></dt><dd><p>SDK and other required libraries</p></dd><dt><span class="term"><code class="filename">samples/</code></span></dt><dd><p>Sample code</p></dd></dl></div><div class="procedure" id="build-openam-csdk-client"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;12.1.&nbsp;To Build OpenAM C SDK Samples</div><ol class="procedure" type="1"><li class="step"><p>Review the <code class="filename">samples/README.TXT</code> file to complete
   any specific instructions required for your platform. The two commands
   shown here confirm that the specified system is a 64-bit Linux OS. Make
   sure it matches the C SDK package that you have downloaded.</p><pre class="cmdline prettyprint">$ uname -s
Linux
$ uname -m
x86_64</pre></li><li class="step"><p>Set up <code class="filename">OpenSSOAgentBootstrap.properties</code>
   and <code class="filename">OpenSSOAgentConfiguration.properties</code> as appropriate
   for your environment.</p><p>Base your work on the template files in the
   <code class="filename">config/</code> directory. You can find the Password Encryption
   Key in the OpenAM console under Configuration &gt; Servers and Sites &gt;
   <em class="replaceable"><code>Server Name</code></em> &gt; Security.</p></li><li class="step"><p>Try one of the samples you built to test your build.</p><pre class="cmdline prettyprint">$ LD_LIBRARY_PATH=../lib
 ./am_auth_test
 -f ../config/
 -u demo
 -p changeit
 -o /
   Login  1 Succeeded!
      SSOToken = AQIC5wM2LY4SfcxZfk4EzC9Y46P9cXG9ogwf2ixnYOeZ0K0.*AAJTSQACMDE.*
      Organization = /
      Module Instance Name [0] = SAE
      Module Instance Name [1] = LDAP
      Module Instance Name [2] = WSSAuthModule
      Module Instance Name [3] = Federation
      Module Instance Name [4] = HOTP
      Module Instance Name [5] = DataStore
   Logout 1 Succeeded!</pre></li></ol></div></div></div><div lang="en" class="chapter" id="chap-extending"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;13.&nbsp;Extending OpenAM</h1></div></div></div><p>OpenAM services solve a wide range of access and federation
 management problems out of the box. Yet, OpenAM also exposes APIs and
 SPIs that enable you extend OpenAM services when built-in functionality
 does not fit your deployment.</p><p>This part of the guide covers OpenAM mechanisms for plugging in
 additional functionality not available out of the box.</p></div><div lang="en" class="chapter" id="chap-custom-attr"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;14.&nbsp;Customizing Profile Attributes</h1></div></div></div><a class="indexterm" name="d14138e5306"></a><p>You can extend user profiles by adding custom attributes. This chapter
 demonstrates how to add a custom attribute to a user profile when storing
 user profiles in the embedded LDAP directory.</p><p>Adding a custom attribute involves both updating the
 <code class="literal">iPlanetAMUserService</code>, and also updating the identity
 repository schema to hold the new attribute. Furthermore, to allow users
 to update the attribute in their own profiles, you must also update the
 OpenAM policy configuration stored in the configuration directory.</p><div class="itemizedlist"><p>This chapter includes the following procedures.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="#add-attr-to-service-description" title="Procedure&nbsp;14.1.&nbsp;To Update the AMUser Service For the New Attribute">Procedure&nbsp;14.1, &#8220;To Update the AMUser Service For the New Attribute&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#add-attr-to-identity-repository" title="Procedure&nbsp;14.2.&nbsp;To Update the Identity Repository For the New Attribute">Procedure&nbsp;14.2, &#8220;To Update the Identity Repository For the New Attribute&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#allow-users-to-update-attr" title="Procedure&nbsp;14.3.&nbsp;To Allow Users To Update the New Attribute">Procedure&nbsp;14.3, &#8220;To Allow Users To Update the New Attribute&#8221;</a></p></li></ul></div><div class="procedure" id="add-attr-to-service-description"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;14.1.&nbsp;To Update the AMUser Service For the New Attribute</div><p>Follow the steps below to create a custom attribute in OpenAM.</p><ol class="procedure" type="1"><li class="step"><p>Create a backup copy of the configuration file for the
   <code class="literal">iPlanetAmUserService</code>.</p><pre class="cmdline prettyprint">$ cd $HOME
$ cp openam/config/xml/amUser.xml openam/config/xml/amUser.xml.orig</pre></li><li class="step"><p>Edit the file to add your attribute as one of the list of
   <code class="literal">&lt;User&gt;</code> attributes.</p><pre class="codelisting prettyprint lang-xml">&lt;AttributeSchema name="customAttribute"
    type="single"
    syntax="string"
    any="display"
    i18nKey="Custom Attribute"&gt;
&lt;/AttributeSchema&gt;</pre><p>Here, the name refers to the attribute type name used in LDAP. The
   <code class="literal">i18nKey</code> holds either the reference, or in this case the
   content, of the text that appears in the user interface.</p></li><li class="step"><p>Delete <code class="literal">iPlanetAMUserService</code>, and then create it
   from your updated configuration file.</p><pre class="cmdline prettyprint">$ cd /path/to/tools/openam/bin/
$ ssoadm
 delete-svc
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --servicename iPlanetAMUserService

Service was deleted.
$ ssoadm
 create-svc
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --xmlfile $HOME/openam/config/xml/amUser.xml

Service was added.</pre></li></ol></div></div><div class="procedure" id="add-attr-to-identity-repository"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;14.2.&nbsp;To Update the Identity Repository For the New Attribute</div><p>Follow the steps below to update the identity repository LDAP schema
  for the custom attribute, and then update OpenAM to use the custom attribute
  and object class.</p><p>If you are adding an existing attribute that is already allowed on
  user profile entries, you can skip this procedure.</p><div class="panel panel-success"><div class="panel-heading"><h3 class="panel-title">Tip</h3></div><div class="panel-body"><p>If you are using OpenDJ as the identity repository, you can update the
   schema through OpenDJ Control Panel &gt; Schema &gt; Manage Schema, as
   described in the <a class="link" href="http://docs.forgerock.org/en/opendj/2.6.0/admin-guide/#update-schema" target="_blank">OpenDJ documentation</a>.</p></div></div><ol class="procedure" type="1"><li class="step"><p>Prepare the attribute type object class definitions in LDIF
   format.</p><pre class="cmdline prettyprint">$ cat custom-attr.ldif 
dn: cn=schema
changetype: modify
add: attributeTypes
attributeTypes: ( temp-custom-attr-oid NAME 'customAttribute' EQUALITY case
 IgnoreMatch ORDERING caseIgnoreOrderingMatch SUBSTR caseIgnoreSubstrings
 Match SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 USAGE userApplications )
-
add: objectClasses
objectClasses: ( temp-custom-oc-oid NAME 'customObjectclass' SUP top AUX
 ILIARY MAY customAttribute )
</pre></li><li class="step"><p>Add the schema definitions to the directory.</p><pre class="cmdline prettyprint">$ /path/to/OpenDJ/bin/ldapmodify
 --port 1389
 --hostname openam.example.com
 --bindDN "cn=Directory Manager"
 --bindPassword password
 --filename custom-attr.ldif
Processing MODIFY request for cn=schema
MODIFY operation successful for DN cn=schema</pre></li><li class="step"><p>In OpenAM console, browse to Access Control &gt; <em class="replaceable"><code>Realm
   Name</code></em> &gt; Data Stores &gt; <em class="replaceable"><code>Data Store
   Name</code></em>.</p></li><li class="step"><p>Add the object class, here <code class="literal">customObjectclass</code>, to
   the LDAP User Object Class list.</p></li><li class="step"><p>Add the attribute type, here <code class="literal">customAttribute</code>, to
   the LDAP User Attributes list.</p></li><li class="step"><p>Save your work.</p></li></ol></div></div><div class="procedure" id="allow-users-to-update-attr"><div class="procedure-inner"><div class="procedure-title">Procedure&nbsp;14.3.&nbsp;To Allow Users To Update the New Attribute</div><p>Follow these steps to make the new attribute editable by users. The
  steps imply use of the embedded configuration directory. If you use a
  different directory server to store the configuration, then adapt them for
  your tools.</p><ol class="procedure" type="1"><li class="step"><p>Login to the control panel for the embedded configuration
   directory.</p><pre class="cmdline prettyprint">$ ./openam/opends/bin/control-panel &amp;</pre><p>Connect using bind DN <code class="literal">cn=Directory Manager</code> and the
   the password for <code class="literal">amadmin</code>.</p></li><li class="step"><p>Select Manage Entries to open the LDAP browser.</p></li><li class="step"><p>Search with <code class="literal">LDAP Filter:</code> set to
   <code class="literal">ou=SelfWriteAttributes</code>, and then expand the tree views
   to see the two entries found.</p></li><li class="step"><p>In the entry under <code class="literal">iPlanetAMPolicyService</code>, edit
   the <code class="literal">sunKeyValue</code> attribute to add your custom attribute to
   the list of self-writable attributes, as in
   <code class="literal">&lt;Value&gt;customAttribute&lt;/Value&gt;</code>.</p></li><li class="step"><p>In the entry under <code class="literal">sunEntitlementIndexes</code>, edit
   the <code class="literal">sunKeyValue</code> attribute to add your custom attribute to
   the list of self-writable attributes, as in replacing the last
   <code class="literal">\n</code> in the list with <code class="literal">,\n
   \"customAttribute\"\n</code>.</p></li><li class="step"><p>Restart OpenAM or the web container where it runs. The following example applies to Tomcat.</p><pre class="cmdline prettyprint">$ /path/to/tomcat/bin/shutdown.sh
$ /path/to/tomcat/bin/startup.sh</pre></li><li class="step"><p>Login to OpenAM console as a user to check that a user can save a
   value for your new, custom attribute.</p><div class="mediaobject" align="center" id="figure-bjensen-with-custom-attribute"><a class="fancybox" href="images/bjensen-with-custom-attribute.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_bjensen-with-custom-attribute.png" align="middle" alt="Saving Babs Jensen's profile with a custom attribute" title="If all goes well, you can save the new custom attribute to the&#xA;     user profile."></a></div></li></ol></div></div></div><div lang="en" class="chapter" id="chap-oauth2-scopes"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;15.&nbsp;Customizing OAuth 2.0 Scope Handling</h1></div></div></div><a class="indexterm" name="d14138e5488"></a><p>RFC 6749, <a class="link" href="http://tools.ietf.org/html/rfc6749" target="_blank"><em class="citetitle">The OAuth 2.0 Authorization Framework</em></a>,
 describes access token scopes as a set of case-sensitive strings defined by
 the authorization server. Clients can request scopes, and resource owners can
 authorize them.</p><p>The default scopes implementation in OpenAM treats scopes as profile
 attributes for the resource owner. When a resource server or other entity uses
 the access token to get token information from OpenAM, OpenAM populates the
 scopes with profile attribute values. For example, if one of the scopes
 is <code class="literal">mail</code>, OpenAM sets <code class="literal">mail</code> to the
 resource owner's email address in the token information returned.</p><p>You can change this behavior by writing your own scopes plugin. This
 chapter shows how to write a custom OAuth 2.0 scopes plugin for use in an
 OAuth 2.0 provider (authorization server) configuration.</p><div class="section" id="design-oauth2-scopes-plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both">15.1.&nbsp;Designing an OAuth 2.0 Scopes Plugin</h2></div></div></div><p>A scopes plugin implements the
  <code class="literal">org.forgerock.openam.oauth2.provider.Scope</code> interface. The
  <code class="literal">Scope</code> interface has four methods that your plugin
  overrides.</p><pre class="codelisting prettyprint linenums lang-java">public Set&lt;String&gt; scopeToPresentOnAuthorizationPage(
        Set&lt;String&gt; requestedScope,
        Set&lt;String&gt; availableScopes,
        Set&lt;String&gt; defaultScopes);

public Set&lt;String&gt; scopeRequestedForAccessToken(
        Set&lt;String&gt; requestedScope,
        Set&lt;String&gt; availableScopes,
        Set&lt;String&gt; defaultScopes);

public Set&lt;String&gt; scopeRequestedForRefreshToken(
        Set&lt;String&gt; requestedScope,
        Set&lt;String&gt; availableScopes,
        Set&lt;String&gt; allScopes,
        Set&lt;String&gt; defaultScopes);

public Map&lt;String, Object&gt; evaluateScope(AccessToken token);</pre><p>The first three methods return the scopes to display when the resource
  owner makes the authorization decision, or when an access token or refresh
  token is granted, respectively. The fourth method,
  <code class="literal">evaluateScope</code> can be used to set values for scopes
  returned when token information is requested.</p><p>The following example plugin sets whether <code class="literal">read</code> and
  <code class="literal">write</code> permissions were granted.</p><pre class="codelisting prettyprint linenums lang-java">package org.forgerock.openam.examples;

import java.util.HashMap;
import java.util.HashSet;
import java.util.Map;
import java.util.Set;

import org.forgerock.openam.oauth2.model.AccessToken;
import org.forgerock.openam.oauth2.provider.Scope;

/**
 * Custom scope providers implement the
 * {@link org.forgerock.openam.oauth2.provider.Scope} interface.
 *
 * This custom scope implementation follows the OpenAM default scope
 * implementation for all methods except {@link #evaluateScope}.
 *
 * The {@code evaluateScope} method is called when a client accesses
 * the {@code /tokeninfo} endpoint to retrieve token information.
 *
 * In this example, the method populates scope values returned in the
 * JSON with the token information.
 */
public class CustomScope implements Scope {

    @Override
    public Set&lt;String&gt; scopeToPresentOnAuthorizationPage(
            Set&lt;String&gt; requestedScope,
            Set&lt;String&gt; availableScopes,
            Set&lt;String&gt; defaultScopes) {

        if (requestedScope == null) {
            return defaultScopes;
        }

        Set&lt;String&gt; scopes = new HashSet&lt;String&gt;(availableScopes);
        scopes.retainAll(requestedScope);
        return scopes;
    }

    @Override
    public Set&lt;String&gt; scopeRequestedForAccessToken(
            Set&lt;String&gt; requestedScope,
            Set&lt;String&gt; availableScopes,
            Set&lt;String&gt; defaultScopes) {

        if (requestedScope == null){
            return defaultScopes;
        }

        Set&lt;String&gt; scopes = new HashSet&lt;String&gt;(availableScopes);
        scopes.retainAll(requestedScope);
        return scopes;
    }

    @Override
    public Set&lt;String&gt; scopeRequestedForRefreshToken(
            Set&lt;String&gt; requestedScope,
            Set&lt;String&gt; availableScopes,
            Set&lt;String&gt; allScopes,
            Set&lt;String&gt; defaultScopes) {

        if (requestedScope == null){
            return defaultScopes;
        }

        Set&lt;String&gt; scopes = new HashSet&lt;String&gt;(availableScopes);
        scopes.retainAll(requestedScope);
        return scopes;
    }

    @Override
    public Map&lt;String, Object&gt; evaluateScope(AccessToken token) {
        Set&lt;String&gt; scopes = token.getScope();

        Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();
        String[] permissions = {"read", "write"};

        for (String scope : permissions) {
            if (scopes.contains(scope)) {
               map.put(scope, true);
            } else {
                map.put(scope, false);
            }
        }

        return map;
    }
}</pre></div><div class="section" id="build-oauth2-scopes-plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both">15.2.&nbsp;Building an OAuth 2.0 Scopes Plugin</h2></div></div></div><p>As the plugin imports at least
  <code class="literal">org.forgerock.openam.oauth2.model.AccessToken</code>
  and <code class="literal">org.forgerock.openam.oauth2.provider.Scope</code>, add
  <code class="filename"></code> to
  the classpath.</p><p>After compiling, put it in a .jar file that you can deploy with
  OpenAM.</p><pre class="cmdline prettyprint">$ mkdir classes
$ javac -d classes
 -cp /path/to/.../openam/WEB-INF/lib/
 CustomScope.java
$ cd classes/
$ jar cf ../CustomScope.jar</pre></div><div class="section" id="configure-oauth2-scopes-plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both">15.3.&nbsp;Configuring OpenAM to Use the Plugin</h2></div></div></div><p>After building your plugin jar file, add the file under
  <code class="filename">WEB-INF/lib/</code> where you deployed OpenAM.</p><p>Restart OpenAM.</p><p>In OpenAM console, you can either configure a specific OAuth 2.0
  provider to use your plugin, or configure your plugin as the default for new
  OAuth 2.0 providers. To configure a specific OAuth 2.0 provider to use your
  plugin, add the class name of your scopes plugin under Access Control &gt;
  <em class="replaceable"><code>Realm Name</code></em> &gt; Services &gt; <em class="replaceable"><code>OAuth2
  Provider Name</code></em> &gt; Scope Implementation Class. To configure your
  plugin as the default for new providers, add the class name of your scopes
  plugin under Configuration &gt; Global &gt; OAuth2 Provider &gt; Scope
  Implementation Class.</p></div><div class="section" id="try-oauth2-scopes-plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both">15.4.&nbsp;Trying the Example Plugin</h2></div></div></div><p>If you build the example plugin shown above in
  <a class="xref" href="#design-oauth2-scopes-plugin" title="15.1.&nbsp;Designing an OAuth 2.0 Scopes Plugin">Section&nbsp;15.1, &#8220;Designing an OAuth 2.0 Scopes Plugin&#8221;</a>, and then create an OAuth 2.0
  client that takes scopes <code class="literal">read</code> and <code class="literal">write</code>,
  you can configure OpenAM to use the plugin, and then try it as shown in the
  following example.</p><pre class="cmdline prettyprint">$ curl
 -d "grant_type=client_credentials&amp;username=demo&amp;password=changeit
 &amp;client_id=myClientID&amp;client_secret=password&amp;scope=read"
 http://oauth2.example.com:8080/openam/oauth2/access_token
{
  "expires_in": 599,
  "token_type": "Bearer",
  "access_token": "84122d5e-0462-4d81-93c3-7bc58bd416b3"
}
$ curl http://oauth2.example.com:8080/openam/oauth2/tokeninfo
 ?access_token=84122d5e-0462-4d81-93c3-7bc58bd416b3
{
  "write": false,
  "read": true,
  "token_type": "Bearer",
  "expires_in": 539,
  "access_token": "84122d5e-0462-4d81-93c3-7bc58bd416b3"
}</pre></div></div><div lang="en" class="chapter" id="chap-auth-spi"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;16.&nbsp;Customizing Authentication Modules</h1></div></div></div><a class="indexterm" name="d14138e5589"></a><p>This chapter shows how to customize authentication with a sample custom
 authentication module. For deployments with particular requirements not met by
 existing OpenAM authentication modules, determine whether you can adapt one of
 the built-in or extension modules for your needs. If not, build the
 functionality into a custom authentication module.</p><div class="section" id="about-custom-auth-module"><div class="titlepage"><div><div><h2 class="title" style="clear: both">16.1.&nbsp;About the Sample Authentication Module</h2></div></div></div><p>The sample authentication module prompts for a user name and password
  to authenticate the user, and handles error conditions. The sample shows how
  you integrate an authentication module into OpenAM such that you can
  configure the module through OpenAM console, and also localize the user
  interface.</p><div class="variablelist"><p>The <a class="link" href="https://github.com/markcraig/openam-auth-sample" target="_blank">sample authentication module source</a> is available
   online. Get a local clone so that you can try the sample on your system.
   In the sources you find the following files.</p><dl class="variablelist"><dt><span class="term"><code class="filename">pom.xml</code></span></dt><dd><p>Apache Maven project file for the module</p><p>This file specifies how to build the sample authentication module,
     and also specifies its dependencies on OpenAM components and on the
     Java Servlet API.</p></dd><dt><span class="term"><code class="filename">src/main/java/org/forgerock/openam/examples/SampleAuth.java</code></span></dt><dd><p>Core class for the sample authentication module</p><p>This class is called by OpenAM to initialize the module and to
     process authentication. See
     <a class="xref" href="#authentication-logic-sample-auth-module" title="16.4.&nbsp;The Sample Authentication Logic">Section&nbsp;16.4, &#8220;The Sample Authentication Logic&#8221;</a> for details.</p></dd><dt><span class="term"><code class="filename">src/main/java/org/forgerock/openam/examples/SampleAuthPrincipal.java</code></span></dt><dd><p>Class implementing <code class="literal">java.security.Principal</code>
     interface that defines how to map credentials to identities</p><p>This class is used to process authentication. See
     <a class="xref" href="#principal-sample-auth-module" title="16.5.&nbsp;The Sample Auth Principal">Section&nbsp;16.5, &#8220;The Sample Auth Principal&#8221;</a> for details.</p></dd><dt><span class="term"><code class="filename">src/main/resources/amAuthSampleAuth.properties</code></span></dt><dd><p>Properties file mapping UI strings to property values</p><p>This file makes it easier to localize the UI. See
     <a class="xref" href="#properties-sample-auth-module" title="16.2.&nbsp;Sample Auth Properties">Section&nbsp;16.2, &#8220;Sample Auth Properties&#8221;</a> for details.</p></dd><dt><span class="term"><code class="filename">src/main/resources/amAuthSampleAuth.xml</code></span></dt><dd><p>Configuration file for the sample authentication service</p><p>This file is used when registering the authentication module with
     OpenAM. See <a class="xref" href="#service-conf-sample-auth-module" title="16.6.&nbsp;The Sample Auth Service Configuration">Section&nbsp;16.6, &#8220;The Sample Auth Service Configuration&#8221;</a> for details.</p></dd><dt><span class="term"><code class="filename">src/main/resources/config/auth/default/SampleAuth.xml</code></span></dt><dd><p>Callback file for OpenAM classic UI authentication pages</p><p>The sample authentication module does not include localized versions
     of this file. See <a class="xref" href="#callbacks-file-sample-auth-module" title="16.3.&nbsp;Sample Auth Callbacks">Section&nbsp;16.3, &#8220;Sample Auth Callbacks&#8221;</a> for
     details.</p></dd></dl></div></div><div class="section" id="properties-sample-auth-module"><div class="titlepage"><div><div><h2 class="title" style="clear: both">16.2.&nbsp;Sample Auth Properties</h2></div></div></div><p>OpenAM uses a Java properties file per locale to retrieve the
  appropriate, localized strings for the authentication module.</p><p>The following is the Sample Authentication Module properties file,
  <code class="filename">amAuthSampleAuth.properties</code>.</p><pre class="codelisting prettyprint linenums lang-java">sampleauth-service-description=Sample Authentication Module
a500=Authentication Level
a501=Service Specific Attribute

sampleauth-ui-login-header=Login
sampleauth-ui-username-prompt=User Name:
sampleauth-ui-password-prompt=Password:

sampleauth-error-1=Error 1 occurred during the authentication
sampleauth-error-2=Error 2 occurred during the authentication</pre></div><div class="section" id="callbacks-file-sample-auth-module"><div class="titlepage"><div><div><h2 class="title" style="clear: both">16.3.&nbsp;Sample Auth Callbacks</h2></div></div></div><p>OpenAM callbacks XML files are used to build the classic UI to prompt
  the user for identity information needed to process the authentication.
  The document type for a callback XML file is described in
  <code class="filename">WEB-INF/Auth_Module_Properties.dtd</code> where OpenAM is
  deployed.</p><div class="example" id="full-callbacks-file"><div class="example-title">Example&nbsp;16.1.&nbsp;Sample Auth Callbacks File</div><div class="example-contents"><p>The following is the <code class="filename">SampleAuth.xml</code> callbacks
   file.</p><pre class="codelisting prettyprint lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE ModuleProperties PUBLIC
 "=//iPlanet//Authentication Module Properties XML Interface 1.0 DTD//EN"
        "jar://com/sun/identity/authentication/Auth_Module_Properties.dtd"&gt;

&lt;ModuleProperties moduleName="SampleAuth" version="1.0" &gt;
    &lt;Callbacks length="0" order="1" timeout="600" header="#NOT SHOWN#" /&gt;
    &lt;Callbacks length="2" order="2" timeout="600" header="#TO BE SUBSTITUTED#"&gt;
        &lt;NameCallback isRequired="true"&gt;
            &lt;Prompt&gt;#USERNAME#&lt;/Prompt&gt;
        &lt;/NameCallback&gt;
        &lt;PasswordCallback echoPassword="false" &gt;
            &lt;Prompt&gt;#PASSWORD#&lt;/Prompt&gt;
        &lt;/PasswordCallback&gt;
    &lt;/Callbacks&gt;
    &lt;Callbacks length="1" order="3" timeout="600" header="#TO BE SUBSTITUTED#"
        error="true" &gt;
        &lt;NameCallback&gt;
            &lt;Prompt&gt;#THE DUMMY WILL NEVER BE SHOWN#&lt;/Prompt&gt;
        &lt;/NameCallback&gt;
    &lt;/Callbacks&gt;
&lt;/ModuleProperties&gt;</pre><div class="orderedlist"><p>This file specifies three states.</p><ol class="orderedlist" type="1"><li class="listitem"><p>The initial state (order="1") is used dynamically to replace the
     dummy strings shown between hashes (for example,
     <code class="literal">#USERNAME#</code>) by the
     <code class="literal">substituteUIStrings()</code> method in
     <code class="filename">SampleAuth.java</code>.</p></li><li class="listitem"><p>The next state (order="2") handles prompting the user for
     authentication information.</p></li><li class="listitem"><p>The last state (order="3") has the attribute
     <code class="literal">error="true"</code>. If the authentication module state
     machine reaches this order then the authentication has failed. The
     <code class="literal">NameCallback</code> is not used and not displayed to user.
     OpenAM requires that the callbacks array have at least one element.
     Otherwise OpenAM does not permit header substitution.</p></li></ol></div></div></div><br class="example-break"></div><div class="section" id="authentication-logic-sample-auth-module"><div class="titlepage"><div><div><h2 class="title" style="clear: both">16.4.&nbsp;The Sample Authentication Logic</h2></div></div></div><p>An OpenAM authentication module must extend the
  <code class="literal">com.sun.identity.authentication.spi.AMLoginModule</code> abstract
  class, and must implement the methods shown below.</p><p>See the <a class="link" href="${javadocBase}" target="_blank"><em class="citetitle">OpenAM Java SDK API Specification</em></a> for
  reference.</p><pre class="codelisting prettyprint linenums lang-java">
// OpenAM calls the init() method once when the module is created.
public void init(Subject subject, Map sharedState, Map options)

// OpenAM calls the process() method when the user submits authentication
// information. The process() method determines what happens next:
// success, failure, or the next state specified by the order
// attribute in the callbacks XML file.
public int process(Callback[] callbacks, int state) throws LoginException

// OpenAM expects the getPrincipal() method to return an implementation of
// the java.security.Principal interface.
public Principal getPrincipal()</pre><p>OpenAM does not reuse authentication module instances. This means that
  you can store information specific to the authentication process in the
  instance.</p><p>The implementation, <code class="filename">SampleAuth.java</code>, is shown
  below.</p><div class="informalexample"><pre class="codelisting prettyprint linenums lang-java">/**
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.
 *
 * Copyright (c) 2011-2013 ForgeRock AS. All Rights Reserved
 *
 * The contents of this file are subject to the terms
 * of the Common Development and Distribution License
 * (the License). You may not use this file except in
 * compliance with the License.
 *
 * You can obtain a copy of the License at
 * http://forgerock.org/license/CDDLv1.0.html
 * See the License for the specific language governing
 * permission and limitations under the License.
 *
 * When distributing Covered Code, include this CDDL
 * Header Notice in each file and include the License file
 * at http://forgerock.org/license/CDDLv1.0.html
 * If applicable, add the following below the CDDL Header,
 * with the fields enclosed by brackets [] replaced by
 * your own identifying information:
 * "Portions Copyrighted [year] [name of copyright owner]"
 *
 */

package org.forgerock.openam.examples;

import java.security.Principal;
import java.util.Map;
import java.util.ResourceBundle;

import javax.security.auth.Subject;
import javax.security.auth.callback.Callback;
import javax.security.auth.callback.NameCallback;
import javax.security.auth.callback.PasswordCallback;
import javax.security.auth.login.LoginException;

import com.sun.identity.authentication.spi.AMLoginModule;
import com.sun.identity.authentication.spi.AuthLoginException;
import com.sun.identity.authentication.spi.InvalidPasswordException;
import com.sun.identity.authentication.util.ISAuthConstants;
import com.sun.identity.shared.datastruct.CollectionHelper;
import com.sun.identity.shared.debug.Debug;



public class SampleAuth extends AMLoginModule
{

    // Name for the debug-log
    private final static String DEBUG_NAME = "SampleAuth";

    // Name of the resource bundle
    private final static String amAuthSampleAuth = "amAuthSampleAuth";

    // User names for authentication logic
    private final static String USERNAME = "demo";
    private final static String ERROR_1_NAME = "test1";
    private final static String ERROR_2_NAME = "test2";

    // Orders defined in the callbacks file
    private final static int STATE_BEGIN = 1;
    private final static int STATE_AUTH = 2;
    private final static int STATE_ERROR = 3;

    private final static Debug debug = Debug.getInstance(DEBUG_NAME);

    private Map options;
    private ResourceBundle bundle;



    public SampleAuth()
    {
        super();
    }



    @Override
    // This method stores service attributes and localized properties
    // for later use.
    public void init(Subject subject, Map sharedState, Map options)
    {
        if (debug.messageEnabled())
        {
            debug.message("SampleAuth::init");
        }
        this.options = options;
        bundle = amCache.getResBundle(amAuthSampleAuth, getLoginLocale());
    }



    @Override
    public int process(Callback[] callbacks, int state) throws LoginException
    {

        if (debug.messageEnabled())
        {
            debug.message("SampleAuth::process state: " + state);
        }

        switch (state)
        {

            case STATE_BEGIN:
                // No time wasted here - simply modify the UI and
                // proceed to next state
                substituteUIStrings();
                return STATE_AUTH;

            case STATE_AUTH:
                // Get data from callbacks. Refer to callbacks XML file.
                NameCallback nc = (NameCallback) callbacks[0];
                PasswordCallback pc = (PasswordCallback) callbacks[1];
                String username = nc.getName();
                String password = new String(pc.getPassword());

                // First errorstring is stored in "sampleauth-error-1" property.
                if (username.equals(ERROR_1_NAME))
                {
                    setErrorText("sampleauth-error-1");
                    return STATE_ERROR;
                }

                // Second errorstring is stored in "sampleauth-error-2" property.
                if (username.equals(ERROR_2_NAME))
                {
                    setErrorText("sampleauth-error-2");
                    return STATE_ERROR;
                }

                if (username.equals(USERNAME) &amp;&amp; password.equals("changeit"))
                {
                    return ISAuthConstants.LOGIN_SUCCEED;
                }

                throw new InvalidPasswordException("password is wrong", USERNAME);

            case STATE_ERROR:
                return STATE_ERROR;
            default:
                throw new AuthLoginException("invalid state");

        }
    }



    @Override
    public Principal getPrincipal()
    {
        return new SampleAuthPrincipal(USERNAME);
    }



    private void setErrorText(String err) throws AuthLoginException
    {
        // Receive correct string from properties and substitute the
        // header in callbacks order 3.
        substituteHeader(STATE_ERROR, bundle.getString(err));
    }



    private void substituteUIStrings() throws AuthLoginException
    {
        // Get service specific attribute configured in OpenAM
        String ssa = CollectionHelper.getMapAttr(options,
                "sampleauth-service-specific-attribute");

        // Get property from bundle
        String new_hdr = ssa + " "
                + bundle.getString("sampleauth-ui-login-header");
        substituteHeader(STATE_AUTH, new_hdr);

        Callback[] cbs_phone = getCallback(STATE_AUTH);

        replaceCallback(STATE_AUTH, 0, new NameCallback(bundle
                .getString("sampleauth-ui-username-prompt")));

        replaceCallback(STATE_AUTH, 1, new PasswordCallback(bundle
                .getString("sampleauth-ui-password-prompt"), false));
    }

}
</pre></div></div><div class="section" id="principal-sample-auth-module"><div class="titlepage"><div><div><h2 class="title" style="clear: both">16.5.&nbsp;The Sample Auth Principal</h2></div></div></div><p>The implementation, <code class="filename">SampleAuthPrincipal.java</code>, is
  shown below.</p><div class="informalexample"><pre class="codelisting prettyprint linenums lang-java">/**
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.
 *
 * Copyright (c) 2011-2013 ForgeRock AS. All Rights Reserved
 *
 * The contents of this file are subject to the terms
 * of the Common Development and Distribution License
 * (the License). You may not use this file except in
 * compliance with the License.
 *
 * You can obtain a copy of the License at
 * http://forgerock.org/license/CDDLv1.0.html
 * See the License for the specific language governing
 * permission and limitations under the License.
 *
 * When distributing Covered Code, include this CDDL
 * Header Notice in each file and include the License file
 * at http://forgerock.org/license/CDDLv1.0.html
 * If applicable, add the following below the CDDL Header,
 * with the fields enclosed by brackets [] replaced by
 * your own identifying information:
 * "Portions Copyrighted [year] [name of copyright owner]"
 *
 */

package org.forgerock.openam.examples;



import java.io.Serializable;
import java.security.Principal;



public class SampleAuthPrincipal implements Principal, Serializable
{
    private final String name;
    private final static String CLASSNAME = "SampleAuthPrincipal";
    private final static String COLON = " : ";



    public SampleAuthPrincipal(String name)
    {
        if (name == null)
        {
            throw new NullPointerException("illegal null input");
        }

        this.name = name;
    }



    /**
     * Return the LDAP username for this &lt;code&gt; SampleAuthPrincipal &lt;/code&gt;.
     *
     * @return the LDAP username for this &lt;code&gt; SampleAuthPrincipal &lt;/code&gt;
     */
    @Override
    public String getName()
    {
        return name;
    }



    /**
     * Return a string representation of this &lt;code&gt; SampleAuthPrincipal &lt;/code&gt;.
     *
     * @return a string representation of this
     *         &lt;code&gt;TestAuthModulePrincipal&lt;/code&gt;.
     */
    @Override
    public String toString()
    {
        return new StringBuilder().append(CLASSNAME).append(COLON)
                .append(name).toString();
    }



    /**
     * Compares the specified Object with this &lt;code&gt; SampleAuthPrincipal &lt;/code&gt;
     * for equality. Returns true if the given object is also a
     * &lt;code&gt; SampleAuthPrincipal &lt;/code&gt; and the two SampleAuthPrincipal have
     * the same username.
     *
     * @param o Object to be compared for equality with this
     *          &lt;code&gt; SampleAuthPrincipal &lt;/code&gt;.
     * @return true if the specified Object is equal equal to this
     *         &lt;code&gt; SampleAuthPrincipal &lt;/code&gt;.
     */
    @Override
    public boolean equals(Object o)
    {
        if (o == null)
        {
            return false;
        }

        if (this == o)
        {
            return true;
        }

        if (!(o instanceof SampleAuthPrincipal))
        {
            return false;
        }
        SampleAuthPrincipal that = (SampleAuthPrincipal) o;

        if (this.getName().equals(that.getName()))
        {
            return true;
        }
        return false;
    }



    /**
     * Return a hash code for this &lt;code&gt; SampleAuthPrincipal &lt;/code&gt;.
     *
     * @return a hash code for this &lt;code&gt; SampleAuthPrincipal &lt;/code&gt;.
     */
    @Override
    public int hashCode()
    {
        return name.hashCode();
    }
}
</pre></div></div><div class="section" id="service-conf-sample-auth-module"><div class="titlepage"><div><div><h2 class="title" style="clear: both">16.6.&nbsp;The Sample Auth Service Configuration</h2></div></div></div><p>OpenAM requires that all authentication modules be configured by means
  of an OpenAM service. At minimum, the service must include an authentication
  level attribute. Your module can access these configuration attributes in
  the <code class="literal">options</code> parameter passed to the
  <code class="literal">init()</code> method.</p><div class="itemizedlist"><p>Some observations about the service configuration file follow in the
   list below.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The document type for a service configuration file is described in
    <code class="filename">WEB-INF/sms.dtd</code> where OpenAM is deployed.</p></li><li class="listitem"><p>The service name is taken from the module name:
    <code class="literal">iPlanetAMAuth<em class="replaceable"><code>module-name</code></em>Service</code>.
    In this case, the service name is
    <code class="literal">iPlanetAMAuthSampleAuthService</code>.</p></li><li class="listitem"><p>The service must have a localized description, retrieved from a
    properties file.</p></li><li class="listitem"><p>The <code class="literal">i18nFileName</code> attribute in the service
    configuration holds the default (non-localized) base name of the Java
    properties file. The <code class="literal">i18nKey</code> attributes indicate
    properties keys to string values in the Java properties file.</p></li><li class="listitem"><p>The authentication level attribute name is taken from the module name:
    <code class="literal">iplanet-am-auth-<em class="replaceable"><code>module-name</code></em>-auth-level</code>,
    where the <em class="replaceable"><code>module-name</code></em> is all lower case. Here,
    the authentication level attribute is named
    <code class="literal">iplanet-am-auth-sampleauth-auth-level</code>.</p></li><li class="listitem"><p>The Sample Auth service configuration includes an example
    <code class="literal">sampleauth-service-specific-attribute</code>, which can be
    configured through OpenAM console.</p></li></ul></div><p>The service configuration file,
  <code class="filename">amAuthSampleAuth.xml</code>, is shown below.</p><pre class="codelisting prettyprint lang-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!--
   DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.

   Copyright (c) 2011 ForgeRock AS. All Rights Reserved

   The contents of this file are subject to the terms
   of the Common Development and Distribution License
   (the License). You may not use this file except in
   compliance with the License.

   You can obtain a copy of the License at
   http://forgerock.org/license/CDDLv1.0.html
   See the License for the specific language governing
   permission and limitations under the License.

   When distributing Covered Code, include this CDDL
   Header Notice in each file and include the License file
   at http://forgerock.org/license/CDDLv1.0.html
   If applicable, add the following below the CDDL Header,
   with the fields enclosed by brackets [] replaced by
   your own identifying information:
   "Portions Copyrighted [year] [name of copyright owner]"
--&gt;
&lt;!DOCTYPE ServicesConfiguration
    PUBLIC "=//iPlanet//Service Management Services (SMS) 1.0 DTD//EN"
    "jar://com/sun/identity/sm/sms.dtd"&gt;

&lt;ServicesConfiguration&gt;
 &lt;Service name="iPlanetAMAuthSampleAuthService" version="1.0"&gt;
  &lt;Schema
   serviceHierarchy="/DSAMEConfig/authentication/iPlanetAMAuthSampleAuthService"
   i18nFileName="amAuthSampleAuth" revisionNumber="10"
   i18nKey="sampleauth-service-description"&gt;
   &lt;Organization&gt;
    &lt;AttributeSchema name="iplanet-am-auth-sampleauth-auth-level"
     type="single" syntax="number_range" rangeStart="0" rangeEnd="2147483647"
     i18nKey="a500"&gt;
     &lt;DefaultValues&gt;
      &lt;Value&gt;1&lt;/Value&gt;
     &lt;/DefaultValues&gt;
    &lt;/AttributeSchema&gt;

    &lt;AttributeSchema name="sampleauth-service-specific-attribute"
     type="single" syntax="string" validator="no" i18nKey="a501"&gt;
     &lt;DefaultValues&gt;
      &lt;Value&gt;&lt;/Value&gt;
     &lt;/DefaultValues&gt;
    &lt;/AttributeSchema&gt;

    &lt;SubSchema name="serverconfig" inheritance="multiple"&gt;
     &lt;AttributeSchema name="iplanet-am-auth-sampleauth-auth-level"
      type="single" syntax="number_range" rangeStart="0" rangeEnd="2147483647"
      i18nKey="a500"&gt;
      &lt;DefaultValues&gt;
       &lt;Value&gt;1&lt;/Value&gt;
      &lt;/DefaultValues&gt;
     &lt;/AttributeSchema&gt;

     &lt;AttributeSchema name="sampleauth-service-specific-attribute"
      type="single" syntax="string" validator="no" i18nKey="a501"&gt;
      &lt;DefaultValues&gt;
       &lt;Value&gt;&lt;/Value&gt;
      &lt;/DefaultValues&gt;
     &lt;/AttributeSchema&gt;

    &lt;/SubSchema&gt;
   &lt;/Organization&gt;
  &lt;/Schema&gt;
 &lt;/Service&gt;
&lt;/ServicesConfiguration&gt;</pre></div><div class="section" id="build-config-sample-auth-module"><div class="titlepage"><div><div><h2 class="title" style="clear: both">16.7.&nbsp;Building &amp; Installing the Sample Auth Module</h2></div></div></div><p>Build the module with Apache Maven, and install the module in
  OpenAM.</p><div class="section" id="building-sample-auth-module"><div class="titlepage"><div><div><h3 class="title">16.7.1.&nbsp;Building the Module</h3></div></div></div><p>Build the module using Apache Maven.</p><pre class="cmdline prettyprint">$ cd /path/to/openam-auth-sample
$ mvn install
[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building openam-auth-sample 1.0.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------
...

[INFO]
[INFO] --- maven-jar-plugin:2.3.1:jar (default-jar) @ openam-auth-sample ---
[INFO] Building jar: ...target/openam-auth-sample-1.0.0-SNAPSHOT.jar
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 3.651s
[INFO] Finished at: Thu Oct 03 11:19:07 CEST 2013
[INFO] Final Memory: 20M/226M
[INFO] ------------------------------------------------------------------------</pre><p>After you successfully build the module, you find the .jar in
   the <code class="filename">target/</code> directory of the project.</p></div><div class="section" id="installing-sample-auth-module"><div class="titlepage"><div><div><h3 class="title">16.7.2.&nbsp;Installing the Module</h3></div></div></div><p>Installing the sample authentication module consists of copying the
   .jar to OpenAM's <code class="filename">WEB-INF/lib/</code> directory, registering
   the module with OpenAM, and then restarting OpenAM or the web application
   container where it runs.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Copy the sample authentication module .jar file to
     <code class="filename">WEB-INF/lib/</code> where OpenAM is deployed.</p><pre class="cmdline prettyprint">$ cp target/openam-auth-sample*.jar /path/to/tomcat/webapps/openam/WEB-INF/lib/</pre></li><li class="listitem"><p>Register the module with OpenAM using the <span class="command"><strong>ssoadm</strong></span>
     command.</p><pre class="cmdline prettyprint">$ ssoadm
 create-svc
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --xmlfile amAuthSampleAuth.xml

Service was added.
$ ssoadm
 register-auth-module
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --authmodule org.forgerock.openam.examples.SampleAuth

Authentication module was registered.</pre><p>See the <a href="../reference/index.html#ssoadm-1" class="link"><span class="command"><strong>ssoadm</strong></span>
     reference</a> a full list of Authentication Service Management
     subcommands.</p></li><li class="listitem"><p>Restart OpenAM or the container in which it runs.</p><p>For example if you deployed OpenAM in Apache Tomcat, then you shut
     down Tomcat and start it again.</p><pre class="cmdline prettyprint">$ /path/to/tomcat/bin/shutdown.sh
$ /path/to/tomcat/bin/startup.sh
$ tail -1 /path/to/tomcat/logs/catalina.out
INFO: Server startup in 14736 ms</pre></li></ol></div></div></div><div class="section" id="configuring-testing-sample-auth-module"><div class="titlepage"><div><div><h2 class="title" style="clear: both">16.8.&nbsp;Configuring &amp; Testing the Sample Auth Module</h2></div></div></div><p>Authentication modules are registered as services with OpenAM globally,
  and then set up for use in a particular realm. In this example, you set up
  the sample authentication module for use in the realm / (Top Level Realm).</p><p>Login to OpenAM Console as OpenAM administrator,
  <code class="literal">amadmin</code>, and browse to Access Control
  &gt; / (Top Level Realm) &gt; Authentication &gt; Module Instances.
  Then click New, and create an instance of the Sample Authentication Module.
  Name the module <code class="literal">Sample</code>.</p><div class="mediaobject" align="center" id="figure-register-sample-auth"><a class="fancybox" href="images/register-sample-auth.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_register-sample-auth.png" align="middle" alt="Sample authentication module registration" title="The module type is Sample Authentication Module."></a></div><p>After creating the module, click the name in the Module Instances
  list, and configure as appropriate.</p><div class="mediaobject" align="center" id="figure-sampleauth-conf"><a class="fancybox" href="images/sampleauth-conf.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_sampleauth-conf.png" align="middle" alt="Sample authentication module configuration" title="The module has two configurable properties, Authentication Level and&#xA;    Service Specific Attribute."></a></div><p>Now that the module is configured, logout of OpenAM console.</p><p>Finally, try the module by specifying the <code class="literal">Sample</code>
  module using a query string parameter. Browse to the login URL such as
  <code class="literal">http://openam.example.com:8080/openam/UI/Login?module=Sample</code>,
  and then authenticate with user name <code class="literal">demo</code> and password
  <code class="literal">changeit</code>.</p><div class="mediaobject" align="center" id="figure-openam-auth-sample-login"><a class="fancybox" href="images/openam-auth-sample-login.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_openam-auth-sample-login.png" align="middle" alt="Sample authentication module login page" title="On the login page, you can see the string you set as the value of&#xA;    Service Specific Attribute."></a></div><p>After authentication you are redirected to the end user page for
  the demo user. You can logout of OpenAM console, and then try the
  authentication as users <code class="literal">test1</code> or <code class="literal">test2</code>
  to see what the error handling looks like to the user.</p></div></div><div lang="en" class="chapter" id="chap-custom-quota-exhaustion-action"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;17.&nbsp;Customizing Session Quota Exhaustion Actions</h1></div></div></div><p>This chapter demonstrates how to develop a custom session quota
 exhaustion action. You only need a custom session quota exhaustion action
 if the built-in actions, described in the <em class="citetitle">Administration
 Guide</em> procedure <a href="../admin-guide/index.html#session-quotas-and-exhaustion-actions" class="link"><em class="citetitle">To Configure
 Session Quotas &amp; Exhaustion Actions</em></a>, are not flexible
 enough for your deployment.</p><div class="section" id="create-custom-quota-exhaustion-action"><div class="titlepage"><div><div><h2 class="title" style="clear: both">17.1.&nbsp;Creating &amp; Installing a Custom Session Quota Exhaustion Action</h2></div></div></div><p>You build custom session quota exhaustion actions into a .jar that
  you then plug in to OpenAM. You must also add your new action to the Session
  service configuration, and restart OpenAM in order to be able to configure it
  for your use.</p><p>Your custom session quota exhaustion action implements the
  <code class="literal">com.iplanet.dpro.session.service.QuotaExhaustionAction</code>
  interface, overriding the <code class="literal">action</code> method. The
  <code class="literal">action</code> method performs the action when the session quota
  is met, and returns <code class="literal">true</code> only if the request for a new
  session should <span class="emphasis"><em>not</em></span> be granted.</p><p>The following example simply removes the first session it finds as
  the session quota exhaustion action.</p><pre class="codelisting prettyprint linenums lang-java">package org.forgerock.openam.examples.quotaexhaustionaction;

import com.iplanet.dpro.session.Session;
import com.iplanet.dpro.session.SessionException;
import com.iplanet.dpro.session.SessionID;
import com.iplanet.dpro.session.service.InternalSession;
import com.iplanet.dpro.session.service.QuotaExhaustionAction;
import com.iplanet.dpro.session.service.SessionService;
import com.sun.identity.shared.debug.Debug;
import java.util.Map;

  public class SampleQuotaExhaustionAction implements QuotaExhaustionAction {

    private static Debug debug = SessionService.sessionDebug;

    /**
     * Check if the session quota for a given user has been exhausted and
     * if so perform the necessary actions. This implementation randomly
     * destroys the first session it finds.
     *
     * @param is               The InternalSession to be activated.
     * @param existingSessions All existing sessions that belong to the same
     *                         uuid (Map:sid-&gt;expiration_time).
     * @return true If the session activation request should be rejected,
     *              otherwise false.
     */
    @Override
    public boolean action(InternalSession is, Map&lt;String, Long&gt; existingSessions) {
        for (Map.Entry&lt;String, Long&gt; entry : existingSessions.entrySet()) {
            try {
                // Get an actual Session instance based on the session ID.
                Session session = Session.getSession(new SessionID(entry.getKey()));
                //we use the session to destroy itself.
                session.destroySession(session);
                // Only destroy the first session.
                break;
            } catch (SessionException se) {
                if (debug.messageEnabled()) {
                    debug.message("Failed to destroy existing session.", se);
                }
                // In this case, deny the session activation request.
                return true;
            }
        }
        return false;
    }
}</pre><p>When you have prepared the class file, compile it into a .jar.
  The following example shows compilation against the libraries with OpenAM
  deployed in Apache Tomcat.</p><pre class="cmdline prettyprint">$ mkdir classes
$ javac
 -d classes
 -cp /path/to/tomcat/webapps/openam/WEB-INF/lib/openam-core-11.0.0-SNAPSHOT.jar:
  /path/to/tomcat/webapps/openam/WEB-INF/lib/openam-shared-11.0.0-SNAPSHOT.jar:
  /path/to/tomcat/lib/servlet-api.jar
 org/forgerock/openam/examples/quotaexhaustionaction/SampleQuotaExhaustionAction.java
$ cd classes
$ jar cvf ../my-quota-exhaustion-action.jar *
$ cd ..</pre><p>Add the .jar into <code class="filename">WEB-INF/lib/</code> where OpenAM is
  deployed.</p><pre class="cmdline prettyprint">$ cp my-quota-exhaustion-action.jar /path/to/tomcat/webapps/openam/WEB-INF/lib/</pre><p>Using the <span class="command"><strong>ssoadm</strong></span> command, update the Session service
  configuration.</p><pre class="cmdline prettyprint">$ ssoadm
 set-attr-choicevals
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --servicename iPlanetAMSessionService
 --schematype Global
 --attributename iplanet-am-session-constraint-handler
 --add
 --choicevalues myKey=
 org.forgerock.openam.examples.quotaexhaustionaction.SampleQuotaExhaustionAction

Choice Values were set.</pre><p>Add the following line to
  <code class="filename">WEB-INF/classes/amSession.properties</code> where OpenAM
  is deployed.</p><pre class="cmdline prettyprint">myKey=Randomly Destroy Session</pre><p>Restart OpenAM or the underlying container.</p><p>You can now use the new session quota exhaustion action in the
  OpenAM console under Configuration &gt; Global &gt; Session &gt;
  Resulting behavior if session quota exhausted.</p><p>Before moving to your test and production environments, be sure to
  add your .jar and updates to <code class="filename">amSession.properties</code> into
  a custom .war that you can then deploy. You must still update the Session
  service configuration in order to use your custom session quota exhaustion
  action.</p></div><div class="section" id="list-custom-quota-exhaustion-actions"><div class="titlepage"><div><div><h2 class="title" style="clear: both">17.2.&nbsp;Listing Session Quota Exhaustion Actions</h2></div></div></div><p>List session quota exhaustion actions with the <span class="command"><strong>ssoadm</strong></span>
  command.</p><pre class="cmdline prettyprint">$ ssoadm
 get-attr-choicevals
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --servicename iPlanetAMSessionService
 --schematype Global
 --attributename iplanet-am-session-constraint-handler

I18n Key                  Choice Value
------------------------- ---...-----------------------------------------
choiceDestroyOldSession   org...session.service.DestroyOldestAction
choiceDenyAccess          org...session.service.DenyAccessAction
choiceDestroyNextExpiring org...session.service.DestroyNextExpiringAction
choiceDestroyAll          org...session.service.DestroyAllAction
myKey                     org...examples...SampleQuotaExhaustionAction</pre></div><div class="section" id="remove-custom-quota-exhaustion-actions"><div class="titlepage"><div><div><h2 class="title" style="clear: both">17.3.&nbsp;Removing a Session Quota Exhaustion Action</h2></div></div></div><p>Remove a session quota exhaustion action with the
  <span class="command"><strong>ssoadm</strong></span> command.</p><pre class="cmdline prettyprint">$ ssoadm
 remove-attr-choicevals
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --servicename iPlanetAMSessionService
 --schematype Global
 --attributename iplanet-am-session-constraint-handler
 --choicevalues
 org.forgerock.openam.examples.quotaexhaustionaction.SampleQuotaExhaustionAction

Choice Values were removed.</pre></div></div><div lang="en" class="chapter" id="chap-post-auth"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;18.&nbsp;Creating a Post Authentication Plugin</h1></div></div></div><a class="indexterm" name="d14138e6065"></a><p>Post authentication plugins (PAP) let you include custom processing at
 the end of the authentication process, immediately before the subject is
 authenticated. Common uses of post authentication plugins include setting
 cookies and session variables. Post authentication plugins are often used in
 conjunction with policy agents. The post authentication plugin sets custom
 session properties, and then the policy agent injects the custom properties
 into the request header to the protected application.</p><p>This chapter explains how to create a post authentication plugin.</p><div class="section" id="design-post-authentication-plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both">18.1.&nbsp;Designing Your Post Authentication Plugin</h2></div></div></div><p>Your post authentication plugin class implements the
  <code class="literal">AMPostAuthProcessInterface</code> interface, and in particular
  the following three methods.</p><pre class="codelisting prettyprint linenums lang-java">public void onLoginSuccess(
  Map requestParamsMap, 
  HttpServletRequest request,
  HttpServletResponse response,
  SSOToken token
) throws AuthenticationException

public void onLoginFailure(
  Map requestParamsMap, 
  HttpServletRequest request,
  HttpServletResponse response
) throws AuthenticationException

public void onLogout(
  HttpServletRequest request, 
  HttpServletResponse response,
  SSOToken token
) throws AuthenticationException</pre><p>OpenAM calls the <code class="literal">onLoginSuccess()</code> and
  <code class="literal">onLoginFailure()</code> methods immediately before informing the
  user of login success or failure, respectively. OpenAM calls the
  <code class="literal">onLogout()</code> method only when the user actively logs out,
  not when a user's session times out.</p><p>See the <a class="link" href="${javadocBase}" target="_blank"><em class="citetitle">OpenAM Java SDK API Specification</em></a> for
  reference.</p><p>These methods can perform whatever processing you require. Yet, know
  that OpenAM calls your methods synchronously as part of the authentication
  process. Therefore, if your methods take a long time to complete, you will
  keep users waiting. Minimize the processing done in your post authentication
  methods.</p></div><div class="section" id="build-post-authentication-plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both">18.2.&nbsp;Building Your Sample Post Authentication Plugin</h2></div></div></div><p>The following example post authentication plugin sets a session
  property during successful login, writing to its debug log if the operation
  fails.</p><pre class="codelisting prettyprint linenums lang-java">package com.forgerock.openam.examples;

import java.util.Map;

import com.iplanet.sso.SSOException;
import com.iplanet.sso.SSOToken;

import com.sun.identity.authentication.spi.AMPostAuthProcessInterface;
import com.sun.identity.authentication.spi.AuthenticationException;
import com.sun.identity.shared.debug.Debug;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class SamplePAP implements AMPostAuthProcessInterface
{
  private final static String PROP_NAME = "MyProperty";
  private final static String PROP_VALUE = "MyValue";
  private final static String DEBUG_FILE = "SamplePAP";

  protected Debug debug = Debug.getInstance(DEBUG_FILE);

  public void onLoginSuccess(
    Map requestParamsMap, 
    HttpServletRequest request,
    HttpServletResponse response,
    SSOToken token
  ) throws AuthenticationException
  {
    try {
      token.setProperty(PROP_NAME, PROP_VALUE);
    } catch (SSOException ssoe) {
      debug.error("Unable to set property");
    }
  }

  public void onLoginFailure(
    Map requestParamsMap, 
    HttpServletRequest request,
    HttpServletResponse response
  ) throws AuthenticationException
  {
    ; // Not used
  }

  public void onLogout(
    HttpServletRequest request, 
    HttpServletResponse response,
    SSOToken token
  ) throws AuthenticationException
  {
    ; // Not used
  }
}</pre><p>A post authentication plugin code relies on three .jar files, two
  of which are deployed with OpenAM, and the third which is provided by your
  web application container.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename"></code></span></dt><dd><p>When you deploy OpenAM, the file is
     <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/lib/</code>.</p></dd><dt><span class="term"><code class="filename"></code></span></dt><dd><p>When you deploy OpenAM, the file is
     <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/lib/</code>.</p></dd><dt><span class="term"><code class="filename">servlet-api.jar</code></span></dt><dd><p>This .jar provides the Java EE Servlet API.</p><p>If you use Apache Tomcat as your web application container, the file
     is <code class="filename">/path/to/tomcat/lib/servlet-api.jar</code>.</p></dd></dl></div><p>Put the sample plugin in
  <code class="filename">src/com/forgerock/openam/examples/SamplePAP.java</code>,
  and compile the class.</p><pre class="cmdline prettyprint">$ cd src
$ mkdir ../classes
$ javac
 -d ../classes
 -classpath /path/to/tomcat/webapps/openam/WEB-INF/lib/:
 /path/to/tomcat/webapps/openam/WEB-INF/lib/:
 /path/to/tomcat/lib/servlet-api.jar
 com/forgerock/openam/examples/SamplePAP.java</pre><p>Copy the classes to the <code class="filename">WEB-INF/classes</code> directory
  where you deployed OpenAM.</p><pre class="cmdline prettyprint">$ cp -r ../classes/* /path/to/tomcat/webapps/openam/WEB-INF/classes/</pre><p>Restart OpenAM or your web container to ensure the post authentication
  plugin class is loaded.</p><pre class="cmdline prettyprint">$ /etc/init.d/tomcat stop
$ /etc/init.d/tomcat start
$ tail -1 /path/to/tomcat/logs/catalina.out
INFO: Server startup in 32070 ms</pre></div><div class="section" id="configure-post-authentication-plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both">18.3.&nbsp;Configuring Your Post Authentication Plugin</h2></div></div></div><p>You can configure the post authentication plugin for a realm, for a
  service (authentication chain), or for a role. Where you configure the plugin
  depends on the scope to which the plugin should apply. Configuring the plugin
  at the realm level as shown here, for example, ensures that OpenAM calls your
  plugin for all authentications to the realm.</p><p>In the OpenAM console, browse to Access Control &gt; <em class="replaceable"><code>Realm
  Name</code></em> &gt; Authentication &gt; All Core Settings... In the
  Authentication Post Processing Classes list, add the sample plugin class,
  <code class="literal">com.forgerock.openam.examples.SamplePAP</code>, and then click
  Save.</p><p>Alternatively, you can configure sample plugin for the realm by using
  the <span class="command"><strong>ssoadm</strong></span> command.</p><pre class="cmdline prettyprint">$ ssoadm
 set-svc-attrs
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --servicename iPlanetAMAuthService
 --realm /realm
 --attributevalues iplanet-am-auth-post-login-process-class=
 com.forgerock.openam.examples.SamplePAP

iPlanetAMAuthService under /realm was modified.</pre></div><div class="section" id="test-post-authentication-plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both">18.4.&nbsp;Testing Your Post Authentication Plugin</h2></div></div></div><p>To test the sample post authentication plugin, login successfully to
  OpenAM in the scope where the plugin is configured. For example, if you
  configured your plugin for the realm, <code class="literal">/realm</code>, specify the
  realm in the login URL.</p><pre class="literallayout">http://openam.example.com:8080/openam/UI/Login?realm=realm</pre><p>Although as a user you do not notice anywhere in the user interface
  that OpenAM calls your plugin, a policy agent or custom client code could
  retrieve the session property your plugin added to the user session.</p></div></div><div lang="en" class="chapter" id="chap-policy-spi"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;19.&nbsp;Customizing Policy Evaluation</h1></div></div></div><a class="indexterm" name="d14138e6202"></a><p>OpenAM policies let you restrict access to resources based both on
 identity and group membership, and also on a range of conditions including
 session age, authentication chain or module used, authentication level, realm,
 session properties, IP address and DNS name, user profile content, resource
 environment, date, day, time of day, and time zone. Yet, some deployments
 require further distinctions for policy evaluation. This chapter explains how
 to customize policy evaluation for deployments with particular requirements
 not met by built-in OpenAM functionality.</p><p>OpenAM comes with sample plugins that demonstrate how to customize
 policy evaluation. This chapter shows how to compile the samples, and how
 to configure OpenAM to use one of the plugins.</p><div class="section" id="about-sample-policy-plugins"><div class="titlepage"><div><div><h2 class="title" style="clear: both">19.1.&nbsp;About the Sample Plugins</h2></div></div></div><p>The OpenAM policy framework lets you build plugins to extend subjects,
  conditions, and response providers for policies, and also extend referrals
  for policy delegation. You can find Java code for sample
  policy evaluation plugins in the <a class="link" href="http://sources.forgerock.org/browse/~br=trunk/openam/trunk/openam/openam-distribution/src/main/amserver/samples/server/source/com/sun/identity/samples/policy" target="_blank">OpenAM project source code</a>. Download the sample Java class
  files into a suitable location, such as
  <code class="filename">~/Downloads/com/sun/identity/samples/policy/</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">SampleCondition.java</code></span></dt><dd><p>Extends the <code class="literal">Condition</code> interface. Shows an
     implementation of a condition to base the policy decision on the length
     of the user name.</p></dd><dt><span class="term"><code class="filename">SampleReferral.java</code></span></dt><dd><p>Extends the <code class="literal">Referral</code> interface. Shows an
     implementation of a policy referral for delegation.</p></dd><dt><span class="term"><code class="filename">SampleResponseProvider.java</code></span></dt><dd><p>Extends the <code class="literal">ResponseProvider</code> interface. Shows an
     implementation of a response provider to send an attribute from the user
     profile with the response.</p></dd><dt><span class="term"><code class="filename">SampleSubject.java</code></span></dt><dd><p>Extends the <code class="literal">Subject</code> interface. Shows an
     implementation that defines the users to whom the policy applies, in this
     case all authenticated users.</p></dd></dl></div><p>Before including the plugins in OpenAM, you compile the four files, and
  package the classes into a .jar for deployment.</p><p>The sample policy evaluation code relies on two .jar files deployed
  with OpenAM.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename"></code></span></dt><dd><p>When you deploy OpenAM, the file is
      <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/lib/</code>.</p></dd><dt><span class="term"><code class="filename"></code></span></dt><dd><p>When you deploy OpenAM, the file is
      <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/lib/</code>.</p></dd></dl></div><pre class="cmdline prettyprint">$ cd /path/to/tomcat/webapps/openam/
$ mkdir classes
$ javac -d classes
 -classpath /path/to/tomcat/webapps/openam/WEB-INF/lib/:
  /path/to/tomcat/webapps/openam/WEB-INF/lib/
  ~/Downloads/com/sun/identity/samples/policy/Sample*.java
$ cd classes/
$ jar cf ../policy-plugins.jar .</pre><p>The .jar belongs under
  <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/lib/</code>.</p><pre class="cmdline prettyprint">$ cp ../policy-plugins.jar /path/to/tomcat/webapps/openam/WEB-INF/lib</pre><p>Alternatively, you can add individual classes under
  <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/classes/</code>.</p></div><div class="section" id="configure-sample-policy-plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both">19.2.&nbsp;Configuring A Sample Policy Plugin</h2></div></div></div><p>This section shows how to configure the sample custom policy condition
  that you built. Configuration involves defining the strings that describe
  the policy condition, and plugging the policy condition into the
  <code class="literal">iPlanetAMPolicyService</code>, and then restarting OpenAM
  to be able to add the condition to your policies.</p><p>You need to update two files where the strings describing your plugin are
  included as properties values.</p><p>In <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/classes/amPolicy.properties</code>
  add this property:</p><pre class="literallayout">samplecondition-policy-name=Sample Condition</pre><p>In <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/classes/amPolicyConfig.properties</code>
  add this property:</p><pre class="literallayout">x100=Sample Condition</pre><p>Add the schema that describes your plugin to OpenAM.</p><pre class="cmdline prettyprint">$ ssoadm
 add-plugin-schema
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --servicename iPlanetAMPolicyService
 --interfacename Condition
 --pluginname SampleCondition
 --i18nname amPolicy
 --i18nkey samplecondition-policy-name
 --classname com.sun.identity.samples.policy.SampleCondition

Plug-in schema, Condition was added to service, iPlanetAMPolicyService.</pre><p>Set the choice values of the schema to include your plugin with other
  policy conditions in the policy service.</p><pre class="cmdline prettyprint">$ ssoadm
 set-attr-choicevals
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --servicename iPlanetAMPolicyConfigService
 --schematype Organization
 --attributename iplanet-am-policy-selected-conditions
 --add
 --choicevalues "x100=SampleCondition"

Choice Values were set.</pre><p>Set the plugin policy condition as one of the default attibutes of the
  policy service.</p><pre class="cmdline prettyprint">$ ssoadm
 add-attr-defs
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --servicename iPlanetAMPolicyConfigService
 --schematype Organization
 --attributevalues "iplanet-am-policy-selected-conditions=SampleCondition"

Schema attribute defaults were added.</pre><p>After completing configuration, restart OpenAM or the web application
  container.</p><pre class="cmdline prettyprint">$ /etc/init.d/tomcat stop
Password: 
Using CATALINA_BASE:   /path/to/tomcat
Using CATALINA_HOME:   /path/to/tomcat
Using CATALINA_TMPDIR: /path/to/tomcat/temp
Using JRE_HOME:        /path/to/jdk/jre
Using CLASSPATH:       /path/to/tomcat/bin/bootstrap.jar:
 /path/to/tomcat/bin/tomcat-juli.jar
$ /etc/init.d/tomcat start
Password: 
Using CATALINA_BASE:   /path/to/tomcat
Using CATALINA_HOME:   /path/to/tomcat
Using CATALINA_TMPDIR: /path/to/tomcat/temp
Using JRE_HOME:        /path/to/jdk/jre
Using CLASSPATH:       /path/to/tomcat/bin/bootstrap.jar:
 /path/to/tomcat/bin/tomcat-juli.jar</pre><p>In OpenAM console, browse to Access Control &gt; <em class="replaceable"><code>Realm
  Name</code></em> &gt; Policies &gt; <em class="replaceable"><code>Policy Name</code></em>
  &gt; Conditions &gt; New... Notice in the list of conditions that you can
  now apply your Sample Condition.</p><div class="mediaobject" align="center" id="figure-sample-condition"><a class="fancybox" href="images/sample-condition.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_sample-condition.png" align="middle" alt="Sample Condition in list of conditions" title="The sample condition you added is present in the list of&#xA;    conditions."></a></div></div></div><div lang="en" class="chapter" id="chap-identity-repo-spi"><div class="titlepage"><div><div><h1 class="title">Chapter&nbsp;20.&nbsp;Customizing Identity Data Storage</h1></div></div></div><a class="indexterm" name="d14138e6373"></a><p>OpenAM maps user and group identities into a realm using data stores.
 An OpenAM data store relies on a Java identity repository (IdRepo) plugin to
 implement interaction with the identity repository where the users and groups
 are stored.</p><div class="section" id="about-idrepo-plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both">20.1.&nbsp;About the Identity Repository Plugin</h2></div></div></div><p>This chapter describes how to create a custom identity repository plugin.
  OpenAM includes built-in support for LDAP and JDBC identity repositories. For
  most deployments, you therefore do not need to create your own custom identity
  repository plugin. Only create custom identity repository plugins for
  deployments with particular requirements not met by built-in OpenAM
  functionality.</p><div class="panel panel-success"><div class="panel-heading"><h3 class="panel-title">Tip</h3></div><div class="panel-body"><p>Before creating your own identity repository plugin, start by reading
   the OpenAM source code for the <code class="literal">FilesRepo</code> or
   <code class="literal">DatabaseRepo</code> plugins under
   <code class="literal">com.sun.identity.idm.plugins</code>.</p></div></div><div class="section" id="idrepo-plugin-inheritance"><div class="titlepage"><div><div><h3 class="title">20.1.1.&nbsp;IdRepo Inheritance</h3></div></div></div><p>Your identity repository plugin class must extend the
   <code class="literal">com.sun.identity.idm.IdRepo</code> abstract class, and must
   include a constructor method that takes no arguments.</p></div><div class="section" id="idrepo-plugin-lifecycle"><div class="titlepage"><div><div><h3 class="title">20.1.2.&nbsp;IdRepo Lifecycle</h3></div></div></div><p>When OpenAM instantiates your IdRepo plugin, it calls the
   <code class="literal">initialize()</code> method.</p><pre class="codelisting prettyprint linenums lang-java">public void initialize(Map configParams)</pre><p>The <code class="literal">configParams</code> are service configuration
   parameters for the realm where the IdRepo plugin is configured. The
   <code class="literal">configParams</code> normally serve to set up communication with
   the underlying identity data store. OpenAM calls the
   <code class="literal">initialize()</code> method once, and considers the identity
   repository ready for use.</p><p>If you encounter errors or exceptions during initialization, catch
   and store them in your plugin for use later when OpenAM calls other plugin
   methods.</p><p>After initialization, OpenAM calls the <code class="literal">addListener()</code>
   and <code class="literal">removeListener()</code> methods to register listeners that
   inform OpenAM client code of changes to identities managed by your
   IdRepo.</p><pre class="codelisting prettyprint linenums lang-java">public int addListener(SSOToken token, IdRepoListener listener)
public void removeListener()</pre><p>You must handle listener registration in your IdRepo plugin, and also
   return events to OpenAM through the <code class="literal">IdRepoListener</code>.</p><p>When stopping, OpenAM calls your IdRepo plugin
   <code class="literal">shutdown()</code> method.</p><pre class="codelisting prettyprint linenums lang-java">public void shutdown()</pre><p>You are not required to implement <code class="literal">shutdown()</code> unless
   your IdRepo plugin has shut down work of its own to do, such as close
   connections to the underlying identity data store.</p></div><div class="section" id="idrepo-plugin-capabilties"><div class="titlepage"><div><div><h3 class="title">20.1.3.&nbsp;IdRepo Plugin Capabilities</h3></div></div></div><p>Your IdRepo plugin provides OpenAM with a generic means to manage
   subjects&#8212;including users and groups but also special types such as
   roles, realms, and agents&#8212; and to create, read, update, delete, and
   search subjects. In order for OpenAM to determine your plugin's capabilities,
   it calls the methods described in this section.</p><pre class="codelisting prettyprint linenums lang-java">public Set getSupportedTypes()</pre><p>The <code class="literal">getSupportedTypes()</code> method returns a set of
   <code class="literal">IdType</code> objects, such as <code class="literal">IdType.USER</code>
   and <code class="literal">IdType.GROUP</code>. You can either hard-code the supported
   types into your plugin, or make them configurable through the IdRepo
   service.</p><pre class="codelisting prettyprint linenums lang-java">public Set getSupportedOperations(IdType type)</pre><p>The <code class="literal">getSupportedOperations()</code> method returns a set
   of <code class="literal">IdOperation</code> objects, such as
   <code class="literal">IdOperation.CREATE</code> and
   <code class="literal">IdOperation.EDIT</code>. You can also either hard-code these, or
   make them configurable.</p><pre class="codelisting prettyprint linenums lang-java">public boolean supportsAuthentication()</pre><p>The <code class="literal">supportsAuthentication()</code> method returns true if
   your plugin supports the <code class="literal">authenticate()</code> method.</p></div></div><div class="section" id="idrepo-plugin-implementation"><div class="titlepage"><div><div><h2 class="title" style="clear: both">20.2.&nbsp;Identity Repository Plugin Implementation</h2></div></div></div><p>Your IdRepo plugin implements operational methods depending on what
  you support. These methods perform the operations in your data store.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Create</span></dt><dd><p>OpenAM calls <code class="literal">create()</code> to provision a new identity
     in the repository, where <code class="literal">name</code> is the new identity's
     name, and <code class="literal">attrMap</code> holds the attributes names and
     values.</p><pre class="codelisting prettyprint linenums lang-java">public String create(SSOToken token, IdType type, String name, Map attrMap)
  throws IdRepoException, SSOException</pre></dd><dt><span class="term">Read</span></dt><dd><p>OpenAM calls the following methods to retrieve subjects in the
     identity repository, and to check account activity. If your data store
     does not support binary attributes, return an empty <code class="literal">Map</code>
     for <code class="literal">getBinaryAttributes()</code>.</p><pre class="codelisting prettyprint linenums lang-java">public boolean isExists(
  SSOToken token,
  IdType type,
  String name
) throws IdRepoException, SSOException

public boolean isActive(
  SSOToken token,
  IdType type,
  String name
) throws IdRepoException, SSOException

public Map getAttributes(
  SSOToken token,
  IdType type,
  String name
) throws IdRepoException, SSOException

public Map getAttributes(
  SSOToken token,
  IdType type,
  String name,
  Set attrNames
) throws IdRepoException, SSOException

public Map getBinaryAttributes(
  SSOToken token,
  IdType type,
  String name,
  Set attrNames
) throws IdRepoException, SSOException

public RepoSearchResults search(
  SSOToken token,
  IdType type,
  String pattern,
  Map avPairs,
  boolean recursive,
  int maxResults,
  int maxTime,
  Set returnAttrs
) throws IdRepoException, SSOException

public RepoSearchResults search(
  SSOToken token,
  IdType type,
  String pattern,
  int maxTime,
  int maxResults,
  Set returnAttrs,
  boolean returnAllAttrs,
  int filterOp,
  Map avPairs,
  boolean recursive
) throws IdRepoException, SSOException</pre></dd><dt><span class="term">Edit</span></dt><dd><p>OpenAM calls the following methods to update a subject in the
     identity repository.</p><pre class="codelisting prettyprint linenums lang-java">public void setAttributes(
  SSOToken token,
  IdType type,
  String name,
  Map attributes,
  boolean isAdd
) throws IdRepoException, SSOException

public void setBinaryAttributes(
  SSOToken token,
  IdType type,
  String name,
  Map attributes,
  boolean isAdd
) throws IdRepoException, SSOException

public void removeAttributes(
  SSOToken token,
  IdType type,
  String name,
  Set attrNames
) throws IdRepoException, SSOException

public void modifyMemberShip(
  SSOToken token,
  IdType type,
  String name,
  Set members,
  IdType membersType,
  int operation
) throws IdRepoException, SSOException

public void setActiveStatus(
  SSOToken token,
  IdType type,
  String name,
  boolean active
)</pre></dd><dt><span class="term">Authenticate</span></dt><dd><p>OpenAM calls <code class="literal">authenticate()</code> with the credentials
     from the <code class="literal">DataStore</code> authentication module.</p><pre class="codelisting prettyprint linenums lang-java">public boolean authenticate(Callback[] credentials)
  throws IdRepoException, AuthLoginException</pre></dd><dt><span class="term">Delete</span></dt><dd><p>The <code class="literal">delete()</code> method removes the subject from
     the identity repository. The <code class="literal">name</code> specifies the
     subject.</p><pre class="codelisting prettyprint linenums lang-java">public void delete(SSOToken token, IdType type, String name)
  throws IdRepoException, SSOException</pre></dd><dt><span class="term">Service</span></dt><dd><p>The <code class="literal">IdOperation.SERVICE</code> operation is rarely used
     in recent OpenAM deployments.</p></dd></dl></div></div><div class="section" id="idrepo-plugin-deployment"><div class="titlepage"><div><div><h2 class="title" style="clear: both">20.3.&nbsp;Identity Repository Plugin Deployment</h2></div></div></div><p>Your IdRepo plugin must link to <code class="filename"></code>,
  which when you deploy OpenAM is
  <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/lib/</code>.</p><p>You can either package your plugin as a .jar, and then add it to
  <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/lib/</code>,
  or add the classes under
  <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/classes/</code>.</p><p>To register your plugin with OpenAM, you add a
  <code class="literal">SubSchema</code> to the
  <code class="literal">sunIdentityRepositoryService</code> using the
  <span class="command"><strong>ssoadm</strong></span> command. First, you create the
  <code class="literal">SubSchema</code> document having the following structure.</p><pre class="codelisting prettyprint lang-xml">&lt;SubSchema i18nKey="x4000" inheritance="multiple" maintainPriority="no"
           name="CustomRepo" supportsApplicableOrganization="no" validate="yes"&gt;
 &lt;AttributeSchema cosQualifier="default" isSearchable="no"
                  name="RequiredValueValidator" syntax="string"
                  type="validator" &gt;
  &lt;DefaultValues&gt;
   &lt;Value&gt;com.sun.identity.sm.RequiredValueValidator&lt;/Value&gt;
  &lt;/DefaultValues&gt;
 &lt;/AttributeSchema&gt;
 &lt;AttributeSchema any="required" cosQualifier="default"
                  i18nKey="x4001" isSearchable="no"
                  name="sunIdRepoClass" syntax="string"
                  type="single" validator="RequiredValueValidator" &gt;
  &lt;DefaultValues&gt;
   &lt;Value&gt;org.test.CustomRepo&lt;/Value&gt;
  &lt;/DefaultValues&gt;
 &lt;/AttributeSchema&gt;
 &lt;AttributeSchema cosQualifier="default" i18nKey="x4002" isSearchable="no"
                  name="sunIdRepoAttributeMapping" syntax="string" type="list"&gt;
  &lt;DefaultValues&gt;
    &lt;Value&gt;&lt;/Value&gt;
  &lt;/DefaultValues&gt;
 &lt;/AttributeSchema&gt;
&lt;/SubSchema&gt;</pre><p>Also include the <code class="literal">AttributeSchema</code> required to
  configure your IdRepo plugin.</p><p>Notice the <code class="literal">i18nKey</code> attributes on
  <code class="literal">SubSchema</code> elements. The <code class="literal">i18nKey</code>
  attribute values correspond to properties in the
  <code class="filename">amIdRepoService.properties</code> file, stored under
  <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/classes/</code>.
  OpenAM console displays the label for the configuration user interface that
  it retrieves from the value of the <code class="literal">i18nKey</code> property in the
  <code class="filename">amIdRepoService.properties</code> file.</p><p>Register your plugin using the <span class="command"><strong>ssoadm</strong></span> command after
  copy the files into place.</p><pre class="cmdline prettyprint">$ ssoadm
 add-sub-schema
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --servicename sunIdentityRepositoryService
 --schematype Organization
 --filename customIdRepo.xml
 --subschemaname CustomRepo</pre><p>Login to OpenAM console as administrator, then then Browse to Access
  Control &gt; <em class="replaceable"><code>Realm Name</code></em> &gt; Data Stores. In the
  Data Stores table, click New... to create a Data Store corresponding to your
  custom IdRepo plugin. In the first screen of the wizard, name the Data Store
  and select the type corresponding to your plugin. In the second screen of the
  wizard, add the configuration for your plugin.</p><p>After creating the Data Store, create a new subject in the realm to
  check that your plugin works as expected. You can do this under Access
  Control &gt; <em class="replaceable"><code>Realm Name</code></em> &gt; Subjects.</p><p>If your plugin supports authentication, then users should now be able
  to authenticate using the <code class="literal">DataStore</code> module for the
  realm.</p><pre class="literallayout">http://openam.example.com:8080/openam/UI/Login?realm=test&amp;module=DataStore</pre></div></div><div class="index" id="d14138e6682"><div class="titlepage"><div><div><h1 class="title">Index</h1></div></div></div><div xmlns:xlink="http://www.w3.org/1999/xlink" class="index"><div class="indexdiv"><h3>A</h3><dl><dt id="ientry-d14138e421">Authentication</dt><dd><dl><dt>Custom module, <a class="indexterm" href="#chap-auth-spi">Customizing Authentication Modules</a></dt><dt>Java API, <a class="indexterm" href="#chap-authentication">Authenticating Using OpenAM Java SDK</a></dt><dt>Post authentication plugins, <a class="indexterm" href="#chap-post-auth">Creating a Post Authentication Plugin</a></dt><dt>REST API, <a class="indexterm" href="#rest-api-auth">Authentication &amp; Logout</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>D</h3><dl><dt id="ientry-d14138e2283">Dashboard services, <a class="indexterm" href="#rest-dashboard">Displaying Dashboard Applications</a></dt></dl></div><div class="indexdiv"><h3>F</h3><dl><dt id="ientry-d14138e3169">Fedlets</dt><dd><dl><dt>.NET, <a class="indexterm" href="#chap-fedlet-dotnet">Using Fedlets in .NET Applications</a></dt><dt>Java, <a class="indexterm" href="#chap-fedlet-java">Using Fedlets in Java Web Applications</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>I</h3><dl><dt id="ientry-d14138e2427">Installing</dt><dd><dl><dt>C SDK, <a class="indexterm" href="#chap-csdk">Using the OpenAM C API</a></dt><dt>Java SDK samples, <a class="indexterm" href="#install-jdk-samples">Installing OpenAM Client SDK Samples</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>O</h3><dl><dt id="ientry-d14138e940">OAuth 2.0, <a class="indexterm" href="#chap-oauth2-scopes">Customizing OAuth 2.0 Scope Handling</a></dt><dd><dl><dt>REST API, <a class="indexterm" href="#rest-api-oauth2">OAuth 2.0 Authorization</a></dt></dl></dd><dt id="ientry-d14138e1383">OpenID Connect 1.0</dt><dd><dl><dt>REST API, <a class="indexterm" href="#rest-api-openid-connect">OpenID Connect 1.0</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>P</h3><dl><dt id="ientry-d14138e1566">Password reset, <a class="indexterm" href="#rest-api-password-reset">Resetting Forgotten Passwords</a></dt><dt id="ientry-d14138e733">Policy</dt><dd><dl><dt>Java API, <a class="indexterm" href="#chap-policy-decisions">Requesting Policy Decisions Using OpenAM Java SDK</a></dt><dt>Plugins, <a class="indexterm" href="#chap-policy-spi">Customizing Policy Evaluation</a></dt><dt>REST API, <a class="indexterm" href="#rest-api-authz">Authorization</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>R</h3><dl><dt id="ientry-d14138e2047">Realm data</dt><dd><dl><dt>REST access, <a class="indexterm" href="#rest-api-crud-realm">Realm Management</a></dt></dl></dd><dt id="ientry-d14138e302">REST API, <a class="indexterm" href="#chap-rest">Using RESTful Web Services</a></dt></dl></div><div class="indexdiv"><h3>S</h3><dl><dt id="ientry-d14138e4868">Secure Attribute Exchange (SAE), <a class="indexterm" href="#chap-sae">Using Secure Attribute Exchange</a></dt><dt id="ientry-d14138e1499">Self-registration, <a class="indexterm" href="#rest-api-self-registration">User Self-Registration</a></dt><dt id="ientry-d14138e426">Session tokens</dt><dd><dl><dt>Java API, <a class="indexterm" href="#chap-session">Handling Single Sign-On Using OpenAM Java SDK</a></dt><dt>REST API, <a class="indexterm" href="#rest-api-auth">Authentication &amp; Logout</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>U</h3><dl><dt id="ientry-d14138e712">User data</dt><dd><dl><dt>Custom profile attributes, <a class="indexterm" href="#chap-custom-attr">Customizing Profile Attributes</a></dt><dt>Custom repository, <a class="indexterm" href="#chap-identity-repo-spi">Customizing Identity Data Storage</a></dt><dt>REST access, <a class="indexterm" href="#rest-api-tokens">Token Validation, Attribute Retrieval</a>, <a class="indexterm" href="#rest-api-crud-identity">Identity Management</a></dt></dl></dd></dl></div></div></div></div><a href="#" class="back-to-top hidden-xs"><button type="button" class="btn btn-primary btn-default"><span class="glyphicon glyphicon-chevron-up"></span></button></a></div></div><div class="footer"><div class="container-fluid"><div class="footer-left"><span class="footer-item">Copyright &copy;
              2011-2013&nbsp;
              ForgeRock AS;&nbsp;
              &nbsp;
              &nbsp;
          </span></div><div class="footer-right"><a target="_blank" class="footer-item snap-left" href="legalnotice.html"><i class="glyphicon glyphicon-briefcase"></i> Legal Notice</a><a target="_blank" class="footer-item snap-left" href="https://github.com/OpenIdentityPlatform/OpenAM/issues"><i class="glyphicon glyphicon-ok-sign"></i> Feedback</a><a target="_blank" class="footer-item snap-left" href="#" data-toggle="modal" data-target="#myModal"><i class="glyphicon glyphicon-info-sign"></i> About</a></div></div></div></body></html>